//! Mirador 0.9.0
//! Built on 2014-04-29
/*! jQuery v1.9.1 | (c) 2005, 2012 jQuery Foundation, Inc. | jquery.org/license
*/
(function(e,t){function n(e){var t=e.length,n=lt.type(e);return lt.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)}function i(e){var t=Ct[e]={};return lt.each(e.match(ct)||[],function(e,n){t[n]=!0}),t}function o(e,n,i,o){if(lt.acceptData(e)){var r,a,s=lt.expando,l="string"==typeof n,u=e.nodeType,c=u?lt.cache:e,d=u?e[s]:e[s]&&s;if(d&&c[d]&&(o||c[d].data)||!l||i!==t)return d||(u?e[s]=d=J.pop()||lt.guid++:d=s),c[d]||(c[d]={},u||(c[d].toJSON=lt.noop)),("object"==typeof n||"function"==typeof n)&&(o?c[d]=lt.extend(c[d],n):c[d].data=lt.extend(c[d].data,n)),r=c[d],o||(r.data||(r.data={}),r=r.data),i!==t&&(r[lt.camelCase(n)]=i),l?(a=r[n],null==a&&(a=r[lt.camelCase(n)])):a=r,a}}function r(e,t,n){if(lt.acceptData(e)){var i,o,r,a=e.nodeType,l=a?lt.cache:e,u=a?e[lt.expando]:lt.expando;if(l[u]){if(t&&(r=n?l[u]:l[u].data)){lt.isArray(t)?t=t.concat(lt.map(t,lt.camelCase)):t in r?t=[t]:(t=lt.camelCase(t),t=t in r?[t]:t.split(" "));for(i=0,o=t.length;o>i;i++)delete r[t[i]];if(!(n?s:lt.isEmptyObject)(r))return}(n||(delete l[u].data,s(l[u])))&&(a?lt.cleanData([e],!0):lt.support.deleteExpando||l!=l.window?delete l[u]:l[u]=null)}}}function a(e,n,i){if(i===t&&1===e.nodeType){var o="data-"+n.replace(Tt,"-$1").toLowerCase();if(i=e.getAttribute(o),"string"==typeof i){try{i="true"===i?!0:"false"===i?!1:"null"===i?null:+i+""===i?+i:St.test(i)?lt.parseJSON(i):i}catch(r){}lt.data(e,n,i)}else i=t}return i}function s(e){var t;for(t in e)if(("data"!==t||!lt.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function l(){return!0}function u(){return!1}function c(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}function d(e,t,n){if(t=t||0,lt.isFunction(t))return lt.grep(e,function(e,i){var o=!!t.call(e,i,e);return o===n});if(t.nodeType)return lt.grep(e,function(e){return e===t===n});if("string"==typeof t){var i=lt.grep(e,function(e){return 1===e.nodeType});if(Wt.test(t))return lt.filter(t,i,!n);t=lt.filter(t,i)}return lt.grep(e,function(e){return lt.inArray(e,t)>=0===n})}function h(e){var t=qt.split("|"),n=e.createDocumentFragment();if(n.createElement)for(;t.length;)n.createElement(t.pop());return n}function p(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function f(e){var t=e.getAttributeNode("type");return e.type=(t&&t.specified)+"/"+e.type,e}function m(e){var t=rn.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function g(e,t){for(var n,i=0;null!=(n=e[i]);i++)lt._data(n,"globalEval",!t||lt._data(t[i],"globalEval"))}function v(e,t){if(1===t.nodeType&&lt.hasData(e)){var n,i,o,r=lt._data(e),a=lt._data(t,r),s=r.events;if(s){delete a.handle,a.events={};for(n in s)for(i=0,o=s[n].length;o>i;i++)lt.event.add(t,n,s[n][i])}a.data&&(a.data=lt.extend({},a.data))}}function y(e,t){var n,i,o;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!lt.support.noCloneEvent&&t[lt.expando]){o=lt._data(t);for(i in o.events)lt.removeEvent(t,i,o.handle);t.removeAttribute(lt.expando)}"script"===n&&t.text!==e.text?(f(t).text=e.text,m(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),lt.support.html5Clone&&e.innerHTML&&!lt.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&tn.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}function b(e,n){var i,o,r=0,a=typeof e.getElementsByTagName!==Q?e.getElementsByTagName(n||"*"):typeof e.querySelectorAll!==Q?e.querySelectorAll(n||"*"):t;if(!a)for(a=[],i=e.childNodes||e;null!=(o=i[r]);r++)!n||lt.nodeName(o,n)?a.push(o):lt.merge(a,b(o,n));return n===t||n&&lt.nodeName(e,n)?lt.merge([e],a):a}function w(e){tn.test(e.type)&&(e.defaultChecked=e.checked)}function x(e,t){if(t in e)return t;for(var n=t.charAt(0).toUpperCase()+t.slice(1),i=t,o=Tn.length;o--;)if(t=Tn[o]+n,t in e)return t;return i}function _(e,t){return e=t||e,"none"===lt.css(e,"display")||!lt.contains(e.ownerDocument,e)}function C(e,t){for(var n,i,o,r=[],a=0,s=e.length;s>a;a++)i=e[a],i.style&&(r[a]=lt._data(i,"olddisplay"),n=i.style.display,t?(r[a]||"none"!==n||(i.style.display=""),""===i.style.display&&_(i)&&(r[a]=lt._data(i,"olddisplay",k(i.nodeName)))):r[a]||(o=_(i),(n&&"none"!==n||!o)&&lt._data(i,"olddisplay",o?n:lt.css(i,"display"))));for(a=0;s>a;a++)i=e[a],i.style&&(t&&"none"!==i.style.display&&""!==i.style.display||(i.style.display=t?r[a]||"":"none"));return e}function S(e,t,n){var i=yn.exec(t);return i?Math.max(0,i[1]-(n||0))+(i[2]||"px"):t}function T(e,t,n,i,o){for(var r=n===(i?"border":"content")?4:"width"===t?1:0,a=0;4>r;r+=2)"margin"===n&&(a+=lt.css(e,n+Sn[r],!0,o)),i?("content"===n&&(a-=lt.css(e,"padding"+Sn[r],!0,o)),"margin"!==n&&(a-=lt.css(e,"border"+Sn[r]+"Width",!0,o))):(a+=lt.css(e,"padding"+Sn[r],!0,o),"padding"!==n&&(a+=lt.css(e,"border"+Sn[r]+"Width",!0,o)));return a}function E(e,t,n){var i=!0,o="width"===t?e.offsetWidth:e.offsetHeight,r=dn(e),a=lt.support.boxSizing&&"border-box"===lt.css(e,"boxSizing",!1,r);if(0>=o||null==o){if(o=hn(e,t,r),(0>o||null==o)&&(o=e.style[t]),bn.test(o))return o;i=a&&(lt.support.boxSizingReliable||o===e.style[t]),o=parseFloat(o)||0}return o+T(e,t,n||(a?"border":"content"),i,r)+"px"}function k(e){var t=G,n=xn[e];return n||(n=N(e,t),"none"!==n&&n||(cn=(cn||lt("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(cn[0].contentWindow||cn[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=N(e,t),cn.detach()),xn[e]=n),n}function N(e,t){var n=lt(t.createElement(e)).appendTo(t.body),i=lt.css(n[0],"display");return n.remove(),i}function A(e,t,n,i){var o;if(lt.isArray(t))lt.each(t,function(t,o){n||kn.test(e)?i(e,o):A(e+"["+("object"==typeof o?t:"")+"]",o,n,i)});else if(n||"object"!==lt.type(t))i(e,t);else for(o in t)A(e+"["+o+"]",t[o],n,i)}function M(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var i,o=0,r=t.toLowerCase().match(ct)||[];if(lt.isFunction(n))for(;i=r[o++];)"+"===i[0]?(i=i.slice(1)||"*",(e[i]=e[i]||[]).unshift(n)):(e[i]=e[i]||[]).push(n)}}function P(e,n,i,o){function r(l){var u;return a[l]=!0,lt.each(e[l]||[],function(e,l){var c=l(n,i,o);return"string"!=typeof c||s||a[c]?s?!(u=c):t:(n.dataTypes.unshift(c),r(c),!1)}),u}var a={},s=e===Vn;return r(n.dataTypes[0])||!a["*"]&&r("*")}function R(e,n){var i,o,r=lt.ajaxSettings.flatOptions||{};for(o in n)n[o]!==t&&((r[o]?e:i||(i={}))[o]=n[o]);return i&&lt.extend(!0,e,i),e}function O(e,n,i){var o,r,a,s,l=e.contents,u=e.dataTypes,c=e.responseFields;for(s in c)s in i&&(n[c[s]]=i[s]);for(;"*"===u[0];)u.shift(),r===t&&(r=e.mimeType||n.getResponseHeader("Content-Type"));if(r)for(s in l)if(l[s]&&l[s].test(r)){u.unshift(s);break}if(u[0]in i)a=u[0];else{for(s in i){if(!u[0]||e.converters[s+" "+u[0]]){a=s;break}o||(o=s)}a=a||o}return a?(a!==u[0]&&u.unshift(a),i[a]):t}function I(e,t){var n,i,o,r,a={},s=0,l=e.dataTypes.slice(),u=l[0];if(e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l[1])for(o in e.converters)a[o.toLowerCase()]=e.converters[o];for(;i=l[++s];)if("*"!==i){if("*"!==u&&u!==i){if(o=a[u+" "+i]||a["* "+i],!o)for(n in a)if(r=n.split(" "),r[1]===i&&(o=a[u+" "+r[0]]||a["* "+r[0]])){o===!0?o=a[n]:a[n]!==!0&&(i=r[0],l.splice(s--,0,i));break}if(o!==!0)if(o&&e["throws"])t=o(t);else try{t=o(t)}catch(c){return{state:"parsererror",error:o?c:"No conversion from "+u+" to "+i}}}u=i}return{state:"success",data:t}}function D(){try{return new e.XMLHttpRequest}catch(t){}}function H(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function L(){return setTimeout(function(){Jn=t}),Jn=lt.now()}function z(e,t){lt.each(t,function(t,n){for(var i=(ri[t]||[]).concat(ri["*"]),o=0,r=i.length;r>o;o++)if(i[o].call(e,t,n))return})}function B(e,t,n){var i,o,r=0,a=oi.length,s=lt.Deferred().always(function(){delete l.elem}),l=function(){if(o)return!1;for(var t=Jn||L(),n=Math.max(0,u.startTime+u.duration-t),i=n/u.duration||0,r=1-i,a=0,l=u.tweens.length;l>a;a++)u.tweens[a].run(r);return s.notifyWith(e,[u,r,n]),1>r&&l?n:(s.resolveWith(e,[u]),!1)},u=s.promise({elem:e,props:lt.extend({},t),opts:lt.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Jn||L(),duration:n.duration,tweens:[],createTween:function(t,n){var i=lt.Tween(e,u.opts,t,n,u.opts.specialEasing[t]||u.opts.easing);return u.tweens.push(i),i},stop:function(t){var n=0,i=t?u.tweens.length:0;if(o)return this;for(o=!0;i>n;n++)u.tweens[n].run(1);return t?s.resolveWith(e,[u,t]):s.rejectWith(e,[u,t]),this}}),c=u.props;for(F(c,u.opts.specialEasing);a>r;r++)if(i=oi[r].call(u,e,c,u.opts))return i;return z(u,c),lt.isFunction(u.opts.start)&&u.opts.start.call(e,u),lt.fx.timer(lt.extend(l,{elem:e,anim:u,queue:u.opts.queue})),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always)}function F(e,t){var n,i,o,r,a;for(o in e)if(i=lt.camelCase(o),r=t[i],n=e[o],lt.isArray(n)&&(r=n[1],n=e[o]=n[0]),o!==i&&(e[i]=n,delete e[o]),a=lt.cssHooks[i],a&&"expand"in a){n=a.expand(n),delete e[i];for(o in n)o in e||(e[o]=n[o],t[o]=r)}else t[i]=r}function j(e,t,n){var i,o,r,a,s,l,u,c,d,h=this,p=e.style,f={},m=[],g=e.nodeType&&_(e);n.queue||(c=lt._queueHooks(e,"fx"),null==c.unqueued&&(c.unqueued=0,d=c.empty.fire,c.empty.fire=function(){c.unqueued||d()}),c.unqueued++,h.always(function(){h.always(function(){c.unqueued--,lt.queue(e,"fx").length||c.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],"inline"===lt.css(e,"display")&&"none"===lt.css(e,"float")&&(lt.support.inlineBlockNeedsLayout&&"inline"!==k(e.nodeName)?p.zoom=1:p.display="inline-block")),n.overflow&&(p.overflow="hidden",lt.support.shrinkWrapBlocks||h.always(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(o in t)if(a=t[o],ti.exec(a)){if(delete t[o],l=l||"toggle"===a,a===(g?"hide":"show"))continue;m.push(o)}if(r=m.length){s=lt._data(e,"fxshow")||lt._data(e,"fxshow",{}),"hidden"in s&&(g=s.hidden),l&&(s.hidden=!g),g?lt(e).show():h.done(function(){lt(e).hide()}),h.done(function(){var t;lt._removeData(e,"fxshow");for(t in f)lt.style(e,t,f[t])});for(o=0;r>o;o++)i=m[o],u=h.createTween(i,g?s[i]:0),f[i]=s[i]||lt.style(e,i),i in s||(s[i]=u.start,g&&(u.end=u.start,u.start="width"===i||"height"===i?1:0))}}function U(e,t,n,i,o){return new U.prototype.init(e,t,n,i,o)}function W(e,t){var n,i={height:e},o=0;for(t=t?1:0;4>o;o+=2-t)n=Sn[o],i["margin"+n]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function V(e){return lt.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}var $,q,Q=typeof t,G=e.document,X=e.location,Y=e.jQuery,Z=e.$,K={},J=[],et="1.9.1",tt=J.concat,nt=J.push,it=J.slice,ot=J.indexOf,rt=K.toString,at=K.hasOwnProperty,st=et.trim,lt=function(e,t){return new lt.fn.init(e,t,q)},ut=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ct=/\S+/g,dt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,ht=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,pt=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,ft=/^[\],:{}\s]*$/,mt=/(?:^|:|,)(?:\s*\[)+/g,gt=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,vt=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,yt=/^-ms-/,bt=/-([\da-z])/gi,wt=function(e,t){return t.toUpperCase()},xt=function(e){(G.addEventListener||"load"===e.type||"complete"===G.readyState)&&(_t(),lt.ready())},_t=function(){G.addEventListener?(G.removeEventListener("DOMContentLoaded",xt,!1),e.removeEventListener("load",xt,!1)):(G.detachEvent("onreadystatechange",xt),e.detachEvent("onload",xt))};lt.fn=lt.prototype={jquery:et,constructor:lt,init:function(e,n,i){var o,r;if(!e)return this;if("string"==typeof e){if(o="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:ht.exec(e),!o||!o[1]&&n)return!n||n.jquery?(n||i).find(e):this.constructor(n).find(e);if(o[1]){if(n=n instanceof lt?n[0]:n,lt.merge(this,lt.parseHTML(o[1],n&&n.nodeType?n.ownerDocument||n:G,!0)),pt.test(o[1])&&lt.isPlainObject(n))for(o in n)lt.isFunction(this[o])?this[o](n[o]):this.attr(o,n[o]);return this}if(r=G.getElementById(o[2]),r&&r.parentNode){if(r.id!==o[2])return i.find(e);this.length=1,this[0]=r}return this.context=G,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):lt.isFunction(e)?i.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),lt.makeArray(e,this))},selector:"",length:0,size:function(){return this.length},toArray:function(){return it.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=lt.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return lt.each(this,e,t)},ready:function(e){return lt.ready.promise().done(e),this},slice:function(){return this.pushStack(it.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},map:function(e){return this.pushStack(lt.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:nt,sort:[].sort,splice:[].splice},lt.fn.init.prototype=lt.fn,lt.extend=lt.fn.extend=function(){var e,n,i,o,r,a,s=arguments[0]||{},l=1,u=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[1]||{},l=2),"object"==typeof s||lt.isFunction(s)||(s={}),u===l&&(s=this,--l);u>l;l++)if(null!=(r=arguments[l]))for(o in r)e=s[o],i=r[o],s!==i&&(c&&i&&(lt.isPlainObject(i)||(n=lt.isArray(i)))?(n?(n=!1,a=e&&lt.isArray(e)?e:[]):a=e&&lt.isPlainObject(e)?e:{},s[o]=lt.extend(c,a,i)):i!==t&&(s[o]=i));return s},lt.extend({noConflict:function(t){return e.$===lt&&(e.$=Z),t&&e.jQuery===lt&&(e.jQuery=Y),lt},isReady:!1,readyWait:1,holdReady:function(e){e?lt.readyWait++:lt.ready(!0)},ready:function(e){if(e===!0?!--lt.readyWait:!lt.isReady){if(!G.body)return setTimeout(lt.ready);lt.isReady=!0,e!==!0&&--lt.readyWait>0||($.resolveWith(G,[lt]),lt.fn.trigger&&lt(G).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===lt.type(e)},isArray:Array.isArray||function(e){return"array"===lt.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?K[rt.call(e)]||"object":typeof e},isPlainObject:function(e){if(!e||"object"!==lt.type(e)||e.nodeType||lt.isWindow(e))return!1;try{if(e.constructor&&!at.call(e,"constructor")&&!at.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var i;for(i in e);return i===t||at.call(e,i)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||G;var i=pt.exec(e),o=!n&&[];return i?[t.createElement(i[1])]:(i=lt.buildFragment([e],t,o),o&&lt(o).remove(),lt.merge([],i.childNodes))},parseJSON:function(n){return e.JSON&&e.JSON.parse?e.JSON.parse(n):null===n?n:"string"==typeof n&&(n=lt.trim(n),n&&ft.test(n.replace(gt,"@").replace(vt,"]").replace(mt,"")))?Function("return "+n)():(lt.error("Invalid JSON: "+n),t)},parseXML:function(n){var i,o;if(!n||"string"!=typeof n)return null;try{e.DOMParser?(o=new DOMParser,i=o.parseFromString(n,"text/xml")):(i=new ActiveXObject("Microsoft.XMLDOM"),i.async="false",i.loadXML(n))}catch(r){i=t}return i&&i.documentElement&&!i.getElementsByTagName("parsererror").length||lt.error("Invalid XML: "+n),i},noop:function(){},globalEval:function(t){t&&lt.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(yt,"ms-").replace(bt,wt)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,i){var o,r=0,a=e.length,s=n(e);if(i){if(s)for(;a>r&&(o=t.apply(e[r],i),o!==!1);r++);else for(r in e)if(o=t.apply(e[r],i),o===!1)break}else if(s)for(;a>r&&(o=t.call(e[r],r,e[r]),o!==!1);r++);else for(r in e)if(o=t.call(e[r],r,e[r]),o===!1)break;return e},trim:st&&!st.call("﻿ ")?function(e){return null==e?"":st.call(e)}:function(e){return null==e?"":(e+"").replace(dt,"")},makeArray:function(e,t){var i=t||[];return null!=e&&(n(Object(e))?lt.merge(i,"string"==typeof e?[e]:e):nt.call(i,e)),i},inArray:function(e,t,n){var i;if(t){if(ot)return ot.call(t,e,n);for(i=t.length,n=n?0>n?Math.max(0,i+n):n:0;i>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var i=n.length,o=e.length,r=0;if("number"==typeof i)for(;i>r;r++)e[o++]=n[r];else for(;n[r]!==t;)e[o++]=n[r++];return e.length=o,e},grep:function(e,t,n){var i,o=[],r=0,a=e.length;for(n=!!n;a>r;r++)i=!!t(e[r],r),n!==i&&o.push(e[r]);return o},map:function(e,t,i){var o,r=0,a=e.length,s=n(e),l=[];if(s)for(;a>r;r++)o=t(e[r],r,i),null!=o&&(l[l.length]=o);else for(r in e)o=t(e[r],r,i),null!=o&&(l[l.length]=o);return tt.apply([],l)},guid:1,proxy:function(e,n){var i,o,r;return"string"==typeof n&&(r=e[n],n=e,e=r),lt.isFunction(e)?(i=it.call(arguments,2),o=function(){return e.apply(n||this,i.concat(it.call(arguments)))},o.guid=e.guid=e.guid||lt.guid++,o):t},access:function(e,n,i,o,r,a,s){var l=0,u=e.length,c=null==i;if("object"===lt.type(i)){r=!0;for(l in i)lt.access(e,n,l,i[l],!0,a,s)}else if(o!==t&&(r=!0,lt.isFunction(o)||(s=!0),c&&(s?(n.call(e,o),n=null):(c=n,n=function(e,t,n){return c.call(lt(e),n)})),n))for(;u>l;l++)n(e[l],i,s?o:o.call(e[l],l,n(e[l],i)));return r?e:c?n.call(e):u?n(e[0],i):a},now:function(){return(new Date).getTime()}}),lt.ready.promise=function(t){if(!$)if($=lt.Deferred(),"complete"===G.readyState)setTimeout(lt.ready);else if(G.addEventListener)G.addEventListener("DOMContentLoaded",xt,!1),e.addEventListener("load",xt,!1);else{G.attachEvent("onreadystatechange",xt),e.attachEvent("onload",xt);var n=!1;try{n=null==e.frameElement&&G.documentElement}catch(i){}n&&n.doScroll&&function o(){if(!lt.isReady){try{n.doScroll("left")}catch(e){return setTimeout(o,50)}_t(),lt.ready()}}()}return $.promise(t)},lt.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){K["[object "+t+"]"]=t.toLowerCase()}),q=lt(G);var Ct={};lt.Callbacks=function(e){e="string"==typeof e?Ct[e]||i(e):lt.extend({},e);var n,o,r,a,s,l,u=[],c=!e.once&&[],d=function(t){for(o=e.memory&&t,r=!0,s=l||0,l=0,a=u.length,n=!0;u&&a>s;s++)if(u[s].apply(t[0],t[1])===!1&&e.stopOnFalse){o=!1;break}n=!1,u&&(c?c.length&&d(c.shift()):o?u=[]:h.disable())},h={add:function(){if(u){var t=u.length;(function i(t){lt.each(t,function(t,n){var o=lt.type(n);"function"===o?e.unique&&h.has(n)||u.push(n):n&&n.length&&"string"!==o&&i(n)})})(arguments),n?a=u.length:o&&(l=t,d(o))}return this},remove:function(){return u&&lt.each(arguments,function(e,t){for(var i;(i=lt.inArray(t,u,i))>-1;)u.splice(i,1),n&&(a>=i&&a--,s>=i&&s--)}),this},has:function(e){return e?lt.inArray(e,u)>-1:!(!u||!u.length)},empty:function(){return u=[],this},disable:function(){return u=c=o=t,this},disabled:function(){return!u},lock:function(){return c=t,o||h.disable(),this},locked:function(){return!c},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],!u||r&&!c||(n?c.push(t):d(t)),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!r}};return h},lt.extend({Deferred:function(e){var t=[["resolve","done",lt.Callbacks("once memory"),"resolved"],["reject","fail",lt.Callbacks("once memory"),"rejected"],["notify","progress",lt.Callbacks("memory")]],n="pending",i={state:function(){return n},always:function(){return o.done(arguments).fail(arguments),this},then:function(){var e=arguments;return lt.Deferred(function(n){lt.each(t,function(t,r){var a=r[0],s=lt.isFunction(e[t])&&e[t];o[r[1]](function(){var e=s&&s.apply(this,arguments);e&&lt.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[a+"With"](this===i?n.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?lt.extend(e,i):i}},o={};return i.pipe=i.then,lt.each(t,function(e,r){var a=r[2],s=r[3];i[r[1]]=a.add,s&&a.add(function(){n=s},t[1^e][2].disable,t[2][2].lock),o[r[0]]=function(){return o[r[0]+"With"](this===o?i:this,arguments),this},o[r[0]+"With"]=a.fireWith}),i.promise(o),e&&e.call(o,o),o},when:function(e){var t,n,i,o=0,r=it.call(arguments),a=r.length,s=1!==a||e&&lt.isFunction(e.promise)?a:0,l=1===s?e:lt.Deferred(),u=function(e,n,i){return function(o){n[e]=this,i[e]=arguments.length>1?it.call(arguments):o,i===t?l.notifyWith(n,i):--s||l.resolveWith(n,i)}};if(a>1)for(t=Array(a),n=Array(a),i=Array(a);a>o;o++)r[o]&&lt.isFunction(r[o].promise)?r[o].promise().done(u(o,i,r)).fail(l.reject).progress(u(o,n,t)):--s;return s||l.resolveWith(i,r),l.promise()}}),lt.support=function(){var t,n,i,o,r,a,s,l,u,c,d=G.createElement("div");if(d.setAttribute("className","t"),d.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=d.getElementsByTagName("*"),i=d.getElementsByTagName("a")[0],!n||!i||!n.length)return{};r=G.createElement("select"),s=r.appendChild(G.createElement("option")),o=d.getElementsByTagName("input")[0],i.style.cssText="top:1px;float:left;opacity:.5",t={getSetAttribute:"t"!==d.className,leadingWhitespace:3===d.firstChild.nodeType,tbody:!d.getElementsByTagName("tbody").length,htmlSerialize:!!d.getElementsByTagName("link").length,style:/top/.test(i.getAttribute("style")),hrefNormalized:"/a"===i.getAttribute("href"),opacity:/^0.5/.test(i.style.opacity),cssFloat:!!i.style.cssFloat,checkOn:!!o.value,optSelected:s.selected,enctype:!!G.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==G.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===G.compatMode,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},o.checked=!0,t.noCloneChecked=o.cloneNode(!0).checked,r.disabled=!0,t.optDisabled=!s.disabled;try{delete d.test}catch(h){t.deleteExpando=!1}o=G.createElement("input"),o.setAttribute("value",""),t.input=""===o.getAttribute("value"),o.value="t",o.setAttribute("type","radio"),t.radioValue="t"===o.value,o.setAttribute("checked","t"),o.setAttribute("name","t"),a=G.createDocumentFragment(),a.appendChild(o),t.appendChecked=o.checked,t.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,d.attachEvent&&(d.attachEvent("onclick",function(){t.noCloneEvent=!1}),d.cloneNode(!0).click());for(c in{submit:!0,change:!0,focusin:!0})d.setAttribute(l="on"+c,"t"),t[c+"Bubbles"]=l in e||d.attributes[l].expando===!1;return d.style.backgroundClip="content-box",d.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===d.style.backgroundClip,lt(function(){var n,i,o,r="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",a=G.getElementsByTagName("body")[0];a&&(n=G.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",a.appendChild(n).appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",o=d.getElementsByTagName("td"),o[0].style.cssText="padding:0;margin:0;border:0;display:none",u=0===o[0].offsetHeight,o[0].style.display="",o[1].style.display="none",t.reliableHiddenOffsets=u&&0===o[0].offsetHeight,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=4===d.offsetWidth,t.doesNotIncludeMarginInBodyOffset=1!==a.offsetTop,e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(d,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(d,null)||{width:"4px"}).width,i=d.appendChild(G.createElement("div")),i.style.cssText=d.style.cssText=r,i.style.marginRight=i.style.width="0",d.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(i,null)||{}).marginRight)),typeof d.style.zoom!==Q&&(d.innerHTML="",d.style.cssText=r+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=3===d.offsetWidth,d.style.display="block",d.innerHTML="<div></div>",d.firstChild.style.width="5px",t.shrinkWrapBlocks=3!==d.offsetWidth,t.inlineBlockNeedsLayout&&(a.style.zoom=1)),a.removeChild(n),n=d=o=i=null)}),n=r=a=s=i=o=null,t}();var St=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,Tt=/([A-Z])/g;lt.extend({cache:{},expando:"jQuery"+(et+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?lt.cache[e[lt.expando]]:e[lt.expando],!!e&&!s(e)},data:function(e,t,n){return o(e,t,n)},removeData:function(e,t){return r(e,t)},_data:function(e,t,n){return o(e,t,n,!0)},_removeData:function(e,t){return r(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType)return!1;var t=e.nodeName&&lt.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),lt.fn.extend({data:function(e,n){var i,o,r=this[0],s=0,l=null;if(e===t){if(this.length&&(l=lt.data(r),1===r.nodeType&&!lt._data(r,"parsedAttrs"))){for(i=r.attributes;i.length>s;s++)o=i[s].name,o.indexOf("data-")||(o=lt.camelCase(o.slice(5)),a(r,o,l[o]));lt._data(r,"parsedAttrs",!0)}return l}return"object"==typeof e?this.each(function(){lt.data(this,e)}):lt.access(this,function(n){return n===t?r?a(r,e,lt.data(r,e)):null:(this.each(function(){lt.data(this,e,n)}),t)},null,n,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){lt.removeData(this,e)})}}),lt.extend({queue:function(e,n,i){var o;return e?(n=(n||"fx")+"queue",o=lt._data(e,n),i&&(!o||lt.isArray(i)?o=lt._data(e,n,lt.makeArray(i)):o.push(i)),o||[]):t},dequeue:function(e,t){t=t||"fx";var n=lt.queue(e,t),i=n.length,o=n.shift(),r=lt._queueHooks(e,t),a=function(){lt.dequeue(e,t)};"inprogress"===o&&(o=n.shift(),i--),r.cur=o,o&&("fx"===t&&n.unshift("inprogress"),delete r.stop,o.call(e,a,r)),!i&&r&&r.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return lt._data(e,n)||lt._data(e,n,{empty:lt.Callbacks("once memory").add(function(){lt._removeData(e,t+"queue"),lt._removeData(e,n)})})}}),lt.fn.extend({queue:function(e,n){var i=2;return"string"!=typeof e&&(n=e,e="fx",i--),i>arguments.length?lt.queue(this[0],e):n===t?this:this.each(function(){var t=lt.queue(this,e,n);lt._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&lt.dequeue(this,e)})},dequeue:function(e){return this.each(function(){lt.dequeue(this,e)})},delay:function(e,t){return e=lt.fx?lt.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var i=setTimeout(t,e);n.stop=function(){clearTimeout(i)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var i,o=1,r=lt.Deferred(),a=this,s=this.length,l=function(){--o||r.resolveWith(a,[a])};for("string"!=typeof e&&(n=e,e=t),e=e||"fx";s--;)i=lt._data(a[s],e+"queueHooks"),i&&i.empty&&(o++,i.empty.add(l));return l(),r.promise(n)}});var Et,kt,Nt=/[\t\r\n]/g,At=/\r/g,Mt=/^(?:input|select|textarea|button|object)$/i,Pt=/^(?:a|area)$/i,Rt=/^(?:checked|selected|autofocus|autoplay|async|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped)$/i,Ot=/^(?:checked|selected)$/i,It=lt.support.getSetAttribute,Dt=lt.support.input;lt.fn.extend({attr:function(e,t){return lt.access(this,lt.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){lt.removeAttr(this,e)})},prop:function(e,t){return lt.access(this,lt.prop,e,t,arguments.length>1)},removeProp:function(e){return e=lt.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,i,o,r,a=0,s=this.length,l="string"==typeof e&&e;if(lt.isFunction(e))return this.each(function(t){lt(this).addClass(e.call(this,t,this.className))});if(l)for(t=(e||"").match(ct)||[];s>a;a++)if(n=this[a],i=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(Nt," "):" ")){for(r=0;o=t[r++];)0>i.indexOf(" "+o+" ")&&(i+=o+" ");n.className=lt.trim(i)}return this},removeClass:function(e){var t,n,i,o,r,a=0,s=this.length,l=0===arguments.length||"string"==typeof e&&e;if(lt.isFunction(e))return this.each(function(t){lt(this).removeClass(e.call(this,t,this.className))});if(l)for(t=(e||"").match(ct)||[];s>a;a++)if(n=this[a],i=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(Nt," "):"")){for(r=0;o=t[r++];)for(;i.indexOf(" "+o+" ")>=0;)i=i.replace(" "+o+" "," ");n.className=e?lt.trim(i):""}return this},toggleClass:function(e,t){var n=typeof e,i="boolean"==typeof t;return lt.isFunction(e)?this.each(function(n){lt(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n)for(var o,r=0,a=lt(this),s=t,l=e.match(ct)||[];o=l[r++];)s=i?s:!a.hasClass(o),a[s?"addClass":"removeClass"](o);else(n===Q||"boolean"===n)&&(this.className&&lt._data(this,"__className__",this.className),this.className=this.className||e===!1?"":lt._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",n=0,i=this.length;i>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(Nt," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,i,o,r=this[0];return arguments.length?(o=lt.isFunction(e),this.each(function(n){var r,a=lt(this);1===this.nodeType&&(r=o?e.call(this,n,a.val()):e,null==r?r="":"number"==typeof r?r+="":lt.isArray(r)&&(r=lt.map(r,function(e){return null==e?"":e+""})),i=lt.valHooks[this.type]||lt.valHooks[this.nodeName.toLowerCase()],i&&"set"in i&&i.set(this,r,"value")!==t||(this.value=r))})):r?(i=lt.valHooks[r.type]||lt.valHooks[r.nodeName.toLowerCase()],i&&"get"in i&&(n=i.get(r,"value"))!==t?n:(n=r.value,"string"==typeof n?n.replace(At,""):null==n?"":n)):void 0}}),lt.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){for(var t,n,i=e.options,o=e.selectedIndex,r="select-one"===e.type||0>o,a=r?null:[],s=r?o+1:i.length,l=0>o?s:r?o:0;s>l;l++)if(n=i[l],!(!n.selected&&l!==o||(lt.support.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&lt.nodeName(n.parentNode,"optgroup"))){if(t=lt(n).val(),r)return t;a.push(t)}return a},set:function(e,t){var n=lt.makeArray(t);return lt(e).find("option").each(function(){this.selected=lt.inArray(lt(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attr:function(e,n,i){var o,r,a,s=e.nodeType;return e&&3!==s&&8!==s&&2!==s?typeof e.getAttribute===Q?lt.prop(e,n,i):(r=1!==s||!lt.isXMLDoc(e),r&&(n=n.toLowerCase(),o=lt.attrHooks[n]||(Rt.test(n)?kt:Et)),i===t?o&&r&&"get"in o&&null!==(a=o.get(e,n))?a:(typeof e.getAttribute!==Q&&(a=e.getAttribute(n)),null==a?t:a):null!==i?o&&r&&"set"in o&&(a=o.set(e,i,n))!==t?a:(e.setAttribute(n,i+""),i):(lt.removeAttr(e,n),t)):void 0},removeAttr:function(e,t){var n,i,o=0,r=t&&t.match(ct);if(r&&1===e.nodeType)for(;n=r[o++];)i=lt.propFix[n]||n,Rt.test(n)?!It&&Ot.test(n)?e[lt.camelCase("default-"+n)]=e[i]=!1:e[i]=!1:lt.attr(e,n,""),e.removeAttribute(It?n:i)},attrHooks:{type:{set:function(e,t){if(!lt.support.radioValue&&"radio"===t&&lt.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,i){var o,r,a,s=e.nodeType;return e&&3!==s&&8!==s&&2!==s?(a=1!==s||!lt.isXMLDoc(e),a&&(n=lt.propFix[n]||n,r=lt.propHooks[n]),i!==t?r&&"set"in r&&(o=r.set(e,i,n))!==t?o:e[n]=i:r&&"get"in r&&null!==(o=r.get(e,n))?o:e[n]):void 0},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):Mt.test(e.nodeName)||Pt.test(e.nodeName)&&e.href?0:t}}}}),kt={get:function(e,n){var i=lt.prop(e,n),o="boolean"==typeof i&&e.getAttribute(n),r="boolean"==typeof i?Dt&&It?null!=o:Ot.test(n)?e[lt.camelCase("default-"+n)]:!!o:e.getAttributeNode(n);return r&&r.value!==!1?n.toLowerCase():t
},set:function(e,t,n){return t===!1?lt.removeAttr(e,n):Dt&&It||!Ot.test(n)?e.setAttribute(!It&&lt.propFix[n]||n,n):e[lt.camelCase("default-"+n)]=e[n]=!0,n}},Dt&&It||(lt.attrHooks.value={get:function(e,n){var i=e.getAttributeNode(n);return lt.nodeName(e,"input")?e.defaultValue:i&&i.specified?i.value:t},set:function(e,n,i){return lt.nodeName(e,"input")?(e.defaultValue=n,t):Et&&Et.set(e,n,i)}}),It||(Et=lt.valHooks.button={get:function(e,n){var i=e.getAttributeNode(n);return i&&("id"===n||"name"===n||"coords"===n?""!==i.value:i.specified)?i.value:t},set:function(e,n,i){var o=e.getAttributeNode(i);return o||e.setAttributeNode(o=e.ownerDocument.createAttribute(i)),o.value=n+="","value"===i||n===e.getAttribute(i)?n:t}},lt.attrHooks.contenteditable={get:Et.get,set:function(e,t,n){Et.set(e,""===t?!1:t,n)}},lt.each(["width","height"],function(e,n){lt.attrHooks[n]=lt.extend(lt.attrHooks[n],{set:function(e,i){return""===i?(e.setAttribute(n,"auto"),i):t}})})),lt.support.hrefNormalized||(lt.each(["href","src","width","height"],function(e,n){lt.attrHooks[n]=lt.extend(lt.attrHooks[n],{get:function(e){var i=e.getAttribute(n,2);return null==i?t:i}})}),lt.each(["href","src"],function(e,t){lt.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}})),lt.support.style||(lt.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),lt.support.optSelected||(lt.propHooks.selected=lt.extend(lt.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),lt.support.enctype||(lt.propFix.enctype="encoding"),lt.support.checkOn||lt.each(["radio","checkbox"],function(){lt.valHooks[this]={get:function(e){return null===e.getAttribute("value")?"on":e.value}}}),lt.each(["radio","checkbox"],function(){lt.valHooks[this]=lt.extend(lt.valHooks[this],{set:function(e,n){return lt.isArray(n)?e.checked=lt.inArray(lt(e).val(),n)>=0:t}})});var Ht=/^(?:input|select|textarea)$/i,Lt=/^key/,zt=/^(?:mouse|contextmenu)|click/,Bt=/^(?:focusinfocus|focusoutblur)$/,Ft=/^([^.]*)(?:\.(.+)|)$/;lt.event={global:{},add:function(e,n,i,o,r){var a,s,l,u,c,d,h,p,f,m,g,v=lt._data(e);if(v){for(i.handler&&(u=i,i=u.handler,r=u.selector),i.guid||(i.guid=lt.guid++),(s=v.events)||(s=v.events={}),(d=v.handle)||(d=v.handle=function(e){return typeof lt===Q||e&&lt.event.triggered===e.type?t:lt.event.dispatch.apply(d.elem,arguments)},d.elem=e),n=(n||"").match(ct)||[""],l=n.length;l--;)a=Ft.exec(n[l])||[],f=g=a[1],m=(a[2]||"").split(".").sort(),c=lt.event.special[f]||{},f=(r?c.delegateType:c.bindType)||f,c=lt.event.special[f]||{},h=lt.extend({type:f,origType:g,data:o,handler:i,guid:i.guid,selector:r,needsContext:r&&lt.expr.match.needsContext.test(r),namespace:m.join(".")},u),(p=s[f])||(p=s[f]=[],p.delegateCount=0,c.setup&&c.setup.call(e,o,m,d)!==!1||(e.addEventListener?e.addEventListener(f,d,!1):e.attachEvent&&e.attachEvent("on"+f,d))),c.add&&(c.add.call(e,h),h.handler.guid||(h.handler.guid=i.guid)),r?p.splice(p.delegateCount++,0,h):p.push(h),lt.event.global[f]=!0;e=null}},remove:function(e,t,n,i,o){var r,a,s,l,u,c,d,h,p,f,m,g=lt.hasData(e)&&lt._data(e);if(g&&(c=g.events)){for(t=(t||"").match(ct)||[""],u=t.length;u--;)if(s=Ft.exec(t[u])||[],p=m=s[1],f=(s[2]||"").split(".").sort(),p){for(d=lt.event.special[p]||{},p=(i?d.delegateType:d.bindType)||p,h=c[p]||[],s=s[2]&&RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),l=r=h.length;r--;)a=h[r],!o&&m!==a.origType||n&&n.guid!==a.guid||s&&!s.test(a.namespace)||i&&i!==a.selector&&("**"!==i||!a.selector)||(h.splice(r,1),a.selector&&h.delegateCount--,d.remove&&d.remove.call(e,a));l&&!h.length&&(d.teardown&&d.teardown.call(e,f,g.handle)!==!1||lt.removeEvent(e,p,g.handle),delete c[p])}else for(p in c)lt.event.remove(e,p+t[u],n,i,!0);lt.isEmptyObject(c)&&(delete g.handle,lt._removeData(e,"events"))}},trigger:function(n,i,o,r){var a,s,l,u,c,d,h,p=[o||G],f=at.call(n,"type")?n.type:n,m=at.call(n,"namespace")?n.namespace.split("."):[];if(l=d=o=o||G,3!==o.nodeType&&8!==o.nodeType&&!Bt.test(f+lt.event.triggered)&&(f.indexOf(".")>=0&&(m=f.split("."),f=m.shift(),m.sort()),s=0>f.indexOf(":")&&"on"+f,n=n[lt.expando]?n:new lt.Event(f,"object"==typeof n&&n),n.isTrigger=!0,n.namespace=m.join("."),n.namespace_re=n.namespace?RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=t,n.target||(n.target=o),i=null==i?[n]:lt.makeArray(i,[n]),c=lt.event.special[f]||{},r||!c.trigger||c.trigger.apply(o,i)!==!1)){if(!r&&!c.noBubble&&!lt.isWindow(o)){for(u=c.delegateType||f,Bt.test(u+f)||(l=l.parentNode);l;l=l.parentNode)p.push(l),d=l;d===(o.ownerDocument||G)&&p.push(d.defaultView||d.parentWindow||e)}for(h=0;(l=p[h++])&&!n.isPropagationStopped();)n.type=h>1?u:c.bindType||f,a=(lt._data(l,"events")||{})[n.type]&&lt._data(l,"handle"),a&&a.apply(l,i),a=s&&l[s],a&&lt.acceptData(l)&&a.apply&&a.apply(l,i)===!1&&n.preventDefault();if(n.type=f,!(r||n.isDefaultPrevented()||c._default&&c._default.apply(o.ownerDocument,i)!==!1||"click"===f&&lt.nodeName(o,"a")||!lt.acceptData(o)||!s||!o[f]||lt.isWindow(o))){d=o[s],d&&(o[s]=null),lt.event.triggered=f;try{o[f]()}catch(g){}lt.event.triggered=t,d&&(o[s]=d)}return n.result}},dispatch:function(e){e=lt.event.fix(e);var n,i,o,r,a,s=[],l=it.call(arguments),u=(lt._data(this,"events")||{})[e.type]||[],c=lt.event.special[e.type]||{};if(l[0]=e,e.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,e)!==!1){for(s=lt.event.handlers.call(this,e,u),n=0;(r=s[n++])&&!e.isPropagationStopped();)for(e.currentTarget=r.elem,a=0;(o=r.handlers[a++])&&!e.isImmediatePropagationStopped();)(!e.namespace_re||e.namespace_re.test(o.namespace))&&(e.handleObj=o,e.data=o.data,i=((lt.event.special[o.origType]||{}).handle||o.handler).apply(r.elem,l),i!==t&&(e.result=i)===!1&&(e.preventDefault(),e.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,n){var i,o,r,a,s=[],l=n.delegateCount,u=e.target;if(l&&u.nodeType&&(!e.button||"click"!==e.type))for(;u!=this;u=u.parentNode||this)if(1===u.nodeType&&(u.disabled!==!0||"click"!==e.type)){for(r=[],a=0;l>a;a++)o=n[a],i=o.selector+" ",r[i]===t&&(r[i]=o.needsContext?lt(i,this).index(u)>=0:lt.find(i,this,null,[u]).length),r[i]&&r.push(o);r.length&&s.push({elem:u,handlers:r})}return n.length>l&&s.push({elem:this,handlers:n.slice(l)}),s},fix:function(e){if(e[lt.expando])return e;var t,n,i,o=e.type,r=e,a=this.fixHooks[o];for(a||(this.fixHooks[o]=a=zt.test(o)?this.mouseHooks:Lt.test(o)?this.keyHooks:{}),i=a.props?this.props.concat(a.props):this.props,e=new lt.Event(r),t=i.length;t--;)n=i[t],e[n]=r[n];return e.target||(e.target=r.srcElement||G),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,a.filter?a.filter(e,r):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var i,o,r,a=n.button,s=n.fromElement;return null==e.pageX&&null!=n.clientX&&(o=e.target.ownerDocument||G,r=o.documentElement,i=o.body,e.pageX=n.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0),e.pageY=n.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)),!e.relatedTarget&&s&&(e.relatedTarget=s===e.target?n.toElement:s),e.which||a===t||(e.which=1&a?1:2&a?3:4&a?2:0),e}},special:{load:{noBubble:!0},click:{trigger:function(){return lt.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):t}},focus:{trigger:function(){if(this!==G.activeElement&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===G.activeElement&&this.blur?(this.blur(),!1):t},delegateType:"focusout"},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,i){var o=lt.extend(new lt.Event,n,{type:e,isSimulated:!0,originalEvent:{}});i?lt.event.trigger(o,null,t):lt.event.dispatch.call(t,o),o.isDefaultPrevented()&&n.preventDefault()}},lt.removeEvent=G.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var i="on"+t;e.detachEvent&&(typeof e[i]===Q&&(e[i]=null),e.detachEvent(i,n))},lt.Event=function(e,n){return this instanceof lt.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?l:u):this.type=e,n&&lt.extend(this,n),this.timeStamp=e&&e.timeStamp||lt.now(),this[lt.expando]=!0,t):new lt.Event(e,n)},lt.Event.prototype={isDefaultPrevented:u,isPropagationStopped:u,isImmediatePropagationStopped:u,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=l,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=l,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=l,this.stopPropagation()}},lt.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){lt.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,i=this,o=e.relatedTarget,r=e.handleObj;return(!o||o!==i&&!lt.contains(i,o))&&(e.type=r.origType,n=r.handler.apply(this,arguments),e.type=t),n}}}),lt.support.submitBubbles||(lt.event.special.submit={setup:function(){return lt.nodeName(this,"form")?!1:(lt.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,i=lt.nodeName(n,"input")||lt.nodeName(n,"button")?n.form:t;i&&!lt._data(i,"submitBubbles")&&(lt.event.add(i,"submit._submit",function(e){e._submit_bubble=!0}),lt._data(i,"submitBubbles",!0))}),t)},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&lt.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return lt.nodeName(this,"form")?!1:(lt.event.remove(this,"._submit"),t)}}),lt.support.changeBubbles||(lt.event.special.change={setup:function(){return Ht.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(lt.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),lt.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),lt.event.simulate("change",this,e,!0)})),!1):(lt.event.add(this,"beforeactivate._change",function(e){var t=e.target;Ht.test(t.nodeName)&&!lt._data(t,"changeBubbles")&&(lt.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||lt.event.simulate("change",this.parentNode,e,!0)}),lt._data(t,"changeBubbles",!0))}),t)},handle:function(e){var n=e.target;return this!==n||e.isSimulated||e.isTrigger||"radio"!==n.type&&"checkbox"!==n.type?e.handleObj.handler.apply(this,arguments):t},teardown:function(){return lt.event.remove(this,"._change"),!Ht.test(this.nodeName)}}),lt.support.focusinBubbles||lt.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,i=function(e){lt.event.simulate(t,e.target,lt.event.fix(e),!0)};lt.event.special[t]={setup:function(){0===n++&&G.addEventListener(e,i,!0)},teardown:function(){0===--n&&G.removeEventListener(e,i,!0)}}}),lt.fn.extend({on:function(e,n,i,o,r){var a,s;if("object"==typeof e){"string"!=typeof n&&(i=i||n,n=t);for(a in e)this.on(a,n,i,e[a],r);return this}if(null==i&&null==o?(o=n,i=n=t):null==o&&("string"==typeof n?(o=i,i=t):(o=i,i=n,n=t)),o===!1)o=u;else if(!o)return this;return 1===r&&(s=o,o=function(e){return lt().off(e),s.apply(this,arguments)},o.guid=s.guid||(s.guid=lt.guid++)),this.each(function(){lt.event.add(this,e,o,i,n)})},one:function(e,t,n,i){return this.on(e,t,n,i,1)},off:function(e,n,i){var o,r;if(e&&e.preventDefault&&e.handleObj)return o=e.handleObj,lt(e.delegateTarget).off(o.namespace?o.origType+"."+o.namespace:o.origType,o.selector,o.handler),this;if("object"==typeof e){for(r in e)this.off(r,n,e[r]);return this}return(n===!1||"function"==typeof n)&&(i=n,n=t),i===!1&&(i=u),this.each(function(){lt.event.remove(this,e,i,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,i){return this.on(t,e,n,i)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},trigger:function(e,t){return this.each(function(){lt.event.trigger(e,t,this)})},triggerHandler:function(e,n){var i=this[0];return i?lt.event.trigger(e,n,i,!0):t}}),function(e,t){function n(e){return ft.test(e+"")}function i(){var e,t=[];return e=function(n,i){return t.push(n+=" ")>S.cacheLength&&delete e[t.shift()],e[n]=i}}function o(e){return e[B]=!0,e}function r(e){var t=P.createElement("div");try{return e(t)}catch(n){return!1}finally{t=null}}function a(e,t,n,i){var o,r,a,s,l,u,c,p,f,m;if((t?t.ownerDocument||t:F)!==P&&M(t),t=t||P,n=n||[],!e||"string"!=typeof e)return n;if(1!==(s=t.nodeType)&&9!==s)return[];if(!O&&!i){if(o=mt.exec(e))if(a=o[1]){if(9===s){if(r=t.getElementById(a),!r||!r.parentNode)return n;if(r.id===a)return n.push(r),n}else if(t.ownerDocument&&(r=t.ownerDocument.getElementById(a))&&L(t,r)&&r.id===a)return n.push(r),n}else{if(o[2])return Z.apply(n,K.call(t.getElementsByTagName(e),0)),n;if((a=o[3])&&j.getByClassName&&t.getElementsByClassName)return Z.apply(n,K.call(t.getElementsByClassName(a),0)),n}if(j.qsa&&!I.test(e)){if(c=!0,p=B,f=t,m=9===s&&e,1===s&&"object"!==t.nodeName.toLowerCase()){for(u=d(e),(c=t.getAttribute("id"))?p=c.replace(yt,"\\$&"):t.setAttribute("id",p),p="[id='"+p+"'] ",l=u.length;l--;)u[l]=p+h(u[l]);f=pt.test(e)&&t.parentNode||t,m=u.join(",")}if(m)try{return Z.apply(n,K.call(f.querySelectorAll(m),0)),n}catch(g){}finally{c||t.removeAttribute("id")}}}return w(e.replace(at,"$1"),t,n,i)}function s(e,t){var n=t&&e,i=n&&(~t.sourceIndex||G)-(~e.sourceIndex||G);if(i)return i;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function l(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function u(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function c(e){return o(function(t){return t=+t,o(function(n,i){for(var o,r=e([],n.length,t),a=r.length;a--;)n[o=r[a]]&&(n[o]=!(i[o]=n[o]))})})}function d(e,t){var n,i,o,r,s,l,u,c=$[e+" "];if(c)return t?0:c.slice(0);for(s=e,l=[],u=S.preFilter;s;){(!n||(i=st.exec(s)))&&(i&&(s=s.slice(i[0].length)||s),l.push(o=[])),n=!1,(i=ut.exec(s))&&(n=i.shift(),o.push({value:n,type:i[0].replace(at," ")}),s=s.slice(n.length));for(r in S.filter)!(i=ht[r].exec(s))||u[r]&&!(i=u[r](i))||(n=i.shift(),o.push({value:n,type:r,matches:i}),s=s.slice(n.length));if(!n)break}return t?s.length:s?a.error(e):$(e,l).slice(0)}function h(e){for(var t=0,n=e.length,i="";n>t;t++)i+=e[t].value;return i}function p(e,t,n){var i=t.dir,o=n&&"parentNode"===i,r=W++;return t.first?function(t,n,r){for(;t=t[i];)if(1===t.nodeType||o)return e(t,n,r)}:function(t,n,a){var s,l,u,c=U+" "+r;if(a){for(;t=t[i];)if((1===t.nodeType||o)&&e(t,n,a))return!0}else for(;t=t[i];)if(1===t.nodeType||o)if(u=t[B]||(t[B]={}),(l=u[i])&&l[0]===c){if((s=l[1])===!0||s===C)return s===!0}else if(l=u[i]=[c],l[1]=e(t,n,a)||C,l[1]===!0)return!0}}function f(e){return e.length>1?function(t,n,i){for(var o=e.length;o--;)if(!e[o](t,n,i))return!1;return!0}:e[0]}function m(e,t,n,i,o){for(var r,a=[],s=0,l=e.length,u=null!=t;l>s;s++)(r=e[s])&&(!n||n(r,i,o))&&(a.push(r),u&&t.push(s));return a}function g(e,t,n,i,r,a){return i&&!i[B]&&(i=g(i)),r&&!r[B]&&(r=g(r,a)),o(function(o,a,s,l){var u,c,d,h=[],p=[],f=a.length,g=o||b(t||"*",s.nodeType?[s]:s,[]),v=!e||!o&&t?g:m(g,h,e,s,l),y=n?r||(o?e:f||i)?[]:a:v;if(n&&n(v,y,s,l),i)for(u=m(y,p),i(u,[],s,l),c=u.length;c--;)(d=u[c])&&(y[p[c]]=!(v[p[c]]=d));if(o){if(r||e){if(r){for(u=[],c=y.length;c--;)(d=y[c])&&u.push(v[c]=d);r(null,y=[],u,l)}for(c=y.length;c--;)(d=y[c])&&(u=r?J.call(o,d):h[c])>-1&&(o[u]=!(a[u]=d))}}else y=m(y===a?y.splice(f,y.length):y),r?r(null,a,y,l):Z.apply(a,y)})}function v(e){for(var t,n,i,o=e.length,r=S.relative[e[0].type],a=r||S.relative[" "],s=r?1:0,l=p(function(e){return e===t},a,!0),u=p(function(e){return J.call(t,e)>-1},a,!0),c=[function(e,n,i){return!r&&(i||n!==A)||((t=n).nodeType?l(e,n,i):u(e,n,i))}];o>s;s++)if(n=S.relative[e[s].type])c=[p(f(c),n)];else{if(n=S.filter[e[s].type].apply(null,e[s].matches),n[B]){for(i=++s;o>i&&!S.relative[e[i].type];i++);return g(s>1&&f(c),s>1&&h(e.slice(0,s-1)).replace(at,"$1"),n,i>s&&v(e.slice(s,i)),o>i&&v(e=e.slice(i)),o>i&&h(e))}c.push(n)}return f(c)}function y(e,t){var n=0,i=t.length>0,r=e.length>0,s=function(o,s,l,u,c){var d,h,p,f=[],g=0,v="0",y=o&&[],b=null!=c,w=A,x=o||r&&S.find.TAG("*",c&&s.parentNode||s),_=U+=null==w?1:Math.random()||.1;for(b&&(A=s!==P&&s,C=n);null!=(d=x[v]);v++){if(r&&d){for(h=0;p=e[h++];)if(p(d,s,l)){u.push(d);break}b&&(U=_,C=++n)}i&&((d=!p&&d)&&g--,o&&y.push(d))}if(g+=v,i&&v!==g){for(h=0;p=t[h++];)p(y,f,s,l);if(o){if(g>0)for(;v--;)y[v]||f[v]||(f[v]=Y.call(u));f=m(f)}Z.apply(u,f),b&&!o&&f.length>0&&g+t.length>1&&a.uniqueSort(u)}return b&&(U=_,A=w),y};return i?o(s):s}function b(e,t,n){for(var i=0,o=t.length;o>i;i++)a(e,t[i],n);return n}function w(e,t,n,i){var o,r,a,s,l,u=d(e);if(!i&&1===u.length){if(r=u[0]=u[0].slice(0),r.length>2&&"ID"===(a=r[0]).type&&9===t.nodeType&&!O&&S.relative[r[1].type]){if(t=S.find.ID(a.matches[0].replace(wt,xt),t)[0],!t)return n;e=e.slice(r.shift().value.length)}for(o=ht.needsContext.test(e)?0:r.length;o--&&(a=r[o],!S.relative[s=a.type]);)if((l=S.find[s])&&(i=l(a.matches[0].replace(wt,xt),pt.test(r[0].type)&&t.parentNode||t))){if(r.splice(o,1),e=i.length&&h(r),!e)return Z.apply(n,K.call(i,0)),n;break}}return k(e,u)(i,t,O,n,pt.test(e)),n}function x(){}var _,C,S,T,E,k,N,A,M,P,R,O,I,D,H,L,z,B="sizzle"+-new Date,F=e.document,j={},U=0,W=0,V=i(),$=i(),q=i(),Q=typeof t,G=1<<31,X=[],Y=X.pop,Z=X.push,K=X.slice,J=X.indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(this[t]===e)return t;return-1},et="[\\x20\\t\\r\\n\\f]",tt="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",nt=tt.replace("w","w#"),it="([*^$|!~]?=)",ot="\\["+et+"*("+tt+")"+et+"*(?:"+it+et+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+nt+")|)|)"+et+"*\\]",rt=":("+tt+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+ot.replace(3,8)+")*)|.*)\\)|)",at=RegExp("^"+et+"+|((?:^|[^\\\\])(?:\\\\.)*)"+et+"+$","g"),st=RegExp("^"+et+"*,"+et+"*"),ut=RegExp("^"+et+"*([\\x20\\t\\r\\n\\f>+~])"+et+"*"),ct=RegExp(rt),dt=RegExp("^"+nt+"$"),ht={ID:RegExp("^#("+tt+")"),CLASS:RegExp("^\\.("+tt+")"),NAME:RegExp("^\\[name=['\"]?("+tt+")['\"]?\\]"),TAG:RegExp("^("+tt.replace("w","w*")+")"),ATTR:RegExp("^"+ot),PSEUDO:RegExp("^"+rt),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+et+"*(even|odd|(([+-]|)(\\d*)n|)"+et+"*(?:([+-]|)"+et+"*(\\d+)|))"+et+"*\\)|)","i"),needsContext:RegExp("^"+et+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+et+"*((?:-\\d)?\\d*)"+et+"*\\)|)(?=[^-]|$)","i")},pt=/[\x20\t\r\n\f]*[+~]/,ft=/^[^{]+\{\s*\[native code/,mt=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,gt=/^(?:input|select|textarea|button)$/i,vt=/^h\d$/i,yt=/'|\\/g,bt=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,wt=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,xt=function(e,t){var n="0x"+t-65536;return n!==n?t:0>n?String.fromCharCode(n+65536):String.fromCharCode(55296|n>>10,56320|1023&n)};try{K.call(F.documentElement.childNodes,0)[0].nodeType}catch(_t){K=function(e){for(var t,n=[];t=this[e++];)n.push(t);return n}}E=a.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},M=a.setDocument=function(e){var i=e?e.ownerDocument||e:F;return i!==P&&9===i.nodeType&&i.documentElement?(P=i,R=i.documentElement,O=E(i),j.tagNameNoComments=r(function(e){return e.appendChild(i.createComment("")),!e.getElementsByTagName("*").length}),j.attributes=r(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return"boolean"!==t&&"string"!==t}),j.getByClassName=r(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",e.getElementsByClassName&&e.getElementsByClassName("e").length?(e.lastChild.className="e",2===e.getElementsByClassName("e").length):!1}),j.getByName=r(function(e){e.id=B+0,e.innerHTML="<a name='"+B+"'></a><div name='"+B+"'></div>",R.insertBefore(e,R.firstChild);var t=i.getElementsByName&&i.getElementsByName(B).length===2+i.getElementsByName(B+0).length;return j.getIdNotName=!i.getElementById(B),R.removeChild(e),t}),S.attrHandle=r(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==Q&&"#"===e.firstChild.getAttribute("href")})?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},j.getIdNotName?(S.find.ID=function(e,t){if(typeof t.getElementById!==Q&&!O){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},S.filter.ID=function(e){var t=e.replace(wt,xt);return function(e){return e.getAttribute("id")===t}}):(S.find.ID=function(e,n){if(typeof n.getElementById!==Q&&!O){var i=n.getElementById(e);return i?i.id===e||typeof i.getAttributeNode!==Q&&i.getAttributeNode("id").value===e?[i]:t:[]}},S.filter.ID=function(e){var t=e.replace(wt,xt);return function(e){var n=typeof e.getAttributeNode!==Q&&e.getAttributeNode("id");return n&&n.value===t}}),S.find.TAG=j.tagNameNoComments?function(e,n){return typeof n.getElementsByTagName!==Q?n.getElementsByTagName(e):t}:function(e,t){var n,i=[],o=0,r=t.getElementsByTagName(e);if("*"===e){for(;n=r[o++];)1===n.nodeType&&i.push(n);return i}return r},S.find.NAME=j.getByName&&function(e,n){return typeof n.getElementsByName!==Q?n.getElementsByName(name):t},S.find.CLASS=j.getByClassName&&function(e,n){return typeof n.getElementsByClassName===Q||O?t:n.getElementsByClassName(e)},D=[],I=[":focus"],(j.qsa=n(i.querySelectorAll))&&(r(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||I.push("\\["+et+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||I.push(":checked")}),r(function(e){e.innerHTML="<input type='hidden' i=''/>",e.querySelectorAll("[i^='']").length&&I.push("[*^$]="+et+"*(?:\"\"|'')"),e.querySelectorAll(":enabled").length||I.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),I.push(",.*:")})),(j.matchesSelector=n(H=R.matchesSelector||R.mozMatchesSelector||R.webkitMatchesSelector||R.oMatchesSelector||R.msMatchesSelector))&&r(function(e){j.disconnectedMatch=H.call(e,"div"),H.call(e,"[s!='']:x"),D.push("!=",rt)}),I=RegExp(I.join("|")),D=RegExp(D.join("|")),L=n(R.contains)||R.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,i=t&&t.parentNode;return e===i||!(!i||1!==i.nodeType||!(n.contains?n.contains(i):e.compareDocumentPosition&&16&e.compareDocumentPosition(i)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},z=R.compareDocumentPosition?function(e,t){var n;return e===t?(N=!0,0):(n=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t))?1&n||e.parentNode&&11===e.parentNode.nodeType?e===i||L(F,e)?-1:t===i||L(F,t)?1:0:4&n?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var n,o=0,r=e.parentNode,a=t.parentNode,l=[e],u=[t];if(e===t)return N=!0,0;if(!r||!a)return e===i?-1:t===i?1:r?-1:a?1:0;if(r===a)return s(e,t);for(n=e;n=n.parentNode;)l.unshift(n);for(n=t;n=n.parentNode;)u.unshift(n);for(;l[o]===u[o];)o++;return o?s(l[o],u[o]):l[o]===F?-1:u[o]===F?1:0},N=!1,[0,0].sort(z),j.detectDuplicates=N,P):P},a.matches=function(e,t){return a(e,null,null,t)},a.matchesSelector=function(e,t){if((e.ownerDocument||e)!==P&&M(e),t=t.replace(bt,"='$1']"),!(!j.matchesSelector||O||D&&D.test(t)||I.test(t)))try{var n=H.call(e,t);if(n||j.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(i){}return a(t,P,null,[e]).length>0},a.contains=function(e,t){return(e.ownerDocument||e)!==P&&M(e),L(e,t)},a.attr=function(e,t){var n;return(e.ownerDocument||e)!==P&&M(e),O||(t=t.toLowerCase()),(n=S.attrHandle[t])?n(e):O||j.attributes?e.getAttribute(t):((n=e.getAttributeNode(t))||e.getAttribute(t))&&e[t]===!0?t:n&&n.specified?n.value:null},a.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},a.uniqueSort=function(e){var t,n=[],i=1,o=0;if(N=!j.detectDuplicates,e.sort(z),N){for(;t=e[i];i++)t===e[i-1]&&(o=n.push(i));for(;o--;)e.splice(n[o],1)}return e},T=a.getText=function(e){var t,n="",i=0,o=e.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=T(e)}else if(3===o||4===o)return e.nodeValue}else for(;t=e[i];i++)n+=T(t);return n},S=a.selectors={cacheLength:50,createPseudo:o,match:ht,find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(wt,xt),e[3]=(e[4]||e[5]||"").replace(wt,xt),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||a.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&a.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return ht.CHILD.test(e[0])?null:(e[4]?e[2]=e[4]:n&&ct.test(n)&&(t=d(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){return"*"===e?function(){return!0}:(e=e.replace(wt,xt).toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=V[e+" "];return t||(t=RegExp("(^|"+et+")"+e+"("+et+"|$)"))&&V(e,function(e){return t.test(e.className||typeof e.getAttribute!==Q&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(i){var o=a.attr(i,e);return null==o?"!="===t:t?(o+="","="===t?o===n:"!="===t?o!==n:"^="===t?n&&0===o.indexOf(n):"*="===t?n&&o.indexOf(n)>-1:"$="===t?n&&o.slice(-n.length)===n:"~="===t?(" "+o+" ").indexOf(n)>-1:"|="===t?o===n||o.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,i,o){var r="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===i&&0===o?function(e){return!!e.parentNode}:function(t,n,l){var u,c,d,h,p,f,m=r!==a?"nextSibling":"previousSibling",g=t.parentNode,v=s&&t.nodeName.toLowerCase(),y=!l&&!s;if(g){if(r){for(;m;){for(d=t;d=d[m];)if(s?d.nodeName.toLowerCase()===v:1===d.nodeType)return!1;f=m="only"===e&&!f&&"nextSibling"}return!0}if(f=[a?g.firstChild:g.lastChild],a&&y){for(c=g[B]||(g[B]={}),u=c[e]||[],p=u[0]===U&&u[1],h=u[0]===U&&u[2],d=p&&g.childNodes[p];d=++p&&d&&d[m]||(h=p=0)||f.pop();)if(1===d.nodeType&&++h&&d===t){c[e]=[U,p,h];break}}else if(y&&(u=(t[B]||(t[B]={}))[e])&&u[0]===U)h=u[1];else for(;(d=++p&&d&&d[m]||(h=p=0)||f.pop())&&((s?d.nodeName.toLowerCase()!==v:1!==d.nodeType)||!++h||(y&&((d[B]||(d[B]={}))[e]=[U,h]),d!==t)););return h-=o,h===i||0===h%i&&h/i>=0}}},PSEUDO:function(e,t){var n,i=S.pseudos[e]||S.setFilters[e.toLowerCase()]||a.error("unsupported pseudo: "+e);return i[B]?i(t):i.length>1?(n=[e,e,"",t],S.setFilters.hasOwnProperty(e.toLowerCase())?o(function(e,n){for(var o,r=i(e,t),a=r.length;a--;)o=J.call(e,r[a]),e[o]=!(n[o]=r[a])}):function(e){return i(e,0,n)}):i}},pseudos:{not:o(function(e){var t=[],n=[],i=k(e.replace(at,"$1"));return i[B]?o(function(e,t,n,o){for(var r,a=i(e,null,o,[]),s=e.length;s--;)(r=a[s])&&(e[s]=!(t[s]=r))}):function(e,o,r){return t[0]=e,i(t,null,r,n),!n.pop()}}),has:o(function(e){return function(t){return a(e,t).length>0}}),contains:o(function(e){return function(t){return(t.textContent||t.innerText||T(t)).indexOf(e)>-1}}),lang:o(function(e){return dt.test(e||"")||a.error("unsupported lang: "+e),e=e.replace(wt,xt).toLowerCase(),function(t){var n;do if(n=O?t.getAttribute("xml:lang")||t.getAttribute("lang"):t.lang)return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===R},focus:function(e){return e===P.activeElement&&(!P.hasFocus||P.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!S.pseudos.empty(e)},header:function(e){return vt.test(e.nodeName)},input:function(e){return gt.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:c(function(){return[0]}),last:c(function(e,t){return[t-1]}),eq:c(function(e,t,n){return[0>n?n+t:n]}),even:c(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:c(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:c(function(e,t,n){for(var i=0>n?n+t:n;--i>=0;)e.push(i);return e}),gt:c(function(e,t,n){for(var i=0>n?n+t:n;t>++i;)e.push(i);return e})}};for(_ in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})S.pseudos[_]=l(_);for(_ in{submit:!0,reset:!0})S.pseudos[_]=u(_);k=a.compile=function(e,t){var n,i=[],o=[],r=q[e+" "];if(!r){for(t||(t=d(e)),n=t.length;n--;)r=v(t[n]),r[B]?i.push(r):o.push(r);r=q(e,y(o,i))}return r},S.pseudos.nth=S.pseudos.eq,S.filters=x.prototype=S.pseudos,S.setFilters=new x,M(),a.attr=lt.attr,lt.find=a,lt.expr=a.selectors,lt.expr[":"]=lt.expr.pseudos,lt.unique=a.uniqueSort,lt.text=a.getText,lt.isXMLDoc=a.isXML,lt.contains=a.contains}(e);var jt=/Until$/,Ut=/^(?:parents|prev(?:Until|All))/,Wt=/^.[^:#\[\.,]*$/,Vt=lt.expr.match.needsContext,$t={children:!0,contents:!0,next:!0,prev:!0};lt.fn.extend({find:function(e){var t,n,i,o=this.length;if("string"!=typeof e)return i=this,this.pushStack(lt(e).filter(function(){for(t=0;o>t;t++)if(lt.contains(i[t],this))return!0}));for(n=[],t=0;o>t;t++)lt.find(e,this[t],n);return n=this.pushStack(o>1?lt.unique(n):n),n.selector=(this.selector?this.selector+" ":"")+e,n},has:function(e){var t,n=lt(e,this),i=n.length;return this.filter(function(){for(t=0;i>t;t++)if(lt.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(d(this,e,!1))},filter:function(e){return this.pushStack(d(this,e,!0))},is:function(e){return!!e&&("string"==typeof e?Vt.test(e)?lt(e,this.context).index(this[0])>=0:lt.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){for(var n,i=0,o=this.length,r=[],a=Vt.test(e)||"string"!=typeof e?lt(e,t||this.context):0;o>i;i++)for(n=this[i];n&&n.ownerDocument&&n!==t&&11!==n.nodeType;){if(a?a.index(n)>-1:lt.find.matchesSelector(n,e)){r.push(n);break}n=n.parentNode}return this.pushStack(r.length>1?lt.unique(r):r)},index:function(e){return e?"string"==typeof e?lt.inArray(this[0],lt(e)):lt.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?lt(e,t):lt.makeArray(e&&e.nodeType?[e]:e),i=lt.merge(this.get(),n);return this.pushStack(lt.unique(i))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),lt.fn.andSelf=lt.fn.addBack,lt.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return lt.dir(e,"parentNode")},parentsUntil:function(e,t,n){return lt.dir(e,"parentNode",n)},next:function(e){return c(e,"nextSibling")},prev:function(e){return c(e,"previousSibling")},nextAll:function(e){return lt.dir(e,"nextSibling")},prevAll:function(e){return lt.dir(e,"previousSibling")
},nextUntil:function(e,t,n){return lt.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return lt.dir(e,"previousSibling",n)},siblings:function(e){return lt.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return lt.sibling(e.firstChild)},contents:function(e){return lt.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:lt.merge([],e.childNodes)}},function(e,t){lt.fn[e]=function(n,i){var o=lt.map(this,t,n);return jt.test(e)||(i=n),i&&"string"==typeof i&&(o=lt.filter(i,o)),o=this.length>1&&!$t[e]?lt.unique(o):o,this.length>1&&Ut.test(e)&&(o=o.reverse()),this.pushStack(o)}}),lt.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),1===t.length?lt.find.matchesSelector(t[0],e)?[t[0]]:[]:lt.find.matches(e,t)},dir:function(e,n,i){for(var o=[],r=e[n];r&&9!==r.nodeType&&(i===t||1!==r.nodeType||!lt(r).is(i));)1===r.nodeType&&o.push(r),r=r[n];return o},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});var qt="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Qt=/ jQuery\d+="(?:null|\d+)"/g,Gt=RegExp("<(?:"+qt+")[\\s/>]","i"),Xt=/^\s+/,Yt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Zt=/<([\w:]+)/,Kt=/<tbody/i,Jt=/<|&#?\w+;/,en=/<(?:script|style|link)/i,tn=/^(?:checkbox|radio)$/i,nn=/checked\s*(?:[^=]|=\s*.checked.)/i,on=/^$|\/(?:java|ecma)script/i,rn=/^true\/(.*)/,an=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,sn={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:lt.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},ln=h(G),un=ln.appendChild(G.createElement("div"));sn.optgroup=sn.option,sn.tbody=sn.tfoot=sn.colgroup=sn.caption=sn.thead,sn.th=sn.td,lt.fn.extend({text:function(e){return lt.access(this,function(e){return e===t?lt.text(this):this.empty().append((this[0]&&this[0].ownerDocument||G).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(lt.isFunction(e))return this.each(function(t){lt(this).wrapAll(e.call(this,t))});if(this[0]){var t=lt(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return lt.isFunction(e)?this.each(function(t){lt(this).wrapInner(e.call(this,t))}):this.each(function(){var t=lt(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=lt.isFunction(e);return this.each(function(n){lt(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){lt.nodeName(this,"body")||lt(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.insertBefore(e,this.firstChild)})},before:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var n,i=0;null!=(n=this[i]);i++)(!e||lt.filter(e,[n]).length>0)&&(t||1!==n.nodeType||lt.cleanData(b(n)),n.parentNode&&(t&&lt.contains(n.ownerDocument,n)&&g(b(n,"script")),n.parentNode.removeChild(n)));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++){for(1===e.nodeType&&lt.cleanData(b(e,!1));e.firstChild;)e.removeChild(e.firstChild);e.options&&lt.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return lt.clone(this,e,t)})},html:function(e){return lt.access(this,function(e){var n=this[0]||{},i=0,o=this.length;if(e===t)return 1===n.nodeType?n.innerHTML.replace(Qt,""):t;if(!("string"!=typeof e||en.test(e)||!lt.support.htmlSerialize&&Gt.test(e)||!lt.support.leadingWhitespace&&Xt.test(e)||sn[(Zt.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(Yt,"<$1></$2>");try{for(;o>i;i++)n=this[i]||{},1===n.nodeType&&(lt.cleanData(b(n,!1)),n.innerHTML=e);n=0}catch(r){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){var t=lt.isFunction(e);return t||"string"==typeof e||(e=lt(e).not(this).detach()),this.domManip([e],!0,function(e){var t=this.nextSibling,n=this.parentNode;n&&(lt(this).remove(),n.insertBefore(e,t))})},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,i){e=tt.apply([],e);var o,r,a,s,l,u,c=0,d=this.length,h=this,g=d-1,v=e[0],y=lt.isFunction(v);if(y||!(1>=d||"string"!=typeof v||lt.support.checkClone)&&nn.test(v))return this.each(function(o){var r=h.eq(o);y&&(e[0]=v.call(this,o,n?r.html():t)),r.domManip(e,n,i)});if(d&&(u=lt.buildFragment(e,this[0].ownerDocument,!1,this),o=u.firstChild,1===u.childNodes.length&&(u=o),o)){for(n=n&&lt.nodeName(o,"tr"),s=lt.map(b(u,"script"),f),a=s.length;d>c;c++)r=u,c!==g&&(r=lt.clone(r,!0,!0),a&&lt.merge(s,b(r,"script"))),i.call(n&&lt.nodeName(this[c],"table")?p(this[c],"tbody"):this[c],r,c);if(a)for(l=s[s.length-1].ownerDocument,lt.map(s,m),c=0;a>c;c++)r=s[c],on.test(r.type||"")&&!lt._data(r,"globalEval")&&lt.contains(l,r)&&(r.src?lt.ajax({url:r.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):lt.globalEval((r.text||r.textContent||r.innerHTML||"").replace(an,"")));u=o=null}return this}}),lt.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){lt.fn[e]=function(e){for(var n,i=0,o=[],r=lt(e),a=r.length-1;a>=i;i++)n=i===a?this:this.clone(!0),lt(r[i])[t](n),nt.apply(o,n.get());return this.pushStack(o)}}),lt.extend({clone:function(e,t,n){var i,o,r,a,s,l=lt.contains(e.ownerDocument,e);if(lt.support.html5Clone||lt.isXMLDoc(e)||!Gt.test("<"+e.nodeName+">")?r=e.cloneNode(!0):(un.innerHTML=e.outerHTML,un.removeChild(r=un.firstChild)),!(lt.support.noCloneEvent&&lt.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||lt.isXMLDoc(e)))for(i=b(r),s=b(e),a=0;null!=(o=s[a]);++a)i[a]&&y(o,i[a]);if(t)if(n)for(s=s||b(e),i=i||b(r),a=0;null!=(o=s[a]);a++)v(o,i[a]);else v(e,r);return i=b(r,"script"),i.length>0&&g(i,!l&&b(e,"script")),i=s=o=null,r},buildFragment:function(e,t,n,i){for(var o,r,a,s,l,u,c,d=e.length,p=h(t),f=[],m=0;d>m;m++)if(r=e[m],r||0===r)if("object"===lt.type(r))lt.merge(f,r.nodeType?[r]:r);else if(Jt.test(r)){for(s=s||p.appendChild(t.createElement("div")),l=(Zt.exec(r)||["",""])[1].toLowerCase(),c=sn[l]||sn._default,s.innerHTML=c[1]+r.replace(Yt,"<$1></$2>")+c[2],o=c[0];o--;)s=s.lastChild;if(!lt.support.leadingWhitespace&&Xt.test(r)&&f.push(t.createTextNode(Xt.exec(r)[0])),!lt.support.tbody)for(r="table"!==l||Kt.test(r)?"<table>"!==c[1]||Kt.test(r)?0:s:s.firstChild,o=r&&r.childNodes.length;o--;)lt.nodeName(u=r.childNodes[o],"tbody")&&!u.childNodes.length&&r.removeChild(u);for(lt.merge(f,s.childNodes),s.textContent="";s.firstChild;)s.removeChild(s.firstChild);s=p.lastChild}else f.push(t.createTextNode(r));for(s&&p.removeChild(s),lt.support.appendChecked||lt.grep(b(f,"input"),w),m=0;r=f[m++];)if((!i||-1===lt.inArray(r,i))&&(a=lt.contains(r.ownerDocument,r),s=b(p.appendChild(r),"script"),a&&g(s),n))for(o=0;r=s[o++];)on.test(r.type||"")&&n.push(r);return s=null,p},cleanData:function(e,t){for(var n,i,o,r,a=0,s=lt.expando,l=lt.cache,u=lt.support.deleteExpando,c=lt.event.special;null!=(n=e[a]);a++)if((t||lt.acceptData(n))&&(o=n[s],r=o&&l[o])){if(r.events)for(i in r.events)c[i]?lt.event.remove(n,i):lt.removeEvent(n,i,r.handle);l[o]&&(delete l[o],u?delete n[s]:typeof n.removeAttribute!==Q?n.removeAttribute(s):n[s]=null,J.push(o))}}});var cn,dn,hn,pn=/alpha\([^)]*\)/i,fn=/opacity\s*=\s*([^)]*)/,mn=/^(top|right|bottom|left)$/,gn=/^(none|table(?!-c[ea]).+)/,vn=/^margin/,yn=RegExp("^("+ut+")(.*)$","i"),bn=RegExp("^("+ut+")(?!px)[a-z%]+$","i"),wn=RegExp("^([+-])=("+ut+")","i"),xn={BODY:"block"},_n={position:"absolute",visibility:"hidden",display:"block"},Cn={letterSpacing:0,fontWeight:400},Sn=["Top","Right","Bottom","Left"],Tn=["Webkit","O","Moz","ms"];lt.fn.extend({css:function(e,n){return lt.access(this,function(e,n,i){var o,r,a={},s=0;if(lt.isArray(n)){for(r=dn(e),o=n.length;o>s;s++)a[n[s]]=lt.css(e,n[s],!1,r);return a}return i!==t?lt.style(e,n,i):lt.css(e,n)},e,n,arguments.length>1)},show:function(){return C(this,!0)},hide:function(){return C(this)},toggle:function(e){var t="boolean"==typeof e;return this.each(function(){(t?e:_(this))?lt(this).show():lt(this).hide()})}}),lt.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=hn(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":lt.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,i,o){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var r,a,s,l=lt.camelCase(n),u=e.style;if(n=lt.cssProps[l]||(lt.cssProps[l]=x(u,l)),s=lt.cssHooks[n]||lt.cssHooks[l],i===t)return s&&"get"in s&&(r=s.get(e,!1,o))!==t?r:u[n];if(a=typeof i,"string"===a&&(r=wn.exec(i))&&(i=(r[1]+1)*r[2]+parseFloat(lt.css(e,n)),a="number"),!(null==i||"number"===a&&isNaN(i)||("number"!==a||lt.cssNumber[l]||(i+="px"),lt.support.clearCloneStyle||""!==i||0!==n.indexOf("background")||(u[n]="inherit"),s&&"set"in s&&(i=s.set(e,i,o))===t)))try{u[n]=i}catch(c){}}},css:function(e,n,i,o){var r,a,s,l=lt.camelCase(n);return n=lt.cssProps[l]||(lt.cssProps[l]=x(e.style,l)),s=lt.cssHooks[n]||lt.cssHooks[l],s&&"get"in s&&(a=s.get(e,!0,i)),a===t&&(a=hn(e,n,o)),"normal"===a&&n in Cn&&(a=Cn[n]),""===i||i?(r=parseFloat(a),i===!0||lt.isNumeric(r)?r||0:a):a},swap:function(e,t,n,i){var o,r,a={};for(r in t)a[r]=e.style[r],e.style[r]=t[r];o=n.apply(e,i||[]);for(r in t)e.style[r]=a[r];return o}}),e.getComputedStyle?(dn=function(t){return e.getComputedStyle(t,null)},hn=function(e,n,i){var o,r,a,s=i||dn(e),l=s?s.getPropertyValue(n)||s[n]:t,u=e.style;return s&&(""!==l||lt.contains(e.ownerDocument,e)||(l=lt.style(e,n)),bn.test(l)&&vn.test(n)&&(o=u.width,r=u.minWidth,a=u.maxWidth,u.minWidth=u.maxWidth=u.width=l,l=s.width,u.width=o,u.minWidth=r,u.maxWidth=a)),l}):G.documentElement.currentStyle&&(dn=function(e){return e.currentStyle},hn=function(e,n,i){var o,r,a,s=i||dn(e),l=s?s[n]:t,u=e.style;return null==l&&u&&u[n]&&(l=u[n]),bn.test(l)&&!mn.test(n)&&(o=u.left,r=e.runtimeStyle,a=r&&r.left,a&&(r.left=e.currentStyle.left),u.left="fontSize"===n?"1em":l,l=u.pixelLeft+"px",u.left=o,a&&(r.left=a)),""===l?"auto":l}),lt.each(["height","width"],function(e,n){lt.cssHooks[n]={get:function(e,i,o){return i?0===e.offsetWidth&&gn.test(lt.css(e,"display"))?lt.swap(e,_n,function(){return E(e,n,o)}):E(e,n,o):t},set:function(e,t,i){var o=i&&dn(e);return S(e,t,i?T(e,n,i,lt.support.boxSizing&&"border-box"===lt.css(e,"boxSizing",!1,o),o):0)}}}),lt.support.opacity||(lt.cssHooks.opacity={get:function(e,t){return fn.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,i=e.currentStyle,o=lt.isNumeric(t)?"alpha(opacity="+100*t+")":"",r=i&&i.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===lt.trim(r.replace(pn,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||i&&!i.filter)||(n.filter=pn.test(r)?r.replace(pn,o):r+" "+o)}}),lt(function(){lt.support.reliableMarginRight||(lt.cssHooks.marginRight={get:function(e,n){return n?lt.swap(e,{display:"inline-block"},hn,[e,"marginRight"]):t}}),!lt.support.pixelPosition&&lt.fn.position&&lt.each(["top","left"],function(e,n){lt.cssHooks[n]={get:function(e,i){return i?(i=hn(e,n),bn.test(i)?lt(e).position()[n]+"px":i):t}}})}),lt.expr&&lt.expr.filters&&(lt.expr.filters.hidden=function(e){return 0>=e.offsetWidth&&0>=e.offsetHeight||!lt.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||lt.css(e,"display"))},lt.expr.filters.visible=function(e){return!lt.expr.filters.hidden(e)}),lt.each({margin:"",padding:"",border:"Width"},function(e,t){lt.cssHooks[e+t]={expand:function(n){for(var i=0,o={},r="string"==typeof n?n.split(" "):[n];4>i;i++)o[e+Sn[i]+t]=r[i]||r[i-2]||r[0];return o}},vn.test(e)||(lt.cssHooks[e+t].set=S)});var En=/%20/g,kn=/\[\]$/,Nn=/\r?\n/g,An=/^(?:submit|button|image|reset|file)$/i,Mn=/^(?:input|select|textarea|keygen)/i;lt.fn.extend({serialize:function(){return lt.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=lt.prop(this,"elements");return e?lt.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!lt(this).is(":disabled")&&Mn.test(this.nodeName)&&!An.test(e)&&(this.checked||!tn.test(e))}).map(function(e,t){var n=lt(this).val();return null==n?null:lt.isArray(n)?lt.map(n,function(e){return{name:t.name,value:e.replace(Nn,"\r\n")}}):{name:t.name,value:n.replace(Nn,"\r\n")}}).get()}}),lt.param=function(e,n){var i,o=[],r=function(e,t){t=lt.isFunction(t)?t():null==t?"":t,o[o.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(n===t&&(n=lt.ajaxSettings&&lt.ajaxSettings.traditional),lt.isArray(e)||e.jquery&&!lt.isPlainObject(e))lt.each(e,function(){r(this.name,this.value)});else for(i in e)A(i,e[i],n,r);return o.join("&").replace(En,"+")},lt.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){lt.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),lt.fn.hover=function(e,t){return this.mouseenter(e).mouseleave(t||e)};var Pn,Rn,On=lt.now(),In=/\?/,Dn=/#.*$/,Hn=/([?&])_=[^&]*/,Ln=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,zn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Bn=/^(?:GET|HEAD)$/,Fn=/^\/\//,jn=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Un=lt.fn.load,Wn={},Vn={},$n="*/".concat("*");try{Rn=X.href}catch(qn){Rn=G.createElement("a"),Rn.href="",Rn=Rn.href}Pn=jn.exec(Rn.toLowerCase())||[],lt.fn.load=function(e,n,i){if("string"!=typeof e&&Un)return Un.apply(this,arguments);var o,r,a,s=this,l=e.indexOf(" ");return l>=0&&(o=e.slice(l,e.length),e=e.slice(0,l)),lt.isFunction(n)?(i=n,n=t):n&&"object"==typeof n&&(a="POST"),s.length>0&&lt.ajax({url:e,type:a,dataType:"html",data:n}).done(function(e){r=arguments,s.html(o?lt("<div>").append(lt.parseHTML(e)).find(o):e)}).complete(i&&function(e,t){s.each(i,r||[e.responseText,t,e])}),this},lt.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){lt.fn[t]=function(e){return this.on(t,e)}}),lt.each(["get","post"],function(e,n){lt[n]=function(e,i,o,r){return lt.isFunction(i)&&(r=r||o,o=i,i=t),lt.ajax({url:e,type:n,dataType:r,data:i,success:o})}}),lt.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Rn,type:"GET",isLocal:zn.test(Pn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":$n,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":lt.parseJSON,"text xml":lt.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?R(R(e,lt.ajaxSettings),t):R(lt.ajaxSettings,e)},ajaxPrefilter:M(Wn),ajaxTransport:M(Vn),ajax:function(e,n){function i(e,n,i,o){var r,d,y,b,x,C=n;2!==w&&(w=2,l&&clearTimeout(l),c=t,s=o||"",_.readyState=e>0?4:0,i&&(b=O(h,_,i)),e>=200&&300>e||304===e?(h.ifModified&&(x=_.getResponseHeader("Last-Modified"),x&&(lt.lastModified[a]=x),x=_.getResponseHeader("etag"),x&&(lt.etag[a]=x)),204===e?(r=!0,C="nocontent"):304===e?(r=!0,C="notmodified"):(r=I(h,b),C=r.state,d=r.data,y=r.error,r=!y)):(y=C,(e||!C)&&(C="error",0>e&&(e=0))),_.status=e,_.statusText=(n||C)+"",r?m.resolveWith(p,[d,C,_]):m.rejectWith(p,[_,C,y]),_.statusCode(v),v=t,u&&f.trigger(r?"ajaxSuccess":"ajaxError",[_,h,r?d:y]),g.fireWith(p,[_,C]),u&&(f.trigger("ajaxComplete",[_,h]),--lt.active||lt.event.trigger("ajaxStop")))}"object"==typeof e&&(n=e,e=t),n=n||{};var o,r,a,s,l,u,c,d,h=lt.ajaxSetup({},n),p=h.context||h,f=h.context&&(p.nodeType||p.jquery)?lt(p):lt.event,m=lt.Deferred(),g=lt.Callbacks("once memory"),v=h.statusCode||{},y={},b={},w=0,x="canceled",_={readyState:0,getResponseHeader:function(e){var t;if(2===w){if(!d)for(d={};t=Ln.exec(s);)d[t[1].toLowerCase()]=t[2];t=d[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===w?s:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return w||(e=b[n]=b[n]||e,y[e]=t),this},overrideMimeType:function(e){return w||(h.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>w)for(t in e)v[t]=[v[t],e[t]];else _.always(e[_.status]);return this},abort:function(e){var t=e||x;return c&&c.abort(t),i(0,t),this}};if(m.promise(_).complete=g.add,_.success=_.done,_.error=_.fail,h.url=((e||h.url||Rn)+"").replace(Dn,"").replace(Fn,Pn[1]+"//"),h.type=n.method||n.type||h.method||h.type,h.dataTypes=lt.trim(h.dataType||"*").toLowerCase().match(ct)||[""],null==h.crossDomain&&(o=jn.exec(h.url.toLowerCase()),h.crossDomain=!(!o||o[1]===Pn[1]&&o[2]===Pn[2]&&(o[3]||("http:"===o[1]?80:443))==(Pn[3]||("http:"===Pn[1]?80:443)))),h.data&&h.processData&&"string"!=typeof h.data&&(h.data=lt.param(h.data,h.traditional)),P(Wn,h,n,_),2===w)return _;u=h.global,u&&0===lt.active++&&lt.event.trigger("ajaxStart"),h.type=h.type.toUpperCase(),h.hasContent=!Bn.test(h.type),a=h.url,h.hasContent||(h.data&&(a=h.url+=(In.test(a)?"&":"?")+h.data,delete h.data),h.cache===!1&&(h.url=Hn.test(a)?a.replace(Hn,"$1_="+On++):a+(In.test(a)?"&":"?")+"_="+On++)),h.ifModified&&(lt.lastModified[a]&&_.setRequestHeader("If-Modified-Since",lt.lastModified[a]),lt.etag[a]&&_.setRequestHeader("If-None-Match",lt.etag[a])),(h.data&&h.hasContent&&h.contentType!==!1||n.contentType)&&_.setRequestHeader("Content-Type",h.contentType),_.setRequestHeader("Accept",h.dataTypes[0]&&h.accepts[h.dataTypes[0]]?h.accepts[h.dataTypes[0]]+("*"!==h.dataTypes[0]?", "+$n+"; q=0.01":""):h.accepts["*"]);for(r in h.headers)_.setRequestHeader(r,h.headers[r]);if(h.beforeSend&&(h.beforeSend.call(p,_,h)===!1||2===w))return _.abort();x="abort";for(r in{success:1,error:1,complete:1})_[r](h[r]);if(c=P(Vn,h,n,_)){_.readyState=1,u&&f.trigger("ajaxSend",[_,h]),h.async&&h.timeout>0&&(l=setTimeout(function(){_.abort("timeout")},h.timeout));try{w=1,c.send(y,i)}catch(C){if(!(2>w))throw C;i(-1,C)}}else i(-1,"No Transport");return _},getScript:function(e,n){return lt.get(e,t,n,"script")},getJSON:function(e,t,n){return lt.get(e,t,n,"json")}}),lt.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return lt.globalEval(e),e}}}),lt.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),lt.ajaxTransport("script",function(e){if(e.crossDomain){var n,i=G.head||lt("head")[0]||G.documentElement;return{send:function(t,o){n=G.createElement("script"),n.async=!0,e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,t){(t||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),n=null,t||o(200,"success"))},i.insertBefore(n,i.firstChild)},abort:function(){n&&n.onload(t,!0)}}}});var Qn=[],Gn=/(=)\?(?=&|$)|\?\?/;lt.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Qn.pop()||lt.expando+"_"+On++;return this[e]=!0,e}}),lt.ajaxPrefilter("json jsonp",function(n,i,o){var r,a,s,l=n.jsonp!==!1&&(Gn.test(n.url)?"url":"string"==typeof n.data&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Gn.test(n.data)&&"data");return l||"jsonp"===n.dataTypes[0]?(r=n.jsonpCallback=lt.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,l?n[l]=n[l].replace(Gn,"$1"+r):n.jsonp!==!1&&(n.url+=(In.test(n.url)?"&":"?")+n.jsonp+"="+r),n.converters["script json"]=function(){return s||lt.error(r+" was not called"),s[0]},n.dataTypes[0]="json",a=e[r],e[r]=function(){s=arguments},o.always(function(){e[r]=a,n[r]&&(n.jsonpCallback=i.jsonpCallback,Qn.push(r)),s&&lt.isFunction(a)&&a(s[0]),s=a=t}),"script"):t});var Xn,Yn,Zn=0,Kn=e.ActiveXObject&&function(){var e;for(e in Xn)Xn[e](t,!0)};lt.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&D()||H()}:D,Yn=lt.ajaxSettings.xhr(),lt.support.cors=!!Yn&&"withCredentials"in Yn,Yn=lt.support.ajax=!!Yn,Yn&&lt.ajaxTransport(function(n){if(!n.crossDomain||lt.support.cors){var i;return{send:function(o,r){var a,s,l=n.xhr();if(n.username?l.open(n.type,n.url,n.async,n.username,n.password):l.open(n.type,n.url,n.async),n.xhrFields)for(s in n.xhrFields)l[s]=n.xhrFields[s];n.mimeType&&l.overrideMimeType&&l.overrideMimeType(n.mimeType),n.crossDomain||o["X-Requested-With"]||(o["X-Requested-With"]="XMLHttpRequest");try{for(s in o)l.setRequestHeader(s,o[s])}catch(u){}l.send(n.hasContent&&n.data||null),i=function(e,o){var s,u,c,d;try{if(i&&(o||4===l.readyState))if(i=t,a&&(l.onreadystatechange=lt.noop,Kn&&delete Xn[a]),o)4!==l.readyState&&l.abort();else{d={},s=l.status,u=l.getAllResponseHeaders(),"string"==typeof l.responseText&&(d.text=l.responseText);try{c=l.statusText}catch(h){c=""}s||!n.isLocal||n.crossDomain?1223===s&&(s=204):s=d.text?200:404}}catch(p){o||r(-1,p)}d&&r(s,c,d,u)},n.async?4===l.readyState?setTimeout(i):(a=++Zn,Kn&&(Xn||(Xn={},lt(e).unload(Kn)),Xn[a]=i),l.onreadystatechange=i):i()},abort:function(){i&&i(t,!0)}}}});var Jn,ei,ti=/^(?:toggle|show|hide)$/,ni=RegExp("^(?:([+-])=|)("+ut+")([a-z%]*)$","i"),ii=/queueHooks$/,oi=[j],ri={"*":[function(e,t){var n,i,o=this.createTween(e,t),r=ni.exec(t),a=o.cur(),s=+a||0,l=1,u=20;if(r){if(n=+r[2],i=r[3]||(lt.cssNumber[e]?"":"px"),"px"!==i&&s){s=lt.css(o.elem,e,!0)||n||1;do l=l||".5",s/=l,lt.style(o.elem,e,s+i);while(l!==(l=o.cur()/a)&&1!==l&&--u)}o.unit=i,o.start=s,o.end=r[1]?s+(r[1]+1)*n:n}return o}]};lt.Animation=lt.extend(B,{tweener:function(e,t){lt.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var n,i=0,o=e.length;o>i;i++)n=e[i],ri[n]=ri[n]||[],ri[n].unshift(t)},prefilter:function(e,t){t?oi.unshift(e):oi.push(e)}}),lt.Tween=U,U.prototype={constructor:U,init:function(e,t,n,i,o,r){this.elem=e,this.prop=n,this.easing=o||"swing",this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=r||(lt.cssNumber[n]?"":"px")},cur:function(){var e=U.propHooks[this.prop];return e&&e.get?e.get(this):U.propHooks._default.get(this)},run:function(e){var t,n=U.propHooks[this.prop];return this.pos=t=this.options.duration?lt.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):U.propHooks._default.set(this),this}},U.prototype.init.prototype=U.prototype,U.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=lt.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){lt.fx.step[e.prop]?lt.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[lt.cssProps[e.prop]]||lt.cssHooks[e.prop])?lt.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},U.propHooks.scrollTop=U.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},lt.each(["toggle","show","hide"],function(e,t){var n=lt.fn[t];lt.fn[t]=function(e,i,o){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(W(t,!0),e,i,o)}}),lt.fn.extend({fadeTo:function(e,t,n,i){return this.filter(_).css("opacity",0).show().end().animate({opacity:t},e,n,i)},animate:function(e,t,n,i){var o=lt.isEmptyObject(e),r=lt.speed(t,n,i),a=function(){var t=B(this,lt.extend({},e),r);a.finish=function(){t.stop(!0)},(o||lt._data(this,"finish"))&&t.stop(!0)};return a.finish=a,o||r.queue===!1?this.each(a):this.queue(r.queue,a)},stop:function(e,n,i){var o=function(e){var t=e.stop;delete e.stop,t(i)};return"string"!=typeof e&&(i=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",r=lt.timers,a=lt._data(this);if(n)a[n]&&a[n].stop&&o(a[n]);else for(n in a)a[n]&&a[n].stop&&ii.test(n)&&o(a[n]);for(n=r.length;n--;)r[n].elem!==this||null!=e&&r[n].queue!==e||(r[n].anim.stop(i),t=!1,r.splice(n,1));(t||!i)&&lt.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=lt._data(this),i=n[e+"queue"],o=n[e+"queueHooks"],r=lt.timers,a=i?i.length:0;for(n.finish=!0,lt.queue(this,e,[]),o&&o.cur&&o.cur.finish&&o.cur.finish.call(this),t=r.length;t--;)r[t].elem===this&&r[t].queue===e&&(r[t].anim.stop(!0),r.splice(t,1));for(t=0;a>t;t++)i[t]&&i[t].finish&&i[t].finish.call(this);delete n.finish})}}),lt.each({slideDown:W("show"),slideUp:W("hide"),slideToggle:W("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){lt.fn[e]=function(e,n,i){return this.animate(t,e,n,i)}}),lt.speed=function(e,t,n){var i=e&&"object"==typeof e?lt.extend({},e):{complete:n||!n&&t||lt.isFunction(e)&&e,duration:e,easing:n&&t||t&&!lt.isFunction(t)&&t};return i.duration=lt.fx.off?0:"number"==typeof i.duration?i.duration:i.duration in lt.fx.speeds?lt.fx.speeds[i.duration]:lt.fx.speeds._default,(null==i.queue||i.queue===!0)&&(i.queue="fx"),i.old=i.complete,i.complete=function(){lt.isFunction(i.old)&&i.old.call(this),i.queue&&lt.dequeue(this,i.queue)},i},lt.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},lt.timers=[],lt.fx=U.prototype.init,lt.fx.tick=function(){var e,n=lt.timers,i=0;for(Jn=lt.now();n.length>i;i++)e=n[i],e()||n[i]!==e||n.splice(i--,1);n.length||lt.fx.stop(),Jn=t},lt.fx.timer=function(e){e()&&lt.timers.push(e)&&lt.fx.start()},lt.fx.interval=13,lt.fx.start=function(){ei||(ei=setInterval(lt.fx.tick,lt.fx.interval))},lt.fx.stop=function(){clearInterval(ei),ei=null},lt.fx.speeds={slow:600,fast:200,_default:400},lt.fx.step={},lt.expr&&lt.expr.filters&&(lt.expr.filters.animated=function(e){return lt.grep(lt.timers,function(t){return e===t.elem}).length}),lt.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){lt.offset.setOffset(this,e,t)});var n,i,o={top:0,left:0},r=this[0],a=r&&r.ownerDocument;return a?(n=a.documentElement,lt.contains(n,r)?(typeof r.getBoundingClientRect!==Q&&(o=r.getBoundingClientRect()),i=V(a),{top:o.top+(i.pageYOffset||n.scrollTop)-(n.clientTop||0),left:o.left+(i.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}):o):void 0},lt.offset={setOffset:function(e,t,n){var i=lt.css(e,"position");"static"===i&&(e.style.position="relative");var o,r,a=lt(e),s=a.offset(),l=lt.css(e,"top"),u=lt.css(e,"left"),c=("absolute"===i||"fixed"===i)&&lt.inArray("auto",[l,u])>-1,d={},h={};c?(h=a.position(),o=h.top,r=h.left):(o=parseFloat(l)||0,r=parseFloat(u)||0),lt.isFunction(t)&&(t=t.call(e,n,s)),null!=t.top&&(d.top=t.top-s.top+o),null!=t.left&&(d.left=t.left-s.left+r),"using"in t?t.using.call(e,d):a.css(d)}},lt.fn.extend({position:function(){if(this[0]){var e,t,n={top:0,left:0},i=this[0];return"fixed"===lt.css(i,"position")?t=i.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),lt.nodeName(e[0],"html")||(n=e.offset()),n.top+=lt.css(e[0],"borderTopWidth",!0),n.left+=lt.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-lt.css(i,"marginTop",!0),left:t.left-n.left-lt.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||G.documentElement;e&&!lt.nodeName(e,"html")&&"static"===lt.css(e,"position");)e=e.offsetParent;return e||G.documentElement})}}),lt.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var i=/Y/.test(n);lt.fn[e]=function(o){return lt.access(this,function(e,o,r){var a=V(e);return r===t?a?n in a?a[n]:a.document.documentElement[o]:e[o]:(a?a.scrollTo(i?lt(a).scrollLeft():r,i?r:lt(a).scrollTop()):e[o]=r,t)},e,o,arguments.length,null)}}),lt.each({Height:"height",Width:"width"},function(e,n){lt.each({padding:"inner"+e,content:n,"":"outer"+e},function(i,o){lt.fn[o]=function(o,r){var a=arguments.length&&(i||"boolean"!=typeof o),s=i||(o===!0||r===!0?"margin":"border");return lt.access(this,function(n,i,o){var r;return lt.isWindow(n)?n.document.documentElement["client"+e]:9===n.nodeType?(r=n.documentElement,Math.max(n.body["scroll"+e],r["scroll"+e],n.body["offset"+e],r["offset"+e],r["client"+e])):o===t?lt.css(n,i,s):lt.style(n,i,o,s)},n,a?o:t,a,null)}})}),e.jQuery=e.$=lt,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return lt})})(window),/*! jQuery UI - v1.10.3 - 2013-06-06
* http://jqueryui.com
* Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.position.js, jquery.ui.draggable.js, jquery.ui.resizable.js, jquery.ui.button.js, jquery.ui.dialog.js, jquery.ui.menu.js, jquery.ui.slider.js
* Copyright 2013 jQuery Foundation and other contributors Licensed MIT */
function(e,t){function n(t,n){var o,r,a,s=t.nodeName.toLowerCase();return"area"===s?(o=t.parentNode,r=o.name,t.href&&r&&"map"===o.nodeName.toLowerCase()?(a=e("img[usemap=#"+r+"]")[0],!!a&&i(a)):!1):(/input|select|textarea|button|object/.test(s)?!t.disabled:"a"===s?t.href||n:n)&&i(t)}function i(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var o=0,r=/^ui-id-\d+$/;e.ui=e.ui||{},e.extend(e.ui,{version:"1.10.3",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({focus:function(t){return function(n,i){return"number"==typeof n?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),i&&i.call(t)},n)}):t.apply(this,arguments)}}(e.fn.focus),scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length)for(var i,o,r=e(this[0]);r.length&&r[0]!==document;){if(i=r.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(o=parseInt(r.css("zIndex"),10),!isNaN(o)&&0!==o))return o;r=r.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++o)})},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,i){return!!e.data(t,i[3])},focusable:function(t){return n(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var i=e.attr(t,"tabindex"),o=isNaN(i);return(o||i>=0)&&n(t,!o)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,i){function o(t,n,i,o){return e.each(r,function(){n-=parseFloat(e.css(t,"padding"+this))||0,i&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),o&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var r="Width"===i?["Left","Right"]:["Top","Bottom"],a=i.toLowerCase(),s={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+i]=function(n){return n===t?s["inner"+i].call(this):this.each(function(){e(this).css(a,o(this,n)+"px")})},e.fn["outer"+i]=function(t,n){return"number"!=typeof t?s["outer"+i].call(this,t):this.each(function(){e(this).css(a,o(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,n,i){var o,r=e.ui[t].prototype;for(o in i)r.plugins[o]=r.plugins[o]||[],r.plugins[o].push([n,i[o]])},call:function(e,t,n){var i,o=e.plugins[t];if(o&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(i=0;o.length>i;i++)e.options[o[i][0]]&&o[i][1].apply(e.element,n)}},hasScroll:function(t,n){if("hidden"===e(t).css("overflow"))return!1;var i=n&&"left"===n?"scrollLeft":"scrollTop",o=!1;return t[i]>0?!0:(t[i]=1,o=t[i]>0,t[i]=0,o)}})}(jQuery),function(e,t){var n=0,i=Array.prototype.slice,o=e.cleanData;e.cleanData=function(t){for(var n,i=0;null!=(n=t[i]);i++)try{e(n).triggerHandler("remove")}catch(r){}o(t)},e.widget=function(n,i,o){var r,a,s,l,u={},c=n.split(".")[0];n=n.split(".")[1],r=c+"-"+n,o||(o=i,i=e.Widget),e.expr[":"][r.toLowerCase()]=function(t){return!!e.data(t,r)},e[c]=e[c]||{},a=e[c][n],s=e[c][n]=function(e,n){return this._createWidget?(arguments.length&&this._createWidget(e,n),t):new s(e,n)},e.extend(s,a,{version:o.version,_proto:e.extend({},o),_childConstructors:[]}),l=new i,l.options=e.widget.extend({},l.options),e.each(o,function(n,o){return e.isFunction(o)?(u[n]=function(){var e=function(){return i.prototype[n].apply(this,arguments)},t=function(e){return i.prototype[n].apply(this,e)};return function(){var n,i=this._super,r=this._superApply;return this._super=e,this._superApply=t,n=o.apply(this,arguments),this._super=i,this._superApply=r,n}}(),t):(u[n]=o,t)}),s.prototype=e.widget.extend(l,{widgetEventPrefix:a?l.widgetEventPrefix:n},u,{constructor:s,namespace:c,widgetName:n,widgetFullName:r}),a?(e.each(a._childConstructors,function(t,n){var i=n.prototype;e.widget(i.namespace+"."+i.widgetName,s,n._proto)}),delete a._childConstructors):i._childConstructors.push(s),e.widget.bridge(n,s)},e.widget.extend=function(n){for(var o,r,a=i.call(arguments,1),s=0,l=a.length;l>s;s++)for(o in a[s])r=a[s][o],a[s].hasOwnProperty(o)&&r!==t&&(n[o]=e.isPlainObject(r)?e.isPlainObject(n[o])?e.widget.extend({},n[o],r):e.widget.extend({},r):r);return n},e.widget.bridge=function(n,o){var r=o.prototype.widgetFullName||n;e.fn[n]=function(a){var s="string"==typeof a,l=i.call(arguments,1),u=this;return a=!s&&l.length?e.widget.extend.apply(null,[a].concat(l)):a,s?this.each(function(){var i,o=e.data(this,r);return o?e.isFunction(o[a])&&"_"!==a.charAt(0)?(i=o[a].apply(o,l),i!==o&&i!==t?(u=i&&i.jquery?u.pushStack(i.get()):i,!1):t):e.error("no such method '"+a+"' for "+n+" widget instance"):e.error("cannot call methods on "+n+" prior to initialization; "+"attempted to call method '"+a+"'")}):this.each(function(){var t=e.data(this,r);t?t.option(a||{})._init():e.data(this,r,new o(a,this))}),u}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,i){var o,r,a,s=n;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof n)if(s={},o=n.split("."),n=o.shift(),o.length){for(r=s[n]=e.widget.extend({},this.options[n]),a=0;o.length-1>a;a++)r[o[a]]=r[o[a]]||{},r=r[o[a]];if(n=o.pop(),i===t)return r[n]===t?null:r[n];r[n]=i}else{if(i===t)return this.options[n]===t?null:this.options[n];s[n]=i}return this._setOptions(s),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(n,i,o){var r,a=this;"boolean"!=typeof n&&(o=i,i=n,n=!1),o?(i=r=e(i),this.bindings=this.bindings.add(i)):(o=i,i=this.element,r=this.widget()),e.each(o,function(o,s){function l(){return n||a.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof s?a[s]:s).apply(a,arguments):t}"string"!=typeof s&&(l.guid=s.guid=s.guid||l.guid||e.guid++);var u=o.match(/^(\w+)\s*(.*)$/),c=u[1]+a.eventNamespace,d=u[2];d?r.delegate(d,c,l):i.bind(c,l)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return("string"==typeof e?i[e]:e).apply(i,arguments)}var i=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,i){var o,r,a=this.options[t];if(i=i||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],r=n.originalEvent)for(o in r)o in n||(n[o]=r[o]);return this.element.trigger(n,i),!(e.isFunction(a)&&a.apply(this.element[0],[n].concat(i))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(i,o,r){"string"==typeof o&&(o={effect:o});var a,s=o?o===!0||"number"==typeof o?n:o.effect||n:t;o=o||{},"number"==typeof o&&(o={duration:o}),a=!e.isEmptyObject(o),o.complete=r,o.delay&&i.delay(o.delay),a&&e.effects&&e.effects.effect[s]?i[t](o):s!==t&&i[s]?i[s](o.duration,o.easing,r):i.queue(function(n){e(this)[t](),r&&r.call(i[0]),n()})}})}(jQuery),function(e){var t=!1;e(document).mouseup(function(){t=!1}),e.widget("ui.mouse",{version:"1.10.3",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){return!0===e.data(n.target,t.widgetName+".preventClickEvent")?(e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(n){if(!t){this._mouseStarted&&this._mouseUp(n),this._mouseDownEvent=n;var i=this,o=1===n.which,r="string"==typeof this.options.cancel&&n.target.nodeName?e(n.target).closest(this.options.cancel).length:!1;return o&&!r&&this._mouseCapture(n)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(n)&&this._mouseDelayMet(n)&&(this._mouseStarted=this._mouseStart(n)!==!1,!this._mouseStarted)?(n.preventDefault(),!0):(!0===e.data(n.target,this.widgetName+".preventClickEvent")&&e.removeData(n.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),n.preventDefault(),t=!0,!0)):!0}},_mouseMove:function(t){return e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(e,t){function n(e,t,n){return[parseFloat(e[0])*(p.test(e[0])?t/100:1),parseFloat(e[1])*(p.test(e[1])?n/100:1)]}function i(t,n){return parseInt(e.css(t,n),10)||0}function o(t){var n=t[0];return 9===n.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(n)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:n.preventDefault?{width:0,height:0,offset:{top:n.pageY,left:n.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.ui=e.ui||{};var r,a=Math.max,s=Math.abs,l=Math.round,u=/left|center|right/,c=/top|center|bottom/,d=/[\+\-]\d+(\.[\d]+)?%?/,h=/^\w+/,p=/%$/,f=e.fn.position;e.position={scrollbarWidth:function(){if(r!==t)return r;var n,i,o=e("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),a=o.children()[0];return e("body").append(o),n=a.offsetWidth,o.css("overflow","scroll"),i=a.offsetWidth,n===i&&(i=o[0].clientWidth),o.remove(),r=n-i},getScrollInfo:function(t){var n=t.isWindow?"":t.element.css("overflow-x"),i=t.isWindow?"":t.element.css("overflow-y"),o="scroll"===n||"auto"===n&&t.width<t.element[0].scrollWidth,r="scroll"===i||"auto"===i&&t.height<t.element[0].scrollHeight;return{width:r?e.position.scrollbarWidth():0,height:o?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var n=e(t||window),i=e.isWindow(n[0]);return{element:n,isWindow:i,offset:n.offset()||{left:0,top:0},scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop(),width:i?n.width():n.outerWidth(),height:i?n.height():n.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return f.apply(this,arguments);t=e.extend({},t);var r,p,m,g,v,y,b=e(t.of),w=e.position.getWithinInfo(t.within),x=e.position.getScrollInfo(w),_=(t.collision||"flip").split(" "),C={};return y=o(b),b[0].preventDefault&&(t.at="left top"),p=y.width,m=y.height,g=y.offset,v=e.extend({},g),e.each(["my","at"],function(){var e,n,i=(t[this]||"").split(" ");1===i.length&&(i=u.test(i[0])?i.concat(["center"]):c.test(i[0])?["center"].concat(i):["center","center"]),i[0]=u.test(i[0])?i[0]:"center",i[1]=c.test(i[1])?i[1]:"center",e=d.exec(i[0]),n=d.exec(i[1]),C[this]=[e?e[0]:0,n?n[0]:0],t[this]=[h.exec(i[0])[0],h.exec(i[1])[0]]}),1===_.length&&(_[1]=_[0]),"right"===t.at[0]?v.left+=p:"center"===t.at[0]&&(v.left+=p/2),"bottom"===t.at[1]?v.top+=m:"center"===t.at[1]&&(v.top+=m/2),r=n(C.at,p,m),v.left+=r[0],v.top+=r[1],this.each(function(){var o,u,c=e(this),d=c.outerWidth(),h=c.outerHeight(),f=i(this,"marginLeft"),y=i(this,"marginTop"),S=d+f+i(this,"marginRight")+x.width,T=h+y+i(this,"marginBottom")+x.height,E=e.extend({},v),k=n(C.my,c.outerWidth(),c.outerHeight());"right"===t.my[0]?E.left-=d:"center"===t.my[0]&&(E.left-=d/2),"bottom"===t.my[1]?E.top-=h:"center"===t.my[1]&&(E.top-=h/2),E.left+=k[0],E.top+=k[1],e.support.offsetFractions||(E.left=l(E.left),E.top=l(E.top)),o={marginLeft:f,marginTop:y},e.each(["left","top"],function(n,i){e.ui.position[_[n]]&&e.ui.position[_[n]][i](E,{targetWidth:p,targetHeight:m,elemWidth:d,elemHeight:h,collisionPosition:o,collisionWidth:S,collisionHeight:T,offset:[r[0]+k[0],r[1]+k[1]],my:t.my,at:t.at,within:w,elem:c})}),t.using&&(u=function(e){var n=g.left-E.left,i=n+p-d,o=g.top-E.top,r=o+m-h,l={target:{element:b,left:g.left,top:g.top,width:p,height:m},element:{element:c,left:E.left,top:E.top,width:d,height:h},horizontal:0>i?"left":n>0?"right":"center",vertical:0>r?"top":o>0?"bottom":"middle"};d>p&&p>s(n+i)&&(l.horizontal="center"),h>m&&m>s(o+r)&&(l.vertical="middle"),l.important=a(s(n),s(i))>a(s(o),s(r))?"horizontal":"vertical",t.using.call(this,e,l)}),c.offset(e.extend(E,{using:u}))})},e.ui.position={fit:{left:function(e,t){var n,i=t.within,o=i.isWindow?i.scrollLeft:i.offset.left,r=i.width,s=e.left-t.collisionPosition.marginLeft,l=o-s,u=s+t.collisionWidth-r-o;t.collisionWidth>r?l>0&&0>=u?(n=e.left+l+t.collisionWidth-r-o,e.left+=l-n):e.left=u>0&&0>=l?o:l>u?o+r-t.collisionWidth:o:l>0?e.left+=l:u>0?e.left-=u:e.left=a(e.left-s,e.left)},top:function(e,t){var n,i=t.within,o=i.isWindow?i.scrollTop:i.offset.top,r=t.within.height,s=e.top-t.collisionPosition.marginTop,l=o-s,u=s+t.collisionHeight-r-o;t.collisionHeight>r?l>0&&0>=u?(n=e.top+l+t.collisionHeight-r-o,e.top+=l-n):e.top=u>0&&0>=l?o:l>u?o+r-t.collisionHeight:o:l>0?e.top+=l:u>0?e.top-=u:e.top=a(e.top-s,e.top)}},flip:{left:function(e,t){var n,i,o=t.within,r=o.offset.left+o.scrollLeft,a=o.width,l=o.isWindow?o.scrollLeft:o.offset.left,u=e.left-t.collisionPosition.marginLeft,c=u-l,d=u+t.collisionWidth-a-l,h="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,p="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,f=-2*t.offset[0];0>c?(n=e.left+h+p+f+t.collisionWidth-a-r,(0>n||s(c)>n)&&(e.left+=h+p+f)):d>0&&(i=e.left-t.collisionPosition.marginLeft+h+p+f-l,(i>0||d>s(i))&&(e.left+=h+p+f))},top:function(e,t){var n,i,o=t.within,r=o.offset.top+o.scrollTop,a=o.height,l=o.isWindow?o.scrollTop:o.offset.top,u=e.top-t.collisionPosition.marginTop,c=u-l,d=u+t.collisionHeight-a-l,h="top"===t.my[1],p=h?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,f="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,m=-2*t.offset[1];0>c?(i=e.top+p+f+m+t.collisionHeight-a-r,e.top+p+f+m>c&&(0>i||s(c)>i)&&(e.top+=p+f+m)):d>0&&(n=e.top-t.collisionPosition.marginTop+p+f+m-l,e.top+p+f+m>d&&(n>0||d>s(n))&&(e.top+=p+f+m))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,n,i,o,r,a=document.getElementsByTagName("body")[0],s=document.createElement("div");t=document.createElement(a?"div":"body"),i={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},a&&e.extend(i,{position:"absolute",left:"-1000px",top:"-1000px"});for(r in i)t.style[r]=i[r];t.appendChild(s),n=a||document.documentElement,n.insertBefore(t,n.firstChild),s.style.cssText="position: absolute; left: 10.7432222px;",o=e(s).offset().left,e.support.offsetFractions=o>10&&11>o,t.innerHTML="",n.removeChild(t)}()}(jQuery),function(e){e.widget("ui.draggable",e.ui.mouse,{version:"1.10.3",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var n=this.options;return this.helper||n.disabled||e(t.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(t),this.handle?(e(n.iframeFix===!0?"iframe":n.iframeFix).each(function(){e("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var n=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,n){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),!n){var i=this._uiHash();if(this._trigger("drag",t,i)===!1)return this._mouseUp({}),!1;this.position=i.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var n=this,i=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(i=e.ui.ddmanager.drop(this,t)),this.dropped&&(i=this.dropped,this.dropped=!1),"original"!==this.options.helper||e.contains(this.element[0].ownerDocument,this.element[0])?("invalid"===this.options.revert&&!i||"valid"===this.options.revert&&i||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,i)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){n._trigger("stop",t)!==!1&&n._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1):!1},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return this.options.handle?!!e(t.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(t){var n=this.options,i=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t])):"clone"===n.helper?this.element.clone().removeAttr("id"):this.element;return i.parents("body").length||i.appendTo("parent"===n.appendTo?this.element[0].parentNode:n.appendTo),i[0]===this.element[0]||/(fixed|absolute)/.test(i.css("position"))||i.css("position","absolute"),i},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,n,i,o=this.options;return o.containment?"window"===o.containment?(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===o.containment?(this.containment=[0,0,e(document).width()-this.helperProportions.width-this.margins.left,(e(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):o.containment.constructor===Array?(this.containment=o.containment,void 0):("parent"===o.containment&&(o.containment=this.helper[0].parentNode),n=e(o.containment),i=n[0],i&&(t="hidden"!==n.css("overflow"),this.containment=[(parseInt(n.css("borderLeftWidth"),10)||0)+(parseInt(n.css("paddingLeft"),10)||0),(parseInt(n.css("borderTopWidth"),10)||0)+(parseInt(n.css("paddingTop"),10)||0),(t?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(n.css("borderRightWidth"),10)||0)-(parseInt(n.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(n.css("borderBottomWidth"),10)||0)-(parseInt(n.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=n),void 0):(this.containment=null,void 0)},_convertPositionTo:function(t,n){n||(n=this.position);var i="absolute"===t?1:-1,o="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:o.scrollTop(),left:o.scrollLeft()}),{top:n.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*i,left:n.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*i}},_generatePosition:function(t){var n,i,o,r,a=this.options,s="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=t.pageX,u=t.pageY;return this.offset.scroll||(this.offset.scroll={top:s.scrollTop(),left:s.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(i=this.relative_container.offset(),n=[this.containment[0]+i.left,this.containment[1]+i.top,this.containment[2]+i.left,this.containment[3]+i.top]):n=this.containment,t.pageX-this.offset.click.left<n[0]&&(l=n[0]+this.offset.click.left),t.pageY-this.offset.click.top<n[1]&&(u=n[1]+this.offset.click.top),t.pageX-this.offset.click.left>n[2]&&(l=n[2]+this.offset.click.left),t.pageY-this.offset.click.top>n[3]&&(u=n[3]+this.offset.click.top)),a.grid&&(o=a.grid[1]?this.originalPageY+Math.round((u-this.originalPageY)/a.grid[1])*a.grid[1]:this.originalPageY,u=n?o-this.offset.click.top>=n[1]||o-this.offset.click.top>n[3]?o:o-this.offset.click.top>=n[1]?o-a.grid[1]:o+a.grid[1]:o,r=a.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/a.grid[0])*a.grid[0]:this.originalPageX,l=n?r-this.offset.click.left>=n[0]||r-this.offset.click.left>n[2]?r:r-this.offset.click.left>=n[0]?r-a.grid[0]:r+a.grid[0]:r)),{top:u-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,n,i){return i=i||this._uiHash(),e.ui.plugin.call(this,t,[n,i]),"drag"===t&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,n,i)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,n){var i=e(this).data("ui-draggable"),o=i.options,r=e.extend({},n,{item:i.element});i.sortables=[],e(o.connectToSortable).each(function(){var n=e.data(this,"ui-sortable");n&&!n.options.disabled&&(i.sortables.push({instance:n,shouldRevert:n.options.revert}),n.refreshPositions(),n._trigger("activate",t,r))})},stop:function(t,n){var i=e(this).data("ui-draggable"),o=e.extend({},n,{item:i.element});e.each(i.sortables,function(){this.instance.isOver?(this.instance.isOver=0,i.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,"original"===i.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,o))})},drag:function(t,n){var i=e(this).data("ui-draggable"),o=this;e.each(i.sortables,function(){var r=!1,a=this;this.instance.positionAbs=i.positionAbs,this.instance.helperProportions=i.helperProportions,this.instance.offset.click=i.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(r=!0,e.each(i.sortables,function(){return this.instance.positionAbs=i.positionAbs,this.instance.helperProportions=i.helperProportions,this.instance.offset.click=i.offset.click,this!==a&&this.instance._intersectsWith(this.instance.containerCache)&&e.contains(a.instance.element[0],this.instance.element[0])&&(r=!1),r})),r?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(o).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return n.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=i.offset.click.top,this.instance.offset.click.left=i.offset.click.left,this.instance.offset.parent.left-=i.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=i.offset.parent.top-this.instance.offset.parent.top,i._trigger("toSortable",t),i.dropped=this.instance.element,i.currentItem=i.element,this.instance.fromOutside=i),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),i._trigger("fromSortable",t),i.dropped=!1)
})}}),e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),n=e(this).data("ui-draggable").options;t.css("cursor")&&(n._cursor=t.css("cursor")),t.css("cursor",n.cursor)},stop:function(){var t=e(this).data("ui-draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,n){var i=e(n.helper),o=e(this).data("ui-draggable").options;i.css("opacity")&&(o._opacity=i.css("opacity")),i.css("opacity",o.opacity)},stop:function(t,n){var i=e(this).data("ui-draggable").options;i._opacity&&e(n.helper).css("opacity",i._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("ui-draggable");t.scrollParent[0]!==document&&"HTML"!==t.scrollParent[0].tagName&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var n=e(this).data("ui-draggable"),i=n.options,o=!1;n.scrollParent[0]!==document&&"HTML"!==n.scrollParent[0].tagName?(i.axis&&"x"===i.axis||(n.overflowOffset.top+n.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity?n.scrollParent[0].scrollTop=o=n.scrollParent[0].scrollTop+i.scrollSpeed:t.pageY-n.overflowOffset.top<i.scrollSensitivity&&(n.scrollParent[0].scrollTop=o=n.scrollParent[0].scrollTop-i.scrollSpeed)),i.axis&&"y"===i.axis||(n.overflowOffset.left+n.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity?n.scrollParent[0].scrollLeft=o=n.scrollParent[0].scrollLeft+i.scrollSpeed:t.pageX-n.overflowOffset.left<i.scrollSensitivity&&(n.scrollParent[0].scrollLeft=o=n.scrollParent[0].scrollLeft-i.scrollSpeed))):(i.axis&&"x"===i.axis||(t.pageY-e(document).scrollTop()<i.scrollSensitivity?o=e(document).scrollTop(e(document).scrollTop()-i.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<i.scrollSensitivity&&(o=e(document).scrollTop(e(document).scrollTop()+i.scrollSpeed))),i.axis&&"y"===i.axis||(t.pageX-e(document).scrollLeft()<i.scrollSensitivity?o=e(document).scrollLeft(e(document).scrollLeft()-i.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<i.scrollSensitivity&&(o=e(document).scrollLeft(e(document).scrollLeft()+i.scrollSpeed)))),o!==!1&&e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(n,t)}}),e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("ui-draggable"),n=t.options;t.snapElements=[],e(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var n=e(this),i=n.offset();this!==t.element[0]&&t.snapElements.push({item:this,width:n.outerWidth(),height:n.outerHeight(),top:i.top,left:i.left})})},drag:function(t,n){var i,o,r,a,s,l,u,c,d,h,p=e(this).data("ui-draggable"),f=p.options,m=f.snapTolerance,g=n.offset.left,v=g+p.helperProportions.width,y=n.offset.top,b=y+p.helperProportions.height;for(d=p.snapElements.length-1;d>=0;d--)s=p.snapElements[d].left,l=s+p.snapElements[d].width,u=p.snapElements[d].top,c=u+p.snapElements[d].height,s-m>v||g>l+m||u-m>b||y>c+m||!e.contains(p.snapElements[d].item.ownerDocument,p.snapElements[d].item)?(p.snapElements[d].snapping&&p.options.snap.release&&p.options.snap.release.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[d].item})),p.snapElements[d].snapping=!1):("inner"!==f.snapMode&&(i=m>=Math.abs(u-b),o=m>=Math.abs(c-y),r=m>=Math.abs(s-v),a=m>=Math.abs(l-g),i&&(n.position.top=p._convertPositionTo("relative",{top:u-p.helperProportions.height,left:0}).top-p.margins.top),o&&(n.position.top=p._convertPositionTo("relative",{top:c,left:0}).top-p.margins.top),r&&(n.position.left=p._convertPositionTo("relative",{top:0,left:s-p.helperProportions.width}).left-p.margins.left),a&&(n.position.left=p._convertPositionTo("relative",{top:0,left:l}).left-p.margins.left)),h=i||o||r||a,"outer"!==f.snapMode&&(i=m>=Math.abs(u-y),o=m>=Math.abs(c-b),r=m>=Math.abs(s-g),a=m>=Math.abs(l-v),i&&(n.position.top=p._convertPositionTo("relative",{top:u,left:0}).top-p.margins.top),o&&(n.position.top=p._convertPositionTo("relative",{top:c-p.helperProportions.height,left:0}).top-p.margins.top),r&&(n.position.left=p._convertPositionTo("relative",{top:0,left:s}).left-p.margins.left),a&&(n.position.left=p._convertPositionTo("relative",{top:0,left:l-p.helperProportions.width}).left-p.margins.left)),!p.snapElements[d].snapping&&(i||o||r||a||h)&&p.options.snap.snap&&p.options.snap.snap.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[d].item})),p.snapElements[d].snapping=i||o||r||a||h)}}),e.ui.plugin.add("draggable","stack",{start:function(){var t,n=this.data("ui-draggable").options,i=e.makeArray(e(n.stack)).sort(function(t,n){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(n).css("zIndex"),10)||0)});i.length&&(t=parseInt(e(i[0]).css("zIndex"),10)||0,e(i).each(function(n){e(this).css("zIndex",t+n)}),this.css("zIndex",t+i.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,n){var i=e(n.helper),o=e(this).data("ui-draggable").options;i.css("zIndex")&&(o._zIndex=i.css("zIndex")),i.css("zIndex",o.zIndex)},stop:function(t,n){var i=e(this).data("ui-draggable").options;i._zIndex&&e(n.helper).css("zIndex",i._zIndex)}})}(jQuery),function(e){function t(e){return parseInt(e,10)||0}function n(e){return!isNaN(parseInt(e,10))}e.widget("ui.resizable",e.ui.mouse,{version:"1.10.3",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var t,n,i,o,r,a=this,s=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!s.aspectRatio,aspectRatio:s.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:s.helper||s.ghost||s.animate?s.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=s.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={},n=0;t.length>n;n++)i=e.trim(t[n]),r="ui-resizable-"+i,o=e("<div class='ui-resizable-handle "+r+"'></div>"),o.css({zIndex:s.zIndex}),"se"===i&&o.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[i]=".ui-resizable-"+i,this.element.append(o);this._renderAxis=function(t){var n,i,o,r;t=t||this.element;for(n in this.handles)this.handles[n].constructor===String&&(this.handles[n]=e(this.handles[n],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(i=e(this.handles[n],this.element),r=/sw|ne|nw|se|n|s/.test(n)?i.outerHeight():i.outerWidth(),o=["padding",/ne|nw|n/.test(n)?"Top":/se|sw|s/.test(n)?"Bottom":/^e$/.test(n)?"Right":"Left"].join(""),t.css(o,r),this._proportionallyResize()),e(this.handles[n]).length},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){a.resizing||(this.className&&(o=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),a.axis=o&&o[1]?o[1]:"se")}),s.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){s.disabled||(e(this).removeClass("ui-resizable-autohide"),a._handles.show())}).mouseleave(function(){s.disabled||a.resizing||(e(this).addClass("ui-resizable-autohide"),a._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,n=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(n(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),n(this.originalElement),this},_mouseCapture:function(t){var n,i,o=!1;for(n in this.handles)i=e(this.handles[n])[0],(i===t.target||e.contains(i,t.target))&&(o=!0);return!this.options.disabled&&o},_mouseStart:function(n){var i,o,r,a=this.options,s=this.element.position(),l=this.element;return this.resizing=!0,/absolute/.test(l.css("position"))?l.css({position:"absolute",top:l.css("top"),left:l.css("left")}):l.is(".ui-draggable")&&l.css({position:"absolute",top:s.top,left:s.left}),this._renderProxy(),i=t(this.helper.css("left")),o=t(this.helper.css("top")),a.containment&&(i+=e(a.containment).scrollLeft()||0,o+=e(a.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:o},this.size=this._helper?{width:l.outerWidth(),height:l.outerHeight()}:{width:l.width(),height:l.height()},this.originalSize=this._helper?{width:l.outerWidth(),height:l.outerHeight()}:{width:l.width(),height:l.height()},this.originalPosition={left:i,top:o},this.sizeDiff={width:l.outerWidth()-l.width(),height:l.outerHeight()-l.height()},this.originalMousePosition={left:n.pageX,top:n.pageY},this.aspectRatio="number"==typeof a.aspectRatio?a.aspectRatio:this.originalSize.width/this.originalSize.height||1,r=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===r?this.axis+"-resize":r),l.addClass("ui-resizable-resizing"),this._propagate("start",n),!0},_mouseDrag:function(t){var n,i=this.helper,o={},r=this.originalMousePosition,a=this.axis,s=this.position.top,l=this.position.left,u=this.size.width,c=this.size.height,d=t.pageX-r.left||0,h=t.pageY-r.top||0,p=this._change[a];return p?(n=p.apply(this,[t,d,h]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(n=this._updateRatio(n,t)),n=this._respectSize(n,t),this._updateCache(n),this._propagate("resize",t),this.position.top!==s&&(o.top=this.position.top+"px"),this.position.left!==l&&(o.left=this.position.left+"px"),this.size.width!==u&&(o.width=this.size.width+"px"),this.size.height!==c&&(o.height=this.size.height+"px"),i.css(o),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(o)||this._trigger("resize",t,this.ui()),!1):!1},_mouseStop:function(t){this.resizing=!1;var n,i,o,r,a,s,l,u=this.options,c=this;return this._helper&&(n=this._proportionallyResizeElements,i=n.length&&/textarea/i.test(n[0].nodeName),o=i&&e.ui.hasScroll(n[0],"left")?0:c.sizeDiff.height,r=i?0:c.sizeDiff.width,a={width:c.helper.width()-r,height:c.helper.height()-o},s=parseInt(c.element.css("left"),10)+(c.position.left-c.originalPosition.left)||null,l=parseInt(c.element.css("top"),10)+(c.position.top-c.originalPosition.top)||null,u.animate||this.element.css(e.extend(a,{top:l,left:s})),c.helper.height(c.size.height),c.helper.width(c.size.width),this._helper&&!u.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(e){var t,i,o,r,a,s=this.options;a={minWidth:n(s.minWidth)?s.minWidth:0,maxWidth:n(s.maxWidth)?s.maxWidth:1/0,minHeight:n(s.minHeight)?s.minHeight:0,maxHeight:n(s.maxHeight)?s.maxHeight:1/0},(this._aspectRatio||e)&&(t=a.minHeight*this.aspectRatio,o=a.minWidth/this.aspectRatio,i=a.maxHeight*this.aspectRatio,r=a.maxWidth/this.aspectRatio,t>a.minWidth&&(a.minWidth=t),o>a.minHeight&&(a.minHeight=o),a.maxWidth>i&&(a.maxWidth=i),a.maxHeight>r&&(a.maxHeight=r)),this._vBoundaries=a},_updateCache:function(e){this.offset=this.helper.offset(),n(e.left)&&(this.position.left=e.left),n(e.top)&&(this.position.top=e.top),n(e.height)&&(this.size.height=e.height),n(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,i=this.size,o=this.axis;return n(e.height)?e.width=e.height*this.aspectRatio:n(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===o&&(e.left=t.left+(i.width-e.width),e.top=null),"nw"===o&&(e.top=t.top+(i.height-e.height),e.left=t.left+(i.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,i=this.axis,o=n(e.width)&&t.maxWidth&&t.maxWidth<e.width,r=n(e.height)&&t.maxHeight&&t.maxHeight<e.height,a=n(e.width)&&t.minWidth&&t.minWidth>e.width,s=n(e.height)&&t.minHeight&&t.minHeight>e.height,l=this.originalPosition.left+this.originalSize.width,u=this.position.top+this.size.height,c=/sw|nw|w/.test(i),d=/nw|ne|n/.test(i);return a&&(e.width=t.minWidth),s&&(e.height=t.minHeight),o&&(e.width=t.maxWidth),r&&(e.height=t.maxHeight),a&&c&&(e.left=l-t.minWidth),o&&c&&(e.left=l-t.maxWidth),s&&d&&(e.top=u-t.minHeight),r&&d&&(e.top=u-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){var e,t,n,i,o,r=this.helper||this.element;for(e=0;this._proportionallyResizeElements.length>e;e++){if(o=this._proportionallyResizeElements[e],!this.borderDif)for(this.borderDif=[],n=[o.css("borderTopWidth"),o.css("borderRightWidth"),o.css("borderBottomWidth"),o.css("borderLeftWidth")],i=[o.css("paddingTop"),o.css("paddingRight"),o.css("paddingBottom"),o.css("paddingLeft")],t=0;n.length>t;t++)this.borderDif[t]=(parseInt(n[t],10)||0)+(parseInt(i[t],10)||0);o.css({height:r.height()-this.borderDif[0]-this.borderDif[2]||0,width:r.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var t=this.element,n=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++n.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var n=this.originalSize,i=this.originalPosition;return{left:i.left+t,width:n.width-t}},n:function(e,t,n){var i=this.originalSize,o=this.originalPosition;return{top:o.top+n,height:i.height-n}},s:function(e,t,n){return{height:this.originalSize.height+n}},se:function(t,n,i){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,n,i]))},sw:function(t,n,i){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,n,i]))},ne:function(t,n,i){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,n,i]))},nw:function(t,n,i){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,n,i]))}},_propagate:function(t,n){e.ui.plugin.call(this,t,[n,this.ui()]),"resize"!==t&&this._trigger(t,n,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var n=e(this).data("ui-resizable"),i=n.options,o=n._proportionallyResizeElements,r=o.length&&/textarea/i.test(o[0].nodeName),a=r&&e.ui.hasScroll(o[0],"left")?0:n.sizeDiff.height,s=r?0:n.sizeDiff.width,l={width:n.size.width-s,height:n.size.height-a},u=parseInt(n.element.css("left"),10)+(n.position.left-n.originalPosition.left)||null,c=parseInt(n.element.css("top"),10)+(n.position.top-n.originalPosition.top)||null;n.element.animate(e.extend(l,c&&u?{top:c,left:u}:{}),{duration:i.animateDuration,easing:i.animateEasing,step:function(){var i={width:parseInt(n.element.css("width"),10),height:parseInt(n.element.css("height"),10),top:parseInt(n.element.css("top"),10),left:parseInt(n.element.css("left"),10)};o&&o.length&&e(o[0]).css({width:i.width,height:i.height}),n._updateCache(i),n._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var n,i,o,r,a,s,l,u=e(this).data("ui-resizable"),c=u.options,d=u.element,h=c.containment,p=h instanceof e?h.get(0):/parent/.test(h)?d.parent().get(0):h;p&&(u.containerElement=e(p),/document/.test(h)||h===document?(u.containerOffset={left:0,top:0},u.containerPosition={left:0,top:0},u.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(n=e(p),i=[],e(["Top","Right","Left","Bottom"]).each(function(e,o){i[e]=t(n.css("padding"+o))}),u.containerOffset=n.offset(),u.containerPosition=n.position(),u.containerSize={height:n.innerHeight()-i[3],width:n.innerWidth()-i[1]},o=u.containerOffset,r=u.containerSize.height,a=u.containerSize.width,s=e.ui.hasScroll(p,"left")?p.scrollWidth:a,l=e.ui.hasScroll(p)?p.scrollHeight:r,u.parentData={element:p,left:o.left,top:o.top,width:s,height:l}))},resize:function(t){var n,i,o,r,a=e(this).data("ui-resizable"),s=a.options,l=a.containerOffset,u=a.position,c=a._aspectRatio||t.shiftKey,d={top:0,left:0},h=a.containerElement;h[0]!==document&&/static/.test(h.css("position"))&&(d=l),u.left<(a._helper?l.left:0)&&(a.size.width=a.size.width+(a._helper?a.position.left-l.left:a.position.left-d.left),c&&(a.size.height=a.size.width/a.aspectRatio),a.position.left=s.helper?l.left:0),u.top<(a._helper?l.top:0)&&(a.size.height=a.size.height+(a._helper?a.position.top-l.top:a.position.top),c&&(a.size.width=a.size.height*a.aspectRatio),a.position.top=a._helper?l.top:0),a.offset.left=a.parentData.left+a.position.left,a.offset.top=a.parentData.top+a.position.top,n=Math.abs((a._helper?a.offset.left-d.left:a.offset.left-d.left)+a.sizeDiff.width),i=Math.abs((a._helper?a.offset.top-d.top:a.offset.top-l.top)+a.sizeDiff.height),o=a.containerElement.get(0)===a.element.parent().get(0),r=/relative|absolute/.test(a.containerElement.css("position")),o&&r&&(n-=a.parentData.left),n+a.size.width>=a.parentData.width&&(a.size.width=a.parentData.width-n,c&&(a.size.height=a.size.width/a.aspectRatio)),i+a.size.height>=a.parentData.height&&(a.size.height=a.parentData.height-i,c&&(a.size.width=a.size.height*a.aspectRatio))},stop:function(){var t=e(this).data("ui-resizable"),n=t.options,i=t.containerOffset,o=t.containerPosition,r=t.containerElement,a=e(t.helper),s=a.offset(),l=a.outerWidth()-t.sizeDiff.width,u=a.outerHeight()-t.sizeDiff.height;t._helper&&!n.animate&&/relative/.test(r.css("position"))&&e(this).css({left:s.left-o.left-i.left,width:l,height:u}),t._helper&&!n.animate&&/static/.test(r.css("position"))&&e(this).css({left:s.left-o.left-i.left,width:l,height:u})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).data("ui-resizable"),n=t.options,i=function(t){e(t).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})};"object"!=typeof n.alsoResize||n.alsoResize.parentNode?i(n.alsoResize):n.alsoResize.length?(n.alsoResize=n.alsoResize[0],i(n.alsoResize)):e.each(n.alsoResize,function(e){i(e)})},resize:function(t,n){var i=e(this).data("ui-resizable"),o=i.options,r=i.originalSize,a=i.originalPosition,s={height:i.size.height-r.height||0,width:i.size.width-r.width||0,top:i.position.top-a.top||0,left:i.position.left-a.left||0},l=function(t,i){e(t).each(function(){var t=e(this),o=e(this).data("ui-resizable-alsoresize"),r={},a=i&&i.length?i:t.parents(n.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(a,function(e,t){var n=(o[t]||0)+(s[t]||0);n&&n>=0&&(r[t]=n||null)}),t.css(r)})};"object"!=typeof o.alsoResize||o.alsoResize.nodeType?l(o.alsoResize):e.each(o.alsoResize,function(e,t){l(e,t)})},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).data("ui-resizable"),n=t.options,i=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof n.ghost?n.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).data("ui-resizable");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).data("ui-resizable");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t=e(this).data("ui-resizable"),n=t.options,i=t.size,o=t.originalSize,r=t.originalPosition,a=t.axis,s="number"==typeof n.grid?[n.grid,n.grid]:n.grid,l=s[0]||1,u=s[1]||1,c=Math.round((i.width-o.width)/l)*l,d=Math.round((i.height-o.height)/u)*u,h=o.width+c,p=o.height+d,f=n.maxWidth&&h>n.maxWidth,m=n.maxHeight&&p>n.maxHeight,g=n.minWidth&&n.minWidth>h,v=n.minHeight&&n.minHeight>p;n.grid=s,g&&(h+=l),v&&(p+=u),f&&(h-=l),m&&(p-=u),/^(se|s|e)$/.test(a)?(t.size.width=h,t.size.height=p):/^(ne)$/.test(a)?(t.size.width=h,t.size.height=p,t.position.top=r.top-d):/^(sw)$/.test(a)?(t.size.width=h,t.size.height=p,t.position.left=r.left-c):(t.size.width=h,t.size.height=p,t.position.top=r.top-d,t.position.left=r.left-c)}})}(jQuery),function(e){var t,n,i,o,r="ui-button ui-widget ui-state-default ui-corner-all",a="ui-state-hover ui-state-active ",s="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",l=function(){var t=e(this);setTimeout(function(){t.find(":ui-button").button("refresh")},1)},u=function(t){var n=t.name,i=t.form,o=e([]);return n&&(n=n.replace(/'/g,"\\'"),o=i?e(i).find("[name='"+n+"']"):e("[name='"+n+"']",t.ownerDocument).filter(function(){return!this.form})),o};e.widget("ui.button",{version:"1.10.3",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,l),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var a=this,s=this.options,c="checkbox"===this.type||"radio"===this.type,d=c?"":"ui-state-active",h="ui-state-focus";null===s.label&&(s.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(r).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){s.disabled||this===t&&e(this).addClass("ui-state-active")}).bind("mouseleave"+this.eventNamespace,function(){s.disabled||e(this).removeClass(d)}).bind("click"+this.eventNamespace,function(e){s.disabled&&(e.preventDefault(),e.stopImmediatePropagation())}),this.element.bind("focus"+this.eventNamespace,function(){a.buttonElement.addClass(h)}).bind("blur"+this.eventNamespace,function(){a.buttonElement.removeClass(h)}),c&&(this.element.bind("change"+this.eventNamespace,function(){o||a.refresh()}),this.buttonElement.bind("mousedown"+this.eventNamespace,function(e){s.disabled||(o=!1,n=e.pageX,i=e.pageY)}).bind("mouseup"+this.eventNamespace,function(e){s.disabled||(n!==e.pageX||i!==e.pageY)&&(o=!0)})),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){return s.disabled||o?!1:void 0}):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(s.disabled||o)return!1;e(this).addClass("ui-state-active"),a.buttonElement.attr("aria-pressed","true");var t=a.element[0];u(t).not(t).map(function(){return e(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){return s.disabled?!1:(e(this).addClass("ui-state-active"),t=this,a.document.one("mouseup",function(){t=null}),void 0)}).bind("mouseup"+this.eventNamespace,function(){return s.disabled?!1:(e(this).removeClass("ui-state-active"),void 0)}).bind("keydown"+this.eventNamespace,function(t){return s.disabled?!1:((t.keyCode===e.ui.keyCode.SPACE||t.keyCode===e.ui.keyCode.ENTER)&&e(this).addClass("ui-state-active"),void 0)}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){e(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(t){t.keyCode===e.ui.keyCode.SPACE&&e(this).click()})),this._setOption("disabled",s.disabled),this._resetButton()},_determineButtonType:function(){var e,t,n;this.type=this.element.is("[type=checkbox]")?"checkbox":this.element.is("[type=radio]")?"radio":this.element.is("input")?"input":"button","checkbox"===this.type||"radio"===this.type?(e=this.element.parents().last(),t="label[for='"+this.element.attr("id")+"']",this.buttonElement=e.find(t),this.buttonElement.length||(e=e.length?e.siblings():this.element.siblings(),this.buttonElement=e.filter(t),this.buttonElement.length||(this.buttonElement=e.find(t))),this.element.addClass("ui-helper-hidden-accessible"),n=this.element.is(":checked"),n&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",n)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(r+" "+a+" "+s).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(e,t){return this._super(e,t),"disabled"===e?(t?this.element.prop("disabled",!0):this.element.prop("disabled",!1),void 0):(this._resetButton(),void 0)},refresh:function(){var t=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOption("disabled",t),"radio"===this.type?u(this.element[0]).each(function(){e(this).is(":checked")?e(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):e(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"===this.type)return this.options.label&&this.element.val(this.options.label),void 0;var t=this.buttonElement.removeClass(s),n=e("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(t.empty()).text(),i=this.options.icons,o=i.primary&&i.secondary,r=[];i.primary||i.secondary?(this.options.text&&r.push("ui-button-text-icon"+(o?"s":i.primary?"-primary":"-secondary")),i.primary&&t.prepend("<span class='ui-button-icon-primary ui-icon "+i.primary+"'></span>"),i.secondary&&t.append("<span class='ui-button-icon-secondary ui-icon "+i.secondary+"'></span>"),this.options.text||(r.push(o?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||t.attr("title",e.trim(n)))):r.push("ui-button-text-only"),t.addClass(r.join(" "))}}),e.widget("ui.buttonset",{version:"1.10.3",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(e,t){"disabled"===e&&this.buttons.button("option",e,t),this._super(e,t)},refresh:function(){var t="rtl"===this.element.css("direction");this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(t?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(t?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}})}(jQuery),function(e){var t={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},n={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};e.widget("ui.dialog",{version:"1.10.3",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(t){var n=e(this).css(t).offset().top;0>n&&e(this).css("top",t.top-n)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&e.fn.draggable&&this._makeDraggable(),this.options.resizable&&e.fn.resizable&&this._makeResizable(),this._isOpen=!1},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var t=this.options.appendTo;return t&&(t.jquery||t.nodeType)?e(t):this.document.find(t||"body").eq(0)},_destroy:function(){var e,t=this.originalPosition;this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),e=t.parent.children().eq(t.index),e.length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element)},widget:function(){return this.uiDialog},disable:e.noop,enable:e.noop,close:function(t){var n=this;this._isOpen&&this._trigger("beforeClose",t)!==!1&&(this._isOpen=!1,this._destroyOverlay(),this.opener.filter(":focusable").focus().length||e(this.document[0].activeElement).blur(),this._hide(this.uiDialog,this.options.hide,function(){n._trigger("close",t)}))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(e,t){var n=!!this.uiDialog.nextAll(":visible").insertBefore(this.uiDialog).length;return n&&!t&&this._trigger("focus",e),n},open:function(){var t=this;return this._isOpen?(this._moveToTop()&&this._focusTabbable(),void 0):(this._isOpen=!0,this.opener=e(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this._show(this.uiDialog,this.options.show,function(){t._focusTabbable(),t._trigger("focus")
}),this._trigger("open"),void 0)},_focusTabbable:function(){var e=this.element.find("[autofocus]");e.length||(e=this.element.find(":tabbable")),e.length||(e=this.uiDialogButtonPane.find(":tabbable")),e.length||(e=this.uiDialogTitlebarClose.filter(":tabbable")),e.length||(e=this.uiDialog),e.eq(0).focus()},_keepFocus:function(t){function n(){var t=this.document[0].activeElement,n=this.uiDialog[0]===t||e.contains(this.uiDialog[0],t);n||this._focusTabbable()}t.preventDefault(),n.call(this),this._delay(n)},_createWrapper:function(){this.uiDialog=e("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(t){if(this.options.closeOnEscape&&!t.isDefaultPrevented()&&t.keyCode&&t.keyCode===e.ui.keyCode.ESCAPE)return t.preventDefault(),this.close(t),void 0;if(t.keyCode===e.ui.keyCode.TAB){var n=this.uiDialog.find(":tabbable"),i=n.filter(":first"),o=n.filter(":last");t.target!==o[0]&&t.target!==this.uiDialog[0]||t.shiftKey?t.target!==i[0]&&t.target!==this.uiDialog[0]||!t.shiftKey||(o.focus(1),t.preventDefault()):(i.focus(1),t.preventDefault())}},mousedown:function(e){this._moveToTop(e)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var t;this.uiDialogTitlebar=e("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(t){e(t.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=e("<button></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(e){e.preventDefault(),this.close(e)}}),t=e("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(t),this.uiDialog.attr({"aria-labelledby":t.attr("id")})},_title:function(e){this.options.title||e.html("&#160;"),e.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=e("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=e("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var t=this,n=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),e.isEmptyObject(n)||e.isArray(n)&&!n.length?(this.uiDialog.removeClass("ui-dialog-buttons"),void 0):(e.each(n,function(n,i){var o,r;i=e.isFunction(i)?{click:i,text:n}:i,i=e.extend({type:"button"},i),o=i.click,i.click=function(){o.apply(t.element[0],arguments)},r={icons:i.icons,text:i.showText},delete i.icons,delete i.showText,e("<button></button>",i).button(r).appendTo(t.uiButtonSet)}),this.uiDialog.addClass("ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog),void 0)},_makeDraggable:function(){function t(e){return{position:e.position,offset:e.offset}}var n=this,i=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(i,o){e(this).addClass("ui-dialog-dragging"),n._blockFrames(),n._trigger("dragStart",i,t(o))},drag:function(e,i){n._trigger("drag",e,t(i))},stop:function(o,r){i.position=[r.position.left-n.document.scrollLeft(),r.position.top-n.document.scrollTop()],e(this).removeClass("ui-dialog-dragging"),n._unblockFrames(),n._trigger("dragStop",o,t(r))}})},_makeResizable:function(){function t(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}var n=this,i=this.options,o=i.resizable,r=this.uiDialog.css("position"),a="string"==typeof o?o:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:i.maxWidth,maxHeight:i.maxHeight,minWidth:i.minWidth,minHeight:this._minHeight(),handles:a,start:function(i,o){e(this).addClass("ui-dialog-resizing"),n._blockFrames(),n._trigger("resizeStart",i,t(o))},resize:function(e,i){n._trigger("resize",e,t(i))},stop:function(o,r){i.height=e(this).height(),i.width=e(this).width(),e(this).removeClass("ui-dialog-resizing"),n._unblockFrames(),n._trigger("resizeStop",o,t(r))}}).css("position",r)},_minHeight:function(){var e=this.options;return"auto"===e.height?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(){var e=this.uiDialog.is(":visible");e||this.uiDialog.show(),this.uiDialog.position(this.options.position),e||this.uiDialog.hide()},_setOptions:function(i){var o=this,r=!1,a={};e.each(i,function(e,i){o._setOption(e,i),e in t&&(r=!0),e in n&&(a[e]=i)}),r&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",a)},_setOption:function(e,t){var n,i,o=this.uiDialog;"dialogClass"===e&&o.removeClass(this.options.dialogClass).addClass(t),"disabled"!==e&&(this._super(e,t),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:""+t}),"draggable"===e&&(n=o.is(":data(ui-draggable)"),n&&!t&&o.draggable("destroy"),!n&&t&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&(i=o.is(":data(ui-resizable)"),i&&!t&&o.resizable("destroy"),i&&"string"==typeof t&&o.resizable("option","handles",t),i||t===!1||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var e,t,n,i=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),i.minWidth>i.width&&(i.width=i.minWidth),e=this.uiDialog.css({height:"auto",width:i.width}).outerHeight(),t=Math.max(0,i.minHeight-e),n="number"==typeof i.maxHeight?Math.max(0,i.maxHeight-e):"none","auto"===i.height?this.element.css({minHeight:t,maxHeight:n,height:"auto"}):this.element.height(Math.max(0,i.height-e)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var t=e(this);return e("<div>").css({position:"absolute",width:t.outerWidth(),height:t.outerHeight()}).appendTo(t.parent()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(t){return e(t.target).closest(".ui-dialog").length?!0:!!e(t.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var t=this,n=this.widgetFullName;e.ui.dialog.overlayInstances||this._delay(function(){e.ui.dialog.overlayInstances&&this.document.bind("focusin.dialog",function(i){t._allowInteraction(i)||(i.preventDefault(),e(".ui-dialog:visible:last .ui-dialog-content").data(n)._focusTabbable())})}),this.overlay=e("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),e.ui.dialog.overlayInstances++}},_destroyOverlay:function(){this.options.modal&&this.overlay&&(e.ui.dialog.overlayInstances--,e.ui.dialog.overlayInstances||this.document.unbind("focusin.dialog"),this.overlay.remove(),this.overlay=null)}}),e.ui.dialog.overlayInstances=0,e.uiBackCompat!==!1&&e.widget("ui.dialog",e.ui.dialog,{_position:function(){var t,n=this.options.position,i=[],o=[0,0];n?(("string"==typeof n||"object"==typeof n&&"0"in n)&&(i=n.split?n.split(" "):[n[0],n[1]],1===i.length&&(i[1]=i[0]),e.each(["left","top"],function(e,t){+i[e]===i[e]&&(o[e]=i[e],i[e]=t)}),n={my:i[0]+(0>o[0]?o[0]:"+"+o[0])+" "+i[1]+(0>o[1]?o[1]:"+"+o[1]),at:i.join(" ")}),n=e.extend({},e.ui.dialog.prototype.options.position,n)):n=e.ui.dialog.prototype.options.position,t=this.uiDialog.is(":visible"),t||this.uiDialog.show(),this.uiDialog.position(n),t||this.uiDialog.hide()}})}(jQuery),function(e){e.widget("ui.menu",{version:"1.10.3",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,e.proxy(function(e){this.options.disabled&&e.preventDefault()},this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item > a":function(e){e.preventDefault()},"click .ui-state-disabled > a":function(e){e.preventDefault()},"click .ui-menu-item:has(a)":function(t){var n=e(t.target).closest(".ui-menu-item");!this.mouseHandled&&n.not(".ui-state-disabled").length&&(this.mouseHandled=!0,this.select(t),n.has(".ui-menu").length?this.expand(t):this.element.is(":focus")||(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(t){var n=e(t.currentTarget);n.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(t,n)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var n=this.active||this.element.children(".ui-menu-item").eq(0);t||this.focus(e,n)},blur:function(t){this._delay(function(){e.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(t)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(t){e(t.target).closest(".ui-menu").length||this.collapseAll(t),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var t=e(this);t.data("ui-menu-submenu-carat")&&t.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(t){function n(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var i,o,r,a,s,l=!0;switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);break;case e.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);break;default:l=!1,o=this.previousFilter||"",r=String.fromCharCode(t.keyCode),a=!1,clearTimeout(this.filterTimer),r===o?a=!0:r=o+r,s=RegExp("^"+n(r),"i"),i=this.activeMenu.children(".ui-menu-item").filter(function(){return s.test(e(this).children("a").text())}),i=a&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i,i.length||(r=String.fromCharCode(t.keyCode),s=RegExp("^"+n(r),"i"),i=this.activeMenu.children(".ui-menu-item").filter(function(){return s.test(e(this).children("a").text())})),i.length?(this.focus(t,i),i.length>1?(this.previousFilter=r,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter):delete this.previousFilter}l&&t.preventDefault()},_activate:function(e){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(e):this.select(e))},refresh:function(){var t,n=this.options.icons.submenu,i=this.element.find(this.options.menus);i.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var t=e(this),i=t.prev("a"),o=e("<span>").addClass("ui-menu-icon ui-icon "+n).data("ui-menu-submenu-carat",!0);i.attr("aria-haspopup","true").prepend(o),t.attr("aria-labelledby",i.attr("id"))}),t=i.add(this.element),t.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()}),t.children(":not(.ui-menu-item)").each(function(){var t=e(this);/[^\-\u2014\u2013\s]/.test(t.text())||t.addClass("ui-widget-content ui-menu-divider")}),t.children(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!e.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(e,t){"icons"===e&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(t.submenu),this._super(e,t)},focus:function(e,t){var n,i;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(t),this.active=t.first(),i=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",i.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),e&&"keydown"===e.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),n=t.children(".ui-menu"),n.length&&/^mouse/.test(e.type)&&this._startOpening(n),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(t){var n,i,o,r,a,s;this._hasScroll()&&(n=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,i=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0,o=t.offset().top-this.activeMenu.offset().top-n-i,r=this.activeMenu.scrollTop(),a=this.activeMenu.height(),s=t.height(),0>o?this.activeMenu.scrollTop(r+o):o+s>a&&this.activeMenu.scrollTop(r+o-a+s))},blur:function(e,t){t||clearTimeout(this.timer),this.active&&(this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active}))},_startOpening:function(e){clearTimeout(this.timer),"true"===e.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(e)},this.delay))},_open:function(t){var n=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true"),t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(n)},collapseAll:function(t,n){clearTimeout(this.timer),this.timer=this._delay(function(){var i=n?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));i.length||(i=this.element),this._close(i),this.blur(t),this.activeMenu=i},this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,n){var i;this.active&&(i="first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[e+"All"](".ui-menu-item").eq(0)),i&&i.length&&this.active||(i=this.activeMenu.children(".ui-menu-item")[t]()),this.focus(n,i)},nextPage:function(t){var n,i,o;return this.active?(this.isLastItem()||(this._hasScroll()?(i=this.active.offset().top,o=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return n=e(this),0>n.offset().top-i-o}),this.focus(t,n)):this.focus(t,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]())),void 0):(this.next(t),void 0)},previousPage:function(t){var n,i,o;return this.active?(this.isFirstItem()||(this._hasScroll()?(i=this.active.offset().top,o=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return n=e(this),n.offset().top-i+o>0}),this.focus(t,n)):this.focus(t,this.activeMenu.children(".ui-menu-item").first())),void 0):(this.next(t),void 0)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(t){this.active=this.active||e(t.target).closest(".ui-menu-item");var n={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(t,!0),this._trigger("select",t,n)}})}(jQuery),function(e){var t=5;e.widget("ui.slider",e.ui.mouse,{version:"1.10.3",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var t,n,i=this.options,o=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),r="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",a=[];for(n=i.values&&i.values.length||1,o.length>n&&(o.slice(n).remove(),o=o.slice(0,n)),t=o.length;n>t;t++)a.push(r);this.handles=o.add(e(a.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)})},_createRange:function(){var t=this.options,n="";t.range?(t.range===!0&&(t.values?t.values.length&&2!==t.values.length?t.values=[t.values[0],t.values[0]]:e.isArray(t.values)&&(t.values=t.values.slice(0)):t.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=e("<div></div>").appendTo(this.element),n="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(n+("min"===t.range||"max"===t.range?" ui-slider-range-"+t.range:""))):this.range=e([])},_setupEvents:function(){var e=this.handles.add(this.range).filter("a");this._off(e),this._on(e,this._handleEvents),this._hoverable(e),this._focusable(e)},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var n,i,o,r,a,s,l,u,c=this,d=this.options;return d.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),n={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(n),o=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var n=Math.abs(i-c.values(t));(o>n||o===n&&(t===c._lastChangedValue||c.values(t)===d.min))&&(o=n,r=e(this),a=t)}),s=this._start(t,a),s===!1?!1:(this._mouseSliding=!0,this._handleIndex=a,r.addClass("ui-state-active").focus(),l=r.offset(),u=!e(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=u?{left:0,top:0}:{left:t.pageX-l.left-r.width()/2,top:t.pageY-l.top-r.height()/2-(parseInt(r.css("borderTopWidth"),10)||0)-(parseInt(r.css("borderBottomWidth"),10)||0)+(parseInt(r.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,a,i),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},n=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,n),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,n,i,o,r;return"horizontal"===this.orientation?(t=this.elementSize.width,n=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,n=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),i=n/t,i>1&&(i=1),0>i&&(i=0),"vertical"===this.orientation&&(i=1-i),o=this._valueMax()-this._valueMin(),r=this._valueMin()+i*o,this._trimAlignValue(r)},_start:function(e,t){var n={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("start",e,n)},_slide:function(e,t,n){var i,o,r;this.options.values&&this.options.values.length?(i=this.values(t?0:1),2===this.options.values.length&&this.options.range===!0&&(0===t&&n>i||1===t&&i>n)&&(n=i),n!==this.values(t)&&(o=this.values(),o[t]=n,r=this._trigger("slide",e,{handle:this.handles[t],value:n,values:o}),i=this.values(t?0:1),r!==!1&&this.values(t,n,!0))):n!==this.value()&&(r=this._trigger("slide",e,{handle:this.handles[t],value:n}),r!==!1&&this.value(n))},_stop:function(e,t){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("stop",e,n)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._lastChangedValue=t,this._trigger("change",e,n)}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0),void 0):this._value()},values:function(t,n){var i,o,r;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(n),this._refreshValue(),this._change(null,t),void 0;if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();for(i=this.options.values,o=arguments[0],r=0;i.length>r;r+=1)i[r]=this._trimAlignValue(o[r]),this._change(null,r);this._refreshValue()},_setOption:function(t,n){var i,o=0;switch("range"===t&&this.options.range===!0&&("min"===n?(this.options.value=this._values(0),this.options.values=null):"max"===n&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),e.isArray(this.options.values)&&(o=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments),t){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),i=0;o>i;i+=1)this._change(null,i);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,n,i;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);if(this.options.values&&this.options.values.length){for(n=this.options.values.slice(),i=0;n.length>i;i+=1)n[i]=this._trimAlignValue(n[i]);return n}return[]},_trimAlignValue:function(e){if(this._valueMin()>=e)return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,n=(e-this._valueMin())%t,i=e-n;return 2*Math.abs(n)>=t&&(i+=n>0?t:-t),parseFloat(i.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,n,i,o,r,a=this.options.range,s=this.options,l=this,u=this._animateOff?!1:s.animate,c={};this.options.values&&this.options.values.length?this.handles.each(function(i){n=100*((l.values(i)-l._valueMin())/(l._valueMax()-l._valueMin())),c["horizontal"===l.orientation?"left":"bottom"]=n+"%",e(this).stop(1,1)[u?"animate":"css"](c,s.animate),l.options.range===!0&&("horizontal"===l.orientation?(0===i&&l.range.stop(1,1)[u?"animate":"css"]({left:n+"%"},s.animate),1===i&&l.range[u?"animate":"css"]({width:n-t+"%"},{queue:!1,duration:s.animate})):(0===i&&l.range.stop(1,1)[u?"animate":"css"]({bottom:n+"%"},s.animate),1===i&&l.range[u?"animate":"css"]({height:n-t+"%"},{queue:!1,duration:s.animate}))),t=n}):(i=this.value(),o=this._valueMin(),r=this._valueMax(),n=r!==o?100*((i-o)/(r-o)):0,c["horizontal"===this.orientation?"left":"bottom"]=n+"%",this.handle.stop(1,1)[u?"animate":"css"](c,s.animate),"min"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[u?"animate":"css"]({width:n+"%"},s.animate),"max"===a&&"horizontal"===this.orientation&&this.range[u?"animate":"css"]({width:100-n+"%"},{queue:!1,duration:s.animate}),"min"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[u?"animate":"css"]({height:n+"%"},s.animate),"max"===a&&"vertical"===this.orientation&&this.range[u?"animate":"css"]({height:100-n+"%"},{queue:!1,duration:s.animate}))},_handleEvents:{keydown:function(n){var i,o,r,a,s=e(n.target).data("ui-slider-handle-index");switch(n.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(n.preventDefault(),!this._keySliding&&(this._keySliding=!0,e(n.target).addClass("ui-state-active"),i=this._start(n,s),i===!1))return}switch(a=this.options.step,o=r=this.options.values&&this.options.values.length?this.values(s):this.value(),n.keyCode){case e.ui.keyCode.HOME:r=this._valueMin();break;case e.ui.keyCode.END:r=this._valueMax();break;case e.ui.keyCode.PAGE_UP:r=this._trimAlignValue(o+(this._valueMax()-this._valueMin())/t);break;case e.ui.keyCode.PAGE_DOWN:r=this._trimAlignValue(o-(this._valueMax()-this._valueMin())/t);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(o===this._valueMax())return;r=this._trimAlignValue(o+a);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(o===this._valueMin())return;r=this._trimAlignValue(o-a)}this._slide(n,s,r)},click:function(e){e.preventDefault()},keyup:function(t){var n=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,n),this._change(t,n),e(t.target).removeClass("ui-state-active"))}}})}(jQuery),function(e){function t(e,t){if(!(e.originalEvent.touches.length>1)){e.preventDefault();var n=e.originalEvent.changedTouches[0],i=document.createEvent("MouseEvents");i.initMouseEvent(t,!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(i)}}if(e.support.touch="ontouchend"in document,e.support.touch){var n,i=e.ui.mouse.prototype,o=i._mouseInit;i._touchStart=function(e){var i=this;!n&&i._mouseCapture(e.originalEvent.changedTouches[0])&&(n=!0,i._touchMoved=!1,t(e,"mouseover"),t(e,"mousemove"),t(e,"mousedown"))},i._touchMove=function(e){n&&(this._touchMoved=!0,t(e,"mousemove"))},i._touchEnd=function(e){n&&(t(e,"mouseup"),t(e,"mouseout"),this._touchMoved||t(e,"click"),n=!1)},i._mouseInit=function(){var t=this;t.element.bind("touchstart",e.proxy(t,"_touchStart")).bind("touchmove",e.proxy(t,"_touchMove")).bind("touchend",e.proxy(t,"_touchEnd")),o.call(t)}}}(jQuery),/*! jquery-dialogextend 2.0.2 2013-08-06 */
function(){var e;e=jQuery,e.widget("ui.dialogExtend",{version:"2.0.0",modes:{},options:{closable:!0,dblclick:!1,titlebar:!1,icons:{close:"ui-icon-closethick",restore:"ui-icon-newwin"},load:null,beforeRestore:null,restore:null},_create:function(){return this._state="normal",e(this.element[0]).data("ui-dialog")||e.error("jQuery.dialogExtend Error : Only jQuery UI Dialog element is accepted"),this._verifyOptions(),this._initStyles(),this._initButtons(),this._initTitleBar(),this._setState("normal"),this._on("load",function(e){return console.log("test",e)}),this._trigger("load")},_setState:function(t){return e(this.element[0]).removeClass("ui-dialog-"+this._state).addClass("ui-dialog-"+t),this._state=t},_verifyOptions:function(){var t,n,i;!this.options.dblclick||this.options.dblclick in this.modes||(e.error("jQuery.dialogExtend Error : Invalid <dblclick> value '"+this.options.dblclick+"'"),this.options.dblclick=!1),this.options.titlebar&&"none"!==(n=this.options.titlebar)&&"transparent"!==n&&(e.error("jQuery.dialogExtend Error : Invalid <titlebar> value '"+this.options.titlebar+"'"),this.options.titlebar=!1),i=[];for(t in this.modes)this["_verifyOptions_"+t]?i.push(this["_verifyOptions_"+t]()):i.push(void 0);return i},_initStyles:function(){var t,n,i;e(".dialog-extend-css").length||(n="",n+='<style class="dialog-extend-css" type="text/css">',n+=".ui-dialog .ui-dialog-titlebar-buttonpane>a { float: right; }",n+=".ui-dialog .ui-dialog-titlebar-restore { width: 19px; height: 18px; }",n+=".ui-dialog .ui-dialog-titlebar-restore span { display: block; margin: 1px; }",n+=".ui-dialog .ui-dialog-titlebar-restore:hover,",n+=".ui-dialog .ui-dialog-titlebar-restore:focus { padding: 0; }",n+=".ui-dialog .ui-dialog-titlebar ::selection { background-color: transparent; }",n+="</style>",e(n).appendTo("body")),i=[];for(t in this.modes)i.push(this["_initStyles_"+t]());return i},_initButtons:function(){var t,n,i,o,r,a=this;o=e(this.element[0]).dialog("widget").find(".ui-dialog-titlebar"),t=e('<div class="ui-dialog-titlebar-buttonpane"></div>').appendTo(o),t.css({position:"absolute",top:"50%",right:"0.3em","margin-top":"-10px",height:"18px"}),o.find(".ui-dialog-titlebar-close").css({position:"relative","float":"right",top:"auto",right:"auto",margin:0}).find(".ui-icon").removeClass("ui-icon-closethick").addClass(this.options.icons.close).end().appendTo(t).end(),t.append('<a class="ui-dialog-titlebar-restore ui-corner-all ui-state-default" href="#"><span class="ui-icon '+this.options.icons.restore+'">restore</span></a>').find(".ui-dialog-titlebar-restore").attr("role","button").mouseover(function(){return e(this).addClass("ui-state-hover")}).mouseout(function(){return e(this).removeClass("ui-state-hover")}).focus(function(){return e(this).addClass("ui-state-focus")}).blur(function(){return e(this).removeClass("ui-state-focus")}).end().find(".ui-dialog-titlebar-close").toggle(this.options.closable).end().find(".ui-dialog-titlebar-restore").hide().click(function(e){return e.preventDefault(),a.restore()}).end(),r=this.modes;for(i in r)n=r[i],this._initModuleButton(i,n);return o.dblclick(function(){return a.options.dblclick?"normal"!==a._state?a.restore():a[a.options.dblclick]():void 0}).select(function(){return!1})},_initModuleButton:function(t,n){var i,o=this;return i=e(this.element[0]).dialog("widget").find(".ui-dialog-titlebar-buttonpane"),i.append('<a class="ui-dialog-titlebar-'+t+' ui-corner-all ui-state-default" href="#"><span class="ui-icon '+this.options.icons[t]+'">'+t+"</span></a>").find(".ui-dialog-titlebar-"+t).attr("role","button").mouseover(function(){return e(this).addClass("ui-state-hover")}).mouseout(function(){return e(this).removeClass("ui-state-hover")}).focus(function(){return e(this).addClass("ui-state-focus")}).blur(function(){return e(this).removeClass("ui-state-focus")}).end().find(".ui-dialog-titlebar-"+t).toggle(this.options[n.option]).click(function(e){return e.preventDefault(),o[t]()}).end()},_initTitleBar:function(){var t;switch(this.options.titlebar){case!1:return 0;case"none":return e(this.element[0]).dialog("option","draggable")&&(t=e("<div />").addClass("ui-dialog-draggable-handle").css("cursor","move").height(5),e(this.element[0]).dialog("widget").prepend(t).draggable("option","handle",t)),e(this.element[0]).dialog("widget").find(".ui-dialog-titlebar").find(".ui-dialog-title").html("&nbsp;").end().css({"background-color":"transparent","background-image":"none",border:0,position:"absolute",right:0,top:0,"z-index":9999}).end();case"transparent":return e(this.element[0]).dialog("widget").find(".ui-dialog-titlebar").css({"background-color":"transparent","background-image":"none",border:0});default:return e.error("jQuery.dialogExtend Error : Invalid <titlebar> value '"+this.options.titlebar+"'")}},state:function(){return this._state},restore:function(){return this._trigger("beforeRestore"),this._restore(),this._setState("normal"),this._toggleButtons(),this._trigger("restore")},_restore:function(){return"normal"!==this._state?this["_restore_"+this._state]():void 0},_saveSnapshot:function(){return"normal"===this._state?(null==this.options.containerCls&&(this.options.containerCls="body"),this.original_config_resizable=e(this.element[0]).dialog("option","resizable"),this.original_config_draggable=e(this.element[0]).dialog("option","draggable"),this.original_size_height=e(this.element[0]).dialog("widget").outerHeight(),this.original_size_width=e(this.element[0]).dialog("option","width"),this.original_size_maxHeight=e(this.element[0]).dialog("option","maxHeight"),this.original_position_mode=e(this.element[0]).dialog("widget").css("position"),this.original_position_left=e(this.element[0]).dialog("widget").offset().left-e(this.options.containerCls).scrollLeft(),this.original_position_top=e(this.element[0]).dialog("widget").offset().top-e(this.options.containerCls).scrollTop(),this.original_titlebar_wrap=e(this.element[0]).dialog("widget").find(".ui-dialog-titlebar").css("white-space")):void 0},_loadSnapshot:function(){return{config:{resizable:this.original_config_resizable,draggable:this.original_config_draggable},size:{height:this.original_size_height,width:this.original_size_width,maxHeight:this.original_size_maxHeight},position:{mode:this.original_position_mode,left:this.original_position_left,top:this.original_position_top},titlebar:{wrap:this.original_titlebar_wrap}}},_toggleButtons:function(){var t,n,i,o;e(this.element[0]).dialog("widget").find(".ui-dialog-titlebar-restore").toggle("normal"!==this._state).css({right:"1.4em"}).end(),i=this.modes,o=[];for(n in i)t=i[n],o.push(e(this.element[0]).dialog("widget").find(".ui-dialog-titlebar-"+n).toggle(this._state!==t.state&&this.options[t.option]));return o}})}.call(this),function(){var e;e=jQuery,e.extend(!0,e.ui.dialogExtend.prototype,{modes:{collapse:{option:"collapsable",state:"collapsed"}},options:{collapsable:!1,icons:{collapse:"ui-icon-triangle-1-s"},beforeCollapse:null,collapse:null},collapse:function(){var t;return t=e(this.element[0]).dialog("widget").find(".ui-dialog-titlebar").height()+15,this._trigger("beforeCollapse"),"normal"!==this._state&&this._restore(),this._saveSnapshot(),e(this.element[0]).dialog("option",{resizable:!1,height:t,maxHeight:t}).on("dialogclose",this._collapse_restore).hide().dialog("widget").find(".ui-dialog-buttonpane:visible").hide().end().find(".ui-dialog-titlebar").css("white-space","nowrap").end().find(".ui-dialog-content"),this._setState("collapsed"),this._toggleButtons(),this._trigger("collapse")},_restore_collapsed:function(){var t;return t=this._loadSnapshot(),e(this.element[0]).show().dialog("widget").find(".ui-dialog-buttonpane:hidden").show().end().find(".ui-dialog-titlebar").css("white-space",t.titlebar.wrap).end().find(".ui-dialog-content").dialog("option",{resizable:t.config.resizable,height:t.size.height,maxHeight:t.size.maxHeight}).off("dialogclose",this._collapse_restore)},_initStyles_collapse:function(){var t;return e(".dialog-extend-collapse-css").length?void 0:(t="",t+='<style class="dialog-extend-collapse-css" type="text/css">',t+=".ui-dialog .ui-dialog-titlebar-collapse { width: 19px; height: 18px; }",t+=".ui-dialog .ui-dialog-titlebar-collapse span { display: block; margin: 1px; }",t+=".ui-dialog .ui-dialog-titlebar-collapse:hover,",t+=".ui-dialog .ui-dialog-titlebar-collapse:focus { padding: 0; }",t+="</style>",e(t).appendTo("body"))},_collapse_restore:function(){return e(this).dialogExtend("restore")}})}.call(this),function(){var e;e=jQuery,e.extend(!0,e.ui.dialogExtend.prototype,{modes:{maximize:{option:"maximizable",state:"maximized"}},options:{maximizable:!1,icons:{maximize:"ui-icon-extlink"},beforeMaximize:null,maximize:null},maximize:function(){var t,n;return null==this.options.mainMenuHeight&&(this.options.mainMenuHeight=0),null==this.options.statusBarHeight&&(this.options.statusBarHeight=0),t=e(window).height()-(this.options.mainMenuHeight+this.options.statusBarHeight),n=e(window).width(),this._trigger("beforeMaximize"),"normal"!==this._state&&this._restore(),this._saveSnapshot(),e(this.element[0]).dialog("option","draggable")&&e(this.element[0]).dialog("widget").draggable("option","handle",null).find(".ui-dialog-draggable-handle").css("cursor","text").end(),e(this.element[0]).dialog("widget").css("position","fixed").find(".ui-dialog-content").show().dialog("widget").find(".ui-dialog-buttonpane").show().end().find(".ui-dialog-content").dialog("option",{resizable:!1,draggable:!1,height:t,width:n,position:{my:"left top",at:"left top+"+this.options.mainMenuHeight}}),this._setState("maximized"),this._toggleButtons(),this._trigger("maximize")},_restore_maximized:function(){var t;return t=this._loadSnapshot(),e(this.element[0]).dialog("widget").css("position",t.position.mode).find(".ui-dialog-titlebar").css("white-space",t.titlebar.wrap).end().find(".ui-dialog-content").dialog("option",{resizable:t.config.resizable,draggable:t.config.draggable,height:t.size.height,width:t.size.width,maxHeight:t.size.maxHeight,position:{my:"left top",at:"left+"+t.position.left+" top+"+t.position.top}}),e(this.element[0]).dialog("option","draggable")?e(this.element[0]).dialog("widget").draggable("option","handle",e(this.element[0]).dialog("widget").find(".ui-dialog-draggable-handle").length?e(this.element[0]).dialog("widget").find(".ui-dialog-draggable-handle"):".ui-dialog-titlebar").find(".ui-dialog-draggable-handle").css("cursor","move"):void 0},_initStyles_maximize:function(){var t;return e(".dialog-extend-maximize-css").length?void 0:(t="",t+='<style class="dialog-extend-maximize-css" type="text/css">',t+=".ui-dialog .ui-dialog-titlebar-maximize { width: 19px; height: 18px; }",t+=".ui-dialog .ui-dialog-titlebar-maximize span { display: block; margin: 1px; }",t+=".ui-dialog .ui-dialog-titlebar-maximize:hover,",t+=".ui-dialog .ui-dialog-titlebar-maximize:focus { padding: 0; }",t+="</style>",e(t).appendTo("body"))}})}.call(this),function(){var e;e=jQuery,e.extend(!0,e.ui.dialogExtend.prototype,{modes:{minimize:{option:"minimizable",state:"minimized"}},options:{minimizable:!1,minimizeLocation:"left",icons:{minimize:"ui-icon-minus"},beforeMinimize:null,minimize:null},minimize:function(){var t,n,i,o;return n=e(this.element[0]).dialog("widget").find(".ui-dialog-titlebar").height()+15,i=200,t=e("#dialog-extend-fixed-container").length?e("#dialog-extend-fixed-container"):e('<div id="dialog-extend-fixed-container"></div>').appendTo("body"),t.css({position:"fixed",bottom:1,left:1,right:1,"z-index":9999}),o=e("<div/>").css({"float":this.options.minimizeLocation,margin:1}),t.append(o),e(this.element[0]).data("dialog-extend-minimize-overlay",o),this._trigger("beforeMinimize"),this._saveSnapshot(),e(this.element[0]).dialog("option","draggable")&&e(this.element[0]).dialog("widget").draggable("option","handle",null).find(".ui-dialog-draggable-handle").css("cursor","text").end(),e(this.element[0]).dialog("option",{resizable:!1,draggable:!1,height:n,width:i}).on("dialogclose",this._minimize_removeOverlay).dialog("widget").css("position","static").appendTo(o).find(".ui-dialog-content").dialog("widget").find(".ui-dialog-titlebar").each(function(){var t,n,i;return i=e(this),t=i.find(".ui-dialog-titlebar-buttonpane"),n=i.find(".ui-dialog-title"),n.css({overflow:"hidden",width:i.width()-t.width()+10})}).end().find(".ui-dialog-content").hide().dialog("widget").find(".ui-dialog-buttonpane:visible").hide().end().find(".ui-dialog-titlebar").css("white-space","nowrap").end().find(".ui-dialog-content"),this._setState("minimized"),this._toggleButtons(),this._trigger("minimize")},_restore_minimized:function(){var t;return t=this._loadSnapshot(),e(this.element[0]).dialog("widget").appendTo("body").css({"float":"none",margin:0,position:t.position.mode}).find(".ui-dialog-content").dialog("widget").find(".ui-dialog-title").css("width","auto").end().find(".ui-dialog-content").show().dialog("widget").find(".ui-dialog-buttonpane:hidden").show().end().find(".ui-dialog-titlebar").css("white-space",t.titlebar.wrap).end().find(".ui-dialog-content").dialog("option",{resizable:t.config.resizable,draggable:t.config.draggable,height:t.size.height,width:t.size.width,maxHeight:t.size.maxHeight,position:{my:"left top",at:"left+"+t.position.left+" top+"+t.position.top}}).off("dialogclose",this._minimize_removeOverlay),e(this.element[0]).dialog("option","draggable")&&e(this.element[0]).dialog("widget").draggable("option","handle",e(this.element[0]).dialog("widget").find(".ui-dialog-draggable-handle").length?e(this.element[0]).dialog("widget").find(".ui-dialog-draggable-handle"):".ui-dialog-titlebar").find(".ui-dialog-draggable-handle").css("cursor","move"),e(this.element[0]).data("dialog-extend-minimize-overlay").remove(),e(this.element[0]).removeData("dialog-extend-overlay")},_initStyles_minimize:function(){var t;return e(".dialog-extend-minimize-css").length?void 0:(t="",t+='<style class="dialog-extend-minimize-css" type="text/css">',t+=".ui-dialog .ui-dialog-titlebar-minimize { width: 19px; height: 18px; }",t+=".ui-dialog .ui-dialog-titlebar-minimize span { display: block; margin: 1px; }",t+=".ui-dialog .ui-dialog-titlebar-minimize:hover,",t+=".ui-dialog .ui-dialog-titlebar-minimize:focus { padding: 0; }",t+="</style>",e(t).appendTo("body"))},_verifyOptions_minimize:function(){var t;return!this.options.minimizeLocation||"left"!==(t=this.options.minimizeLocation)&&"right"!==t?(e.error("jQuery.dialogExtend Error : Invalid <minimizeLocation> value '"+this.options.minimizeLocation+"'"),this.options.minimizeLocation="left"):void 0},_minimize_removeOverlay:function(){return e(this).dialogExtend("restore"),e(this).dialog("widget").appendTo(e("body")),e(this).data("dialog-extend-minimize-overlay").remove(),e(this).removeData("dialog-extend-overlay")}})}.call(this),function(e){function t(e){return"object"==typeof e?e:{top:e,left:e}}var n=e.scrollTo=function(t,n,i){e(window).scrollTo(t,n,i)};n.defaults={axis:"xy",duration:parseFloat(e.fn.jquery)>=1.3?0:1,limit:!0},n.window=function(){return e(window)._scrollable()},e.fn._scrollable=function(){return this.map(function(){var t=this,n=!t.nodeName||-1!=e.inArray(t.nodeName.toLowerCase(),["iframe","#document","html","body"]);if(!n)return t;var i=(t.contentWindow||t).document||t.ownerDocument||t;return/webkit/i.test(navigator.userAgent)||"BackCompat"==i.compatMode?i.body:i.documentElement})},e.fn.scrollTo=function(i,o,r){return"object"==typeof o&&(r=o,o=0),"function"==typeof r&&(r={onAfter:r}),"max"==i&&(i=9e9),r=e.extend({},n.defaults,r),o=o||r.duration,r.queue=r.queue&&r.axis.length>1,r.queue&&(o/=2),r.offset=t(r.offset),r.over=t(r.over),this._scrollable().each(function(){function a(e){u.animate(d,o,r.easing,e&&function(){e.call(this,c,r)})}if(null!=i){var s,l=this,u=e(l),c=i,d={},h=u.is("html,body");switch(typeof c){case"number":case"string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(c)){c=t(c);break}if(c=e(c,this),!c.length)return;case"object":(c.is||c.style)&&(s=(c=e(c)).offset())}e.each(r.axis.split(""),function(e,t){var i="x"==t?"Left":"Top",o=i.toLowerCase(),p="scroll"+i,f=l[p],m=n.max(l,t);if(s)d[p]=s[o]+(h?0:f-u.offset()[o]),r.margin&&(d[p]-=parseInt(c.css("margin"+i))||0,d[p]-=parseInt(c.css("border"+i+"Width"))||0),d[p]+=r.offset[o]||0,r.over[o]&&(d[p]+=c["x"==t?"width":"height"]()*r.over[o]);else{var g=c[o];d[p]=g.slice&&"%"==g.slice(-1)?parseFloat(g)/100*m:g}r.limit&&/^\d+$/.test(d[p])&&(d[p]=0>=d[p]?0:Math.min(d[p],m)),!e&&r.queue&&(f!=d[p]&&a(r.onAfterFirst),delete d[p])}),a(r.onAfter)}}).end()},n.max=function(t,n){var i="x"==n?"Width":"Height",o="scroll"+i;if(!e(t).is("html,body"))return t[o]-e(t)[i.toLowerCase()]();var r="client"+i,a=t.ownerDocument.documentElement,s=t.ownerDocument.body;return Math.max(a[o],s[o])-Math.min(a[r],s[r])}}(jQuery);var Handlebars=function(){var e=function(){"use strict";function e(e){this.string=e}var t;return e.prototype.toString=function(){return""+this.string},t=e}(),t=function(e){"use strict";function t(e){return l[e]||"&amp;"}function n(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}function i(e){return e instanceof a?""+e:e||0===e?(e=""+e,c.test(e)?e.replace(u,t):e):""}function o(e){return e||0===e?s(e)&&0===e.length?!0:!1:!0}var r={},a=e,s=Array.isArray,l={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},u=/[&<>"'`]/g,c=/[&<>"'`]/;return r.extend=n,r.escapeExpression=i,r.isEmpty=o,r}(e),n=function(){"use strict";function e(){for(var e=Error.prototype.constructor.apply(this,arguments),t=0;n.length>t;t++)this[n[t]]=e[n[t]]}var t,n=["description","fileName","lineNumber","message","name","number","stack"];return e.prototype=Error(),t=e}(),i=function(e,t){"use strict";function n(e){return e&&"object"==typeof e?"[object Array]"===h.call(e):!1}function i(e,t){this.helpers=e||{},this.partials=t||{},o(this)}function o(e){e.registerHelper("helperMissing",function(e){if(2===arguments.length)return void 0;throw Error("Missing helper: '"+e+"'")}),e.registerHelper("blockHelperMissing",function(t,i){var o=i.inverse||function(){},r=i.fn;return f(t)&&(t=t.call(this)),t===!0?r(this):t===!1||null==t?o(this):n(t)?t.length>0?e.helpers.each(t,i):o(this):r(t)}),e.registerHelper("each",function(e,t){var i,o=t.fn,r=t.inverse,a=0,s="";if(f(e)&&(e=e.call(this)),t.data&&(i=g(t.data)),e&&"object"==typeof e)if(n(e))for(var l=e.length;l>a;a++)i&&(i.index=a,i.first=0===a,i.last=a===e.length-1),s+=o(e[a],{data:i});else for(var u in e)e.hasOwnProperty(u)&&(i&&(i.key=u),s+=o(e[u],{data:i}),a++);return 0===a&&(s=r(this)),s}),e.registerHelper("if",function(e,t){return f(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||s.isEmpty(e)?t.inverse(this):t.fn(this)}),e.registerHelper("unless",function(t,n){return e.helpers["if"].call(this,t,{fn:n.inverse,inverse:n.fn,hash:n.hash})}),e.registerHelper("with",function(e,t){return f(e)&&(e=e.call(this)),s.isEmpty(e)?void 0:t.fn(e)}),e.registerHelper("log",function(t,n){var i=n.data&&null!=n.data.level?parseInt(n.data.level,10):1;e.log(i,t)})}function r(e,t){m.log(e,t)}var a={},s=e,l=t,u="1.1.0";a.VERSION=u;var c=4;a.COMPILER_REVISION=c;var d={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};a.REVISION_CHANGES=d;var h=Object.prototype.toString,p="[object Object]",f=function(e){return"function"==typeof e};f(/x/)&&(f=function(e){return"function"==typeof e&&"[object Function]"===h.call(e)}),a.HandlebarsEnvironment=i,i.prototype={constructor:i,logger:m,log:r,registerHelper:function(e,t,n){if(h.call(e)===p){if(n||t)throw new l("Arg not supported with multiple helpers");s.extend(this.helpers,e)}else n&&(t.not=n),this.helpers[e]=t},registerPartial:function(e,t){h.call(e)===p?s.extend(this.partials,e):this.partials[e]=t}};var m={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(e,t){if(e>=m.level){var n=m.methodMap[e];"undefined"!=typeof console&&console[n]&&console[n].call(console,t)}}};a.logger=m,a.log=r;var g=function(e){var t={};return s.extend(t,e),t};return a.createFrame=g,a}(t,n),o=function(e,t,n){"use strict";function i(e){var t=e&&e[0]||1,n=h;if(t!==n){if(n>t){var i=p[n],o=p[t];throw Error("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+i+") or downgrade your runtime to an older version ("+o+").")}throw Error("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}}function o(e,t){if(!t)throw Error("No environment passed to template");var n;n=t.compile?function(e,n,i,o,r,a){var l=s.apply(this,arguments);if(l)return l;var u={helpers:o,partials:r,data:a};return r[n]=t.compile(e,{data:void 0!==a},t),r[n](i,u)}:function(e,t){var n=s.apply(this,arguments);if(n)return n;throw new d("The partial "+t+" could not be compiled when running in runtime-only mode")};var o={escapeExpression:c.escapeExpression,invokePartial:n,programs:[],program:function(e,t,n){var i=this.programs[e];return n?i=a(e,t,n):i||(i=this.programs[e]=a(e,t)),i},merge:function(e,t){var n=e||t;return e&&t&&e!==t&&(n={},c.extend(n,t),c.extend(n,e)),n},programWithDepth:r,noop:l,compilerInfo:null};return function(n,r){r=r||{};var a,s,l=r.partial?r:t;r.partial||(a=r.helpers,s=r.partials);var u=e.call(o,l,n,a,s,r.data);return r.partial||i(o.compilerInfo),u}}function r(e,t,n){var i=Array.prototype.slice.call(arguments,3),o=function(e,o){return o=o||{},t.apply(this,[e,o.data||n].concat(i))};return o.program=e,o.depth=i.length,o}function a(e,t,n){var i=function(e,i){return i=i||{},t(e,i.data||n)};return i.program=e,i.depth=0,i}function s(e,t,n,i,o,r){var a={partial:!0,helpers:i,partials:o,data:r};if(void 0===e)throw new d("The partial "+t+" could not be found");return e instanceof Function?e(n,a):void 0}function l(){return""}var u={},c=e,d=t,h=n.COMPILER_REVISION,p=n.REVISION_CHANGES;return u.template=o,u.programWithDepth=r,u.program=a,u.invokePartial=s,u.noop=l,u}(t,n,i),r=function(e,t,n,i,o){"use strict";var r,a=e,s=t,l=n,u=i,c=o,d=function(){var e=new a.HandlebarsEnvironment;return u.extend(e,a),e.SafeString=s,e.Exception=l,e.Utils=u,e.VM=c,e.template=function(t){return c.template(t,e)},e},h=d();return h.create=d,r=h}(i,e,n,t,o),a=function(e){"use strict";function t(e,n,i){this.type="program",this.statements=e,this.strip={},i?(this.inverse=new t(i,n),this.strip.right=n.left):n&&(this.strip.left=n.right)}function n(e,t,n,i){this.type="mustache",this.hash=t,this.strip=i;var o=n[3]||n[2];this.escaped="{"!==o&&"&"!==o;var r=this.id=e[0],a=this.params=e.slice(1),s=this.eligibleHelper=r.isSimple;this.isHelper=s&&(a.length||t)}function i(e,t,n){this.type="partial",this.partialName=e,this.context=t,this.strip=n}function o(e,t,n,i){if(e.id.original!==i.path.original)throw new m(e.id.original+" doesn't match "+i.path.original);this.type="block",this.mustache=e,this.program=t,this.inverse=n,this.strip={left:e.strip.left,right:i.strip.right},(t||n).strip.left=e.strip.right,(n||t).strip.right=i.strip.left,n&&!t&&(this.isInverse=!0)}function r(e){this.type="content",this.string=e}function a(e){this.type="hash",this.pairs=e}function s(e){this.type="ID";for(var t="",n=[],i=0,o=0,r=e.length;r>o;o++){var a=e[o].part;if(t+=(e[o].separator||"")+a,".."===a||"."===a||"this"===a){if(n.length>0)throw new m("Invalid path: "+t);".."===a?i++:this.isScoped=!0}else n.push(a)}this.original=t,this.parts=n,this.string=n.join("."),this.depth=i,this.isSimple=1===e.length&&!this.isScoped&&0===i,this.stringModeValue=this.string}function l(e){this.type="PARTIAL_NAME",this.name=e.original}function u(e){this.type="DATA",this.id=e}function c(e){this.type="STRING",this.original=this.string=this.stringModeValue=e}function d(e){this.type="INTEGER",this.original=this.integer=e,this.stringModeValue=Number(e)}function h(e){this.type="BOOLEAN",this.bool=e,this.stringModeValue="true"===e}function p(e){this.type="comment",this.comment=e}var f={},m=e;return f.ProgramNode=t,f.MustacheNode=n,f.PartialNode=i,f.BlockNode=o,f.ContentNode=r,f.HashNode=a,f.IdNode=s,f.PartialNameNode=l,f.DataNode=u,f.StringNode=c,f.IntegerNode=d,f.BooleanNode=h,f.CommentNode=p,f}(n),s=function(){"use strict";var e,t=function(){function e(e,t){return{left:"~"===e[2],right:"~"===t[0]||"~"===t[1]}}function t(){this.yy={}}var n={trace:function(){},yy:{},symbols_:{error:2,root:3,statements:4,EOF:5,program:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,CLOSE_UNESCAPED:24,OPEN_PARTIAL:25,partialName:26,partial_option0:27,inMustache_repetition0:28,inMustache_option0:29,dataName:30,param:31,STRING:32,INTEGER:33,BOOLEAN:34,hash:35,hash_repetition_plus0:36,hashSegment:37,ID:38,EQUALS:39,DATA:40,pathSegments:41,SEP:42,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"CLOSE_UNESCAPED",25:"OPEN_PARTIAL",32:"STRING",33:"INTEGER",34:"BOOLEAN",38:"ID",39:"EQUALS",40:"DATA",42:"SEP"},productions_:[0,[3,2],[6,2],[6,3],[6,2],[6,1],[6,1],[6,0],[4,1],[4,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,4],[7,2],[17,3],[17,1],[31,1],[31,1],[31,1],[31,1],[31,1],[35,1],[37,3],[26,1],[26,1],[26,1],[30,2],[21,1],[41,3],[41,1],[27,0],[27,1],[28,0],[28,2],[29,0],[29,1],[36,1],[36,2]],performAction:function(t,n,i,o,r,a){var s=a.length-1;switch(r){case 1:return new o.ProgramNode(a[s-1]);case 2:this.$=new o.ProgramNode([],a[s-1],a[s]);break;case 3:this.$=new o.ProgramNode(a[s-2],a[s-1],a[s]);break;case 4:this.$=new o.ProgramNode(a[s-1],a[s],[]);break;case 5:this.$=new o.ProgramNode(a[s]);break;case 6:this.$=new o.ProgramNode([]);break;case 7:this.$=new o.ProgramNode([]);break;case 8:this.$=[a[s]];break;case 9:a[s-1].push(a[s]),this.$=a[s-1];break;case 10:this.$=new o.BlockNode(a[s-2],a[s-1].inverse,a[s-1],a[s]);break;case 11:this.$=new o.BlockNode(a[s-2],a[s-1],a[s-1].inverse,a[s]);break;case 12:this.$=a[s];break;case 13:this.$=a[s];break;case 14:this.$=new o.ContentNode(a[s]);break;case 15:this.$=new o.CommentNode(a[s]);break;case 16:this.$=new o.MustacheNode(a[s-1][0],a[s-1][1],a[s-2],e(a[s-2],a[s]));break;case 17:this.$=new o.MustacheNode(a[s-1][0],a[s-1][1],a[s-2],e(a[s-2],a[s]));break;case 18:this.$={path:a[s-1],strip:e(a[s-2],a[s])};break;case 19:this.$=new o.MustacheNode(a[s-1][0],a[s-1][1],a[s-2],e(a[s-2],a[s]));break;case 20:this.$=new o.MustacheNode(a[s-1][0],a[s-1][1],a[s-2],e(a[s-2],a[s]));break;case 21:this.$=new o.PartialNode(a[s-2],a[s-1],e(a[s-3],a[s]));break;case 22:this.$=e(a[s-1],a[s]);break;case 23:this.$=[[a[s-2]].concat(a[s-1]),a[s]];break;case 24:this.$=[[a[s]],null];break;case 25:this.$=a[s];break;case 26:this.$=new o.StringNode(a[s]);break;case 27:this.$=new o.IntegerNode(a[s]);break;case 28:this.$=new o.BooleanNode(a[s]);break;case 29:this.$=a[s];break;case 30:this.$=new o.HashNode(a[s]);break;case 31:this.$=[a[s-2],a[s]];break;case 32:this.$=new o.PartialNameNode(a[s]);break;case 33:this.$=new o.PartialNameNode(new o.StringNode(a[s]));break;case 34:this.$=new o.PartialNameNode(new o.IntegerNode(a[s]));break;case 35:this.$=new o.DataNode(a[s]);break;case 36:this.$=new o.IdNode(a[s]);break;case 37:a[s-2].push({part:a[s],separator:a[s-1]}),this.$=a[s-2];break;case 38:this.$=[{part:a[s]}];break;case 41:this.$=[];break;case 42:a[s-1].push(a[s]);break;case 45:this.$=[a[s]];break;case 46:a[s-1].push(a[s])}},table:[{3:1,4:2,8:3,9:4,11:5,12:6,13:7,14:[1,8],15:[1,9],16:[1,11],19:[1,10],22:[1,12],23:[1,13],25:[1,14]},{1:[3]},{5:[1,15],8:16,9:4,11:5,12:6,13:7,14:[1,8],15:[1,9],16:[1,11],19:[1,10],22:[1,12],23:[1,13],25:[1,14]},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],25:[2,8]},{4:19,6:17,7:18,8:3,9:4,11:5,12:6,13:7,14:[1,8],15:[1,9],16:[1,11],19:[1,20],20:[2,7],22:[1,12],23:[1,13],25:[1,14]},{4:19,6:21,7:18,8:3,9:4,11:5,12:6,13:7,14:[1,8],15:[1,9],16:[1,11],19:[1,20],20:[2,7],22:[1,12],23:[1,13],25:[1,14]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],25:[2,12]},{5:[2,13],14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],25:[2,13]},{5:[2,14],14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],25:[2,14]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],25:[2,15]},{17:22,21:23,30:24,38:[1,27],40:[1,26],41:25},{17:28,21:23,30:24,38:[1,27],40:[1,26],41:25},{17:29,21:23,30:24,38:[1,27],40:[1,26],41:25},{17:30,21:23,30:24,38:[1,27],40:[1,26],41:25},{21:32,26:31,32:[1,33],33:[1,34],38:[1,27],41:25},{1:[2,1]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],25:[2,9]},{10:35,20:[1,36]},{4:37,8:3,9:4,11:5,12:6,13:7,14:[1,8],15:[1,9],16:[1,11],19:[1,10],20:[2,6],22:[1,12],23:[1,13],25:[1,14]},{7:38,8:16,9:4,11:5,12:6,13:7,14:[1,8],15:[1,9],16:[1,11],19:[1,20],20:[2,5],22:[1,12],23:[1,13],25:[1,14]},{17:22,18:[1,39],21:23,30:24,38:[1,27],40:[1,26],41:25},{10:40,20:[1,36]},{18:[1,41]},{18:[2,41],24:[2,41],28:42,32:[2,41],33:[2,41],34:[2,41],38:[2,41],40:[2,41]},{18:[2,24],24:[2,24]},{18:[2,36],24:[2,36],32:[2,36],33:[2,36],34:[2,36],38:[2,36],40:[2,36],42:[1,43]},{21:44,38:[1,27],41:25},{18:[2,38],24:[2,38],32:[2,38],33:[2,38],34:[2,38],38:[2,38],40:[2,38],42:[2,38]},{18:[1,45]},{18:[1,46]},{24:[1,47]},{18:[2,39],21:49,27:48,38:[1,27],41:25},{18:[2,32],38:[2,32]},{18:[2,33],38:[2,33]},{18:[2,34],38:[2,34]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],25:[2,10]},{21:50,38:[1,27],41:25},{8:16,9:4,11:5,12:6,13:7,14:[1,8],15:[1,9],16:[1,11],19:[1,10],20:[2,2],22:[1,12],23:[1,13],25:[1,14]},{4:51,8:3,9:4,11:5,12:6,13:7,14:[1,8],15:[1,9],16:[1,11],19:[1,10],20:[2,4],22:[1,12],23:[1,13],25:[1,14]},{14:[2,22],15:[2,22],16:[2,22],19:[2,22],20:[2,22],22:[2,22],23:[2,22],25:[2,22]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],25:[2,11]},{14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],25:[2,17]},{18:[2,43],21:55,24:[2,43],29:52,30:59,31:53,32:[1,56],33:[1,57],34:[1,58],35:54,36:60,37:61,38:[1,62],40:[1,26],41:25},{38:[1,63]},{18:[2,35],24:[2,35],32:[2,35],33:[2,35],34:[2,35],38:[2,35],40:[2,35]},{14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],25:[2,16]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],25:[2,19]},{5:[2,20],14:[2,20],15:[2,20],16:[2,20],19:[2,20],20:[2,20],22:[2,20],23:[2,20],25:[2,20]},{18:[1,64]},{18:[2,40]},{18:[1,65]},{8:16,9:4,11:5,12:6,13:7,14:[1,8],15:[1,9],16:[1,11],19:[1,10],20:[2,3],22:[1,12],23:[1,13],25:[1,14]},{18:[2,23],24:[2,23]},{18:[2,42],24:[2,42],32:[2,42],33:[2,42],34:[2,42],38:[2,42],40:[2,42]},{18:[2,44],24:[2,44]},{18:[2,25],24:[2,25],32:[2,25],33:[2,25],34:[2,25],38:[2,25],40:[2,25]},{18:[2,26],24:[2,26],32:[2,26],33:[2,26],34:[2,26],38:[2,26],40:[2,26]},{18:[2,27],24:[2,27],32:[2,27],33:[2,27],34:[2,27],38:[2,27],40:[2,27]},{18:[2,28],24:[2,28],32:[2,28],33:[2,28],34:[2,28],38:[2,28],40:[2,28]},{18:[2,29],24:[2,29],32:[2,29],33:[2,29],34:[2,29],38:[2,29],40:[2,29]},{18:[2,30],24:[2,30],37:66,38:[1,67]},{18:[2,45],24:[2,45],38:[2,45]},{18:[2,38],24:[2,38],32:[2,38],33:[2,38],34:[2,38],38:[2,38],39:[1,68],40:[2,38],42:[2,38]},{18:[2,37],24:[2,37],32:[2,37],33:[2,37],34:[2,37],38:[2,37],40:[2,37],42:[2,37]},{5:[2,21],14:[2,21],15:[2,21],16:[2,21],19:[2,21],20:[2,21],22:[2,21],23:[2,21],25:[2,21]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],25:[2,18]},{18:[2,46],24:[2,46],38:[2,46]},{39:[1,68]},{21:55,30:59,31:69,32:[1,56],33:[1,57],34:[1,58],38:[1,27],40:[1,26],41:25},{18:[2,31],24:[2,31],38:[2,31]}],defaultActions:{15:[2,1],49:[2,40]},parseError:function(e){throw Error(e)},parse:function(e){function t(){var e;return e=n.lexer.lex()||1,"number"!=typeof e&&(e=n.symbols_[e]||e),e}var n=this,i=[0],o=[null],r=[],a=this.table,s="",l=0,u=0,c=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,this.lexer.yylloc===void 0&&(this.lexer.yylloc={});
var d=this.lexer.yylloc;r.push(d);var h=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var p,f,m,g,v,y,b,w,x,_={};;){if(m=i[i.length-1],this.defaultActions[m]?g=this.defaultActions[m]:((null===p||p===void 0)&&(p=t()),g=a[m]&&a[m][p]),g===void 0||!g.length||!g[0]){var C="";if(!c){x=[];for(y in a[m])this.terminals_[y]&&y>2&&x.push("'"+this.terminals_[y]+"'");C=this.lexer.showPosition?"Parse error on line "+(l+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+x.join(", ")+", got '"+(this.terminals_[p]||p)+"'":"Parse error on line "+(l+1)+": Unexpected "+(1==p?"end of input":"'"+(this.terminals_[p]||p)+"'"),this.parseError(C,{text:this.lexer.match,token:this.terminals_[p]||p,line:this.lexer.yylineno,loc:d,expected:x})}}if(g[0]instanceof Array&&g.length>1)throw Error("Parse Error: multiple actions possible at state: "+m+", token: "+p);switch(g[0]){case 1:i.push(p),o.push(this.lexer.yytext),r.push(this.lexer.yylloc),i.push(g[1]),p=null,f?(p=f,f=null):(u=this.lexer.yyleng,s=this.lexer.yytext,l=this.lexer.yylineno,d=this.lexer.yylloc,c>0&&c--);break;case 2:if(b=this.productions_[g[1]][1],_.$=o[o.length-b],_._$={first_line:r[r.length-(b||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(b||1)].first_column,last_column:r[r.length-1].last_column},h&&(_._$.range=[r[r.length-(b||1)].range[0],r[r.length-1].range[1]]),v=this.performAction.call(_,s,u,l,this.yy,g[1],o,r),v!==void 0)return v;b&&(i=i.slice(0,2*-1*b),o=o.slice(0,-1*b),r=r.slice(0,-1*b)),i.push(this.productions_[g[1]][0]),o.push(_.$),r.push(_._$),w=a[i[i.length-2]][i[i.length-1]],i.push(w);break;case 3:return!0}}return!0}},i=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw Error(e);this.yy.parser.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e;var t=e.match(/(?:\r\n?|\n).*/g);return t?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var i=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var o=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===i.length?this.yylloc.first_column:0)+i[i.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[o[0],o[0]+this.yyleng-t]),this},more:function(){return this._more=!0,this},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return 20>e.length&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,n,i,o;this._more||(this.yytext="",this.match="");for(var r=this._currentRules(),a=0;r.length>a&&(n=this._input.match(this.rules[r[a]]),!n||t&&!(n[0].length>t[0].length)||(t=n,i=a,this.options.flex));a++);return t?(o=t[0].match(/(?:\r\n?|\n).*/g),o&&(this.yylineno+=o.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:o?o[o.length-1].length-o[o.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,r[i],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),e?e:void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return e!==void 0?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)}};return e.options={},e.performAction=function(e,t,n,i){function o(e,n){return t.yytext=t.yytext.substr(e,t.yyleng-n)}switch(n){case 0:if("\\\\"===t.yytext.slice(-2)?(o(0,1),this.begin("mu")):"\\"===t.yytext.slice(-1)?(o(0,1),this.begin("emu")):this.begin("mu"),t.yytext)return 14;break;case 1:return 14;case 2:return"\\"!==t.yytext.slice(-1)&&this.popState(),"\\"===t.yytext.slice(-1)&&o(0,1),14;case 3:return o(0,4),this.popState(),15;case 4:return 25;case 5:return 16;case 6:return 20;case 7:return 19;case 8:return 19;case 9:return 23;case 10:return 22;case 11:this.popState(),this.begin("com");break;case 12:return o(3,5),this.popState(),15;case 13:return 22;case 14:return 39;case 15:return 38;case 16:return 38;case 17:return 42;case 18:break;case 19:return this.popState(),24;case 20:return this.popState(),18;case 21:return t.yytext=o(1,2).replace(/\\"/g,'"'),32;case 22:return t.yytext=o(1,2).replace(/\\'/g,"'"),32;case 23:return 40;case 24:return 34;case 25:return 34;case 26:return 33;case 27:return 38;case 28:return t.yytext=o(1,2),38;case 29:return"INVALID";case 30:return 5}},e.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|$)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{(~)?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s])))/,/^(?:false(?=([~}\s])))/,/^(?:-?[0-9]+(?=([~}\s])))/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.]))))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],e.conditions={mu:{rules:[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[3],inclusive:!1},INITIAL:{rules:[0,1,30],inclusive:!0}},e}();return n.lexer=i,t.prototype=n,n.Parser=t,new t}();return e=t}(),l=function(e,t){"use strict";function n(e){return e.constructor===r.ProgramNode?e:(o.yy=r,o.parse(e))}var i={},o=e,r=t;return i.parser=o,i.parse=n,i}(s,a),u=function(e){"use strict";function t(e){this.value=e}function n(){}var i,o=e.COMPILER_REVISION,r=e.REVISION_CHANGES,a=e.log;n.prototype={nameLookup:function(e,t){var i,o;return 0===e.indexOf("depth")&&(i=!0),o=/^[0-9]+$/.test(t)?e+"["+t+"]":n.isValidJavaScriptVariableName(t)?e+"."+t:e+"['"+t+"']",i?"("+e+" && "+o+")":o},appendToBuffer:function(e){return this.environment.isSimple?"return "+e+";":{appendToBuffer:!0,content:e,toString:function(){return"buffer += "+e+";"}}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(e,t,n,i){this.environment=e,this.options=t||{},a("debug",this.environment.disassemble()+"\n\n"),this.name=this.environment.name,this.isChild=!!n,this.context=n||{programs:[],environments:[],aliases:{}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.registers={list:[]},this.compileStack=[],this.inlineStack=[],this.compileChildren(e,t);var o,r=e.opcodes;this.i=0;for(var s=r.length;s>this.i;this.i++)o=r[this.i],"DECLARE"===o.opcode?this[o.name]=o.value:this[o.opcode].apply(this,o.args),o.opcode!==this.stripNext&&(this.stripNext=!1);return this.pushSource(""),this.createFunctionContext(i)},preamble:function(){var e=[];if(this.isChild)e.push("");else{var t=this.namespace,n="helpers = this.merge(helpers, "+t+".helpers);";this.environment.usePartial&&(n=n+" partials = this.merge(partials, "+t+".partials);"),this.options.data&&(n+=" data = data || {};"),e.push(n)}this.environment.isSimple?e.push(""):e.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=e},createFunctionContext:function(e){var t=this.stackVars.concat(this.registers.list);if(t.length>0&&(this.source[1]=this.source[1]+", "+t.join(", ")),!this.isChild)for(var n in this.context.aliases)this.context.aliases.hasOwnProperty(n)&&(this.source[1]=this.source[1]+", "+n+"="+this.context.aliases[n]);this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.pushSource("return buffer;");for(var i=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"],s=0,l=this.environment.depths.list.length;l>s;s++)i.push("depth"+this.environment.depths.list[s]);var u=this.mergeSource();if(!this.isChild){var c=o,d=r[c];u="this.compilerInfo = ["+c+",'"+d+"'];\n"+u}if(e)return i.push(u),Function.apply(this,i);var h="function "+(this.name||"")+"("+i.join(",")+") {\n  "+u+"}";return a("debug",h+"\n\n"),h},mergeSource:function(){for(var e,t="",n=0,i=this.source.length;i>n;n++){var o=this.source[n];o.appendToBuffer?e=e?e+"\n    + "+o.content:o.content:(e&&(t+="buffer += "+e+";\n  ",e=void 0),t+=o+"\n  ")}return t},blockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var e=["depth0"];this.setupParams(0,e),this.replaceStack(function(t){return e.splice(1,0,t),"blockHelperMissing.call("+e.join(", ")+")"})},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var e=["depth0"];this.setupParams(0,e);var t=this.topStack();e.splice(1,0,t),e[e.length-1]="options",this.pushSource("if (!"+this.lastHelper+") { "+t+" = blockHelperMissing.call("+e.join(", ")+"); }")},appendContent:function(e){this.pendingContent&&(e=this.pendingContent+e),this.stripNext&&(e=e.replace(/^\s+/,"")),this.pendingContent=e},strip:function(){this.pendingContent&&(this.pendingContent=this.pendingContent.replace(/\s+$/,"")),this.stripNext="strip"},append:function(){this.flushInline();var e=this.popStack();this.pushSource("if("+e+" || "+e+" === 0) { "+this.appendToBuffer(e)+" }"),this.environment.isSimple&&this.pushSource("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){this.context.aliases.escapeExpression="this.escapeExpression",this.pushSource(this.appendToBuffer("escapeExpression("+this.popStack()+")"))},getContext:function(e){this.lastContext!==e&&(this.lastContext=e)},lookupOnContext:function(e){this.push(this.nameLookup("depth"+this.lastContext,e,"context"))},pushContext:function(){this.pushStackLiteral("depth"+this.lastContext)},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"',this.replaceStack(function(e){return"typeof "+e+" === functionType ? "+e+".apply(depth0) : "+e})},lookup:function(e){this.replaceStack(function(t){return t+" == null || "+t+" === false ? "+t+" : "+this.nameLookup(t,e,"context")})},lookupData:function(){this.push("data")},pushStringParam:function(e,t){this.pushStackLiteral("depth"+this.lastContext),this.pushString(t),"string"==typeof e?this.pushString(e):this.pushStackLiteral(e)},emptyHash:function(){this.pushStackLiteral("{}"),this.options.stringParams&&(this.register("hashTypes","{}"),this.register("hashContexts","{}"))},pushHash:function(){this.hash={values:[],types:[],contexts:[]}},popHash:function(){var e=this.hash;this.hash=void 0,this.options.stringParams&&(this.register("hashContexts","{"+e.contexts.join(",")+"}"),this.register("hashTypes","{"+e.types.join(",")+"}")),this.push("{\n    "+e.values.join(",\n    ")+"\n  }")},pushString:function(e){this.pushStackLiteral(this.quotedString(e))},push:function(e){return this.inlineStack.push(e),e},pushLiteral:function(e){this.pushStackLiteral(e)},pushProgram:function(e){null!=e?this.pushStackLiteral(this.programExpression(e)):this.pushStackLiteral(null)},invokeHelper:function(e,t){this.context.aliases.helperMissing="helpers.helperMissing";var n=this.lastHelper=this.setupHelper(e,t,!0),i=this.nameLookup("depth"+this.lastContext,t,"context");this.push(n.name+" || "+i),this.replaceStack(function(e){return e+" ? "+e+".call("+n.callParams+") "+": helperMissing.call("+n.helperMissingParams+")"})},invokeKnownHelper:function(e,t){var n=this.setupHelper(e,t);this.push(n.name+".call("+n.callParams+")")},invokeAmbiguous:function(e,t){this.context.aliases.functionType='"function"',this.pushStackLiteral("{}");var n=this.setupHelper(0,e,t),i=this.lastHelper=this.nameLookup("helpers",e,"helper"),o=this.nameLookup("depth"+this.lastContext,e,"context"),r=this.nextStack();this.pushSource("if ("+r+" = "+i+") { "+r+" = "+r+".call("+n.callParams+"); }"),this.pushSource("else { "+r+" = "+o+"; "+r+" = typeof "+r+" === functionType ? "+r+".call("+n.callParams+") : "+r+"; }")},invokePartial:function(e){var t=[this.nameLookup("partials",e,"partial"),"'"+e+"'",this.popStack(),"helpers","partials"];this.options.data&&t.push("data"),this.context.aliases.self="this",this.push("self.invokePartial("+t.join(", ")+")")},assignToHash:function(e){var t,n,i=this.popStack();this.options.stringParams&&(n=this.popStack(),t=this.popStack());var o=this.hash;t&&o.contexts.push("'"+e+"': "+t),n&&o.types.push("'"+e+"': "+n),o.values.push("'"+e+"': ("+i+")")},compiler:n,compileChildren:function(e,t){for(var n,i,o=e.children,r=0,a=o.length;a>r;r++){n=o[r],i=new this.compiler;var s=this.matchExistingProgram(n);null==s?(this.context.programs.push(""),s=this.context.programs.length,n.index=s,n.name="program"+s,this.context.programs[s]=i.compile(n,t,this.context),this.context.environments[s]=n):(n.index=s,n.name="program"+s)}},matchExistingProgram:function(e){for(var t=0,n=this.context.environments.length;n>t;t++){var i=this.context.environments[t];if(i&&i.equals(e))return t}},programExpression:function(e){if(this.context.aliases.self="this",null==e)return"self.noop";for(var t,n=this.environment.children[e],i=n.depths.list,o=[n.index,n.name,"data"],r=0,a=i.length;a>r;r++)t=i[r],1===t?o.push("depth0"):o.push("depth"+(t-1));return(0===i.length?"self.program(":"self.programWithDepth(")+o.join(", ")+")"},register:function(e,t){this.useRegister(e),this.pushSource(e+" = "+t+";")},useRegister:function(e){this.registers[e]||(this.registers[e]=!0,this.registers.list.push(e))},pushStackLiteral:function(e){return this.push(new t(e))},pushSource:function(e){this.pendingContent&&(this.source.push(this.appendToBuffer(this.quotedString(this.pendingContent))),this.pendingContent=void 0),e&&this.source.push(e)},pushStack:function(e){this.flushInline();var t=this.incrStack();return e&&this.pushSource(t+" = "+e+";"),this.compileStack.push(t),t},replaceStack:function(e){var n,i="",o=this.isInline();if(o){var r=this.popStack(!0);if(r instanceof t)n=r.value;else{var a=this.stackSlot?this.topStackName():this.incrStack();i="("+this.push(a)+" = "+r+"),",n=this.topStack()}}else n=this.topStack();var s=e.call(this,n);return o?((this.inlineStack.length||this.compileStack.length)&&this.popStack(),this.push("("+i+s+")")):(/^stack/.test(n)||(n=this.nextStack()),this.pushSource(n+" = ("+i+s+");")),n},nextStack:function(){return this.pushStack()},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var e=this.inlineStack;if(e.length){this.inlineStack=[];for(var n=0,i=e.length;i>n;n++){var o=e[n];o instanceof t?this.compileStack.push(o):this.pushStack(o)}}},isInline:function(){return this.inlineStack.length},popStack:function(e){var n=this.isInline(),i=(n?this.inlineStack:this.compileStack).pop();return!e&&i instanceof t?i.value:(n||this.stackSlot--,i)},topStack:function(e){var n=this.isInline()?this.inlineStack:this.compileStack,i=n[n.length-1];return!e&&i instanceof t?i.value:i},quotedString:function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},setupHelper:function(e,t,n){var i=[];this.setupParams(e,i,n);var o=this.nameLookup("helpers",t,"helper");return{params:i,name:o,callParams:["depth0"].concat(i).join(", "),helperMissingParams:n&&["depth0",this.quotedString(t)].concat(i).join(", ")}},setupParams:function(e,t,n){var i,o,r,a=[],s=[],l=[];a.push("hash:"+this.popStack()),o=this.popStack(),r=this.popStack(),(r||o)&&(r||(this.context.aliases.self="this",r="self.noop"),o||(this.context.aliases.self="this",o="self.noop"),a.push("inverse:"+o),a.push("fn:"+r));for(var u=0;e>u;u++)i=this.popStack(),t.push(i),this.options.stringParams&&(l.push(this.popStack()),s.push(this.popStack()));return this.options.stringParams&&(a.push("contexts:["+s.join(",")+"]"),a.push("types:["+l.join(",")+"]"),a.push("hashContexts:hashContexts"),a.push("hashTypes:hashTypes")),this.options.data&&a.push("data:data"),a="{"+a.join(",")+"}",n?(this.register("options",a),t.push("options")):t.push(a),t.join(", ")}};for(var s="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),l=n.RESERVED_WORDS={},u=0,c=s.length;c>u;u++)l[s[u]]=!0;return n.isValidJavaScriptVariableName=function(e){return!n.RESERVED_WORDS[e]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(e)?!0:!1},i=n}(i),c=function(e,t,n,i){"use strict";function o(){}function r(e,t){if(null==e||"string"!=typeof e&&e.constructor!==d.ProgramNode)throw new l("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+e);t=t||{},"data"in t||(t.data=!0);var n=u(e),i=(new o).compile(n,t);return(new c).compile(i,t)}function a(e,t,n){function i(){var i=u(e),r=(new o).compile(i,t),a=(new c).compile(r,t,void 0,!0);return n.template(a)}if(null==e||"string"!=typeof e&&e.constructor!==d.ProgramNode)throw new l("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+e);t=t||{},"data"in t||(t.data=!0);var r;return function(e,t){return r||(r=i()),r.call(this,e,t)}}var s={},l=e,u=t.parse,c=n,d=i;return s.Compiler=o,o.prototype={compiler:o,disassemble:function(){for(var e,t,n,i=this.opcodes,o=[],r=0,a=i.length;a>r;r++)if(e=i[r],"DECLARE"===e.opcode)o.push("DECLARE "+e.name+"="+e.value);else{t=[];for(var s=0;e.args.length>s;s++)n=e.args[s],"string"==typeof n&&(n='"'+n.replace("\n","\\n")+'"'),t.push(n);o.push(e.opcode+" "+t.join(" "))}return o.join("\n")},equals:function(e){var t=this.opcodes.length;if(e.opcodes.length!==t)return!1;for(var n=0;t>n;n++){var i=this.opcodes[n],o=e.opcodes[n];if(i.opcode!==o.opcode||i.args.length!==o.args.length)return!1;for(var r=0;i.args.length>r;r++)if(i.args[r]!==o.args[r])return!1}if(t=this.children.length,e.children.length!==t)return!1;for(n=0;t>n;n++)if(!this.children[n].equals(e.children[n]))return!1;return!0},guid:0,compile:function(e,t){this.opcodes=[],this.children=[],this.depths={list:[]},this.options=t;var n=this.options.knownHelpers;if(this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0},n)for(var i in n)this.options.knownHelpers[i]=n[i];return this.accept(e)},accept:function(e){var t,n=e.strip||{};return n.left&&this.opcode("strip"),t=this[e.type](e),n.right&&this.opcode("strip"),t},program:function(e){for(var t=e.statements,n=0,i=t.length;i>n;n++)this.accept(t[n]);return this.isSimple=1===i,this.depths.list=this.depths.list.sort(function(e,t){return e-t}),this},compileProgram:function(e){var t,n=(new this.compiler).compile(e,this.options),i=this.guid++;this.usePartial=this.usePartial||n.usePartial,this.children[i]=n;for(var o=0,r=n.depths.list.length;r>o;o++)t=n.depths.list[o],2>t||this.addDepth(t-1);return i},block:function(e){var t=e.mustache,n=e.program,i=e.inverse;n&&(n=this.compileProgram(n)),i&&(i=this.compileProgram(i));var o=this.classifyMustache(t);"helper"===o?this.helperMustache(t,n,i):"simple"===o?(this.simpleMustache(t),this.opcode("pushProgram",n),this.opcode("pushProgram",i),this.opcode("emptyHash"),this.opcode("blockValue")):(this.ambiguousMustache(t,n,i),this.opcode("pushProgram",n),this.opcode("pushProgram",i),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(e){var t,n,i=e.pairs;this.opcode("pushHash");for(var o=0,r=i.length;r>o;o++)t=i[o],n=t[1],this.options.stringParams?(n.depth&&this.addDepth(n.depth),this.opcode("getContext",n.depth||0),this.opcode("pushStringParam",n.stringModeValue,n.type)):this.accept(n),this.opcode("assignToHash",t[0]);this.opcode("popHash")},partial:function(e){var t=e.partialName;this.usePartial=!0,e.context?this.ID(e.context):this.opcode("push","depth0"),this.opcode("invokePartial",t.name),this.opcode("append")},content:function(e){this.opcode("appendContent",e.string)},mustache:function(e){var t=this.options,n=this.classifyMustache(e);"simple"===n?this.simpleMustache(e):"helper"===n?this.helperMustache(e):this.ambiguousMustache(e),e.escaped&&!t.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ambiguousMustache:function(e,t,n){var i=e.id,o=i.parts[0],r=null!=t||null!=n;this.opcode("getContext",i.depth),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.opcode("invokeAmbiguous",o,r)},simpleMustache:function(e){var t=e.id;"DATA"===t.type?this.DATA(t):t.parts.length?this.ID(t):(this.addDepth(t.depth),this.opcode("getContext",t.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperMustache:function(e,t,n){var i=this.setupFullMustacheParams(e,t,n),o=e.id.parts[0];if(this.options.knownHelpers[o])this.opcode("invokeKnownHelper",i.length,o);else{if(this.options.knownHelpersOnly)throw Error("You specified knownHelpersOnly, but used the unknown helper "+o);this.opcode("invokeHelper",i.length,o)}},ID:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth);var t=e.parts[0];t?this.opcode("lookupOnContext",e.parts[0]):this.opcode("pushContext");for(var n=1,i=e.parts.length;i>n;n++)this.opcode("lookup",e.parts[n])},DATA:function(e){if(this.options.data=!0,e.id.isScoped||e.id.depth)throw new l("Scoped data references are not supported: "+e.original);this.opcode("lookupData");for(var t=e.id.parts,n=0,i=t.length;i>n;n++)this.opcode("lookup",t[n])},STRING:function(e){this.opcode("pushString",e.string)},INTEGER:function(e){this.opcode("pushLiteral",e.integer)},BOOLEAN:function(e){this.opcode("pushLiteral",e.bool)},comment:function(){},opcode:function(e){this.opcodes.push({opcode:e,args:[].slice.call(arguments,1)})},declare:function(e,t){this.opcodes.push({opcode:"DECLARE",name:e,value:t})},addDepth:function(e){if(isNaN(e))throw Error("EWOT");0!==e&&(this.depths[e]||(this.depths[e]=!0,this.depths.list.push(e)))},classifyMustache:function(e){var t=e.isHelper,n=e.eligibleHelper,i=this.options;if(n&&!t){var o=e.id.parts[0];i.knownHelpers[o]?t=!0:i.knownHelpersOnly&&(n=!1)}return t?"helper":n?"ambiguous":"simple"},pushParams:function(e){for(var t,n=e.length;n--;)t=e[n],this.options.stringParams?(t.depth&&this.addDepth(t.depth),this.opcode("getContext",t.depth||0),this.opcode("pushStringParam",t.stringModeValue,t.type)):this[t.type](t)},setupMustacheParams:function(e){var t=e.params;return this.pushParams(t),e.hash?this.hash(e.hash):this.opcode("emptyHash"),t},setupFullMustacheParams:function(e,t,n){var i=e.params;return this.pushParams(i),this.opcode("pushProgram",t),this.opcode("pushProgram",n),e.hash?this.hash(e.hash):this.opcode("emptyHash"),i}},s.precompile=r,s.compile=a,s}(n,l,u,a),d=function(e,t,n,i,o){"use strict";var r,a=e,s=t,l=n.parser,u=n.parse,c=i.Compiler,d=i.compile,h=i.precompile,p=o,f=a.create,m=function(){var e=f();return e.compile=function(t,n){return d(t,n,e)},e.precompile=h,e.AST=s,e.Compiler=c,e.JavaScriptCompiler=p,e.Parser=l,e.parse=u,e};return a=m(),a.create=m,r=a}(r,a,l,c,u);return d}();//! OpenSeadragon 0.9.129
//! Built on 2013-08-05
//! Git commit: v0.9.129-29-g967f2e4-dirty
//! http://openseadragon.github.io
//! License: http://openseadragon.github.io/license/
window.OpenSeadragon=window.OpenSeadragon||function(e){return new OpenSeadragon.Viewer(e)},function(e){var t={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},n=Object.prototype.toString,i=Object.prototype.hasOwnProperty;e.isFunction=function(t){return"function"===e.type(t)},e.isArray=Array.isArray||function(t){return"array"===e.type(t)},e.isWindow=function(e){return e&&"object"==typeof e&&"setInterval"in e},e.type=function(e){return null===e||void 0===e?e+"":t[n.call(e)]||"object"},e.isPlainObject=function(t){if(!t||"object"!==OpenSeadragon.type(t)||t.nodeType||e.isWindow(t))return!1;if(t.constructor&&!i.call(t,"constructor")&&!i.call(t.constructor.prototype,"isPrototypeOf"))return!1;var n;for(n in t);return void 0===n||i.call(t,n)},e.isEmptyObject=function(e){for(var t in e)return!1;return!0}}(OpenSeadragon),function(e){function t(e,t){return t&&e!=document.body?document.body:e.offsetParent}e.extend=function(){var e,t,n,i,o,r,a=arguments[0]||{},s=arguments.length,l=!1,u=1;for("boolean"==typeof a&&(l=a,a=arguments[1]||{},u=2),"object"==typeof a||OpenSeadragon.isFunction(a)||(a={}),s===u&&(a=this,--u);s>u;u++)if(e=arguments[u],null!==e||void 0!==e)for(t in e)n=a[t],i=e[t],a!==i&&(l&&i&&(OpenSeadragon.isPlainObject(i)||(o=OpenSeadragon.isArray(i)))?(o?(o=!1,r=n&&OpenSeadragon.isArray(n)?n:[]):r=n&&OpenSeadragon.isPlainObject(n)?n:{},a[t]=OpenSeadragon.extend(l,r,i)):void 0!==i&&(a[t]=i));return a},e.extend(e,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,springStiffness:7,clickTimeThreshold:300,clickDistThreshold:5,zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,animationTime:1.2,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,showSequenceControl:!0,preserveViewport:!1,showNavigationControl:!0,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorHeight:null,navigatorWidth:null,navigatorPosition:null,navigatorSizeRatio:.2,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,onPageChange:null,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},navPrevNextWrap:!1,debugMode:!1,debugGridColor:"#437AB2"},SIGNAL:"----seadragon----",delegate:function(e,t){return function(){var n=arguments;return void 0===n&&(n=[]),t.apply(e,n)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(e){return"string"==typeof e&&(e=document.getElementById(e)),e},getElementPosition:function(n){var i,o,r=new e.Point;for(n=e.getElement(n),i="fixed"==e.getElementStyle(n).position,o=t(n,i);o;)r.x+=n.offsetLeft,r.y+=n.offsetTop,i&&(r=r.plus(e.getPageScroll())),n=o,i="fixed"==e.getElementStyle(n).position,o=t(n,i);return r},getElementSize:function(t){return t=e.getElement(t),new e.Point(t.clientWidth,t.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(t){return t=e.getElement(t),t.currentStyle}:function(t){return t=e.getElement(t),window.getComputedStyle(t,"")},getEvent:function(t){return e.getEvent=t?function(e){return e}:function(){return window.event},e.getEvent(t)},getMousePosition:function(t){if("number"==typeof t.pageX)e.getMousePosition=function(t){var n=new e.Point;return t=e.getEvent(t),n.x=t.pageX,n.y=t.pageY,n};else{if("number"!=typeof t.clientX)throw Error("Unknown event mouse position, no known technique.");e.getMousePosition=function(t){var n=new e.Point;return t=e.getEvent(t),n.x=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n.y=t.clientY+document.body.scrollTop+document.documentElement.scrollTop,n}}return e.getMousePosition(t)},getPageScroll:function(){var t=document.documentElement||{},n=document.body||{};return e.getPageScroll="number"==typeof window.pageXOffset?function(){return new e.Point(window.pageXOffset,window.pageYOffset)}:n.scrollLeft||n.scrollTop?function(){return new e.Point(document.body.scrollLeft,document.body.scrollTop)}:t.scrollLeft||t.scrollTop?function(){return new e.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}:function(){return new e.Point(0,0)},e.getPageScroll()},getWindowSize:function(){var t=document.documentElement||{},n=document.body||{};if("number"==typeof window.innerWidth)e.getWindowSize=function(){return new e.Point(window.innerWidth,window.innerHeight)};else if(t.clientWidth||t.clientHeight)e.getWindowSize=function(){return new e.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!n.clientWidth&&!n.clientHeight)throw Error("Unknown window size, no known technique.");e.getWindowSize=function(){return new e.Point(document.body.clientWidth,document.body.clientHeight)}}return e.getWindowSize()},makeCenteredNode:function(t){t=e.getElement(t);var n=[e.makeNeutralElement("div"),e.makeNeutralElement("div"),e.makeNeutralElement("div")];return e.extend(n[0].style,{display:"table",height:"100%",width:"100%"}),e.extend(n[1].style,{display:"table-row"}),e.extend(n[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),n[0].appendChild(n[1]),n[1].appendChild(n[2]),n[2].appendChild(t),n[0]},makeNeutralElement:function(e){var t=document.createElement(e),n=t.style;return n.background="transparent none",n.border="none",n.margin="0px",n.padding="0px",n.position="static",t},now:function(){return e.now=Date.now?Date.now:function(){return(new Date).getTime()},e.now()},makeTransparentImage:function(t){return e.makeTransparentImage=function(t){var n=e.makeNeutralElement("img");return n.src=t,n},e.Browser.vendor==e.BROWSERS.IE&&7>e.Browser.version&&(e.makeTransparentImage=function(t){var n=e.makeNeutralElement("img"),i=null;return i=e.makeNeutralElement("span"),i.style.display="inline-block",n.onload=function(){i.style.width=i.style.width||n.width+"px",i.style.height=i.style.height||n.height+"px",n.onload=null,n=null},n.src=t,i.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+t+"', sizingMethod='scale')",i}),e.makeTransparentImage(t)},setElementOpacity:function(t,n,i){var o,r;t=e.getElement(t),i&&!e.Browser.alpha&&(n=Math.round(n)),e.Browser.opacity?t.style.opacity=1>n?n:"":1>n?(o=Math.round(100*n),r="alpha(opacity="+o+")",t.style.filter=r):t.style.filter=""},addClass:function(t,n){t=e.getElement(t),t.className?-1===(" "+t.className+" ").indexOf(" "+n+" ")&&(t.className+=" "+n):t.className=n},removeClass:function(t,n){var i,o,r=[];for(t=e.getElement(t),i=t.className.split(/\s+/),o=0;i.length>o;o++)i[o]&&i[o]!==n&&r.push(i[o]);t.className=r.join(" ")},addEvent:function(t,n,i,o){if(t=e.getElement(t),t.addEventListener)e.addEvent=function(t,n,i,o){t=e.getElement(t),t.addEventListener(n,i,o)};else{if(!t.attachEvent)throw Error("Unable to attach event handler, no known technique.");e.addEvent=function(t,n,i,o){t=e.getElement(t),t.attachEvent("on"+n,i),o&&t.setCapture&&t.setCapture()}}return e.addEvent(t,n,i,o)},removeEvent:function(t,n,i,o){if(t=e.getElement(t),t.removeEventListener)e.removeEvent=function(t,n,i,o){t=e.getElement(t),t.removeEventListener(n,i,o)};else{if(!t.detachEvent)throw Error("Unable to detach event handler, no known technique.");e.removeEvent=function(t,n,i,o){t=e.getElement(t),t.detachEvent("on"+n,i),o&&t.releaseCapture&&t.releaseCapture()}}return e.removeEvent(t,n,i,o)},cancelEvent:function(t){t=e.getEvent(t),e.cancelEvent=t.preventDefault?function(e){e.preventDefault()}:function(t){t=e.getEvent(t),t.cancel=!0,t.returnValue=!1},e.cancelEvent(t)},stopEvent:function(t){t=e.getEvent(t),e.stopEvent=t.stopPropagation?function(e){e.stopPropagation()}:function(t){t=e.getEvent(t),t.cancelBubble=!0},e.stopEvent(t)},createCallback:function(e,t){var n,i=[];for(n=2;arguments.length>n;n++)i.push(arguments[n]);return function(){var n,o=i.concat([]);for(n=0;arguments.length>n;n++)o.push(arguments[n]);return t.apply(e,o)}},getUrlParameter:function(e){var t=o[e];return t?t:null},createAjaxRequest:function(){var t;if(window.XMLHttpRequest)e.createAjaxRequest=function(){return new XMLHttpRequest},t=new XMLHttpRequest;else if(window.ActiveXObject)for(var i=0;n.length>i;i++)try{t=new ActiveXObject(n[i]),e.createAjaxRequest=function(){return new ActiveXObject(n[i])};break}catch(o){continue}if(!t)throw Error("Browser doesn't support XMLHttpRequest.");return t},makeAjaxRequest:function(t,n,i){var o=e.createAjaxRequest();if(!e.isFunction(n))throw Error("makeAjaxRequest requires a success callback");o.onreadystatechange=function(){4==o.readyState&&(o.onreadystatechange=function(){},200==o.status?n(o):(e.console.log("AJAX request returned %s: %s",o.status,t),e.isFunction(i)&&i(o)))};try{o.open("GET",t,!0),o.send(null)}catch(r){e.console.log("%s while making AJAX request: %s",r.name,r.message),o.onreadystatechange=function(){},e.isFunction(i)&&i(o,r)}},jsonp:function(t){var n,i=t.url,o=document.head||document.getElementsByTagName("head")[0]||document.documentElement,r=t.callbackName||"openseadragon"+e.now(),a=window[r],s="$1"+r+"$2",l=t.param||"callback",u=t.callback;i=i.replace(/(\=)\?(&|$)|\?\?/i,s),i+=(/\?/.test(i)?"&":"?")+l+"="+r,window[r]=function(t){if(a)window[r]=a;else try{delete window[r]}catch(n){}u&&e.isFunction(u)&&u(t)},n=document.createElement("script"),(void 0!==t.async||!1!==t.async)&&(n.async="async"),t.scriptCharset&&(n.charset=t.scriptCharset),n.src=i,n.onload=n.onreadystatechange=function(e,t){(t||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,o&&n.parentNode&&o.removeChild(n),n=void 0)},o.insertBefore(n,o.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(t){if(window.ActiveXObject)e.parseXml=function(e){var t=null;return t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(e),t};else{if(!window.DOMParser)throw Error("Browser doesn't support XML DOM.");e.parseXml=function(e){var t,n=null;return t=new DOMParser,n=t.parseFromString(e,"text/xml")}}return e.parseXml(t)},imageFormatSupported:function(e){return e=e?e:"",!!i[e.toLowerCase()]}}),e.Browser={vendor:e.BROWSERS.UNKNOWN,version:0,alpha:!0};var n=["Msxml2.XMLHTTP","Msxml3.XMLHTTP","Microsoft.XMLHTTP"],i={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},o={};!function(){var t=(navigator.appName,navigator.appVersion),n=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(n.substring(n.indexOf("MSIE")+5,n.indexOf(";",n.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(n.indexOf("Firefox")>=0?(e.Browser.vendor=e.BROWSERS.FIREFOX,e.Browser.version=parseFloat(n.substring(n.indexOf("Firefox")+8))):n.indexOf("Safari")>=0&&(e.Browser.vendor=n.indexOf("Chrome")>=0?e.BROWSERS.CHROME:e.BROWSERS.SAFARI,e.Browser.version=parseFloat(n.substring(n.substring(0,n.indexOf("Safari")).lastIndexOf("/")+1,n.indexOf("Safari")))));break;case"Opera":e.Browser.vendor=e.BROWSERS.OPERA,e.Browser.version=parseFloat(t)}var i,r,a,s=window.location.search.substring(1),l=s.split("&");for(a=0;l.length>a;a++)i=l[a],r=i.indexOf("="),r>0&&(o[i.substring(0,r)]=decodeURIComponent(i.substring(r+1)));e.Browser.alpha=!(e.Browser.vendor==e.BROWSERS.IE&&9>e.Browser.version||e.Browser.vendor==e.BROWSERS.CHROME&&2>e.Browser.version),e.Browser.opacity=!(e.Browser.vendor==e.BROWSERS.IE&&9>e.Browser.version)}();var r=function(){};e.console=window.console||{log:r,debug:r,info:r,warn:r,error:r},function(t){var n=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame,i=t.cancelAnimationFrame||t.mozCancelAnimationFrame||t.webkitCancelAnimationFrame||t.msCancelAnimationFrame;if(n&&i)e.requestAnimationFrame=function(){return n.apply(t,arguments)},e.cancelAnimationFrame=function(){return i.apply(t,arguments)};else{var o,r=[],a=[],s=0;e.requestAnimationFrame=function(t){return r.push([++s,t]),o||(o=setInterval(function(){if(r.length){var t=e.now(),n=a;for(a=r,r=n;a.length;)a.shift()[1](t)}else clearInterval(o),o=void 0},20)),s},e.cancelAnimationFrame=function(e){var t,n;for(t=0,n=r.length;n>t;t+=1)if(r[t][0]===e)return r.splice(t,1),void 0;for(t=0,n=a.length;n>t;t+=1)if(a[t][0]===e)return a.splice(t,1),void 0}}}(window),e._processDZIError=function(e){var t=e.getElementsByTagName("Message")[0],n=t.firstChild.nodeValue;throw Error(n)}}(OpenSeadragon),function(e){var t={supportsFullScreen:!1,isFullScreen:function(){return!1},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",prefix:""},n="webkit moz o ms khtml".split(" ");if(document.cancelFullScreen!==void 0)t.supportsFullScreen=!0;else for(var i=0,o=n.length;o>i;i++)if(t.prefix=n[i],document[t.prefix+"CancelFullScreen"]!==void 0){t.supportsFullScreen=!0;break}t.supportsFullScreen?(t.fullScreenEventName=t.prefix+"fullscreenchange",t.isFullScreen=function(){switch(this.prefix){case"":return document.fullScreen;case"webkit":return document.webkitIsFullScreen;default:return document[this.prefix+"FullScreen"]}},t.requestFullScreen=function(e){return""===this.prefix?e.requestFullScreen():e[this.prefix+"RequestFullScreen"]()},t.cancelFullScreen=function(){return""===this.prefix?document.cancelFullScreen():document[this.prefix+"CancelFullScreen"]()}):window.ActiveXObject!==void 0&&(t.requestFullScreen=function(){var e=new ActiveXObject("WScript.Shell");return null!==e&&e.SendKeys("{F11}"),!1},t.cancelFullScreen=t.requestFullScreen),e.extend(e,t)}(OpenSeadragon),function(e){e.EventHandler=function(){this.events={}},e.EventHandler.prototype={addHandler:function(t,n){var i=this.events[t];i||(this.events[t]=i=[]),n&&e.isFunction(n)&&(i[i.length]=n)},removeHandler:function(t,n){var i,o=this.events[t],r=[];if(o&&e.isArray(o)){for(i=0;o.length>i;i++)o[i]!==n&&r.push(o[i]);this.events[t]=r}},removeAllHandlers:function(e){this.events[e]=[]},getHandler:function(e){var t=this.events[e];return t&&t.length?(t=1===t.length?[t[0]]:Array.apply(null,t),function(e,n){var i,o=t.length;for(i=0;o>i;i++)t[i]&&t[i](e,n)}):null},raiseEvent:function(e,t){var n=this.getHandler(e);n&&(t||(t={}),n(this,t))}}}(OpenSeadragon),function(e){function t(t){var n,i,o=["mouseover","mouseout","mousedown","mouseup","click","DOMMouseScroll","mousewheel","touchstart","touchmove","touchend","keypress","focus","blur"],r=O[t.hash];if(!r.tracking){for(i=0;o.length>i;i++)n=o[i],e.addEvent(t.element,n,r[n],!1);r.tracking=!0,P[t.hash]=t}}function n(t){var n,i,o=["mouseover","mouseout","mousedown","mouseup","click","DOMMouseScroll","mousewheel","touchstart","touchmove","touchend","keypress","focus","blur"],a=O[t.hash];if(a.tracking){for(i=0;o.length>i;i++)n=o[i],e.removeEvent(t.element,n,a[n],!1);r(t),a.tracking=!1,delete P[t.hash]}}function i(e){return O[e.hash].insideElement}function o(t){var n=O[t.hash];n.capturing||(e.Browser.vendor==e.BROWSERS.IE&&9>e.Browser.version?(e.removeEvent(t.element,"mouseup",n.mouseup,!1),e.addEvent(t.element,"mouseup",n.mouseupie,!0),e.addEvent(t.element,"mousemove",n.mousemoveie,!0)):(e.addEvent(window,"mouseup",n.mouseupwindow,!0),e.addEvent(window,"mousemove",n.mousemove,!0)),n.capturing=!0)}function r(t){var n=O[t.hash];n.capturing&&(e.Browser.vendor==e.BROWSERS.IE&&9>e.Browser.version?(e.removeEvent(t.element,"mousemove",n.mousemoveie,!0),e.removeEvent(t.element,"mouseup",n.mouseupie,!0),e.addEvent(t.element,"mouseup",n.mouseup,!1)):(e.removeEvent(window,"mousemove",n.mousemove,!0),e.removeEvent(window,"mouseup",n.mouseupwindow,!0)),n.capturing=!1)}function a(e,t,n){var i;for(i in P)P.hasOwnProperty(i)&&e.hash!=i&&t(P[i],n)}function s(t,n){var i;t.focusHandler&&(i=t.focusHandler(t,n),i===!1&&e.cancelEvent(n))}function l(t,n){var i;t.blurHandler&&(i=t.blurHandler(t,n),i===!1&&e.cancelEvent(n))}function u(t,n){var i;t.keyHandler&&(i=t.keyHandler(t,n.keyCode?n.keyCode:n.charCode,n.shiftKey),i||e.cancelEvent(n))}function c(t,n){var i,o=O[t.hash];n=e.getEvent(n),e.Browser.vendor==e.BROWSERS.IE&&9>e.Browser.version&&o.capturing&&!E(n.srcElement,t.element)&&a(t,c,n);var r=n.target?n.target:n.srcElement,s=n.relatedTarget?n.relatedTarget:n.fromElement;E(t.element,r)&&!E(t.element,s)&&(o.insideElement=!0,t.enterHandler&&(i=t.enterHandler(t,T(n,t.element),o.buttonDown,A),i===!1&&e.cancelEvent(n)))}function d(t,n){var i,o=O[t.hash];n=e.getEvent(n),e.Browser.vendor==e.BROWSERS.IE&&9>e.Browser.version&&o.capturing&&!E(n.srcElement,t.element)&&a(t,d,n);var r=n.target?n.target:n.srcElement,s=n.relatedTarget?n.relatedTarget:n.toElement;E(t.element,r)&&!E(t.element,s)&&(o.insideElement=!1,t.exitHandler&&(i=t.exitHandler(t,T(n,t.element),o.buttonDown,A),i===!1&&e.cancelEvent(n)))}function h(t,n,i){var r,a=O[t.hash];n=e.getEvent(n),2!=n.button&&(a.buttonDown=!0,a.lastPoint=S(n),a.lastMouseDownPoint=a.lastPoint,a.lastMouseDownTime=e.now(),t.pressHandler&&(r=t.pressHandler(t,T(n,t.element)),r===!1&&e.cancelEvent(n)),(t.pressHandler||t.dragHandler)&&e.cancelEvent(n),i||(e.Browser.vendor==e.BROWSERS.IE&&9>e.Browser.version&&M?e.Browser.vendor==e.BROWSERS.IE&&9>e.Browser.version&&R.push(t):(o(t),M=!0,R=[t])))}function p(t,n){var i,o;1==n.touches.length&&1==n.targetTouches.length&&1==n.changedTouches.length&&(O[t.hash].lastTouch=n.touches[0],c(t,n.changedTouches[0]),h(t,n.touches[0],!0)),2==n.touches.length&&(i=S(n.touches[0]),o=S(n.touches[1]),O[t.hash].lastPinchDelta=Math.abs(i.x-o.x)+Math.abs(i.y-o.y),O[t.hash].pinchMidpoint=new e.Point((i.x+o.x)/2,(i.y+o.y)/2)),n.preventDefault()}function f(t,n){var i,o=O[t.hash],r=o.buttonDown,a=o.insideElement;n=e.getEvent(n),2!=n.button&&(o.buttonDown=!1,t.releaseHandler&&(i=t.releaseHandler(t,T(n,t.element),r,a),i===!1&&e.cancelEvent(n)),r&&a&&w(t,n))}function m(e,t){0===t.touches.length&&0===t.targetTouches.length&&1==t.changedTouches.length&&(O[e.hash].lastTouch=null,v(e,t.changedTouches[0],!0),d(e,t.changedTouches[0])),2==t.touches.length+t.changedTouches.length&&(O[e.hash].lastPinchDelta=null,O[e.hash].pinchMidpoint=null),t.preventDefault()}function g(t,n){var o,a;if(n=e.getEvent(n),2!=n.button){for(a=0;R.length>a;a++)o=R[a],i(o)||f(o,n);r(t),M=!1,n.srcElement.fireEvent("on"+n.type,document.createEventObject(n)),e.stopEvent(n)}}function v(e,t,n){O[e.hash].insideElement||f(e,t),n||r(e)}function y(t,n){t.clickHandler&&e.cancelEvent(n)}function b(t,n){var i,o=0;n||(n=window.event),n.wheelDelta?(o=n.wheelDelta,window.opera&&(o=-o)):n.detail&&(o=-n.detail),o=o>0?1:-1,t.scrollHandler&&(i=t.scrollHandler(t,T(n,t.element),o,n.shiftKey),i===!1&&e.cancelEvent(n))}function w(t,n){var i,o=O[t.hash];if(n=e.getEvent(n),2!=n.button){var r=e.now()-o.lastMouseDownTime,a=S(n),s=o.lastMouseDownPoint.distanceTo(a),l=t.clickTimeThreshold>=r&&t.clickDistThreshold>=s;t.clickHandler&&(i=t.clickHandler(t,T(n,t.element),l,n.shiftKey),i===!1&&e.cancelEvent(n))}}function x(t,n){var i,o,r,a=O[t.hash];n=e.getEvent(n),r=S(n),i=r.minus(a.lastPoint),a.lastPoint=r,t.dragHandler&&(o=t.dragHandler(t,T(n,t.element),i,n.shiftKey),o===!1&&e.cancelEvent(n))}function _(e,t){var n,i,o;1===t.touches.length&&1===t.targetTouches.length&&1===t.changedTouches.length&&O[e.hash].lastTouch.identifier===t.touches[0].identifier?x(e,t.touches[0]):2===t.touches.length&&(n=S(t.touches[0]),i=S(t.touches[1]),o=Math.abs(n.x-i.x)+Math.abs(n.y-i.y),Math.abs(O[e.hash].lastPinchDelta-o)>75&&(b(e,{shift:!1,pageX:O[e.hash].pinchMidpoint.x,pageY:O[e.hash].pinchMidpoint.y,detail:O[e.hash].lastPinchDelta>o?1:-1}),O[e.hash].lastPinchDelta=o)),t.preventDefault()}function C(t,n){var i;for(i=0;R.length>i;i++)x(R[i],n);e.stopEvent(n)}function S(t){return e.getMousePosition(t)}function T(t,n){var i=e.getMousePosition(t),o=e.getElementPosition(n);return i.minus(o)}function E(e,t){for(var n=document.body;t&&e!=t&&n!=t;)try{t=t.parentNode}catch(i){return!1}return e==t}function k(){A=!0}function N(){A=!1}var A=!1,M=!1,P={},R=[],O={};e.MouseTracker=function(t){var n=arguments;e.isPlainObject(t)||(t={element:n[0],clickTimeThreshold:n[1],clickDistThreshold:n[2]}),this.hash=Math.random(),this.element=e.getElement(t.element),this.clickTimeThreshold=t.clickTimeThreshold,this.clickDistThreshold=t.clickDistThreshold,this.enterHandler=t.enterHandler||null,this.exitHandler=t.exitHandler||null,this.pressHandler=t.pressHandler||null,this.releaseHandler=t.releaseHandler||null,this.scrollHandler=t.scrollHandler||null,this.clickHandler=t.clickHandler||null,this.dragHandler=t.dragHandler||null,this.keyHandler=t.keyHandler||null,this.focusHandler=t.focusHandler||null,this.blurHandler=t.blurHandler||null;var i=this;O[this.hash]={mouseover:function(e){c(i,e)},mouseout:function(e){d(i,e)},mousedown:function(e){h(i,e)},mouseup:function(e){f(i,e)},click:function(e){y(i,e)},DOMMouseScroll:function(e){b(i,e)},mousewheel:function(e){b(i,e)},mouseupie:function(e){g(i,e)},mousemoveie:function(e){C(i,e)},mouseupwindow:function(e){v(i,e)},mousemove:function(e){x(i,e)},touchstart:function(e){p(i,e)},touchmove:function(e){_(i,e)},touchend:function(e){m(i,e)},keypress:function(e){u(i,e)},focus:function(e){s(i,e)},blur:function(e){l(i,e)},tracking:!1,capturing:!1,buttonDown:!1,insideElement:!1,lastPoint:null,lastMouseDownTime:null,lastMouseDownPoint:null,lastPinchDelta:0}},e.MouseTracker.prototype={isTracking:function(){return O[this.hash].tracking},setTracking:function(e){return e?t(this):n(this),this},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},releaseHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dragHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},function(){e.Browser.vendor==e.BROWSERS.IE&&9>e.Browser.version?(e.addEvent(document,"mousedown",k,!1),e.addEvent(document,"mouseup",N,!1)):(e.addEvent(window,"mousedown",k,!0),e.addEvent(window,"mouseup",N,!0))}()}(OpenSeadragon),function(e){e.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4},e.Control=function(t,n,i){var o=t.parentNode;"number"==typeof n&&(e.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),n={anchor:n}),n.attachToViewer=n.attachToViewer===void 0?!0:n.attachToViewer,this.autoFade=n.autoFade===void 0?!0:n.autoFade,this.element=t,this.anchor=n.anchor,this.container=i,this.wrapper=e.makeNeutralElement("span"),this.wrapper.style.display="inline-block",this.wrapper.appendChild(this.element),this.anchor==e.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%"),n.attachToViewer?this.anchor==e.ControlAnchor.TOP_RIGHT||this.anchor==e.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):o.appendChild(this.wrapper)},e.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!=this.wrapper.style.display},setVisible:function(e){this.wrapper.style.display=e?"inline-block":"none"},setOpacity:function(t){this.element[e.SIGNAL]&&e.Browser.vendor==e.BROWSERS.IE?e.setElementOpacity(this.element,t,!0):e.setElementOpacity(this.wrapper,t,!0)}}}(OpenSeadragon),function(e){function t(e,t){var n,i=e.controls;for(n=i.length-1;n>=0;n--)if(i[n].element==t)return n;return-1}e.ControlDock=function(t){var n,i,o=["topleft","topright","bottomright","bottomleft"];for(e.extend(!0,this,{id:"controldock-"+e.now()+"-"+Math.floor(1e6*Math.random()),container:e.makeNeutralElement("form"),controls:[]},t),this.element&&(this.element=e.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),i=0;o.length>i;i++)n=o[i],this.controls[n]=e.makeNeutralElement("div"),this.controls[n].style.position="absolute",n.match("left")&&(this.controls[n].style.left="0px"),n.match("right")&&(this.controls[n].style.right="0px"),n.match("top")&&(this.controls[n].style.top="0px"),n.match("bottom")&&(this.controls[n].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},e.ControlDock.prototype={addControl:function(n,i){n=e.getElement(n);var o=null;if(!(t(this,n)>=0)){switch(i.anchor){case e.ControlAnchor.TOP_RIGHT:o=this.controls.topright,n.style.position="relative",n.style.paddingRight="0px",n.style.paddingTop="0px";break;case e.ControlAnchor.BOTTOM_RIGHT:o=this.controls.bottomright,n.style.position="relative",n.style.paddingRight="0px",n.style.paddingBottom="0px";break;case e.ControlAnchor.BOTTOM_LEFT:o=this.controls.bottomleft,n.style.position="relative",n.style.paddingLeft="0px",n.style.paddingBottom="0px";break;case e.ControlAnchor.TOP_LEFT:o=this.controls.topleft,n.style.position="relative",n.style.paddingLeft="0px",n.style.paddingTop="0px";break;default:case e.ControlAnchor.NONE:o=this.container,n.style.margin="0px",n.style.padding="0px"}this.controls.push(new e.Control(n,i,o)),n.style.display="inline-block"}},removeControl:function(n){n=e.getElement(n);var i=t(this,n);return i>=0&&(this.controls[i].destroy(),this.controls.splice(i,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var e;for(e=this.controls.length-1;e>=0;e--)if(this.controls[e].isVisible())return!0;return!1},setControlsEnabled:function(e){var t;for(t=this.controls.length-1;t>=0;t--)this.controls[t].setVisible(e);return this}}}(OpenSeadragon),function($){function _getSafeElemSize(e){return e=$.getElement(e),new $.Point(0===e.clientWidth?1:e.clientWidth,0===e.clientHeight?1:e.clientHeight)}function openTileSource(e,t){var n,i,o=e;for(o.source&&o.close(),o.canvas.innerHTML="",THIS[o.hash].prevContainerSize=_getSafeElemSize(o.container),o.collectionMode?(o.source=new $.TileSourceCollection({rows:o.collectionRows,layout:o.collectionLayout,tileSize:o.collectionTileSize,tileSources:o.tileSources,tileMargin:o.collectionTileMargin}),o.viewport=o.viewport?o.viewport:new $.Viewport({collectionMode:!0,collectionTileSource:o.source,containerSize:THIS[o.hash].prevContainerSize,contentSize:o.source.dimensions,springStiffness:o.springStiffness,animationTime:o.animationTime,showNavigator:!1,minZoomImageRatio:1,maxZoomPixelRatio:1,viewer:o})):(t&&(o.source=t),o.viewport=o.viewport?o.viewport:new $.Viewport({containerSize:THIS[o.hash].prevContainerSize,contentSize:o.source.dimensions,springStiffness:o.springStiffness,animationTime:o.animationTime,minZoomImageRatio:o.minZoomImageRatio,maxZoomPixelRatio:o.maxZoomPixelRatio,visibilityRatio:o.visibilityRatio,wrapHorizontal:o.wrapHorizontal,wrapVertical:o.wrapVertical,defaultZoomLevel:o.defaultZoomLevel,minZoomLevel:o.minZoomLevel,maxZoomLevel:o.maxZoomLevel,viewer:o})),o.preserveViewport&&o.viewport.resetContentSize(o.source.dimensions),o.source.overlays=o.source.overlays||[],o.drawer=new $.Drawer({viewer:o,source:o.source,viewport:o.viewport,element:o.canvas,overlays:[].concat(o.overlays).concat(o.source.overlays),maxImageCacheCount:o.maxImageCacheCount,imageLoaderLimit:o.imageLoaderLimit,minZoomImageRatio:o.minZoomImageRatio,wrapHorizontal:o.wrapHorizontal,wrapVertical:o.wrapVertical,immediateRender:o.immediateRender,blendTime:o.blendTime,alwaysBlend:o.alwaysBlend,minPixelRatio:o.collectionMode?0:o.minPixelRatio,timeout:o.timeout,debugMode:o.debugMode,debugGridColor:o.debugGridColor}),o.showNavigator&&!o.collectionMode&&(o.navigator?o.navigator.open(t):o.navigator=new $.Navigator({id:o.navigatorId,position:o.navigatorPosition,sizeRatio:o.navigatorSizeRatio,height:o.navigatorHeight,width:o.navigatorWidth,tileSources:t,tileHost:o.tileHost,prefixUrl:o.prefixUrl,overlays:o.overlays,viewer:o})),o.showReferenceStrip&&!o.referenceStrip&&(o.referenceStrip=new $.ReferenceStrip({id:o.referenceStripElement,position:o.referenceStripPosition,sizeRatio:o.referenceStripSizeRatio,scroll:o.referenceStripScroll,height:o.referenceStripHeight,width:o.referenceStripWidth,tileSources:o.tileSources,tileHost:o.tileHost,prefixUrl:o.prefixUrl,overlays:o.overlays,viewer:o})),THIS[o.hash].animating=!1,THIS[o.hash].forceRedraw=!0,o._updateRequestId=scheduleUpdate(o,updateMulti),i=0;o.overlayControls.length>i;i++)n=o.overlayControls[i],n.point?o.drawer.addOverlay(n.id,new $.Point(n.point.X,n.point.Y),$.OverlayPlacement.TOP_LEFT):o.drawer.addOverlay(n.id,new $.Rect(n.rect.Point.X,n.rect.Point.Y,n.rect.Width,n.rect.Height),n.placement);return VIEWERS[o.hash]=o,o.raiseEvent("open",{source:t,viewer:o}),o}function scheduleUpdate(e,t){return $.requestAnimationFrame(function(){t(e)})}function scheduleControlsFade(e){$.requestAnimationFrame(function(){updateControlsFade(e)})}function beginControlsAutoHide(e){e.autoHideControls&&(e.controlsShouldFade=!0,e.controlsFadeBeginTime=$.now()+e.controlsFadeDelay,window.setTimeout(function(){scheduleControlsFade(e)},e.controlsFadeDelay))}function updateControlsFade(e){var t,n,i,o;if(e.controlsShouldFade){for(t=$.now(),n=t-e.controlsFadeBeginTime,i=1-n/e.controlsFadeLength,i=Math.min(1,i),i=Math.max(0,i),o=e.controls.length-1;o>=0;o--)e.controls[o].autoFade&&e.controls[o].setOpacity(i);i>0&&scheduleControlsFade(e)}}function abortControlsAutoHide(e){var t;for(e.controlsShouldFade=!1,t=e.controls.length-1;t>=0;t--)e.controls[t].setOpacity(1)}function onFocus(){abortControlsAutoHide(this)}function onBlur(){beginControlsAutoHide(this)}function onCanvasClick(e,t,n,i){var o,r;this.viewport&&n&&(o=this.zoomPerClick,r=i?1/o:o,this.viewport.zoomBy(r,this.viewport.pointFromPixel(t,!0)),this.viewport.applyConstraints()),this.raiseEvent("canvas-click",{tracker:e,position:t,quick:n,shift:i})}function onCanvasDrag(e,t,n,i){this.viewport&&(this.panHorizontal||(n.x=0),this.panVertical||(n.y=0),this.viewport.panBy(this.viewport.deltaPointsFromPixels(n.negate())),this.constrainDuringPan&&this.viewport.applyConstraints()),this.raiseEvent("canvas-click",{tracker:e,position:t,delta:n,shift:i})}function onCanvasRelease(e,t,n,i){n&&this.viewport&&this.viewport.applyConstraints(),this.raiseEvent("canvas-release",{tracker:e,position:t,insideElementPress:n,insideElementRelease:i})}function onCanvasScroll(e,t,n,i){var o;return this.viewport&&(o=Math.pow(this.zoomPerScroll,n),this.viewport.zoomBy(o,this.viewport.pointFromPixel(t,!0)),this.viewport.applyConstraints()),this.raiseEvent("canvas-scroll",{tracker:e,position:t,scroll:n,shift:i}),!1}function onContainerExit(e,t,n,i){n||(THIS[this.hash].mouseInside=!1,THIS[this.hash].animating||beginControlsAutoHide(this)),this.raiseEvent("container-exit",{tracker:e,position:t,buttonDownElement:n,buttonDownAny:i})
}function onContainerRelease(e,t,n,i){i||(THIS[this.hash].mouseInside=!1,THIS[this.hash].animating||beginControlsAutoHide(this)),this.raiseEvent("container-release",{tracker:e,position:t,insideElementPress:n,insideElementRelease:i})}function onContainerEnter(e,t,n,i){THIS[this.hash].mouseInside=!0,abortControlsAutoHide(this),this.raiseEvent("container-enter",{tracker:e,position:t,buttonDownElement:n,buttonDownAny:i})}function updateMulti(e){return e.source?(updateOnce(e),e.source&&(e._updateRequestId=scheduleUpdate(e,updateMulti)),void 0):(e._updateRequestId=null,void 0)}function updateOnce(e){var t,n;e.source&&(t=_getSafeElemSize(e.container),t.equals(THIS[e.hash].prevContainerSize)||(e.viewport.resize(t,!0),THIS[e.hash].prevContainerSize=t),n=e.viewport.update(),e.referenceStrip&&(n=e.referenceStrip.update(e.viewport)||n),!THIS[e.hash].animating&&n&&(e.raiseEvent("animationstart"),abortControlsAutoHide(e)),n?(e.drawer.update(),e.navigator&&e.navigator.update(e.viewport),e.raiseEvent("animation")):(THIS[e.hash].forceRedraw||e.drawer.needsUpdate())&&(e.drawer.update(),e.navigator&&e.navigator.update(e.viewport),THIS[e.hash].forceRedraw=!1),THIS[e.hash].animating&&!n&&(e.raiseEvent("animationfinish"),THIS[e.hash].mouseInside||beginControlsAutoHide(e)),THIS[e.hash].animating=n)}function resolveUrl(e,t){return e?e+t:t}function beginZoomingIn(){THIS[this.hash].lastZoomTime=$.now(),THIS[this.hash].zoomFactor=this.zoomPerSecond,THIS[this.hash].zooming=!0,scheduleZoom(this)}function beginZoomingOut(){THIS[this.hash].lastZoomTime=$.now(),THIS[this.hash].zoomFactor=1/this.zoomPerSecond,THIS[this.hash].zooming=!0,scheduleZoom(this)}function endZooming(){THIS[this.hash].zooming=!1}function scheduleZoom(e){$.requestAnimationFrame($.delegate(e,doZoom))}function doZoom(){var e,t,n;THIS[this.hash].zooming&&this.viewport&&(e=$.now(),t=e-THIS[this.hash].lastZoomTime,n=Math.pow(THIS[this.hash].zoomFactor,t/1e3),this.viewport.zoomBy(n),this.viewport.applyConstraints(),THIS[this.hash].lastZoomTime=e,scheduleZoom(this))}function doSingleZoomIn(){this.viewport&&(THIS[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function doSingleZoomOut(){this.viewport&&(THIS[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function lightUp(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function onHome(){this.viewport&&this.viewport.goHome()}function onFullPage(){this.setFullPage(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function onPrevious(){var e=THIS[this.hash].sequence-1;this.navPrevNextWrap&&0>e&&(e+=this.tileSources.length),this.goToPage(e)}function onNext(){var e=THIS[this.hash].sequence+1;this.navPrevNextWrap&&e>=this.tileSources.length&&(e=0),this.goToPage(e)}var THIS={},VIEWERS={};$.Viewer=function(e){var t,n=arguments,i=this;$.isPlainObject(e)||(e={id:n[0],xmlPath:n.length>1?n[1]:void 0,prefixUrl:n.length>2?n[2]:void 0,controls:n.length>3?n[3]:void 0,overlays:n.length>4?n[4]:void 0,overlayControls:n.length>5?n[5]:void 0}),e.config&&($.extend(!0,e,e.config),delete e.config),$.extend(!0,this,{id:e.id,hash:e.id,element:null,canvas:null,container:null,overlays:[],overlayControls:[],previousBody:[],customControls:[],source:null,drawer:null,drawers:[],viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},$.DEFAULT_SETTINGS,e),THIS[this.hash]={fsBoundsDelta:new $.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,sequenced:!1,sequence:0,fullPage:!1,onfullscreenchange:null},this._updateRequestId=null,$.EventHandler.call(this),this.addHandler("open-failed",function(e,t){var n=$.getString("Errors.Open-Failed",t.source,t.message);i._showMessage(n)}),$.ControlDock.call(this,e);var o;for(this.xmlPath&&(this.tileSources=[this.xmlPath]),this.tileSources&&($.isArray(this.tileSources)?(this.tileSources.length>1&&(THIS[this.hash].sequenced=!0),o=this.tileSources[0]):o=this.tileSources,this.open(o)),this.element=this.element||document.getElementById(this.id),this.canvas=$.makeNeutralElement("div"),this.keyboardCommandArea=$.makeNeutralElement("textarea"),this.canvas.className="openseadragon-canvas",function(e){e.width="100%",e.height="100%",e.overflow="hidden",e.position="absolute",e.top="0px",e.left="0px"}(this.canvas.style),this.container.className="openseadragon-container",function(e){e.width="100%",e.height="100%",e.position="relative",e.overflow="hidden",e.left="0px",e.top="0px",e.textAlign="left"}(this.container.style),this.keyboardCommandArea.className="keyboard-command-area",function(e){e.width="100%",e.height="100%",e.overflow="hidden",e.position="absolute",e.top="0px",e.left="0px",e.resize="none"}(this.keyboardCommandArea.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.container.insertBefore(this.keyboardCommandArea,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.keyboardCommandArea.innerTracker=new $.MouseTracker({_this:this,element:this.keyboardCommandArea,focusHandler:function(){var e=$.getElementPosition(this.element);window.scrollTo(0,e.y)},keyHandler:function(e,t,n){switch(t){case 61:return i.viewport.zoomBy(1.1),i.viewport.applyConstraints(),!1;case 45:return i.viewport.zoomBy(.9),i.viewport.applyConstraints(),!1;case 48:return i.viewport.goHome(),i.viewport.applyConstraints(),!1;case 119:case 87:case 38:return n?i.viewport.zoomBy(1.1):i.viewport.panBy(new $.Point(0,-.05)),i.viewport.applyConstraints(),!1;case 115:case 83:case 40:return n?i.viewport.zoomBy(.9):i.viewport.panBy(new $.Point(0,.05)),i.viewport.applyConstraints(),!1;case 97:case 37:return i.viewport.panBy(new $.Point(-.05,0)),i.viewport.applyConstraints(),!1;case 100:case 39:return i.viewport.panBy(new $.Point(.05,0)),i.viewport.applyConstraints(),!1;default:return!0}}}).setTracking(!0),this.innerTracker=new $.MouseTracker({element:this.canvas,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,clickHandler:$.delegate(this,onCanvasClick),dragHandler:$.delegate(this,onCanvasDrag),releaseHandler:$.delegate(this,onCanvasRelease),scrollHandler:$.delegate(this,onCanvasScroll)}).setTracking(this.mouseNavEnabled?!0:!1),this.outerTracker=new $.MouseTracker({element:this.container,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:$.delegate(this,onContainerEnter),exitHandler:$.delegate(this,onContainerExit),releaseHandler:$.delegate(this,onContainerRelease)}).setTracking(this.mouseNavEnabled?!0:!1),this.toolbar&&(this.toolbar=new $.ControlDock({element:this.toolbar})),this.bindStandardControls(),this.bindSequenceControls(),t=0;this.customControls.length>t;t++)this.addControl(this.customControls[t].id,{anchor:this.customControls[t].anchor});$.requestAnimationFrame(function(){beginControlsAutoHide(i)})},$.extend($.Viewer.prototype,$.EventHandler.prototype,$.ControlDock.prototype,{isOpen:function(){return!!this.source},openDzi:function(e){return this.open(e)},openTileSource:function(e){return this.open(e)},open:function(tileSource){var _this=this,customTileSource,readySource,$TileSource,options;return _this._hideMessage(),"string"==$.type(tileSource)&&(tileSource.match(/\s*<.*/)?tileSource=$.parseXml(tileSource):tileSource.match(/\s*[\{\[].*/)&&(tileSource=eval("("+tileSource+")"))),setTimeout(function(){if("string"==$.type(tileSource))tileSource=new $.TileSource(tileSource,function(e){openTileSource(_this,e)}),tileSource.addHandler("open-failed",function(e,t){_this.raiseEvent("open-failed",t)});else if($.isPlainObject(tileSource)||tileSource.nodeType)if($.isFunction(tileSource.getTileUrl))customTileSource=new $.TileSource(tileSource),customTileSource.getTileUrl=tileSource.getTileUrl,openTileSource(_this,customTileSource);else{if($TileSource=$.TileSource.determineType(_this,tileSource),!$TileSource)return _this.raiseEvent("open-failed",{message:"Unable to load TileSource",source:tileSource}),void 0;options=$TileSource.prototype.configure.apply(_this,[tileSource]),readySource=new $TileSource(options),openTileSource(_this,readySource)}else openTileSource(_this,tileSource)},1),this},close:function(){return null!==this._updateRequestId&&($.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.navigator&&this.navigator.close(),this.drawer&&this.drawer.clearOverlays(),this.source=null,this.drawer=null,this.viewport=this.preserveViewport?this.viewport:null,this.canvas.innerHTML="",VIEWERS[this.hash]=null,delete VIEWERS[this.hash],this.raiseEvent("close",{viewer:this}),this},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(e){return this.innerTracker.setTracking(e),this.raiseEvent("mouse-enabled",{enabled:e,viewer:this}),this},areControlsEnabled:function(){var e,t=this.controls.length;for(e=0;this.controls.length>e;e++)t=t&&this.controls[e].isVisibile();return t},setControlsEnabled:function(e){return e?abortControlsAutoHide(this):beginControlsAutoHide(this),this.raiseEvent("controls-enabled",{enabled:e,viewer:this}),this},isFullPage:function(){return THIS[this.hash].fullPage},setFullPage:function(e){var t,n,i,o,r,a,s=document.body,l=s.style,u=document.documentElement.style,c=this.canvas.style,d=this;if(e!=this.isFullPage()){if(e){for(this.bodyOverflow=l.overflow,this.docOverflow=u.overflow,l.overflow="hidden",u.overflow="hidden",this.bodyWidth=l.width,this.bodyHeight=l.height,l.width="100%",l.height="100%",this.previousBody=[],THIS[this.hash].prevElementParent=this.element.parentNode,THIS[this.hash].prevNextSibling=this.element.nextSibling,THIS[this.hash].prevElementSize=$.getElementSize(this.element),r=s.childNodes.length,a=0;r>a;a++)this.previousBody.push(s.childNodes[0]),s.removeChild(s.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,s.appendChild(this.toolbar.element),$.addClass(this.toolbar.element,"fullpage")),$.addClass(this.element,"fullpage"),s.appendChild(this.element),$.supportsFullScreen?(THIS[this.hash].onfullscreenchange=function(){$.isFullScreen()?d.setFullPage(!0):d.setFullPage(!1)},$.requestFullScreen(document.body),document.addEventListener($.fullScreenEventName,THIS[this.hash].onfullscreenchange),this.element.style.height="100%",this.element.style.width="100%"):(this.element.style.height=$.getWindowSize().y+"px",this.element.style.width=$.getWindowSize().x+"px"),this.toolbar&&this.toolbar.element&&(this.element.style.height=$.getElementSize(this.element).y-$.getElementSize(this.toolbar.element).y+"px"),THIS[this.hash].fullPage=!0,$.delegate(this,onContainerEnter)()}else{for($.supportsFullScreen&&(document.removeEventListener($.fullScreenEventName,THIS[this.hash].onfullscreenchange),$.cancelFullScreen(document)),l.overflow=this.bodyOverflow,u.overflow=this.docOverflow,l.width=this.bodyWidth,l.height=this.bodyHeight,c.backgroundColor="",c.color="",s.removeChild(this.element),r=this.previousBody.length,a=0;r>a;a++)s.appendChild(this.previousBody.shift());$.removeClass(this.element,"fullpage"),THIS[this.hash].prevElementParent.insertBefore(this.element,THIS[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(s.removeChild(this.toolbar.element),$.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.height=THIS[this.hash].prevElementSize.y+"px",this.element.style.width=THIS[this.hash].prevElementSize.x+"px",THIS[this.hash].fullPage=!1,$.delegate(this,onContainerExit)()}if(this.raiseEvent("fullpage",{fullpage:e,viewer:this}),this.viewport){if(t=this.viewport.getBounds(),this.viewport.resize(THIS[this.hash].prevContainerSize),n=this.viewport.getBounds(),e)THIS[this.hash].fsBoundsDelta=new $.Point(n.width/t.width,n.height/t.height);else{this.viewport.update(),this.viewport.zoomBy(Math.max(THIS[this.hash].fsBoundsDelta.x,THIS[this.hash].fsBoundsDelta.y),null,!0);for(o in VIEWERS)i=VIEWERS[o],i!==this&&i!=this.navigator&&(i.open(i.source),i.navigator&&i.navigator.open(i.source))}THIS[this.hash].forceRedraw=!0,updateOnce(this)}return this}},isVisible:function(){return"hidden"!=this.container.style.visibility},setVisible:function(e){return this.container.style.visibility=e?"":"hidden",this.raiseEvent("visible",{visible:e,viewer:this}),this},bindSequenceControls:function(){var e=$.delegate(this,onFocus),t=$.delegate(this,onBlur),n=$.delegate(this,onNext),i=$.delegate(this,onPrevious),o=this.navImages,r=!0;return this.showSequenceControl&&THIS[this.hash].sequenced&&((this.previousButton||this.nextButton)&&(r=!1),this.previousButton=new $.Button({element:this.previousButton?$.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.PreviousPage"),srcRest:resolveUrl(this.prefixUrl,o.previous.REST),srcGroup:resolveUrl(this.prefixUrl,o.previous.GROUP),srcHover:resolveUrl(this.prefixUrl,o.previous.HOVER),srcDown:resolveUrl(this.prefixUrl,o.previous.DOWN),onRelease:i,onFocus:e,onBlur:t}),this.nextButton=new $.Button({element:this.nextButton?$.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.NextPage"),srcRest:resolveUrl(this.prefixUrl,o.next.REST),srcGroup:resolveUrl(this.prefixUrl,o.next.GROUP),srcHover:resolveUrl(this.prefixUrl,o.next.HOVER),srcDown:resolveUrl(this.prefixUrl,o.next.DOWN),onRelease:n,onFocus:e,onBlur:t}),this.navPrevNextWrap||this.previousButton.disable(),r&&(this.paging=new $.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:$.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:$.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var e=$.delegate(this,beginZoomingIn),t=$.delegate(this,endZooming),n=$.delegate(this,doSingleZoomIn),i=$.delegate(this,beginZoomingOut),o=$.delegate(this,doSingleZoomOut),r=$.delegate(this,onHome),a=$.delegate(this,onFullPage),s=$.delegate(this,onFocus),l=$.delegate(this,onBlur),u=this.navImages,c=[],d=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton)&&(d=!1),c.push(this.zoomInButton=new $.Button({element:this.zoomInButton?$.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.ZoomIn"),srcRest:resolveUrl(this.prefixUrl,u.zoomIn.REST),srcGroup:resolveUrl(this.prefixUrl,u.zoomIn.GROUP),srcHover:resolveUrl(this.prefixUrl,u.zoomIn.HOVER),srcDown:resolveUrl(this.prefixUrl,u.zoomIn.DOWN),onPress:e,onRelease:t,onClick:n,onEnter:e,onExit:t,onFocus:s,onBlur:l})),c.push(this.zoomOutButton=new $.Button({element:this.zoomOutButton?$.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.ZoomOut"),srcRest:resolveUrl(this.prefixUrl,u.zoomOut.REST),srcGroup:resolveUrl(this.prefixUrl,u.zoomOut.GROUP),srcHover:resolveUrl(this.prefixUrl,u.zoomOut.HOVER),srcDown:resolveUrl(this.prefixUrl,u.zoomOut.DOWN),onPress:i,onRelease:t,onClick:o,onEnter:i,onExit:t,onFocus:s,onBlur:l})),c.push(this.homeButton=new $.Button({element:this.homeButton?$.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.Home"),srcRest:resolveUrl(this.prefixUrl,u.home.REST),srcGroup:resolveUrl(this.prefixUrl,u.home.GROUP),srcHover:resolveUrl(this.prefixUrl,u.home.HOVER),srcDown:resolveUrl(this.prefixUrl,u.home.DOWN),onRelease:r,onFocus:s,onBlur:l})),c.push(this.fullPageButton=new $.Button({element:this.fullPageButton?$.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.FullPage"),srcRest:resolveUrl(this.prefixUrl,u.fullpage.REST),srcGroup:resolveUrl(this.prefixUrl,u.fullpage.GROUP),srcHover:resolveUrl(this.prefixUrl,u.fullpage.HOVER),srcDown:resolveUrl(this.prefixUrl,u.fullpage.DOWN),onRelease:a,onFocus:s,onBlur:l})),d&&(this.buttons=new $.ButtonGroup({buttons:c,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",$.delegate(this,lightUp)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:$.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:$.ControlAnchor.TOP_LEFT}))),this},goToPage:function(e){return this.raiseEvent("page",{page:e,viewer:this}),this.tileSources.length>e&&(THIS[this.hash].sequence=e,this.nextButton&&(this.tileSources.length-1===e?this.navPrevNextWrap||this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(e>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable()),this.open(this.tileSources[e])),$.isFunction(this.onPageChange)&&this.onPageChange({page:e,viewer:this}),this.referenceStrip&&this.referenceStrip.setFocus(e),this},_showMessage:function(e){this._hideMessage();var t=$.makeNeutralElement("div");t.appendChild(document.createTextNode(e)),this.messageDiv=$.makeCenteredNode(t),$.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var e=this.messageDiv;e&&(e.parentNode.removeChild(e),delete this.messageDiv)}})}(OpenSeadragon),function(e){function t(t,n){var i,o,r;this.drag?this.drag=!1:this.viewer.viewport&&(o=this.viewport.deltaPointsFromPixels(n),r=this.viewer.viewport.getBounds().getSize(),i=new e.Rect(o.x-r.x/2,o.y-r.y/2,r.x,r.y),this.viewer.source.aspectRatio>this.viewer.viewport.getAspectRatio()?i.y=i.y-(this.viewerSizeInPoints.y-1/this.viewer.source.aspectRatio)/2:i.x=i.x-(this.viewerSizeInPoints.x-1)/2,this.viewer.viewport.fitBounds(i),this.viewer.viewport.applyConstraints())}function n(e,t,n){this.viewer.viewport&&(this.drag=!0,this.panHorizontal||(n.x=0),this.panVertical||(n.y=0),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(n)))}function i(e,t,n){n&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}e.Navigator=function(o){var r,a=o.viewer,s=e.getElementSize(a.element);o.id?(this.element=document.getElementById(o.id),o.controlOptions={anchor:e.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(o.id="navigator-"+e.now(),this.element=e.makeNeutralElement("div"),o.controlOptions={anchor:e.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:!0}),this.element.id=o.id,this.element.className+=" navigator",o=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.navigatorSizeRatio},o,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0}),o.minPixelRatio=this.minPixelRatio=a.minPixelRatio,this.viewerSizeInPoints=a.viewport.deltaPointsFromPixels(s),this.borderWidth=2,this.fudge=new e.Point(1,1),this.totalBorderWidths=new e.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),function(e,t){e.margin="0px",e.border=t+"px solid #555",e.padding="0px",e.background="#000",e.opacity=.8,e.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=e.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(e,t){e.position="relative",e.top="0px",e.left="0px",e.fontSize="0px",e.overflow="hidden",e.border=t+"px solid #900",e.margin="0px",e.padding="0px",e.background="transparent",e["float"]="left",e.cssFloat="left",e.styleFloat="left",e.zIndex=999999999,e.cursor="default"}(this.displayRegion.style,this.borderWidth),this.element.innerTracker=new e.MouseTracker({element:this.element,dragHandler:e.delegate(this,n),clickHandler:e.delegate(this,t),releaseHandler:e.delegate(this,i),scrollHandler:function(){return!1}}).setTracking(!0),a.addControl(this.element,o.controlOptions),o.width&&o.height?(this.element.style.width=o.width+"px",this.element.style.height=o.height+"px"):(this.element.style.width=s.x*o.sizeRatio+"px",this.element.style.height=s.y*o.sizeRatio+"px"),e.Viewer.apply(this,[o]),this.element.getElementsByTagName("form")[0].appendChild(this.displayRegion),r=this.element.getElementsByTagName("textarea")[0],r&&r.parentNode.removeChild(r)},e.extend(e.Navigator.prototype,e.EventHandler.prototype,e.Viewer.prototype,{update:function(e){var t,n,i;e&&this.viewport&&(t=e.getBounds(!0),n=this.viewport.pixelFromPoint(t.getTopLeft()),i=this.viewport.pixelFromPoint(t.getBottomRight()).minus(this.totalBorderWidths),function(e){e.top=n.y+"px",e.left=n.x+"px";var t=Math.abs(n.x-i.x),o=Math.abs(n.y-i.y);e.width=Math.max(t,0)+"px",e.height=Math.max(o,0)+"px"}(this.displayRegion.style))},open:function(t){var n=this.viewer.viewport.containerSize.times(this.sizeRatio);return this.minPixelRatio=t.tileSize>n.x||t.tileSize>n.y?Math.min(n.x,n.y)/t.tileSize:this.viewer.minPixelRatio,e.Viewer.prototype.open.apply(this,[t])}})}(OpenSeadragon),function(e){var t={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).","Open-Failed":"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page"}};e.extend(e,{getString:function(n){var i,o=n.split("."),r=null,a=arguments,s=t;for(i=0;o.length-1>i;i++)s=s[o[i]]||{};return r=s[o[i]],"string"!=typeof r&&(e.console.debug("Untranslated source string:",n),r=""),r.replace(/\{\d+\}/g,function(e){var t=parseInt(e.match(/\d+/),10)+1;return a.length>t?a[t]:""})},setString:function(e,n){var i,o=e.split("."),r=t;for(i=0;o.length-1>i;i++)r[o[i]]||(r[o[i]]={}),r=r[o[i]];r[o[i]]=n}})}(OpenSeadragon),function(e){e.Point=function(e,t){this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0},e.Point.prototype={plus:function(t){return new e.Point(this.x+t.x,this.y+t.y)},minus:function(t){return new e.Point(this.x-t.x,this.y-t.y)},times:function(t){return new e.Point(this.x*t,this.y*t)},divide:function(t){return new e.Point(this.x/t,this.y/t)},negate:function(){return new e.Point(-this.x,-this.y)},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},apply:function(t){return new e.Point(t(this.x),t(this.y))},equals:function(t){return t instanceof e.Point&&this.x===t.x&&this.y===t.y},toString:function(){return"("+Math.round(this.x)+","+Math.round(this.y)+")"}}}(OpenSeadragon),function($){function processResponse(xhr){var responseText=xhr.responseText,status=xhr.status,statusText,data;if(!xhr)throw Error($.getString("Errors.Security"));if(200!==xhr.status&&0!==xhr.status)throw status=xhr.status,statusText=404==status?"Not Found":xhr.statusText,Error($.getString("Errors.Status",status,statusText));if(responseText.match(/\s*<.*/))try{data=xhr.responseXML&&xhr.responseXML.documentElement?xhr.responseXML:$.parseXml(responseText)}catch(e){data=xhr.responseText}else data=responseText.match(/\s*[\{\[].*/)?eval("("+responseText+")"):responseText;return data}$.TileSource=function(e){var t,n,i=null,o=arguments;for(t=$.isPlainObject(e)?e:{width:o[0],height:o[1],tileSize:o[2],tileOverlap:o[3],minLevel:o[4],maxLevel:o[5]},$.EventHandler.call(this),$.extend(!0,this,t),n=0;arguments.length>n;n++)if($.isFunction(arguments[n])){i=arguments[n],this.addHandler("ready",function(e,t){i(t)});break}"string"==$.type(arguments[0])?(this.aspectRatio=1,this.dimensions=new $.Point(10,10),this.tileSize=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(arguments[0])):(this.ready=!0,this.aspectRatio=t.width&&t.height?t.width/t.height:1,this.dimensions=new $.Point(t.width,t.height),this.tileSize=t.tileSize?t.tileSize:0,this.tileOverlap=t.tileOverlap?t.tileOverlap:0,this.minLevel=t.minLevel?t.minLevel:0,this.maxLevel=void 0!==t.maxLevel&&null!==t.maxLevel?t.maxLevel:t.width&&t.height?Math.ceil(Math.log(Math.max(t.width,t.height))/Math.log(2)):0,i&&$.isFunction(i)&&i(this))},$.TileSource.prototype={getLevelScale:function(e){var t,n={};for(t=0;this.maxLevel>=t;t++)n[t]=1/Math.pow(2,this.maxLevel-t);return this.getLevelScale=function(e){return n[e]},this.getLevelScale(e)},getNumTiles:function(e){var t=this.getLevelScale(e),n=Math.ceil(t*this.dimensions.x/this.tileSize),i=Math.ceil(t*this.dimensions.y/this.tileSize);return new $.Point(n,i)},getPixelRatio:function(e){var t=this.dimensions.times(this.getLevelScale(e)),n=1/t.x,i=1/t.y;return new $.Point(n,i)},getClosestLevel:function(e){var t,n,i=Math.floor(Math.max(e.x,e.y)/this.tileSize);for(t=this.minLevel;this.maxLevel>t&&(n=this.getNumTiles(t),!(Math.max(n.x,n.y)+1>=i));t++);return Math.max(0,t-1)},getTileAtPoint:function(e,t){var n=t.times(this.dimensions.x).times(this.getLevelScale(e)),i=Math.floor(n.x/this.tileSize),o=Math.floor(n.y/this.tileSize);return new $.Point(i,o)},getTileBounds:function(e,t,n){var i=this.dimensions.times(this.getLevelScale(e)),o=0===t?0:this.tileSize*t-this.tileOverlap,r=0===n?0:this.tileSize*n-this.tileOverlap,a=this.tileSize+(0===t?1:2)*this.tileOverlap,s=this.tileSize+(0===n?1:2)*this.tileOverlap,l=1/i.x;return a=Math.min(a,i.x-o),s=Math.min(s,i.y-r),new $.Rect(o*l,r*l,a*l,s*l)},getImageInfo:function(e){var t,n,i,o,r,a,s,l=this;e&&(r=e.split("/"),a=r[r.length-1],s=a.lastIndexOf("."),s>-1&&(r[r.length-1]=a.slice(0,s))),n=function(t){var n=$.TileSource.determineType(l,t,e);return n?(o=n.prototype.configure.apply(l,[t,e]),i=new n(o),l.ready=!0,l.raiseEvent("ready",i),void 0):(l.raiseEvent("open-failed",{message:"Unable to load TileSource",source:e}),void 0)},e.match(/\.js$/)?(t=e.split("/").pop().replace(".js",""),$.jsonp({url:e,async:!1,callbackName:t,callback:n})):$.makeAjaxRequest(e,function(e){var t=processResponse(e);n(t)},function(t){l.raiseEvent("open-failed",{message:"HTTP "+t.status+" attempting to load TileSource",source:e})})},supports:function(){return!1},configure:function(){throw Error("Method not implemented.")},getTileUrl:function(){throw Error("Method not implemented.")},tileExists:function(e,t,n){var i=this.getNumTiles(e);return e>=this.minLevel&&this.maxLevel>=e&&t>=0&&n>=0&&i.x>t&&i.y>n}},$.extend(!0,$.TileSource.prototype,$.EventHandler.prototype),$.TileSource.determineType=function(e,t,n){var i;for(i in OpenSeadragon)if(i.match(/.+TileSource$/)&&$.isFunction(OpenSeadragon[i])&&$.isFunction(OpenSeadragon[i].prototype.supports)&&OpenSeadragon[i].prototype.supports.call(e,t,n))return OpenSeadragon[i];$.console.error("No TileSource was able to open %s %s",n,t)}}(OpenSeadragon),function(e){function t(t,i){if(!i||!i.documentElement)throw Error(e.getString("Errors.Xml"));var o,r,a,s,l,u=i.documentElement,c=u.tagName,d=null,h=[];if("Image"==c)try{if(s=u.getElementsByTagName("Size")[0],d={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:u.getAttribute("Url"),Format:u.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(u.getAttribute("Overlap"),10),TileSize:parseInt(u.getAttribute("TileSize"),10),Size:{Height:parseInt(s.getAttribute("Height"),10),Width:parseInt(s.getAttribute("Width"),10)}}},!e.imageFormatSupported(d.Image.Format))throw Error(e.getString("Errors.ImageFormat",d.Image.Format.toUpperCase()));for(o=u.getElementsByTagName("DisplayRect"),l=0;o.length>l;l++)r=o[l],a=r.getElementsByTagName("Rect")[0],h.push({Rect:{X:parseInt(a.getAttribute("X"),10),Y:parseInt(a.getAttribute("Y"),10),Width:parseInt(a.getAttribute("Width"),10),Height:parseInt(a.getAttribute("Height"),10),MinLevel:parseInt(r.getAttribute("MinLevel"),10),MaxLevel:parseInt(r.getAttribute("MaxLevel"),10)}});return h.length&&(d.Image.DisplayRect=h),n(t,d)}catch(p){throw p instanceof Error?p:Error(e.getString("Errors.Dzi"))}else{if("Collection"==c)throw Error(e.getString("Errors.Dzc"));if("Error"==c)return e._processDZIError(u)}throw Error(e.getString("Errors.Dzi"))}function n(t,n){var i,o,r=n.Image,a=r.Url,s=r.Format,l=r.Size,u=r.DisplayRect||[],c=parseInt(l.Width,10),d=parseInt(l.Height,10),h=parseInt(r.TileSize,10),p=parseInt(r.Overlap,10),f=[];for(o=0;u.length>o;o++)i=u[o].Rect,f.push(new e.DisplayRect(parseInt(i.X,10),parseInt(i.Y,10),parseInt(i.Width,10),parseInt(i.Height,10),parseInt(i.MinLevel,10),parseInt(i.MaxLevel,10)));return e.extend(!0,{width:c,height:d,tileSize:h,tileOverlap:p,minLevel:null,maxLevel:null,tilesUrl:a,fileFormat:s,displayRects:f},n)}e.DziTileSource=function(t){var n,i,o,r;if(r=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=r.tilesUrl,this.fileFormat=r.fileFormat,this.displayRects=r.displayRects,this.displayRects)for(n=this.displayRects.length-1;n>=0;n--)for(i=this.displayRects[n],o=i.minLevel;i.maxLevel>=o;o++)this._levelRects[o]||(this._levelRects[o]=[]),this._levelRects[o].push(i);e.TileSource.apply(this,[r])},e.extend(e.DziTileSource.prototype,e.TileSource.prototype,{supports:function(e){var t;return e.Image?t=e.Image.xmlns:e.documentElement&&"Image"==e.documentElement.tagName&&(t=e.documentElement.namespaceURI),"http://schemas.microsoft.com/deepzoom/2008"==t||"http://schemas.microsoft.com/deepzoom/2009"==t},configure:function(i,o){var r;return r=e.isPlainObject(i)?n(this,i):t(this,i),o&&!r.tilesUrl&&(r.tilesUrl=o.replace(/([^\/]+)\.(dzi|xml|js)$/,"$1_files/")),r},getTileUrl:function(e,t,n){return[this.tilesUrl,e,"/",t,"_",n,".",this.fileFormat].join("")},tileExists:function(e,t,n){var i,o,r,a,s,l,u,c=this._levelRects[e];if(!c||!c.length)return!0;for(u=c.length-1;u>=0;u--)if(i=c[u],!(i.minLevel>e||e>i.maxLevel)&&(o=this.getLevelScale(e),r=i.x*o,a=i.y*o,s=r+i.width*o,l=a+i.height*o,r=Math.floor(r/this.tileSize),a=Math.floor(a/this.tileSize),s=Math.ceil(s/this.tileSize),l=Math.ceil(l/this.tileSize),t>=r&&s>t&&n>=a&&l>n))return!0;return!1}})}(OpenSeadragon),function(e){function t(t,o){if(!o||!o.documentElement)throw Error(e.getString("Errors.Xml"));var r=o.documentElement,a=r.tagName,s=null;if("info"==a)try{return s={ns:r.namespaceURI},n(r,s),i(t,s)}catch(l){throw l instanceof Error?l:Error(e.getString("Errors.IIIF"))}throw Error(e.getString("Errors.IIIF"))}function n(t,i,o){var r,a;if(3==t.nodeType&&o)a=t.nodeValue.trim(),a.match(/^\d*$/)&&(a=Number(a)),i[o]?(e.isArray(i[o])||(i[o]=[i[o]]),i[o].push(a)):i[o]=a;else if(1==t.nodeType)for(r=0;t.childNodes.length>r;r++)n(t.childNodes[r],i,t.nodeName)}function i(e,t){return t.image_host&&(t.tilesUrl=t.image_host),t}e.IIIFTileSource=function(t){if(e.extend(!0,this,t),!(this.height&&this.width&&this.identifier&&this.tilesUrl))throw Error("IIIF required parameters not provided.");if(t.tileSize=this.tile_width,!t.maxLevel){var n=-1,i=this.scale_factors||this.scale_factor;if(i instanceof Array)for(var o=0;i.length>o;o++){var r=Number(i[o]);!isNaN(r)&&r>n&&(n=r)}t.maxLevel=0>n?Number(Math.ceil(Math.log(Math.max(this.width,this.height),2))):n}e.TileSource.apply(this,[t])},e.extend(e.IIIFTileSource.prototype,e.TileSource.prototype,{supports:function(e){return e.ns&&"http://library.stanford.edu/iiif/image-api/ns/"==e.ns||e.profile&&("http://library.stanford.edu/iiif/image-api/compliance.html#level1"==e.profile||"http://library.stanford.edu/iiif/image-api/compliance.html#level2"==e.profile||"http://library.stanford.edu/iiif/image-api/compliance.html#level3"==e.profile||"http://library.stanford.edu/iiif/image-api/compliance.html"==e.profile)||e.documentElement&&"info"==e.documentElement.tagName&&"http://library.stanford.edu/iiif/image-api/ns/"==e.documentElement.namespaceURI
},configure:function(n,o){var r,a,s;return a=e.isPlainObject(n)?i(this,n):t(this,n),o&&!a.tilesUrl&&(r=o.split("/"),r.pop(),r=r.join("/"),"http"!==o.substring(0,4)&&(s=location.protocol+"//"+location.host,r=s+r),a.tilesUrl=r.replace(n.identifier,"")),a},getTileUrl:function(e,t,n){var i,o,r,a,s,l="0",u="native.jpg",c=Math.pow(.5,this.maxLevel-e),d="pct:"+100*c,h=Math.ceil(this.width*c),p=Math.ceil(this.height*c),f=Math.ceil(this.tileSize/c),m=Math.ceil(this.tileSize/c);return this.tile_width>h&&this.tile_height>p?i="full":(o=t*f,r=n*m,a=Math.min(f,this.width-o),s=Math.min(m,this.height-r),i=[o,r,a,s].join(",")),[this.tilesUrl.replace(/\/$/,""),encodeURIComponent(this.identifier),i,d,l,u].join("/")}})}(OpenSeadragon),function(e){e.OsmTileSource=function(t){var n;n=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},n.width&&n.height||(n.width=65572864,n.height=65572864),n.tileSize||(n.tileSize=256,n.tileOverlap=0),n.tilesUrl||(n.tilesUrl="http://tile.openstreetmap.org/"),n.minLevel=8,e.TileSource.apply(this,[n])},e.extend(e.OsmTileSource.prototype,e.TileSource.prototype,{supports:function(e){return e.type&&"openstreetmaps"==e.type},configure:function(e){return e},getTileUrl:function(e,t,n){return this.tilesUrl+(e-8)+"/"+t+"/"+n+".png"}})}(OpenSeadragon),function(e){e.TmsTileSource=function(t){var n;n=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var i,o=256*Math.ceil(n.width/256),r=256*Math.ceil(n.height/256);i=o>r?o/256:r/256,n.maxLevel=Math.ceil(Math.log(i)/Math.log(2))-1,n.tileSize=256,n.width=o,n.height=r,e.TileSource.apply(this,[n])},e.extend(e.TmsTileSource.prototype,e.TileSource.prototype,{supports:function(e){return e.type&&"tiledmapservice"==e.type},configure:function(e){return e},getTileUrl:function(e,t,n){var i=this.getNumTiles(e).y-1;return this.tilesUrl+e+"/"+t+"/"+(i-n)+".png"}})}(OpenSeadragon),function(e){function t(e){var t,n,i=[];for(n=0;e.length>n;n++)t=e[n],t.height&&t.width&&t.url&&(t.url.toLowerCase().match(/^.*\.(png|jpg|jpeg|gif)$/)||t.mimetype&&t.mimetype.toLowerCase().match(/^.*\/(png|jpg|jpeg|gif)$/))&&i.push({url:t.url,width:Number(t.width),height:Number(t.height)});return i.sort(function(e,t){return e.height-t.height})}function n(t,n){if(!n||!n.documentElement)throw Error(e.getString("Errors.Xml"));var o,r,a=n.documentElement,s=a.tagName,l=null,u=[];if("image"==s)try{for(l={type:a.getAttribute("type"),levels:[]},u=a.getElementsByTagName("level"),r=0;u.length>r;r++)o=u[r],l.levels.push({url:o.getAttribute("url"),width:parseInt(o.getAttribute("width"),10),height:parseInt(o.getAttribute("height"),10)});return i(t,l)}catch(c){throw c instanceof Error?c:Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"==s)throw Error("Legacy Image Pyramid Collections not yet supported.");if("error"==s)throw Error("Error: "+n)}throw Error("Unknown element "+s)}function i(e,t){return t.levels}e.LegacyTileSource=function(n){var i,o,r;e.isArray(n)&&(i={type:"legacy-image-pyramid",levels:n}),i.levels=t(i.levels),o=i.levels[i.levels.length-1].width,r=i.levels[i.levels.length-1].height,e.extend(!0,i,{width:o,height:r,tileSize:Math.max(r,o),tileOverlap:0,minLevel:0,maxLevel:i.levels.length-1}),e.TileSource.apply(this,[i]),this.levels=i.levels},e.extend(e.LegacyTileSource.prototype,e.TileSource.prototype,{supports:function(e){return e.type&&"legacy-image-pyramid"==e.type||e.documentElement&&"legacy-image-pyramid"==e.documentElement.getAttribute("type")},configure:function(t){var o;return o=e.isPlainObject(t)?i(this,t):n(this,t)},getLevelScale:function(e){var t=0/0;return e>=this.minLevel&&this.maxLevel>=e&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(t){var n=this.getLevelScale(t);return n?new e.Point(1,1):new e.Point(0,0)},getTileAtPoint:function(){return new e.Point(0,0)},getTileUrl:function(e){var t=null;return e>=this.minLevel&&this.maxLevel>=e&&(t=this.levels[e].url),t}})}(OpenSeadragon),function(e){e.TileSourceCollection=function(t){var n;n=e.isPlainObject(t)?t:{tileSize:arguments[0],tileSources:arguments[1],rows:arguments[2],layout:arguments[3]},n.layout||(n.layout="horizontal");var i=0,o=1,r=Math.ceil(n.tileSources.length/n.rows),a=r>=n.rows?r:n.rows;for("horizontal"==n.layout?(n.width=n.tileSize*r,n.height=n.tileSize*n.rows):(n.height=n.tileSize*r,n.width=n.tileSize*n.rows),n.tileOverlap=-n.tileMargin,n.tilesPerRow=r;n.tileSize*a>o;)o=2*o,i++;n.minLevel=i,e.TileSource.apply(this,[n])},e.extend(e.TileSourceCollection.prototype,e.TileSource.prototype,{getTileBounds:function(t,n,i){var o=this.dimensions.times(this.getLevelScale(t)),r=this.tileSize*n-this.tileOverlap,a=this.tileSize*i-this.tileOverlap,s=this.tileSize+1*this.tileOverlap,l=this.tileSize+1*this.tileOverlap,u=1/o.x;return s=Math.min(s,o.x-r),l=Math.min(l,o.y-a),new e.Rect(r*u,a*u,s*u,l*u)},configure:function(){},getTileUrl:function(){return null}})}(OpenSeadragon),function(e){function t(t){e.requestAnimationFrame(function(){n(t)})}function n(n){var i,o,r;n.shouldFade&&(i=e.now(),o=i-n.fadeBeginTime,r=1-o/n.fadeLength,r=Math.min(1,r),r=Math.max(0,r),n.imgGroup&&e.setElementOpacity(n.imgGroup,r,!0),r>0&&t(n))}function i(n){n.shouldFade=!0,n.fadeBeginTime=e.now()+n.fadeDelay,window.setTimeout(function(){t(n)},n.fadeDelay)}function o(t){t.shouldFade=!1,t.imgGroup&&e.setElementOpacity(t.imgGroup,1,!0)}function r(t,n){t.element.disabled||(n>=e.ButtonState.GROUP&&t.currentState==e.ButtonState.REST&&(o(t),t.currentState=e.ButtonState.GROUP),n>=e.ButtonState.HOVER&&t.currentState==e.ButtonState.GROUP&&(t.imgHover&&(t.imgHover.style.visibility=""),t.currentState=e.ButtonState.HOVER),n>=e.ButtonState.DOWN&&t.currentState==e.ButtonState.HOVER&&(t.imgDown&&(t.imgDown.style.visibility=""),t.currentState=e.ButtonState.DOWN))}function a(t,n){t.element.disabled||(e.ButtonState.HOVER>=n&&t.currentState==e.ButtonState.DOWN&&(t.imgDown&&(t.imgDown.style.visibility="hidden"),t.currentState=e.ButtonState.HOVER),e.ButtonState.GROUP>=n&&t.currentState==e.ButtonState.HOVER&&(t.imgHover&&(t.imgHover.style.visibility="hidden"),t.currentState=e.ButtonState.GROUP),e.ButtonState.REST>=n&&t.currentState==e.ButtonState.GROUP&&(i(t),t.currentState=e.ButtonState.REST))}e.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},e.Button=function(t){var n=this;e.EventHandler.call(this),e.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},t),this.element=t.element||e.makeNeutralElement("button"),this.element.href=this.element.href||"#",t.element||(this.imgRest=e.makeTransparentImage(this.srcRest),this.imgGroup=e.makeTransparentImage(this.srcGroup),this.imgHover=e.makeTransparentImage(this.srcHover),this.imgDown=e.makeTransparentImage(this.srcDown),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",e.Browser.vendor==e.BROWSERS.FIREFOX&&3>e.Browser.version&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="")),this.addHandler("onPress",this.onPress),this.addHandler("onRelease",this.onRelease),this.addHandler("onClick",this.onClick),this.addHandler("onEnter",this.onEnter),this.addHandler("onExit",this.onExit),this.addHandler("onFocus",this.onFocus),this.addHandler("onBlur",this.onBlur),this.currentState=e.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new e.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(t,i,o,a){o?(r(n,e.ButtonState.DOWN),n.raiseEvent("onEnter",n)):a||r(n,e.ButtonState.HOVER)},focusHandler:function(e,t,i,o){this.enterHandler(e,t,i,o),n.raiseEvent("onFocus",n)},exitHandler:function(t,i,o){a(n,e.ButtonState.GROUP),o&&n.raiseEvent("onExit",n)},blurHandler:function(e,t,i,o){this.exitHandler(e,t,i,o),n.raiseEvent("onBlur",n)},pressHandler:function(){r(n,e.ButtonState.DOWN),n.raiseEvent("onPress",n)},releaseHandler:function(t,i,o,s){o&&s?(a(n,e.ButtonState.HOVER),n.raiseEvent("onRelease",n)):o?a(n,e.ButtonState.GROUP):r(n,e.ButtonState.HOVER)},clickHandler:function(e,t,i){i&&n.raiseEvent("onClick",n)},keyHandler:function(e,t){return 13===t?(n.raiseEvent("onClick",n),n.raiseEvent("onRelease",n),!1):!0}}).setTracking(!0),a(this,e.ButtonState.REST)},e.extend(e.Button.prototype,e.EventHandler.prototype,{notifyGroupEnter:function(){r(this,e.ButtonState.GROUP)},notifyGroupExit:function(){a(this,e.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,e.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,e.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}})}(OpenSeadragon),function(e){e.ButtonGroup=function(t){e.extend(!0,this,{buttons:[],clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},t);var n,i=this.buttons.concat([]),o=this;if(this.element=t.element||e.makeNeutralElement("fieldgroup"),!t.group)for(this.label=e.makeNeutralElement("label"),this.element.style.display="inline-block",this.element.appendChild(this.label),n=0;i.length>n;n++)this.element.appendChild(i[n].element);this.tracker=new e.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(){var e;for(e=0;o.buttons.length>e;e++)o.buttons[e].notifyGroupEnter()},exitHandler:function(){var e,t=arguments.length>2?arguments[2]:null;if(!t)for(e=0;o.buttons.length>e;e++)o.buttons[e].notifyGroupExit()},releaseHandler:function(){var e,t=arguments.length>3?arguments[3]:null;if(!t)for(e=0;o.buttons.length>e;e++)o.buttons[e].notifyGroupExit()}}).setTracking(!0)},e.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler()},emulateExit:function(){this.tracker.exitHandler()}}}(OpenSeadragon),function(e){e.Rect=function(e,t,n,i){this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0,this.width="number"==typeof n?n:0,this.height="number"==typeof i?i:0},e.Rect.prototype={getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new e.Point(this.x,this.y)},getBottomRight:function(){return new e.Point(this.x+this.width,this.y+this.height)},getCenter:function(){return new e.Point(this.x+this.width/2,this.y+this.height/2)},getSize:function(){return new e.Point(this.width,this.height)},equals:function(t){return t instanceof e.Rect&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},toString:function(){return"["+Math.round(100*this.x)+","+Math.round(100*this.y)+","+Math.round(100*this.width)+"x"+Math.round(100*this.height)+"]"}}}(OpenSeadragon),function(e){function t(t,n,o){var r=Number(this.element.style.marginLeft.replace("px","")),a=Number(this.element.style.marginTop.replace("px","")),s=Number(this.element.style.width.replace("px","")),l=Number(this.element.style.height.replace("px","")),u=e.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&("horizontal"==this.scroll?-o.x>0?r>-(s-u.x)&&(this.element.style.marginLeft=r+2*o.x+"px",i(this,u.x,r+2*o.x)):0>-o.x&&0>r&&(this.element.style.marginLeft=r+2*o.x+"px",i(this,u.x,r+2*o.x)):-o.y>0?a>-(l-u.y)&&(this.element.style.marginTop=a+2*o.y+"px",i(this,u.y,a+2*o.y)):0>-o.y&&0>a&&(this.element.style.marginTop=a+2*o.y+"px",i(this,u.y,a+2*o.y))),!1}function n(t,n,o){var r=Number(this.element.style.marginLeft.replace("px","")),a=Number(this.element.style.marginTop.replace("px","")),s=Number(this.element.style.width.replace("px","")),l=Number(this.element.style.height.replace("px","")),u=e.getElementSize(this.viewer.canvas);return this.element&&("horizontal"==this.scroll?o>0?r>-(s-u.x)&&(this.element.style.marginLeft=r-60*o+"px",i(this,u.x,r-60*o)):0>o&&0>r&&(this.element.style.marginLeft=r-60*o+"px",i(this,u.x,r-60*o)):0>o?a>u.y-l&&(this.element.style.marginTop=a+60*o+"px",i(this,u.y,a+60*o)):o>0&&0>a&&(this.element.style.marginTop=a+60*o+"px",i(this,u.y,a+60*o))),!1}function i(t,n,i){var o,r,a,s,l,u,c;for(o="horizontal"==t.scroll?t.panelWidth:t.panelHeight,r=Math.ceil(n/o)+5,a=Math.ceil((Math.abs(i)+n)/o)+1,r=a-r,r=0>r?0:r,u=r;a>u&&t.panels.length>u;u++)c=t.panels[u],c.activePanel||(s=new e.Viewer({id:c.id,tileSources:[t.viewer.tileSources[u]],element:c,navigatorSizeRatio:t.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0}),s.displayRegion=e.makeNeutralElement("textarea"),s.displayRegion.id=c.id+"-displayregion",s.displayRegion.className="displayregion",l=s.displayRegion.style,l.position="relative",l.top="0px",l.left="0px",l.fontSize="0px",l.overflow="hidden",l.float="left",l.cssFloat="left",l.styleFloat="left",l.zIndex=999999999,l.cursor="default",l.width=t.panelWidth-4+"px",l.height=t.panelHeight-4+"px",s.displayRegion.innerTracker=new e.MouseTracker({element:s.displayRegion}),c.getElementsByTagName("form")[0].appendChild(s.displayRegion),c.activePanel=!0)}function o(e){return"horizontal"==this.scroll?e.element.style.marginBottom="0px":e.element.style.marginLeft="0px",!1}function r(t){return"horizontal"==this.scroll?t.element.style.marginBottom="-"+e.getElementSize(t.element).y/2+"px":t.element.style.marginLeft="-"+e.getElementSize(t.element).x/2+"px",!1}function a(e,t){switch(t){case 61:return n.call(this,this.tracker,null,1,null),!1;case 45:return n.call(this,this.tracker,null,-1,null),!1;case 48:case 119:case 87:case 38:return n.call(this,this.tracker,null,1,null),!1;case 115:case 83:case 40:return n.call(this,this.tracker,null,-1,null),!1;case 97:case 37:return n.call(this,this.tracker,null,-1,null),!1;case 100:case 39:return n.call(this,this.tracker,null,1,null),!1;default:return!0}}var s={};e.ReferenceStrip=function(l){var u,c,d,h=this,p=l.viewer,f=e.getElementSize(p.element);for(l.id||(l.id="referencestrip-"+e.now(),this.element=e.makeNeutralElement("div"),this.element.id=l.id,this.element.className="referencestrip"),l=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.referenceStripSizeRatio,position:e.DEFAULT_SETTINGS.referenceStripPosition,scroll:e.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold},l,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),e.extend(this,l),s[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,c=this.element.style,c.marginTop="0px",c.marginRight="0px",c.marginBottom="0px",c.marginLeft="0px",c.left="0px",c.bottom="0px",c.border="0px",c.background="#000",c.position="relative",e.setElementOpacity(this.element,.8),this.viewer=p,this.innerTracker=new e.MouseTracker({element:this.element,dragHandler:e.delegate(this,t),scrollHandler:e.delegate(this,n),enterHandler:e.delegate(this,o),exitHandler:e.delegate(this,r),keyHandler:e.delegate(this,a)}).setTracking(!0),l.width&&l.height?(this.element.style.width=l.width+"px",this.element.style.height=l.height+"px",p.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):"horizontal"==l.scroll?(this.element.style.width=f.x*l.sizeRatio*p.tileSources.length+12*p.tileSources.length+"px",this.element.style.height=f.y*l.sizeRatio+"px",p.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=f.y*l.sizeRatio*p.tileSources.length+12*p.tileSources.length+"px",this.element.style.width=f.x*l.sizeRatio+"px",p.addControl(this.element,{anchor:e.ControlAnchor.TOP_LEFT})),this.panelWidth=f.x*this.sizeRatio+8,this.panelHeight=f.y*this.sizeRatio+8,this.panels=[],d=0;p.tileSources.length>d;d++)u=e.makeNeutralElement("div"),u.id=this.element.id+"-"+d,u.style.width=h.panelWidth+"px",u.style.height=h.panelHeight+"px",u.style.display="inline",u.style.float="left",u.style.cssFloat="left",u.style.styleFloat="left",u.style.padding="2px",u.innerTracker=new e.MouseTracker({element:u,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(t){t.dragging=e.now()},releaseHandler:function(t,n,i,o){var r=t.element.id,a=Number(r.split("-")[2]),s=e.now();i&&o&&t.dragging&&s-t.dragging<t.clickTimeThreshold&&(t.dragging=null,p.goToPage(a))}}).setTracking(!0),this.element.appendChild(u),u.activePanel=!1,this.panels.push(u);i(this,"vertical"==this.scroll?f.y:f.y,0),this.setFocus(0)},e.extend(e.ReferenceStrip.prototype,e.EventHandler.prototype,e.Viewer.prototype,{setFocus:function(t){var n,r=e.getElement(this.element.id+"-"+t),a=e.getElementSize(this.viewer.canvas),s=Number(this.element.style.width.replace("px","")),l=Number(this.element.style.height.replace("px","")),u=-Number(this.element.style.marginLeft.replace("px","")),c=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==r&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=r,this.currentSelected.style.background="#999","horizontal"==this.scroll?(n=Number(t)*(this.panelWidth+3),n>u+a.x-this.panelWidth?(n=Math.min(n,s-a.x),this.element.style.marginLeft=-n+"px",i(this,a.x,-n)):u>n&&(n=Math.max(0,n-a.x/2),this.element.style.marginLeft=-n+"px",i(this,a.x,-n))):(n=Number(t)*(this.panelHeight+3),n>c+a.y-this.panelHeight?(n=Math.min(n,l-a.y),this.element.style.marginTop=-n+"px",i(this,a.y,-n)):c>n&&(n=Math.max(0,n-a.y/2),this.element.style.marginTop=-n+"px",i(this,a.y,-n))),this.currentPage=t,e.getElement(r.id+"-displayregion").focus(),o.call(this,this.innerTracker))},update:function(){return s[this.id].animating?(e.console.log("image reference strip update"),!0):!1}})}(OpenSeadragon),function(e){e.DisplayRect=function(t,n,i,o,r,a){e.Rect.apply(this,[t,n,i,o]),this.minLevel=r,this.maxLevel=a},e.extend(e.DisplayRect.prototype,e.Rect.prototype)}(OpenSeadragon),function(e){function t(e,t){return(1-Math.exp(e*-t))/(1-Math.exp(-e))}e.Spring=function(t){var n=arguments;"object"!=typeof t&&(t={initial:n.length&&"number"==typeof n[0]?n[0]:0,springStiffness:n.length>1?n[1].springStiffness:5,animationTime:n.length>1?n[1].animationTime:1.5}),e.extend(!0,this,t),this.current={value:"number"==typeof this.initial?this.initial:0,time:e.now()},this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time}},e.Spring.prototype={resetTo:function(e){this.target.value=e,this.target.time=this.current.time,this.start.value=this.target.value,this.start.time=this.target.time},springTo:function(e){this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=e,this.target.time=this.start.time+1e3*this.animationTime},shiftBy:function(e){this.start.value+=e,this.target.value+=e},update:function(){this.current.time=e.now(),this.current.value=this.current.time>=this.target.time?this.target.value:this.start.value+(this.target.value-this.start.value)*t(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time))}}}(OpenSeadragon),function(e){var t={};e.Tile=function(e,t,n,i,o,r){this.level=e,this.x=t,this.y=n,this.bounds=i,this.exists=o,this.url=r,this.loaded=!1,this.loading=!1,this.element=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.distance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0},e.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},drawHTML:function(t){return this.loaded&&this.image?(this.element||(this.element=e.makeNeutralElement("img"),this.element.src=this.url,this.element.style.msInterpolationMode="nearest-neighbor",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=t&&t.appendChild(this.element),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",e.setElementOpacity(this.element,this.opacity),void 0):(e.console.warn("Attempting to draw tile %s when it's not yet loaded.",""+this),void 0)},drawCanvas:function(n){var i,o,r=this.position,a=this.size;return this.loaded&&(this.image||t[this.url])?(n.globalAlpha=this.opacity,1==n.globalAlpha&&this.url.match(".png")&&n.clearRect(r.x+1,r.y+1,a.x-2,a.y-2),t[this.url]||(o=document.createElement("canvas"),o.width=this.image.width,o.height=this.image.height,i=o.getContext("2d"),i.drawImage(this.image,0,0),t[this.url]=i,this.image=null),i=t[this.url],n.drawImage(i.canvas,0,0,i.canvas.width,i.canvas.height,r.x,r.y,a.x,a.y),void 0):(e.console.warn("Attempting to draw tile %s when it's not yet loaded.",""+this),void 0)},unload:function(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),t[this.url]&&delete t[this.url],this.element=null,this.image=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(e){e.OverlayPlacement={CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8},e.Overlay=function(t,n,i){var o;o=e.isPlainObject(t)?t:{element:t,location:n,placement:i},this.element=o.element,this.scales=o.location instanceof e.Rect,this.bounds=new e.Rect(o.location.x,o.location.y,o.location.width,o.location.height),this.position=new e.Point(o.location.x,o.location.y),this.size=new e.Point(o.location.width,o.location.height),this.style=o.element.style,this.placement=o.location instanceof e.Point?o.placement:e.OverlayPlacement.TOP_LEFT,this.onDraw=o.onDraw},e.Overlay.prototype={adjust:function(t,n){switch(this.placement){case e.OverlayPlacement.TOP_LEFT:break;case e.OverlayPlacement.TOP:t.x-=n.x/2;break;case e.OverlayPlacement.TOP_RIGHT:t.x-=n.x;break;case e.OverlayPlacement.RIGHT:t.x-=n.x,t.y-=n.y/2;break;case e.OverlayPlacement.BOTTOM_RIGHT:t.x-=n.x,t.y-=n.y;break;case e.OverlayPlacement.BOTTOM:t.x-=n.x/2,t.y-=n.y;break;case e.OverlayPlacement.BOTTOM_LEFT:t.y-=n.y;break;case e.OverlayPlacement.LEFT:t.y-=n.y/2;break;default:case e.OverlayPlacement.CENTER:t.x-=n.x/2,t.y-=n.y/2}},destroy:function(){var e=this.element,t=this.style;e.parentNode&&(e.parentNode.removeChild(e),e.prevElementParent&&(t.display="none",document.body.appendChild(e))),t.top="",t.left="",t.position="",this.scales&&(t.width="",t.height="")},drawHTML:function(t){var n,i,o=this.element,r=this.style,a=this.scales;o.parentNode!=t&&(o.prevElementParent=o.parentNode,o.prevNextSibling=o.nextSibling,t.appendChild(o)),a||(this.size=e.getElementSize(o)),n=this.position,i=this.size,this.adjust(n,i),n=n.apply(Math.floor),i=i.apply(Math.ceil),this.onDraw?this.onDraw(n,i,o):(r.left=n.x+"px",r.top=n.y+"px",r.position="absolute",r.display="block",a&&(r.width=i.x+"px",r.height=i.y+"px"))},update:function(t,n){this.scales=t instanceof e.Rect,this.bounds=new e.Rect(t.x,t.y,t.width,t.height),this.placement=t instanceof e.Point?n:e.OverlayPlacement.TOP_LEFT}}}(OpenSeadragon),function(e){function t(t,n){var i=null,o=n.height&&n.width?new e.Rect(n.x||n.px,n.y||n.py,n.width,n.height):new e.Point(n.x||n.px,n.y||n.py),r=n.id?n.id:"openseadragon-overlay-"+Math.floor(1e7*Math.random());return i=e.getElement(n.id),i||(i=document.createElement("a"),i.href="#/overlay/"+r),i.id=r,e.addClass(i,n.className?n.className:"openseadragon-overlay"),void 0!==n.px&&(o=t.viewport.imageToViewportRectangle(o)),n.placement?new e.Overlay({element:i,location:t.viewport.pointFromPixel(o),placement:e.OverlayPlacement[n.placement.toUpperCase()],onDraw:n.onDraw}):new e.Overlay({element:i,location:o,onDraw:n.onDraw})}function n(t){t.updateAgain=!1,t.viewer&&t.viewer.raiseEvent("update-viewport",{viewer:t.viewer});for(var n,o,r,s,l,u,c,h,p=null,f=!1,m=e.now(),g=t.viewport.getContainerSize(),v=t.viewport.getBounds(!0),b=v.getTopLeft(),x=v.getBottomRight(),_=t.viewport.deltaPixelsFromPoints(t.source.getPixelRatio(0),!0).x,C=Math.max(t.source.minLevel,Math.floor(Math.log(t.minZoomImageRatio)/Math.log(2))),S=Math.min(Math.abs(t.source.maxLevel),Math.abs(Math.floor(Math.log(_/t.minPixelRatio)/Math.log(2))));t.lastDrawn.length>0;)n=t.lastDrawn.pop(),n.beingDrawn=!1;if(t.canvas.innerHTML="",E&&((t.canvas.width!=g.x||t.canvas.height!=g.y)&&(t.canvas.width=g.x,t.canvas.height=g.y),t.context.clearRect(0,0,g.x,g.y)),!(!t.wrapHorizontal&&(0>x.x||b.x>1)||!t.wrapVertical&&(0>x.y||b.y>t.normHeight))){t.wrapHorizontal||(b.x=Math.max(b.x,0),x.x=Math.min(x.x,1)),t.wrapVertical||(b.y=Math.max(b.y,0),x.y=Math.min(x.y,t.normHeight)),C=Math.min(C,S);var T;for(o=S;o>=C;o--){if(T=!1,r=t.viewport.deltaPixelsFromPoints(t.source.getPixelRatio(o),!0).x,!f&&r>=t.minPixelRatio||o==C)T=!0,f=!0;else if(!f)continue;if(s=t.viewport.deltaPixelsFromPoints(t.source.getPixelRatio(o),!1).x,l=t.viewport.deltaPixelsFromPoints(t.source.getPixelRatio(Math.max(t.source.getClosestLevel(t.viewport.containerSize)-1,0)),!1).x,u=t.immediateRender?1:l,c=Math.min(1,(r-.5)/.5),h=u/Math.abs(u-s),p=i(t,f,T,o,c,h,b,x,m,p),d(t.coverage,o))break}w(t,t.lastDrawn),y(t.viewport,t.overlays,t.container),p&&(a(t,p,m),t.updateAgain=!0)}}function i(e,t,n,i,r,a,s,l,u,c){var d,h,p,m,g,v=e.viewport.pixelFromPoint(e.viewport.getCenter());for(e.viewer&&e.viewer.raiseEvent("update-level",{viewer:e.viewer,havedrawn:t,level:i,opacity:r,visibility:a,topleft:s,bottomright:l,currenttime:u,best:c}),p=e.source.getTileAtPoint(i,s),m=e.source.getTileAtPoint(i,l),g=e.source.getNumTiles(i),f(e.coverage,i),e.wrapHorizontal||(m.x=Math.min(m.x,g.x-1)),e.wrapVertical||(m.y=Math.min(m.y,g.y-1)),d=p.x;m.x>=d;d++)for(h=p.y;m.y>=h;h++)c=o(e,n,t,d,h,i,r,a,v,g,u,c);return c}function o(e,t,n,i,o,a,s,c,d,f,m,v){var y=r(i,o,a,e.source,e.tilesMatrix,m,f,e.normHeight),b=t;if(e.viewer&&e.viewer.raiseEvent("update-tile",{viewer:e.viewer,tile:y}),p(e.coverage,a,i,o,!1),!y.exists)return v;if(n&&!b&&(h(e.coverage,a,i,o)?p(e.coverage,a,i,o,!0):b=!0),!b)return v;if(l(y,e.source.tileOverlap,e.viewport,d,c),y.loaded){var w=u(e,y,i,o,a,s,m);w&&(e.updateAgain=!0)}else y.loading||(v=g(v,y));return v}function r(t,n,i,o,r,a,s,l){var u,c,d,h,p,f;return r[i]||(r[i]={}),r[i][t]||(r[i][t]={}),r[i][t][n]||(u=(s.x+t%s.x)%s.x,c=(s.y+n%s.y)%s.y,d=o.getTileBounds(i,u,c),h=o.tileExists(i,u,c),p=o.getTileUrl(i,u,c),d.x+=1*(t-u)/s.x,d.y+=l*(n-c)/s.y,r[i][t][n]=new e.Tile(i,t,n,d,h,p)),f=r[i][t][n],f.lastTouchTime=a,f}function a(e,t,n){e.viewport.collectionMode?(e.midUpdate=!1,s(e,t,n)):t.loading=e.loadImage(t.url,function(i){s(e,t,n,i)})}function s(t,n,i,o){var r,a,s,l,u,c,d,h,p,f;if(n.loading=!1,t.midUpdate)return e.console.warn("Tile load callback in middle of drawing routine."),void 0;if(o||t.viewport.collectionMode){if(t.lastResetTime>i)return e.console.log("Ignoring tile %s loaded before reset: %s",n,n.url),void 0}else if(e.console.log("Tile %s failed to load: %s",n,n.url),!t.debugMode)return n.exists=!1,void 0;if(n.loaded=!0,n.image=o,r=t.tilesLoaded.length,t.tilesLoaded.length>=t.maxImageCacheCount){for(a=Math.ceil(Math.log(t.source.tileSize)/Math.log(2)),s=null,c=-1,f=t.tilesLoaded.length-1;f>=0;f--)d=t.tilesLoaded[f],d.level<=t.cutoff||d.beingDrawn||(s?(h=d.lastTouchTime,l=s.lastTouchTime,p=d.level,u=s.level,(l>h||h==l&&p>u)&&(s=d,c=f)):(s=d,c=f));s&&c>=0&&(s.unload(),r=c)}t.tilesLoaded[r]=n,t.updateAgain=!0}function l(t,n,i,o,r){var a=t.bounds.getTopLeft(),s=t.bounds.getSize(),l=i.pixelFromPoint(a,!0),u=i.pixelFromPoint(a,!1),c=i.deltaPixelsFromPoints(s,!0),d=i.deltaPixelsFromPoints(s,!1),h=u.plus(d.divide(2)),p=o.distanceTo(h);n||(c=c.plus(new e.Point(1,1))),t.position=l,t.size=c,t.distance=p,t.visibility=r}function u(e,t,n,i,o,r,a){var s,l,u=1e3*e.blendTime;if(t.blendStart||(t.blendStart=a),s=a-t.blendStart,l=u?Math.min(1,s/u):1,e.alwaysBlend&&(l*=r),t.opacity=l,e.lastDrawn.push(t),1==l)p(e.coverage,o,n,i,!0);else if(u>s)return!0;return!1}function c(e){e.tilesMatrix={},e.tilesLoaded=[]}function d(e,t,n,i){var o,r,a,s;if(!e[t])return!1;if(void 0===n||void 0===i){o=e[t];for(a in o)if(o.hasOwnProperty(a)){r=o[a];for(s in r)if(r.hasOwnProperty(s)&&!r[s])return!1}return!0}return void 0===e[t][n]||void 0===e[t][n][i]||e[t][n][i]===!0}function h(e,t,n,i){return void 0===n||void 0===i?d(e,t+1):d(e,t+1,2*n,2*i)&&d(e,t+1,2*n,2*i+1)&&d(e,t+1,2*n+1,2*i)&&d(e,t+1,2*n+1,2*i+1)}function p(t,n,i,o,r){return t[n]?(t[n][i]||(t[n][i]={}),t[n][i][o]=r,void 0):(e.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",n),void 0)}function f(e,t){e[t]={}}function m(e,t){var n;for(n=e.length-1;n>=0;n--)if(e[n].element==t)return n;return-1}function g(e,t){return e?t.visibility>e.visibility?t:t.visibility==e.visibility&&t.distance<e.distance?t:e:t}function v(t,n,i,o){t.onload=null,t.onabort=null,t.onerror=null,o&&window.clearTimeout(o),e.requestAnimationFrame(function(){n(t.src,i?t:null)})}function y(e,t,n){var i,o=t.length;for(i=0;o>i;i++)b(e,t[i],n)}function b(e,t,n){t.position=e.pixelFromPoint(t.bounds.getTopLeft(),!0),t.size=e.deltaPixelsFromPoints(t.bounds.getSize(),!0),t.drawHTML(n)}function w(t,n){var i,o,r,a,s,l,u,c;for(i=n.length-1;i>=0;i--){if(o=n[i],t.viewport.collectionMode?(r=o.x+"/"+o.y,s=t.viewport,c=s.collectionTileSource,t.collectionOverlays[r]?(a=t.collectionOverlays[r],a.viewport&&(a.viewport.resize(o.size,!0),a.viewport.goHome(!0))):(l="horizontal"==c.layout?o.y+o.x*c.rows:o.x+o.y*c.rows,u=c.tileSources.length>l?c.tileSources[l]:null,u&&(t.collectionOverlays[r]=a=new e.Viewer({element:e.makeNeutralElement("div"),mouseNavEnabled:!1,showNavigator:!1,showSequenceControl:!1,showNavigationControl:!1,tileSources:[u]}),T&&(a.element.style.border="1px solid rgba(255,255,255,0.38)",a.element.style["-webkit-box-reflect"]="below 0px -webkit-gradient(linear,left top,left bottom,from(transparent),color-stop(62%,transparent),to(rgba(255,255,255,0.62)))"),t.addOverlay(a.element,o.bounds)))):(E?o.drawCanvas(t.context):o.drawHTML(t.canvas),o.beingDrawn=!0),t.debugMode)try{x(t,o,n.length,i)}catch(d){e.console.error(d)}t.viewer&&t.viewer.raiseEvent("tile-drawn",{viewer:t.viewer,tile:o})}}function x(e,t,n,i){E&&(e.context.save(),e.context.lineWidth=2,e.context.font="small-caps bold 13px ariel",e.context.strokeStyle=e.debugGridColor,e.context.fillStyle=e.debugGridColor,e.context.strokeRect(t.position.x,t.position.y,t.size.x,t.size.y),0===t.x&&0===t.y&&(e.context.fillText("Zoom: "+e.viewport.getZoom(),t.position.x,t.position.y-30),e.context.fillText("Pan: "+(""+e.viewport.getBounds()),t.position.x,t.position.y-20)),e.context.fillText("Level: "+t.level,t.position.x+10,t.position.y+20),e.context.fillText("Column: "+t.x,t.position.x+10,t.position.y+30),e.context.fillText("Row: "+t.y,t.position.x+10,t.position.y+40),e.context.fillText("Order: "+i+" of "+n,t.position.x+10,t.position.y+50),e.context.fillText("Size: "+(""+t.size),t.position.x+10,t.position.y+60),e.context.fillText("Position: "+(""+t.position),t.position.x+10,t.position.y+70),e.context.restore())}var _=e.getWindowSize(),C=e.Browser.vendor,S=e.Browser.version,T=C==e.BROWSERS.FIREFOX||C==e.BROWSERS.OPERA||C==e.BROWSERS.SAFARI&&S>=4||C==e.BROWSERS.CHROME&&S>=2||C==e.BROWSERS.IE&&S>=9,E=T&&!(400>=_.x||400>=_.y)&&!navigator.appVersion.match("Mobile")&&e.isFunction(document.createElement("canvas").getContext);e.Drawer=function(n){var i,o=arguments;for(e.isPlainObject(n)||(n={source:o[0],viewport:o[1],element:o[2]}),e.extend(!0,this,{viewer:null,downloading:0,tilesMatrix:{},tilesLoaded:[],coverage:{},lastDrawn:[],lastResetTime:0,midUpdate:!1,updateAgain:!0,overlays:[],collectionOverlays:{},maxImageCacheCount:e.DEFAULT_SETTINGS.maxImageCacheCount,imageLoaderLimit:e.DEFAULT_SETTINGS.imageLoaderLimit,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,immediateRender:e.DEFAULT_SETTINGS.immediateRender,blendTime:e.DEFAULT_SETTINGS.blendTime,alwaysBlend:e.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:e.DEFAULT_SETTINGS.minPixelRatio,debugMode:e.DEFAULT_SETTINGS.debugMode,timeout:e.DEFAULT_SETTINGS.timeout},n),this.container=e.getElement(this.element),this.canvas=e.makeNeutralElement(E?"canvas":"div"),this.context=E?this.canvas.getContext("2d"):null,this.normHeight=this.source.dimensions.y/this.source.dimensions.x,this.element=this.container,this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",this.container.style.textAlign="left",this.container.appendChild(this.canvas),i=0;this.overlays.length>i;i++)e.isPlainObject(this.overlays[i])?this.overlays[i]=t(this,this.overlays[i]):e.isFunction(this.overlays[i])
},e.Drawer.prototype={addOverlay:function(t,n,i,o){var r;return r=e.isPlainObject(t)?t:{element:t,location:n,placement:i,onDraw:o},t=e.getElement(r.element),m(this.overlays,t)>=0?void 0:(this.overlays.push(new e.Overlay({element:t,location:r.location,placement:r.placement,onDraw:r.onDraw})),this.updateAgain=!0,this.viewer&&this.viewer.raiseEvent("add-overlay",{viewer:this.viewer,element:t,location:r.location,placement:r.placement}),this)},updateOverlay:function(t,n,i){var o;return t=e.getElement(t),o=m(this.overlays,t),o>=0&&(this.overlays[o].update(n,i),this.updateAgain=!0),this.viewer&&this.viewer.raiseEvent("update-overlay",{viewer:this.viewer,element:t,location:n,placement:i}),this},removeOverlay:function(t){var n;return t=e.getElement(t),n=m(this.overlays,t),n>=0&&(this.overlays[n].destroy(),this.overlays.splice(n,1),this.updateAgain=!0),this.viewer&&this.viewer.raiseEvent("remove-overlay",{viewer:this.viewer,element:t}),this},clearOverlays:function(){for(;this.overlays.length>0;)this.overlays.pop().destroy(),this.updateAgain=!0;return this.viewer&&this.viewer.raiseEvent("clear-overlay",{viewer:this.viewer}),this},needsUpdate:function(){return this.updateAgain},numTilesLoaded:function(){return this.tilesLoaded.length},reset:function(){return c(this),this.lastResetTime=e.now(),this.updateAgain=!0,this},update:function(){return this.midUpdate=!0,n(this),this.midUpdate=!1,this},loadImage:function(t,n){var i,o,r,a=this,s=!1;return(!this.imageLoaderLimit||this.downloading<this.imageLoaderLimit)&&(this.downloading++,i=new Image,r=function(i,o){if(a.downloading--,"function"==typeof n)try{n(o)}catch(r){e.console.error("%s while executing %s callback: %s",r.name,t,r.message,r)}},i.onload=function(){v(i,r,!0,o)},i.onabort=i.onerror=function(){v(i,r,!1,o)},o=window.setTimeout(function(){v(i,r,!1,o)},this.timeout),s=!0,i.src=t),s}}}(OpenSeadragon),function(e){e.Viewport=function(t){var n=arguments;n.length&&n[0]instanceof e.Point&&(t={containerSize:n[0],contentSize:n[1],config:n[2]}),t.config&&(e.extend(!0,t,t.config),delete t.config),e.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:e.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:e.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:e.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:e.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:e.DEFAULT_SETTINGS.maxZoomLevel},t),this.centerSpringX=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new e.Spring({initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.resetContentSize(this.contentSize),this.goHome(!0),this.update()},e.Viewport.prototype={resetContentSize:function(t){return this.contentSize=t,this.contentAspectX=this.contentSize.x/this.contentSize.y,this.contentAspectY=this.contentSize.y/this.contentSize.x,this.fitWidthBounds=new e.Rect(0,0,1,this.contentAspectY),this.fitHeightBounds=new e.Rect(0,0,this.contentAspectY,this.contentAspectY),this.homeBounds=new e.Rect(0,0,1,this.contentAspectY),this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:t,viewer:this.viewer}),this},getHomeZoom:function(){var e=this.contentAspectX/this.getAspectRatio();return this.defaultZoomLevel?this.defaultZoomLevel:e>=1?1:e},getHomeBounds:function(){var t=this.homeBounds.getCenter(),n=1/this.getHomeZoom(),i=n/this.getAspectRatio();return new e.Rect(t.x-n/2,t.y-i/2,n,i)},goHome:function(e){return this.viewer&&this.viewer.raiseEvent("home",{immediately:e,viewer:this.viewer}),this.fitBounds(this.getHomeBounds(),e)},getMinZoom:function(){var e=this.getHomeZoom(),t=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*e;return Math.min(t,e)},getMaxZoom:function(){var e=this.maxZoomLevel?this.maxZoomLevel:this.contentSize.x*this.maxZoomPixelRatio/this.containerSize.x;return Math.max(e,this.getHomeZoom())},getAspectRatio:function(){return this.containerSize.x/this.containerSize.y},getContainerSize:function(){return new e.Point(this.containerSize.x,this.containerSize.y)},getBounds:function(t){var n=this.getCenter(t),i=1/this.getZoom(t),o=i/this.getAspectRatio();return new e.Rect(n.x-i/2,n.y-o/2,i,o)},getCenter:function(t){var n,i,o,r,a,s,l,u,c=new e.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),d=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return t?c:this.zoomPoint?(n=this.pixelFromPoint(this.zoomPoint,!0),i=this.getZoom(),o=1/i,r=o/this.getAspectRatio(),a=new e.Rect(c.x-o/2,c.y-r/2,o,r),s=this.zoomPoint.minus(a.getTopLeft()).times(this.containerSize.x/a.width),l=s.minus(n),u=l.divide(this.containerSize.x*i),d.plus(u)):d},getZoom:function(e){return e?this.zoomSpring.current.value:this.zoomSpring.target.value},applyConstraints:function(e){var t,n,i,o,r,a,s,l=this.getZoom(),u=Math.max(Math.min(l,this.getMaxZoom()),this.getMinZoom()),c=0,d=0;return l!=u&&this.zoomTo(u,this.zoomPoint,e),t=this.getBounds(),n=this.visibilityRatio*t.width,i=this.visibilityRatio*t.height,o=t.x+t.width,r=1-t.x,a=t.y+t.height,s=this.contentAspectY-t.y,this.wrapHorizontal||(n>o&&(c=n-o),n>r&&(c=c?(c+r-n)/2:r-n)),this.wrapVertical||(i>a&&(d=i-a),i>s&&(d=d?(d+s-i)/2:s-i)),(c||d||e)&&(t.x+=c,t.y+=d,t.width>1&&(t.x=.5-t.width/2),t.height>this.contentAspectY&&(t.y=this.contentAspectY/2-t.height/2),this.fitBounds(t,e)),this.viewer&&this.viewer.raiseEvent("constrain",{immediately:e,viewer:this.viewer}),this},ensureVisible:function(e){return this.applyConstraints(e)},fitBounds:function(t,n){var i,o,r,a,s=this.getAspectRatio(),l=t.getCenter(),u=new e.Rect(t.x,t.y,t.width,t.height);return u.getAspectRatio()>=s?(u.height=t.width/s,u.y=l.y-u.height/2):(u.width=t.height*s,u.x=l.x-u.width/2),this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0),i=this.getBounds(),o=this.getZoom(),r=1/u.width,r==o||u.width==i.width?this.panTo(l,n):(a=i.getTopLeft().times(this.containerSize.x/i.width).minus(u.getTopLeft().times(this.containerSize.x/u.width)).divide(this.containerSize.x/i.width-this.containerSize.x/u.width),this.zoomTo(r,a,n))},fitVertically:function(e){var t=this.getCenter();return this.wrapHorizontal&&(t.x=(1+t.x%1)%1,this.centerSpringX.resetTo(t.x),this.centerSpringX.update()),this.wrapVertical&&(t.y=(this.contentAspectY+t.y%this.contentAspectY)%this.contentAspectY,this.centerSpringY.resetTo(t.y),this.centerSpringY.update()),this.fitBounds(this.fitHeightBounds,e)},fitHorizontally:function(e){var t=this.getCenter();return this.wrapHorizontal&&(t.x=(this.contentAspectX+t.x%this.contentAspectX)%this.contentAspectX,this.centerSpringX.resetTo(t.x),this.centerSpringX.update()),this.wrapVertical&&(t.y=(1+t.y%1)%1,this.centerSpringY.resetTo(t.y),this.centerSpringY.update()),this.fitBounds(this.fitWidthBounds,e)},panBy:function(t,n){var i=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(i.plus(t),n)},panTo:function(e,t){return t?(this.centerSpringX.resetTo(e.x),this.centerSpringY.resetTo(e.y)):(this.centerSpringX.springTo(e.x),this.centerSpringY.springTo(e.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:e,immediately:t,viewer:this.viewer}),this},zoomBy:function(e,t,n){return this.zoomTo(this.zoomSpring.target.value*e,t,n)},zoomTo:function(t,n,i){return this.zoomPoint=n instanceof e.Point?n:null,i?this.zoomSpring.resetTo(t):this.zoomSpring.springTo(t),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:t,refPoint:n,immediately:i,viewer:this.viewer}),this},resize:function(t,n){var i=this.getBounds(),o=i,r=t.x/this.containerSize.x;return this.containerSize=new e.Point(t.x,t.y),n&&(o.width=i.width*r,o.height=o.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:t,maintain:n,viewer:this.viewer}),this.fitBounds(o,!0)},update:function(){var e,t,n,i,o=this.centerSpringX.current.value,r=this.centerSpringY.current.value,a=this.zoomSpring.current.value;return this.zoomPoint&&(e=this.pixelFromPoint(this.zoomPoint,!0)),this.zoomSpring.update(),this.zoomPoint&&this.zoomSpring.current.value!=a?(t=this.pixelFromPoint(this.zoomPoint,!0),n=t.minus(e),i=this.deltaPointsFromPixels(n,!0),this.centerSpringX.shiftBy(i.x),this.centerSpringY.shiftBy(i.y)):this.zoomPoint=null,this.centerSpringX.update(),this.centerSpringY.update(),this.centerSpringX.current.value!=o||this.centerSpringY.current.value!=r||this.zoomSpring.current.value!=a},deltaPixelsFromPoints:function(e,t){return e.times(this.containerSize.x*this.getZoom(t))},deltaPointsFromPixels:function(e,t){return e.divide(this.containerSize.x*this.getZoom(t))},pixelFromPoint:function(e,t){var n=this.getBounds(t);return e.minus(n.getTopLeft()).times(this.containerSize.x/n.width)},pointFromPixel:function(e,t){var n=this.getBounds(t);return e.divide(this.containerSize.x/n.width).plus(n.getTopLeft())},viewportToImageCoordinates:function(t,n){return new e.Point(t*this.contentSize.x,n*this.contentSize.y*this.contentAspectX)},imageToViewportCoordinates:function(t,n){return new e.Point(t/this.contentSize.x,n/this.contentSize.y/this.contentAspectX)},imageToViewportRectangle:function(t,n,i,o){var r,a,s;return 1==arguments.length?(s=t,this.imageToViewportRectangle(s.x,s.y,s.width,s.height)):(r=this.imageToViewportCoordinates(t,n),a=this.imageToViewportCoordinates(i,o),new e.Rect(r.x,r.y,a.x,a.y))}}}(OpenSeadragon),function(e,t,n,o){function r(t,n){this.element=t,this.options=e.extend({},u,n),this._defaults=u,this._name=l,this.init()}function a(){return!!("ontouchstart"in t)}function s(){var e=n.body||n.documentElement,t=e.style,i="transition";if("string"==typeof t[i])return!0;v=["Moz","Webkit","Khtml","O","ms"],i=i.charAt(0).toUpperCase()+i.substr(1);for(var o=0;v.length>o;o++)if("string"==typeof t[v[o]+i])return!0;return!1}var l="tooltipster",u={animation:"fade",arrow:!0,arrowColor:"",content:"",delay:200,fixedWidth:0,maxWidth:0,functionBefore:function(e,t){t()},functionReady:function(){},functionAfter:function(){},icon:"(?)",iconDesktop:!1,iconTouch:!1,iconTheme:".tooltipster-icon",interactive:!1,interactiveTolerance:350,offsetX:0,offsetY:0,onlyOne:!0,position:"top",speed:350,timer:0,theme:".tooltipster-default",touchDevices:!0,trigger:"hover",updateAnimation:!0},c=!0;s()||(c=!1);var d=a();e(t).on("mousemove.tooltipster",function(){d=!1,e(t).off("mousemove.tooltipster")}),r.prototype={init:function(){var t=e(this.element),i=this,r=!0;if(0==i.options.touchDevices&&d&&(r=!1),n.all&&!n.querySelector&&(r=!1),1==r){if(1==this.options.iconDesktop&&!d||1==this.options.iconTouch&&d){var a=t.attr("title");t.removeAttr("title");var s=i.options.iconTheme,l=e('<span class="'+s.replace(".","")+'" title="'+a+'">'+this.options.icon+"</span>");l.insertAfter(t),t.data("tooltipsterIcon",l),t=l}var u=e.trim(i.options.content).length>0?i.options.content:t.attr("title");t.data("tooltipsterContent",u),t.removeAttr("title"),1!=this.options.touchDevices||!d||"click"!=this.options.trigger&&"hover"!=this.options.trigger?("hover"==this.options.trigger&&(t.on("mouseenter.tooltipster",function(){i.showTooltip()}),1==this.options.interactive?t.on("mouseleave.tooltipster",function(){var e=t.data("tooltipster"),n=!1;e!==o&&""!==e?(e.mouseenter(function(){n=!0}),e.mouseleave(function(){n=!1}),setTimeout(function(){1==n?e.mouseleave(function(e){"SELECT"!=e.target.tagName&&"OPTION"!=e.target.tagName&&i.hideTooltip()}):i.hideTooltip()},i.options.interactiveTolerance)):i.hideTooltip()}):t.on("mouseleave.tooltipster",function(){i.hideTooltip()})),"click"==this.options.trigger&&t.on("click.tooltipster",function(){""==t.data("tooltipster")||t.data("tooltipster")==o?i.showTooltip():i.hideTooltip()})):t.bind("touchstart",function(){i.showTooltip()})}},showTooltip:function(){var t=e(this.element),n=this;t.data("tooltipsterIcon")!==o&&(t=t.data("tooltipsterIcon")),t.hasClass("tooltipster-disable")||(e(".tooltipster-base").not(".tooltipster-dying").length>0&&1==n.options.onlyOne&&e(".tooltipster-base").not(".tooltipster-dying").not(t.data("tooltipster")).each(function(){e(this).addClass("tooltipster-kill");var t=e(this).data("origin");t.data("plugin_tooltipster").hideTooltip()}),t.clearQueue().delay(n.options.delay).queue(function(){n.options.functionBefore(t,function(){if(t.data("tooltipster")!==o&&""!==t.data("tooltipster")){var i=t.data("tooltipster");if(!i.hasClass("tooltipster-kill")){var r="tooltipster-"+n.options.animation;if(i.removeClass("tooltipster-dying"),1==c&&i.clearQueue().addClass(r+"-show"),n.options.timer>0){var a=i.data("tooltipsterTimer");clearTimeout(a),a=setTimeout(function(){i.data("tooltipsterTimer",o),n.hideTooltip()},n.options.timer),i.data("tooltipsterTimer",a)}1==n.options.touchDevices&&d&&e("body").bind("touchstart",function(t){if(1==n.options.interactive){var i=e(t.target),o=!0;i.parents().each(function(){e(this).hasClass("tooltipster-base")&&(o=!1)}),1==o&&(n.hideTooltip(),e("body").unbind("touchstart"))}else n.hideTooltip(),e("body").unbind("touchstart")})}}else{e("body").css("overflow-x","hidden");var l=t.data("tooltipsterContent"),u=n.options.theme,h=u.replace(".",""),r="tooltipster-"+n.options.animation,p="-webkit-transition-duration: "+n.options.speed+"ms; -webkit-animation-duration: "+n.options.speed+"ms; -moz-transition-duration: "+n.options.speed+"ms; -moz-animation-duration: "+n.options.speed+"ms; -o-transition-duration: "+n.options.speed+"ms; -o-animation-duration: "+n.options.speed+"ms; -ms-transition-duration: "+n.options.speed+"ms; -ms-animation-duration: "+n.options.speed+"ms; transition-duration: "+n.options.speed+"ms; animation-duration: "+n.options.speed+"ms;",f=n.options.fixedWidth>0?"width:"+n.options.fixedWidth+"px;":"",m=n.options.maxWidth>0?"max-width:"+n.options.maxWidth+"px;":"",g=1==n.options.interactive?"pointer-events: auto;":"",i=e('<div class="tooltipster-base '+h+" "+r+'" style="'+f+" "+m+" "+g+" "+p+'"></div>'),v=e('<div class="tooltipster-content"></div>');v.html(l),i.append(v),i.appendTo("body"),t.data("tooltipster",i),i.data("origin",t),n.positionTooltip(),n.options.functionReady(t,i),1==c?i.addClass(r+"-show"):i.css("display","none").removeClass(r).fadeIn(n.options.speed);var y=l,b=setInterval(function(){var o=t.data("tooltipsterContent");0==e("body").find(t).length?(i.addClass("tooltipster-dying"),n.hideTooltip()):y!==o&&""!==o&&(y=o,i.find(".tooltipster-content").html(o),1==n.options.updateAnimation&&(s()?(i.css({width:"","-webkit-transition":"all "+n.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms","-moz-transition":"all "+n.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms","-o-transition":"all "+n.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms","-ms-transition":"all "+n.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms",transition:"all "+n.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms"}).addClass("tooltipster-content-changing"),setTimeout(function(){i.removeClass("tooltipster-content-changing"),setTimeout(function(){i.css({"-webkit-transition":n.options.speed+"ms","-moz-transition":n.options.speed+"ms","-o-transition":n.options.speed+"ms","-ms-transition":n.options.speed+"ms",transition:n.options.speed+"ms"})},n.options.speed)},n.options.speed)):i.fadeTo(n.options.speed,.5,function(){i.fadeTo(n.options.speed,1)})),n.positionTooltip()),(0==e("body").find(i).length||0==e("body").find(t).length)&&clearInterval(b)},200);if(n.options.timer>0){var a=setTimeout(function(){i.data("tooltipsterTimer",o),n.hideTooltip()},n.options.timer+n.options.speed);i.data("tooltipsterTimer",a)}1==n.options.touchDevices&&d&&e("body").bind("touchstart",function(t){if(1==n.options.interactive){var i=e(t.target),o=!0;i.parents().each(function(){e(this).hasClass("tooltipster-base")&&(o=!1)}),1==o&&(n.hideTooltip(),e("body").unbind("touchstart"))}else n.hideTooltip(),e("body").unbind("touchstart")}),i.mouseleave(function(e){"SELECT"!=e.target.tagName&&"OPTION"!=e.target.tagName&&n.hideTooltip()})}}),t.dequeue()}))},hideTooltip:function(){var t=e(this.element),n=this;t.data("tooltipsterIcon")!==o&&(t=t.data("tooltipsterIcon"));var i=t.data("tooltipster");if(i==o&&(i=e(".tooltipster-dying")),t.clearQueue(),i!==o&&""!==i){var r=i.data("tooltipsterTimer");r!==o&&clearTimeout(r);var a="tooltipster-"+n.options.animation;1==c?i.clearQueue().removeClass(a+"-show").addClass("tooltipster-dying").delay(n.options.speed).queue(function(){i.remove(),t.data("tooltipster",""),e("body").css("verflow-x",""),n.options.functionAfter(t)}):i.clearQueue().addClass("tooltipster-dying").fadeOut(n.options.speed,function(){i.remove(),t.data("tooltipster",""),e("body").css("verflow-x",""),n.options.functionAfter(t)})}},positionTooltip:function(){function n(){var n=e(t).scrollLeft();if(0>H-n){var i=H-n;H=n,l.data("arrow-reposition",i)}if(H+h-n>u){var i=H-(u+n-h);H=u+n-h,l.data("arrow-reposition",i)}}function r(n,i){0>g-e(t).scrollTop()-f-z-12&&i.indexOf("top")>-1&&(s.options.position=n,y=i),g+d+f+12+z>e(t).scrollTop()+e(t).height()&&i.indexOf("bottom")>-1&&(s.options.position=n,y=i,L=g-f-z-12)}var a=e(this.element),s=this;if(a.data("tooltipsterIcon")!==o&&(a=a.data("tooltipsterIcon")),a.data("tooltipster")!==o&&""!==a.data("tooltipster")){var l=a.data("tooltipster");l.css("width","");var u=e(t).width(),c=a.outerWidth(!1),d=a.outerHeight(!1),h=l.outerWidth(!1),p=l.innerWidth()+1,f=l.outerHeight(!1),m=a.offset(),g=m.top,v=m.left,y=o;if(a.is("area")){var b=a.attr("shape"),w=a.parent().attr("name"),x=e('img[usemap="#'+w+'"]'),_=x.offset().left,C=x.offset().top,S=a.attr("coords")!==o?a.attr("coords").split(","):o;if("circle"==b){var T=parseInt(S[0]),E=parseInt(S[1]),k=parseInt(S[2]);d=2*k,c=2*k,g=C+E-k,v=_+T-k}else if("rect"==b){var T=parseInt(S[0]),E=parseInt(S[1]),N=parseInt(S[2]),A=parseInt(S[3]);d=A-E,c=N-T,g=C+E,v=_+T}else if("poly"==b){var M=0,P=0,R=0,O=0,I="even";for(i=0;S.length>i;i++){var D=parseInt(S[i]);"even"==I?(D>R&&(R=D,0==i&&(M=R)),M>D&&(M=D),I="odd"):(D>O&&(O=D,1==i&&(P=O)),P>D&&(P=D),I="even")}d=O-P,c=R-M,g=C+P,v=_+M}else d=x.outerHeight(!1),c=x.outerWidth(!1),g=C,v=_}0==s.options.fixedWidth&&l.css({width:p+"px","padding-left":"0px","padding-right":"0px"});var H=0,L=0,z=parseInt(s.options.offsetY),B=parseInt(s.options.offsetX),F="";if("top"==s.options.position){var j=v+h-(v+c);H=v+B-j/2,L=g-f-z-12,n(),r("bottom","top")}if("top-left"==s.options.position&&(H=v+B,L=g-f-z-12,n(),r("bottom-left","top-left")),"top-right"==s.options.position&&(H=v+c+B-h,L=g-f-z-12,n(),r("bottom-right","top-right")),"bottom"==s.options.position){var j=v+h-(v+c);H=v-j/2+B,L=g+d+z+12,n(),r("top","bottom")}if("bottom-left"==s.options.position&&(H=v+B,L=g+d+z+12,n(),r("top-left","bottom-left")),"bottom-right"==s.options.position&&(H=v+c+B-h,L=g+d+z+12,n(),r("top-right","bottom-right")),"left"==s.options.position){H=v-B-h-12,myLeftMirror=v+B+c+12;var U=g+f-(g+a.outerHeight(!1));if(L=g-U/2-z,0>H&&myLeftMirror+h>u){var W=2*parseFloat(l.css("border-width")),V=h+H-W;l.css("width",V+"px"),f=l.outerHeight(!1),H=v-B-V-12-W,U=g+f-(g+a.outerHeight(!1)),L=g-U/2-z}else 0>H&&(H=v+B+c+12,l.data("arrow-reposition","left"))}if("right"==s.options.position){H=v+B+c+12,myLeftMirror=v-B-h-12;var U=g+f-(g+a.outerHeight(!1));if(L=g-U/2-z,H+h>u&&0>myLeftMirror){var W=2*parseFloat(l.css("border-width")),V=u-H-W;l.css("width",V+"px"),f=l.outerHeight(!1),U=g+f-(g+a.outerHeight(!1)),L=g-U/2-z}else H+h>u&&(H=v-B-h-12,l.data("arrow-reposition","right"))}if(1==s.options.arrow){var $="tooltipster-arrow-"+s.options.position;if(1>s.options.arrowColor.length)var q=l.css("background-color");else var q=s.options.arrowColor;var Q=l.data("arrow-reposition");if(Q?"left"==Q?($="tooltipster-arrow-right",Q=""):"right"==Q?($="tooltipster-arrow-left",Q=""):Q="left:"+Q+"px;":Q="","top"==s.options.position||"top-left"==s.options.position||"top-right"==s.options.position)var G=parseFloat(l.css("border-bottom-width")),X=l.css("border-bottom-color");else if("bottom"==s.options.position||"bottom-left"==s.options.position||"bottom-right"==s.options.position)var G=parseFloat(l.css("border-top-width")),X=l.css("border-top-color");else if("left"==s.options.position)var G=parseFloat(l.css("border-right-width")),X=l.css("border-right-color");else if("right"==s.options.position)var G=parseFloat(l.css("border-left-width")),X=l.css("border-left-color");else var G=parseFloat(l.css("border-bottom-width")),X=l.css("border-bottom-color");G>1&&G++;var Y="";if(0!==G){var Z="",K="border-color: "+X+";";-1!==$.indexOf("bottom")?Z="margin-top: -"+G+"px;":-1!==$.indexOf("top")?Z="margin-bottom: -"+G+"px;":-1!==$.indexOf("left")?Z="margin-right: -"+G+"px;":-1!==$.indexOf("right")&&(Z="margin-left: -"+G+"px;"),Y='<span class="tooltipster-arrow-border" style="'+Z+" "+K+';"></span>'}l.find(".tooltipster-arrow").remove(),F='<div class="'+$+' tooltipster-arrow" style="'+Q+'">'+Y+'<span style="border-color:'+q+';"></span></div>',l.append(F)}l.css({top:L+"px",left:H+"px"}),y!==o&&(s.options.position=y)}}},e.fn[l]=function(t){if("string"==typeof t){var n=this,i=arguments[1];if(n.data("plugin_tooltipster")==o){var a=n.find("*");n=e(),a.each(function(){e(this).data("plugin_tooltipster")!==o&&n.push(e(this))})}return n.each(function(){switch(t.toLowerCase()){case"show":e(this).data("plugin_tooltipster").showTooltip();break;case"hide":e(this).data("plugin_tooltipster").hideTooltip();break;case"disable":e(this).addClass("tooltipster-disable");break;case"enable":e(this).removeClass("tooltipster-disable");break;case"destroy":e(this).data("plugin_tooltipster").hideTooltip(),e(this).data("plugin_tooltipster","").attr("title",n.data("tooltipsterContent")).data("tooltipsterContent","").data("plugin_tooltipster","").off("mouseenter.tooltipster mouseleave.tooltipster click.tooltipster");break;case"update":if(e(this).data("tooltipsterIcon")==o)e(this).data("tooltipsterContent",i);else{var r=e(this).data("tooltipsterIcon");r.data("tooltipsterContent",i)}break;case"reposition":e(this).data("plugin_tooltipster").positionTooltip()}}),this}return this.each(function(){e.data(this,"plugin_"+l)||e.data(this,"plugin_"+l,new r(this,t));var n=e(this).data("plugin_tooltipster").options;if(1==n.iconDesktop&&!d||1==n.iconTouch&&d){var i=e(this).data("plugin_tooltipster");e(this).next().data("plugin_tooltipster",i)}})},d&&t.addEventListener("orientationchange",function(){e(".tooltipster-base").length>0&&e(".tooltipster-base").each(function(){var t=e(this).data("origin");t.data("plugin_tooltipster").hideTooltip()})},!1),e(t).on("resize.tooltipster",function(){var t=e(".tooltipster-base").data("origin");null!==t&&t!==o&&t.tooltipster("reposition")})}(jQuery,window,document),d3=function(){function e(e){return null!=e&&!isNaN(e)}function t(e){return e.length}function n(e){for(var t=1;e*t%1;)t*=10;return t}function i(e,t){try{for(var n in t)Object.defineProperty(e.prototype,n,{value:t[n],enumerable:!1})}catch(i){e.prototype=t}}function o(){}function r(){}function a(e,t,n){return function(){var i=n.apply(t,arguments);return i===t?e:i}}function s(){}function l(e){function t(){for(var t,i=n,o=-1,r=i.length;r>++o;)(t=i[o].on)&&t.apply(this,arguments);return e}var n=[],i=new o;return t.on=function(t,o){var r,a=i.get(t);return 2>arguments.length?a&&a.on:(a&&(a.on=null,n=n.slice(0,r=n.indexOf(a)).concat(n.slice(r+1)),i.remove(t)),o&&n.push(i.set(t,{on:o})),e)},t}function u(){sa.event.stopPropagation(),sa.event.preventDefault()}function c(){for(var e,t=sa.event;e=t.sourceEvent;)t=e;return t}function d(e,t){function n(){e.on(t,null)}e.on(t,function(){u(),n()},!0),setTimeout(n,0)}function h(e){for(var t=new s,n=0,i=arguments.length;i>++n;)t[arguments[n]]=l(t);return t.of=function(n,i){return function(o){try{var r=o.sourceEvent=sa.event;o.target=e,sa.event=o,t[o.type].apply(n,i)}finally{sa.event=r}}},t}function p(e,t){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();if(0>ga&&(ua.scrollX||ua.scrollY)){n=sa.select(la.body).append("svg").style("position","absolute").style("top",0).style("left",0);var o=n[0][0].getScreenCTM();ga=!(o.f||o.e),n.remove()}return ga?(i.x=t.pageX,i.y=t.pageY):(i.x=t.clientX,i.y=t.clientY),i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}function f(e){for(var t=-1,n=e.length,i=[];n>++t;)i.push(e[t]);return i}function m(e){return Array.prototype.slice.call(e)}function g(e){return ba(e,Ta),e}function v(e){return function(){return wa(e,this)}}function y(e){return function(){return xa(e,this)}}function b(e,t){function n(){this.removeAttribute(e)}function i(){this.removeAttributeNS(e.space,e.local)}function o(){this.setAttribute(e,t)}function r(){this.setAttributeNS(e.space,e.local,t)}function a(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}function s(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}return e=sa.ns.qualify(e),null==t?e.local?i:n:"function"==typeof t?e.local?s:a:e.local?r:o}function w(e){return e.trim().replace(/\s+/g," ")}function x(e){return RegExp("(?:^|\\s+)"+sa.requote(e)+"(?:\\s+|$)","g")}function _(e,t){function n(){for(var n=-1;o>++n;)e[n](this,t)}function i(){for(var n=-1,i=t.apply(this,arguments);o>++n;)e[n](this,i)}e=e.trim().split(/\s+/).map(C);var o=e.length;return"function"==typeof t?i:n}function C(e){var t=x(e);return function(n,i){if(o=n.classList)return i?o.add(e):o.remove(e);var o=n.getAttribute("class")||"";i?(t.lastIndex=0,t.test(o)||n.setAttribute("class",w(o+" "+e))):n.setAttribute("class",w(o.replace(t," ")))}}function S(e,t,n){function i(){this.style.removeProperty(e)}function o(){this.style.setProperty(e,t,n)}function r(){var i=t.apply(this,arguments);null==i?this.style.removeProperty(e):this.style.setProperty(e,i,n)}return null==t?i:"function"==typeof t?r:o}function T(e,t){function n(){delete this[e]}function i(){this[e]=t}function o(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}return null==t?n:"function"==typeof t?o:i}function E(e){return{__data__:e}}function k(e){return function(){return Sa(this,e)}}function N(e){return arguments.length||(e=sa.ascending),function(t,n){return!t-!n||e(t.__data__,n.__data__)}}function A(){}function M(e,t,n){function i(){var t=this[a];t&&(this.removeEventListener(e,t,t.$),delete this[a])}function o(){var o=l(t,va(arguments));i.call(this),this.addEventListener(e,this[a]=o,o.$=n),o._=t}function r(){var t,n=RegExp("^__on([^.]+)"+sa.requote(e)+"$");for(var i in this)if(t=i.match(n)){var o=this[i];this.removeEventListener(t[1],o,o.$),delete this[i]}}var a="__on"+e,s=e.indexOf("."),l=P;s>0&&(e=e.substring(0,s));var u=Na.get(e);return u&&(e=u,l=R),s?t?o:i:t?A:r}function P(e,t){return function(n){var i=sa.event;sa.event=n,t[0]=this.__data__;try{e.apply(this,t)}finally{sa.event=i}}}function R(e,t){var n=P(e,t);return function(e){var t=this,i=e.relatedTarget;i&&(i===t||8&i.compareDocumentPosition(t))||n.call(t,e)}}function O(e,t){for(var n=0,i=e.length;i>n;n++)for(var o,r=e[n],a=0,s=r.length;s>a;a++)(o=r[a])&&t(o,a,n);return e}function I(e){return ba(e,Aa),e}function D(){}function H(e,t,n){return new L(e,t,n)}function L(e,t,n){this.h=e,this.s=t,this.l=n}function z(e,t,n){function i(e){return e>360?e-=360:0>e&&(e+=360),60>e?r+(a-r)*e/60:180>e?a:240>e?r+(a-r)*(240-e)/60:r}function o(e){return Math.round(255*i(e))}var r,a;return e=isNaN(e)?0:0>(e%=360)?e+360:e,t=isNaN(t)?0:0>t?0:t>1?1:t,n=0>n?0:n>1?1:n,a=.5>=n?n*(1+t):n+t-n*t,r=2*n-a,tt(o(e+120),o(e),o(e-120))}function B(e){return e>0?1:0>e?-1:0}function F(e){return Math.acos(Math.max(-1,Math.min(1,e)))}function j(e){return e>1?Da/2:-1>e?-Da/2:Math.asin(e)}function U(e){return(Math.exp(e)-Math.exp(-e))/2}function W(e){return(Math.exp(e)+Math.exp(-e))/2}function V(e){return(e=Math.sin(e/2))*e}function $(e,t,n){return new q(e,t,n)}function q(e,t,n){this.h=e,this.c=t,this.l=n}function Q(e,t,n){return isNaN(e)&&(e=0),isNaN(t)&&(t=0),G(n,Math.cos(e*=La)*t,Math.sin(e)*t)}function G(e,t,n){return new X(e,t,n)}function X(e,t,n){this.l=e,this.a=t,this.b=n}function Y(e,t,n){var i=(e+16)/116,o=i+t/500,r=i-n/200;return o=K(o)*ja,i=K(i)*Ua,r=K(r)*Wa,tt(et(3.2404542*o-1.5371385*i-.4985314*r),et(-.969266*o+1.8760108*i+.041556*r),et(.0556434*o-.2040259*i+1.0572252*r))}function Z(e,t,n){return e>0?$(Math.atan2(n,t)*za,Math.sqrt(t*t+n*n),e):$(0/0,0/0,e)}function K(e){return e>.206893034?e*e*e:(e-4/29)/7.787037}function J(e){return e>.008856?Math.pow(e,1/3):7.787037*e+4/29}function et(e){return Math.round(255*(.00304>=e?12.92*e:1.055*Math.pow(e,1/2.4)-.055))}function tt(e,t,n){return new nt(e,t,n)}function nt(e,t,n){this.r=e,this.g=t,this.b=n}function it(e){return 16>e?"0"+Math.max(0,e).toString(16):Math.min(255,e).toString(16)}function ot(e,t,n){var i,o,r,a=0,s=0,l=0;if(i=/([a-z]+)\((.*)\)/i.exec(e))switch(o=i[2].split(","),i[1]){case"hsl":return n(parseFloat(o[0]),parseFloat(o[1])/100,parseFloat(o[2])/100);case"rgb":return t(lt(o[0]),lt(o[1]),lt(o[2]))}return(r=qa.get(e))?t(r.r,r.g,r.b):(null!=e&&"#"===e.charAt(0)&&(4===e.length?(a=e.charAt(1),a+=a,s=e.charAt(2),s+=s,l=e.charAt(3),l+=l):7===e.length&&(a=e.substring(1,3),s=e.substring(3,5),l=e.substring(5,7)),a=parseInt(a,16),s=parseInt(s,16),l=parseInt(l,16)),t(a,s,l))}function rt(e,t,n){var i,o,r=Math.min(e/=255,t/=255,n/=255),a=Math.max(e,t,n),s=a-r,l=(a+r)/2;return s?(o=.5>l?s/(a+r):s/(2-a-r),i=e==a?(t-n)/s+(n>t?6:0):t==a?(n-e)/s+2:(e-t)/s+4,i*=60):(i=0/0,o=l>0&&1>l?0:i),H(i,o,l)}function at(e,t,n){e=st(e),t=st(t),n=st(n);var i=J((.4124564*e+.3575761*t+.1804375*n)/ja),o=J((.2126729*e+.7151522*t+.072175*n)/Ua),r=J((.0193339*e+.119192*t+.9503041*n)/Wa);return G(116*o-16,500*(i-o),200*(o-r))}function st(e){return.04045>=(e/=255)?e/12.92:Math.pow((e+.055)/1.055,2.4)}function lt(e){var t=parseFloat(e);return"%"===e.charAt(e.length-1)?Math.round(2.55*t):t}function ut(e){return"function"==typeof e?e:function(){return e}}function ct(e){return e}function dt(e){return function(t,n,i){return 2===arguments.length&&"function"==typeof n&&(i=n,n=null),ht(t,n,e,i)}}function ht(e,t,n,i){function o(){var e,t=l.status;if(!t&&l.responseText||t>=200&&300>t||304===t){try{e=n.call(r,l)}catch(i){return a.error.call(r,i),void 0}a.load.call(r,e)}else a.error.call(r,l)}var r={},a=sa.dispatch("progress","load","error"),s={},l=new(ua.XDomainRequest&&/^(http(s)?:)?\/\//.test(e)?XDomainRequest:XMLHttpRequest);return"onload"in l?l.onload=l.onerror=o:l.onreadystatechange=function(){l.readyState>3&&o()},l.onprogress=function(e){var t=sa.event;sa.event=e;try{a.progress.call(r,l)}finally{sa.event=t}},r.header=function(e,t){return e=(e+"").toLowerCase(),2>arguments.length?s[e]:(null==t?delete s[e]:s[e]=t+"",r)},r.mimeType=function(e){return arguments.length?(t=null==e?null:e+"",r):t},r.response=function(e){return n=e,r},["get","post"].forEach(function(e){r[e]=function(){return r.send.apply(r,[e].concat(va(arguments)))}}),r.send=function(n,i,o){if(2===arguments.length&&"function"==typeof i&&(o=i,i=null),l.open(n,e,!0),null==t||"accept"in s||(s.accept=t+",*/*"),l.setRequestHeader)for(var a in s)l.setRequestHeader(a,s[a]);return null!=t&&l.overrideMimeType&&l.overrideMimeType(t),null!=o&&r.on("error",o).on("load",function(e){o(null,e)}),l.send(null==i?null:i),r},r.abort=function(){return l.abort(),r},sa.rebind(r,a,"on"),null==i?r:r.get(pt(i))}function pt(e){return 1===e.length?function(t,n){e(null==t?n:null)}:e}function ft(e,t){function n(e,n,r){3>arguments.length&&(r=n,n=null);var a=sa.xhr(e,t,r);return a.row=function(e){return arguments.length?a.response(null==(n=e)?i:o(e)):n},a.row(n)}function i(e){return n.parse(e.responseText)}function o(e){return function(t){return n.parse(t.responseText,e)}}function a(t){return t.map(s).join(e)
}function s(e){return l.test(e)?'"'+e.replace(/\"/g,'""')+'"':e}var l=RegExp('["'+e+"\n]"),u=e.charCodeAt(0);return n.parse=function(e,t){var i;return n.parseRows(e,function(e,n){if(i)return i(e,n-1);var o=Function("d","return {"+e.map(function(e,t){return JSON.stringify(e)+": d["+t+"]"}).join(",")+"}");i=t?function(e,n){return t(o(e),n)}:o})},n.parseRows=function(e,t){function n(){if(c>=l)return a;if(o)return o=!1,r;var t=c;if(34===e.charCodeAt(t)){for(var n=t;l>n++;)if(34===e.charCodeAt(n)){if(34!==e.charCodeAt(n+1))break;++n}c=n+2;var i=e.charCodeAt(n+1);return 13===i?(o=!0,10===e.charCodeAt(n+2)&&++c):10===i&&(o=!0),e.substring(t+1,n).replace(/""/g,'"')}for(;l>c;){var i=e.charCodeAt(c++),s=1;if(10===i)o=!0;else if(13===i)o=!0,10===e.charCodeAt(c)&&(++c,++s);else if(i!==u)continue;return e.substring(t,c-s)}return e.substring(t)}for(var i,o,r={},a={},s=[],l=e.length,c=0,d=0;(i=n())!==a;){for(var h=[];i!==r&&i!==a;)h.push(i),i=n();(!t||(h=t(h,d++)))&&s.push(h)}return s},n.format=function(t){if(Array.isArray(t[0]))return n.formatRows(t);var i=new r,o=[];return t.forEach(function(e){for(var t in e)i.has(t)||o.push(i.add(t))}),[o.map(s).join(e)].concat(t.map(function(t){return o.map(function(e){return s(t[e])}).join(e)})).join("\n")},n.formatRows=function(e){return e.map(a).join("\n")},n}function mt(){var e=gt(),t=vt()-e;t>24?(isFinite(t)&&(clearTimeout(Ya),Ya=setTimeout(mt,t)),Xa=0):(Xa=1,Za(mt))}function gt(){for(var e=Date.now(),t=Qa;t;)e>=t.time&&(t.flush=t.callback(e-t.time)),t=t.next;return e}function vt(){for(var e,t=Qa,n=1/0;t;)t.flush?t=e?e.next=t.next:Qa=t.next:(n>t.time&&(n=t.time),t=(e=t).next);return Ga=e,n}function yt(e,t){var n=Math.pow(10,3*Math.abs(8-t));return{scale:t>8?function(e){return e/n}:function(e){return e*n},symbol:e}}function bt(e,t){return t-(e?Math.ceil(Math.log(e)/Math.LN10):1)}function wt(e){return e+""}function xt(e,t){e&&ss.hasOwnProperty(e.type)&&ss[e.type](e,t)}function _t(e,t,n){var i,o=-1,r=e.length-n;for(t.lineStart();r>++o;)i=e[o],t.point(i[0],i[1]);t.lineEnd()}function Ct(e,t){var n=-1,i=e.length;for(t.polygonStart();i>++n;)_t(e[n],t,1);t.polygonEnd()}function St(){function e(e,t){e*=La,t=t*La/2+Da/4;var n=e-i,a=Math.cos(t),s=Math.sin(t),l=r*s,u=o*a+l*Math.cos(n),c=l*Math.sin(n);us+=Math.atan2(c,u),i=e,o=a,r=s}var t,n,i,o,r;cs.point=function(a,s){cs.point=e,i=(t=a)*La,o=Math.cos(s=(n=s)*La/2+Da/4),r=Math.sin(s)},cs.lineEnd=function(){e(t,n)}}function Tt(e){var t=e[0],n=e[1],i=Math.cos(n);return[i*Math.cos(t),i*Math.sin(t),Math.sin(n)]}function Et(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function kt(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Nt(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function At(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Mt(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function Pt(e){return[Math.atan2(e[1],e[0]),Math.asin(Math.max(-1,Math.min(1,e[2])))]}function Rt(e,t){return Ha>Math.abs(e[0]-t[0])&&Ha>Math.abs(e[1]-t[1])}function Ot(e,t){if(!ds){++hs,e*=La;var n=Math.cos(t*=La);ps+=(n*Math.cos(e)-ps)/hs,fs+=(n*Math.sin(e)-fs)/hs,ms+=(Math.sin(t)-ms)/hs}}function It(){var e,t;ds=1,Dt(),ds=2;var n=gs.point;gs.point=function(i,o){n(e=i,t=o)},gs.lineEnd=function(){gs.point(e,t),Ht(),gs.lineEnd=Ht}}function Dt(){function e(e,o){e*=La;var r=Math.cos(o*=La),a=r*Math.cos(e),s=r*Math.sin(e),l=Math.sin(o),u=Math.atan2(Math.sqrt((u=n*l-i*s)*u+(u=i*a-t*l)*u+(u=t*s-n*a)*u),t*a+n*s+i*l);hs+=u,ps+=u*(t+(t=a)),fs+=u*(n+(n=s)),ms+=u*(i+(i=l))}var t,n,i;ds>1||(1>ds&&(ds=1,hs=ps=fs=ms=0),gs.point=function(o,r){o*=La;var a=Math.cos(r*=La);t=a*Math.cos(o),n=a*Math.sin(o),i=Math.sin(r),gs.point=e})}function Ht(){gs.point=Ot}function Lt(){return!0}function zt(e,t,n,i,o){var r=[],a=[];if(e.forEach(function(e){if(!(0>=(t=e.length-1))){var t,n=e[0],i=e[t];if(Rt(n,i)){o.lineStart();for(var s=0;t>s;++s)o.point((n=e[s])[0],n[1]);return o.lineEnd(),void 0}var l={point:n,points:e,other:null,visited:!1,entry:!0,subject:!0},u={point:n,points:[n],other:l,visited:!1,entry:!1,subject:!1};l.other=u,r.push(l),a.push(u),l={point:i,points:[i],other:null,visited:!1,entry:!1,subject:!0},u={point:i,points:[i],other:l,visited:!1,entry:!0,subject:!1},l.other=u,r.push(l),a.push(u)}}),a.sort(t),Bt(r),Bt(a),r.length){if(n)for(var s=1,l=!n(a[0].point),u=a.length;u>s;++s)a[s].entry=l=!l;for(var c,d,h,p=r[0];;){for(c=p;c.visited;)if((c=c.next)===p)return;d=c.points,o.lineStart();do{if(c.visited=c.other.visited=!0,c.entry){if(c.subject)for(var s=0;d.length>s;s++)o.point((h=d[s])[0],h[1]);else i(c.point,c.next.point,1,o);c=c.next}else{if(c.subject){d=c.prev.points;for(var s=d.length;--s>=0;)o.point((h=d[s])[0],h[1])}else i(c.point,c.prev.point,-1,o);c=c.prev}c=c.other,d=c.points}while(!c.visited);o.lineEnd()}}}function Bt(e){if(t=e.length){for(var t,n,i=0,o=e[0];t>++i;)o.next=n=e[i],n.prev=o,o=n;o.next=n=e[0],n.prev=o}}function Ft(e,t,n){return function(i){function o(t,n){e(t,n)&&i.point(t,n)}function r(e,t){g.point(e,t)}function a(){v.point=r,g.lineStart()}function s(){v.point=o,g.lineEnd()}function l(e,t){b.point(e,t),m.push([e,t])}function u(){b.lineStart(),m=[]}function c(){l(m[0][0],m[0][1]),b.lineEnd();var e,t=b.clean(),n=y.buffer(),o=n.length;if(!o)return f=!0,p+=Wt(m,-1),m=null,void 0;if(m=null,1&t){e=n[0],h+=Wt(e,1);var r,o=e.length-1,a=-1;for(i.lineStart();o>++a;)i.point((r=e[a])[0],r[1]);return i.lineEnd(),void 0}o>1&&2&t&&n.push(n.pop().concat(n.shift())),d.push(n.filter(jt))}var d,h,p,f,m,g=t(i),v={point:o,lineStart:a,lineEnd:s,polygonStart:function(){v.point=l,v.lineStart=u,v.lineEnd=c,f=!1,p=h=0,d=[],i.polygonStart()},polygonEnd:function(){v.point=o,v.lineStart=a,v.lineEnd=s,d=sa.merge(d),d.length?zt(d,Vt,null,n,i):(-Ha>h||f&&-Ha>p)&&(i.lineStart(),n(null,null,1,i),i.lineEnd()),i.polygonEnd(),d=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}},y=Ut(),b=t(y);return v}}function jt(e){return e.length>1}function Ut(){var e,t=[];return{lineStart:function(){t.push(e=[])},point:function(t,n){e.push([t,n])},lineEnd:A,buffer:function(){var n=t;return t=[],e=null,n},rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))}}}function Wt(e,t){if(!(n=e.length))return 0;for(var n,i,o,r=0,a=0,s=e[0],l=s[0],u=s[1],c=Math.cos(u),d=Math.atan2(t*Math.sin(l)*c,Math.sin(u)),h=1-t*Math.cos(l)*c,p=d;n>++r;)s=e[r],c=Math.cos(u=s[1]),i=Math.atan2(t*Math.sin(l=s[0])*c,Math.sin(u)),o=1-t*Math.cos(l)*c,Ha>Math.abs(h-2)&&Ha>Math.abs(o-2)||(Ha>Math.abs(o)||Ha>Math.abs(h)||(Ha>Math.abs(Math.abs(i-d)-Da)?o+h>2&&(a+=4*(i-d)):a+=Ha>Math.abs(h-2)?4*(i-p):((3*Da+i-d)%(2*Da)-Da)*(h+o)),p=d,d=i,h=o);return a}function Vt(e,t){return(0>(e=e.point)[0]?e[1]-Da/2-Ha:Da/2-e[1])-(0>(t=t.point)[0]?t[1]-Da/2-Ha:Da/2-t[1])}function $t(e){var t,n=0/0,i=0/0,o=0/0;return{lineStart:function(){e.lineStart(),t=1},point:function(r,a){var s=r>0?Da:-Da,l=Math.abs(r-n);Ha>Math.abs(l-Da)?(e.point(n,i=(i+a)/2>0?Da/2:-Da/2),e.point(o,i),e.lineEnd(),e.lineStart(),e.point(s,i),e.point(r,i),t=0):o!==s&&l>=Da&&(Ha>Math.abs(n-o)&&(n-=o*Ha),Ha>Math.abs(r-s)&&(r-=s*Ha),i=qt(n,i,r,a),e.point(o,i),e.lineEnd(),e.lineStart(),e.point(s,i),t=0),e.point(n=r,i=a),o=s},lineEnd:function(){e.lineEnd(),n=i=0/0},clean:function(){return 2-t}}}function qt(e,t,n,i){var o,r,a=Math.sin(e-n);return Math.abs(a)>Ha?Math.atan((Math.sin(t)*(r=Math.cos(i))*Math.sin(n)-Math.sin(i)*(o=Math.cos(t))*Math.sin(e))/(o*r*a)):(t+i)/2}function Qt(e,t,n,i){var o;if(null==e)o=n*Da/2,i.point(-Da,o),i.point(0,o),i.point(Da,o),i.point(Da,0),i.point(Da,-o),i.point(0,-o),i.point(-Da,-o),i.point(-Da,0),i.point(-Da,o);else if(Math.abs(e[0]-t[0])>Ha){var r=(e[0]<t[0]?1:-1)*Da;o=n*r/2,i.point(-r,o),i.point(0,o),i.point(r,o)}else i.point(t[0],t[1])}function Gt(e){function t(e,t){return Math.cos(e)*Math.cos(t)>r}function n(e){var n,r,l,u,c;return{lineStart:function(){u=l=!1,c=1},point:function(d,h){var p,f=[d,h],m=t(d,h),g=a?m?0:o(d,h):m?o(d+(0>d?Da:-Da),h):0;if(!n&&(u=l=m)&&e.lineStart(),m!==l&&(p=i(n,f),(Rt(n,p)||Rt(f,p))&&(f[0]+=Ha,f[1]+=Ha,m=t(f[0],f[1]))),m!==l)c=0,m?(e.lineStart(),p=i(f,n),e.point(p[0],p[1])):(p=i(n,f),e.point(p[0],p[1]),e.lineEnd()),n=p;else if(s&&n&&a^m){var v;g&r||!(v=i(f,n,!0))||(c=0,a?(e.lineStart(),e.point(v[0][0],v[0][1]),e.point(v[1][0],v[1][1]),e.lineEnd()):(e.point(v[1][0],v[1][1]),e.lineEnd(),e.lineStart(),e.point(v[0][0],v[0][1])))}!m||n&&Rt(n,f)||e.point(f[0],f[1]),n=f,l=m,r=g},lineEnd:function(){l&&e.lineEnd(),n=null},clean:function(){return c|(u&&l)<<1}}}function i(e,t,n){var i=Tt(e),o=Tt(t),a=[1,0,0],s=kt(i,o),l=Et(s,s),u=s[0],c=l-u*u;if(!c)return!n&&e;var d=r*l/c,h=-r*u/c,p=kt(a,s),f=At(a,d),m=At(s,h);Nt(f,m);var g=p,v=Et(f,g),y=Et(g,g),b=v*v-y*(Et(f,f)-1);if(!(0>b)){var w=Math.sqrt(b),x=At(g,(-v-w)/y);if(Nt(x,f),x=Pt(x),!n)return x;var _,C=e[0],S=t[0],T=e[1],E=t[1];C>S&&(_=C,C=S,S=_);var k=S-C,N=Ha>Math.abs(k-Da),A=N||Ha>k;if(!N&&T>E&&(_=T,T=E,E=_),A?N?T+E>0^x[1]<(Ha>Math.abs(x[0]-C)?T:E):x[1]>=T&&E>=x[1]:k>Da^(x[0]>=C&&S>=x[0])){var M=At(g,(-v+w)/y);return Nt(M,f),[x,Pt(M)]}}}function o(t,n){var i=a?e:Da-e,o=0;return-i>t?o|=1:t>i&&(o|=2),-i>n?o|=4:n>i&&(o|=8),o}var r=Math.cos(e),a=r>0,s=Math.abs(r)>Ha,l=ln(e,6*La);return Ft(t,n,l)}function Xt(e,t,n,i){function o(i,o){return Ha>Math.abs(i[0]-e)?o>0?0:3:Ha>Math.abs(i[0]-n)?o>0?2:1:Ha>Math.abs(i[1]-t)?o>0?1:0:o>0?3:2}function r(e,t){return a(e.point,t.point)}function a(e,t){var n=o(e,1),i=o(t,1);return n!==i?n-i:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0]}function s(o,r){var a=r[0]-o[0],s=r[1]-o[1],l=[0,1];return Ha>Math.abs(a)&&Ha>Math.abs(s)?o[0]>=e&&n>=o[0]&&o[1]>=t&&i>=o[1]:Yt(e-o[0],a,l)&&Yt(o[0]-n,-a,l)&&Yt(t-o[1],s,l)&&Yt(o[1]-i,-s,l)?(1>l[1]&&(r[0]=o[0]+l[1]*a,r[1]=o[1]+l[1]*s),l[0]>0&&(o[0]+=l[0]*a,o[1]+=l[0]*s),!0):!1}return function(l){function u(r){var a=o(r,-1),s=c([0===a||3===a?e:n,a>1?i:t]);return s}function c(e){for(var t=0,n=b.length,i=e[1],o=0;n>o;++o)for(var r,a=1,s=b[o],l=s.length,u=s[0];l>a;++a)r=s[a],i>=u[1]?r[1]>i&&d(u,r,e)>0&&++t:i>=r[1]&&0>d(u,r,e)&&--t,u=r;return 0!==t}function d(e,t,n){return(t[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(t[1]-e[1])}function h(r,s,l,u){var c=0,d=0;if(null==r||(c=o(r,l))!==(d=o(s,l))||0>a(r,s)^l>0){do u.point(0===c||3===c?e:n,c>1?i:t);while((c=(c+l+4)%4)!==d)}else u.point(s[0],s[1])}function p(o,r){return o>=e&&n>=o&&r>=t&&i>=r}function f(e,t){p(e,t)&&l.point(e,t)}function m(){M.point=v,b&&b.push(w=[]),k=!0,E=!1,S=T=0/0}function g(){y&&(v(x,_),C&&E&&A.rejoin(),y.push(A.buffer())),M.point=f,E&&l.lineEnd()}function v(e,t){e=Math.max(-ys,Math.min(ys,e)),t=Math.max(-ys,Math.min(ys,t));var n=p(e,t);if(b&&w.push([e,t]),k)x=e,_=t,C=n,k=!1,n&&(l.lineStart(),l.point(e,t));else if(n&&E)l.point(e,t);else{var i=[S,T],o=[e,t];s(i,o)?(E||(l.lineStart(),l.point(i[0],i[1])),l.point(o[0],o[1]),n||l.lineEnd()):n&&(l.lineStart(),l.point(e,t))}S=e,T=t,E=n}var y,b,w,x,_,C,S,T,E,k,N=l,A=Ut(),M={point:f,lineStart:m,lineEnd:g,polygonStart:function(){l=A,y=[],b=[]},polygonEnd:function(){l=N,(y=sa.merge(y)).length?(l.polygonStart(),zt(y,r,u,h,l),l.polygonEnd()):c([e,t])&&(l.polygonStart(),l.lineStart(),h(null,null,1,l),l.lineEnd(),l.polygonEnd()),y=b=w=null}};return M}}function Yt(e,t,n){if(Ha>Math.abs(t))return 0>=e;var i=e/t;if(t>0){if(i>n[1])return!1;i>n[0]&&(n[0]=i)}else{if(n[0]>i)return!1;n[1]>i&&(n[1]=i)}return!0}function Zt(e,t){function n(n,i){return n=e(n,i),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,i){return n=t.invert(n,i),n&&e.invert(n[0],n[1])}),n}function Kt(e){function t(t){function i(n,i){n=e(n,i),t.point(n[0],n[1])}function r(){c=0/0,m.point=a,t.lineStart()}function a(i,r){var a=Tt([i,r]),s=e(i,r);n(c,d,u,h,p,f,c=s[0],d=s[1],u=i,h=a[0],p=a[1],f=a[2],o,t),t.point(c,d)}function s(){m.point=i,t.lineEnd()}function l(){var e,i,l,g,v,y,b;r(),m.point=function(t,n){a(e=t,i=n),l=c,g=d,v=h,y=p,b=f,m.point=a},m.lineEnd=function(){n(c,d,u,h,p,f,l,g,e,v,y,b,o,t),m.lineEnd=s,s()}}var u,c,d,h,p,f,m={point:i,lineStart:r,lineEnd:s,polygonStart:function(){t.polygonStart(),m.lineStart=l},polygonEnd:function(){t.polygonEnd(),m.lineStart=r}};return m}function n(t,o,r,a,s,l,u,c,d,h,p,f,m,g){var v=u-t,y=c-o,b=v*v+y*y;if(b>4*i&&m--){var w=a+h,x=s+p,_=l+f,C=Math.sqrt(w*w+x*x+_*_),S=Math.asin(_/=C),T=Ha>Math.abs(Math.abs(_)-1)?(r+d)/2:Math.atan2(x,w),E=e(T,S),k=E[0],N=E[1],A=k-t,M=N-o,P=y*A-v*M;(P*P/b>i||Math.abs((v*A+y*M)/b-.5)>.3)&&(n(t,o,r,a,s,l,k,N,T,w/=C,x/=C,_,m,g),g.point(k,N),n(k,N,T,w,x,_,u,c,d,h,p,f,m,g))}}var i=.5,o=16;return t.precision=function(e){return arguments.length?(o=(i=e*e)>0&&16,t):Math.sqrt(i)},t}function Jt(e){return en(function(){return e})()}function en(e){function t(e){return e=a(e[0]*La,e[1]*La),[e[0]*c+s,l-e[1]*c]}function n(e){return e=a.invert((e[0]-s)/c,(l-e[1])/c),e&&[e[0]*za,e[1]*za]}function i(){a=Zt(r=on(m,g,v),o);var e=o(p,f);return s=d-e[0]*c,l=h+e[1]*c,t}var o,r,a,s,l,u=Kt(function(e,t){return e=o(e,t),[e[0]*c+s,l-e[1]*c]}),c=150,d=480,h=250,p=0,f=0,m=0,g=0,v=0,y=vs,b=ct,w=null,x=null;return t.stream=function(e){return tn(r,y(u(b(e))))},t.clipAngle=function(e){return arguments.length?(y=null==e?(w=e,vs):Gt((w=+e)*La),t):w},t.clipExtent=function(e){return arguments.length?(x=e,b=null==e?ct:Xt(e[0][0],e[0][1],e[1][0],e[1][1]),t):x},t.scale=function(e){return arguments.length?(c=+e,i()):c},t.translate=function(e){return arguments.length?(d=+e[0],h=+e[1],i()):[d,h]},t.center=function(e){return arguments.length?(p=e[0]%360*La,f=e[1]%360*La,i()):[p*za,f*za]},t.rotate=function(e){return arguments.length?(m=e[0]%360*La,g=e[1]%360*La,v=e.length>2?e[2]%360*La:0,i()):[m*za,g*za,v*za]},sa.rebind(t,u,"precision"),function(){return o=e.apply(this,arguments),t.invert=o.invert&&n,i()}}function tn(e,t){return{point:function(n,i){i=e(n*La,i*La),n=i[0],t.point(n>Da?n-2*Da:-Da>n?n+2*Da:n,i[1])},sphere:function(){t.sphere()},lineStart:function(){t.lineStart()},lineEnd:function(){t.lineEnd()},polygonStart:function(){t.polygonStart()},polygonEnd:function(){t.polygonEnd()}}}function nn(e,t){return[e,t]}function on(e,t,n){return e?t||n?Zt(an(e),sn(t,n)):an(e):t||n?sn(t,n):nn}function rn(e){return function(t,n){return t+=e,[t>Da?t-2*Da:-Da>t?t+2*Da:t,n]}}function an(e){var t=rn(e);return t.invert=rn(-e),t}function sn(e,t){function n(e,t){var n=Math.cos(t),s=Math.cos(e)*n,l=Math.sin(e)*n,u=Math.sin(t),c=u*i+s*o;return[Math.atan2(l*r-c*a,s*i-u*o),Math.asin(Math.max(-1,Math.min(1,c*r+l*a)))]}var i=Math.cos(e),o=Math.sin(e),r=Math.cos(t),a=Math.sin(t);return n.invert=function(e,t){var n=Math.cos(t),s=Math.cos(e)*n,l=Math.sin(e)*n,u=Math.sin(t),c=u*r-l*a;return[Math.atan2(l*r+u*a,s*i+c*o),Math.asin(Math.max(-1,Math.min(1,c*i-s*o)))]},n}function ln(e,t){var n=Math.cos(e),i=Math.sin(e);return function(o,r,a,s){null!=o?(o=un(n,o),r=un(n,r),(a>0?r>o:o>r)&&(o+=2*a*Da)):(o=e+2*a*Da,r=e);for(var l,u=a*t,c=o;a>0?c>r:r>c;c-=u)s.point((l=Pt([n,-i*Math.cos(c),-i*Math.sin(c)]))[0],l[1])}}function un(e,t){var n=Tt(t);n[0]-=e,Mt(n);var i=F(-n[1]);return((0>-n[2]?-i:i)+2*Math.PI-Ha)%(2*Math.PI)}function cn(e,t,n){var i=sa.range(e,t-Ha,n).concat(t);return function(e){return i.map(function(t){return[e,t]})}}function dn(e,t,n){var i=sa.range(e,t-Ha,n).concat(t);return function(e){return i.map(function(t){return[t,e]})}}function hn(e){return e.source}function pn(e){return e.target}function fn(e,t,n,i){var o=Math.cos(t),r=Math.sin(t),a=Math.cos(i),s=Math.sin(i),l=o*Math.cos(e),u=o*Math.sin(e),c=a*Math.cos(n),d=a*Math.sin(n),h=2*Math.asin(Math.sqrt(V(i-t)+o*a*V(n-e))),p=1/Math.sin(h),f=h?function(e){var t=Math.sin(e*=h)*p,n=Math.sin(h-e)*p,i=n*l+t*c,o=n*u+t*d,a=n*r+t*s;return[Math.atan2(o,i)*za,Math.atan2(a,Math.sqrt(i*i+o*o))*za]}:function(){return[e*za,t*za]};return f.distance=h,f}function mn(){function e(e,o){var r=Math.sin(o*=La),a=Math.cos(o),s=Math.abs((e*=La)-t),l=Math.cos(s);bs+=Math.atan2(Math.sqrt((s=a*Math.sin(s))*s+(s=i*r-n*a*l)*s),n*r+i*a*l),t=e,n=r,i=a}var t,n,i;ws.point=function(o,r){t=o*La,n=Math.sin(r*=La),i=Math.cos(r),ws.point=e},ws.lineEnd=function(){ws.point=ws.lineEnd=A}}function gn(e){var t=0,n=Da/3,i=en(e),o=i(t,n);return o.parallels=function(e){return arguments.length?i(t=e[0]*Da/180,n=e[1]*Da/180):[180*(t/Da),180*(n/Da)]},o}function vn(e,t){function n(e,t){var n=Math.sqrt(r-2*o*Math.sin(t))/o;return[n*Math.sin(e*=o),a-n*Math.cos(e)]}var i=Math.sin(e),o=(i+Math.sin(t))/2,r=1+i*(2*o-i),a=Math.sqrt(r)/o;return n.invert=function(e,t){var n=a-t;return[Math.atan2(e,n)/o,j((r-(e*e+n*n)*o*o)/(2*o))]},n}function yn(){function e(e,t){_s+=o*e-i*t,i=e,o=t}var t,n,i,o;ks.point=function(r,a){ks.point=e,t=i=r,n=o=a},ks.lineEnd=function(){e(t,n)}}function bn(e,t){Cs>e&&(Cs=e),e>Ts&&(Ts=e),Ss>t&&(Ss=t),t>Es&&(Es=t)}function wn(){function e(e,t){a.push("M",e,",",t,r)}function t(e,t){a.push("M",e,",",t),s.point=n}function n(e,t){a.push("L",e,",",t)}function i(){s.point=e}function o(){a.push("Z")}var r=xn(4.5),a=[],s={point:e,lineStart:function(){s.point=t},lineEnd:i,polygonStart:function(){s.lineEnd=o},polygonEnd:function(){s.lineEnd=i,s.point=e},pointRadius:function(e){return r=xn(e),s},result:function(){if(a.length){var e=a.join("");return a=[],e}}};return s}function xn(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function _n(e,t){ds||(ps+=e,fs+=t,++ms)}function Cn(){function e(e,i){var o=e-t,r=i-n,a=Math.sqrt(o*o+r*r);ps+=a*(t+e)/2,fs+=a*(n+i)/2,ms+=a,t=e,n=i}var t,n;if(1!==ds){if(!(1>ds))return;ds=1,ps=fs=ms=0}As.point=function(i,o){As.point=e,t=i,n=o}}function Sn(){As.point=_n}function Tn(){function e(e,t){var n=o*e-i*t;ps+=n*(i+e),fs+=n*(o+t),ms+=3*n,i=e,o=t}var t,n,i,o;2>ds&&(ds=2,ps=fs=ms=0),As.point=function(r,a){As.point=e,t=i=r,n=o=a},As.lineEnd=function(){e(t,n)}}function En(e){function t(t,n){e.moveTo(t,n),e.arc(t,n,a,0,2*Da)}function n(t,n){e.moveTo(t,n),s.point=i}function i(t,n){e.lineTo(t,n)}function o(){s.point=t}function r(){e.closePath()}var a=4.5,s={point:t,lineStart:function(){s.point=n},lineEnd:o,polygonStart:function(){s.lineEnd=r},polygonEnd:function(){s.lineEnd=o,s.point=t},pointRadius:function(e){return a=e,s},result:A};return s}function kn(e){var t=Kt(function(t,n){return e([t*za,n*za])});return function(e){return e=t(e),{point:function(t,n){e.point(t*La,n*La)},sphere:function(){e.sphere()},lineStart:function(){e.lineStart()},lineEnd:function(){e.lineEnd()},polygonStart:function(){e.polygonStart()},polygonEnd:function(){e.polygonEnd()}}}}function Nn(e,t){function n(t,n){var i=Math.cos(t),o=Math.cos(n),r=e(i*o);return[r*o*Math.sin(t),r*Math.sin(n)]}return n.invert=function(e,n){var i=Math.sqrt(e*e+n*n),o=t(i),r=Math.sin(o),a=Math.cos(o);return[Math.atan2(e*r,i*a),Math.asin(i&&n*r/i)]},n}function An(e,t){function n(e,t){var n=Ha>Math.abs(Math.abs(t)-Da/2)?0:a/Math.pow(o(t),r);return[n*Math.sin(r*e),a-n*Math.cos(r*e)]}var i=Math.cos(e),o=function(e){return Math.tan(Da/4+e/2)},r=e===t?Math.sin(e):Math.log(i/Math.cos(t))/Math.log(o(t)/o(e)),a=i*Math.pow(o(e),r)/r;return r?(n.invert=function(e,t){var n=a-t,i=B(r)*Math.sqrt(e*e+n*n);return[Math.atan2(e,n)/r,2*Math.atan(Math.pow(a/i,1/r))-Da/2]},n):Pn}function Mn(e,t){function n(e,t){var n=r-t;return[n*Math.sin(o*e),r-n*Math.cos(o*e)]}var i=Math.cos(e),o=e===t?Math.sin(e):(i-Math.cos(t))/(t-e),r=i/o+e;return Ha>Math.abs(o)?nn:(n.invert=function(e,t){var n=r-t;return[Math.atan2(e,n)/o,r-B(o)*Math.sqrt(e*e+n*n)]},n)}function Pn(e,t){return[e,Math.log(Math.tan(Da/4+t/2))]}function Rn(e){var t,n=Jt(e),i=n.scale,o=n.translate,r=n.clipExtent;return n.scale=function(){var e=i.apply(n,arguments);return e===n?t?n.clipExtent(null):n:e},n.translate=function(){var e=o.apply(n,arguments);return e===n?t?n.clipExtent(null):n:e},n.clipExtent=function(e){var a=r.apply(n,arguments);if(a===n){if(t=null==e){var s=Da*i(),l=o();r([[l[0]-s,l[1]-s],[l[0]+s,l[1]+s]])}}else t&&(a=null);return a},n.clipExtent(null)}function On(e,t){var n=Math.cos(t)*Math.sin(e);return[Math.log((1+n)/(1-n))/2,Math.atan2(Math.tan(t),Math.cos(e))]}function In(e){function t(t){function a(){u.push("M",r(e(c),s))}for(var l,u=[],c=[],d=-1,h=t.length,p=ut(n),f=ut(i);h>++d;)o.call(this,l=t[d],d)?c.push([+p.call(this,l,d),+f.call(this,l,d)]):c.length&&(a(),c=[]);return c.length&&a(),u.length?u.join(""):null}var n=Dn,i=Hn,o=Lt,r=Ln,a=r.key,s=.7;return t.x=function(e){return arguments.length?(n=e,t):n},t.y=function(e){return arguments.length?(i=e,t):i},t.defined=function(e){return arguments.length?(o=e,t):o},t.interpolate=function(e){return arguments.length?(a="function"==typeof e?r=e:(r=Ds.get(e)||Ln).key,t):a},t.tension=function(e){return arguments.length?(s=e,t):s},t}function Dn(e){return e[0]}function Hn(e){return e[1]}function Ln(e){return e.join("L")}function zn(e){return Ln(e)+"Z"}function Bn(e){for(var t=0,n=e.length,i=e[0],o=[i[0],",",i[1]];n>++t;)o.push("V",(i=e[t])[1],"H",i[0]);return o.join("")}function Fn(e){for(var t=0,n=e.length,i=e[0],o=[i[0],",",i[1]];n>++t;)o.push("H",(i=e[t])[0],"V",i[1]);return o.join("")}function jn(e,t){return 4>e.length?Ln(e):e[1]+Vn(e.slice(1,e.length-1),$n(e,t))}function Un(e,t){return 3>e.length?Ln(e):e[0]+Vn((e.push(e[0]),e),$n([e[e.length-2]].concat(e,[e[1]]),t))}function Wn(e,t){return 3>e.length?Ln(e):e[0]+Vn(e,$n(e,t))}function Vn(e,t){if(1>t.length||e.length!=t.length&&e.length!=t.length+2)return Ln(e);var n=e.length!=t.length,i="",o=e[0],r=e[1],a=t[0],s=a,l=1;if(n&&(i+="Q"+(r[0]-2*a[0]/3)+","+(r[1]-2*a[1]/3)+","+r[0]+","+r[1],o=e[1],l=2),t.length>1){s=t[1],r=e[l],l++,i+="C"+(o[0]+a[0])+","+(o[1]+a[1])+","+(r[0]-s[0])+","+(r[1]-s[1])+","+r[0]+","+r[1];for(var u=2;t.length>u;u++,l++)r=e[l],s=t[u],i+="S"+(r[0]-s[0])+","+(r[1]-s[1])+","+r[0]+","+r[1]}if(n){var c=e[l];i+="Q"+(r[0]+2*s[0]/3)+","+(r[1]+2*s[1]/3)+","+c[0]+","+c[1]}return i}function $n(e,t){for(var n,i=[],o=(1-t)/2,r=e[0],a=e[1],s=1,l=e.length;l>++s;)n=r,r=a,a=e[s],i.push([o*(a[0]-n[0]),o*(a[1]-n[1])]);return i}function qn(e){if(3>e.length)return Ln(e);var t=1,n=e.length,i=e[0],o=i[0],r=i[1],a=[o,o,o,(i=e[1])[0]],s=[r,r,r,i[1]],l=[o,",",r];for(Zn(l,a,s);n>++t;)i=e[t],a.shift(),a.push(i[0]),s.shift(),s.push(i[1]),Zn(l,a,s);for(t=-1;2>++t;)a.shift(),a.push(i[0]),s.shift(),s.push(i[1]),Zn(l,a,s);return l.join("")}function Qn(e){if(4>e.length)return Ln(e);for(var t,n=[],i=-1,o=e.length,r=[0],a=[0];3>++i;)t=e[i],r.push(t[0]),a.push(t[1]);for(n.push(Yn(zs,r)+","+Yn(zs,a)),--i;o>++i;)t=e[i],r.shift(),r.push(t[0]),a.shift(),a.push(t[1]),Zn(n,r,a);return n.join("")}function Gn(e){for(var t,n,i=-1,o=e.length,r=o+4,a=[],s=[];4>++i;)n=e[i%o],a.push(n[0]),s.push(n[1]);for(t=[Yn(zs,a),",",Yn(zs,s)],--i;r>++i;)n=e[i%o],a.shift(),a.push(n[0]),s.shift(),s.push(n[1]),Zn(t,a,s);return t.join("")}function Xn(e,t){var n=e.length-1;if(n)for(var i,o,r=e[0][0],a=e[0][1],s=e[n][0]-r,l=e[n][1]-a,u=-1;n>=++u;)i=e[u],o=u/n,i[0]=t*i[0]+(1-t)*(r+o*s),i[1]=t*i[1]+(1-t)*(a+o*l);return qn(e)}function Yn(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Zn(e,t,n){e.push("C",Yn(Hs,t),",",Yn(Hs,n),",",Yn(Ls,t),",",Yn(Ls,n),",",Yn(zs,t),",",Yn(zs,n))}function Kn(e,t){return(t[1]-e[1])/(t[0]-e[0])}function Jn(e){for(var t=0,n=e.length-1,i=[],o=e[0],r=e[1],a=i[0]=Kn(o,r);n>++t;)i[t]=(a+(a=Kn(o=r,r=e[t+1])))/2;return i[t]=a,i}function ei(e){for(var t,n,i,o,r=[],a=Jn(e),s=-1,l=e.length-1;l>++s;)t=Kn(e[s],e[s+1]),1e-6>Math.abs(t)?a[s]=a[s+1]=0:(n=a[s]/t,i=a[s+1]/t,o=n*n+i*i,o>9&&(o=3*t/Math.sqrt(o),a[s]=o*n,a[s+1]=o*i));for(s=-1;l>=++s;)o=(e[Math.min(l,s+1)][0]-e[Math.max(0,s-1)][0])/(6*(1+a[s]*a[s])),r.push([o||0,a[s]*o||0]);return r}function ti(e){return 3>e.length?Ln(e):e[0]+Vn(e,ei(e))}function ni(e,t,n,i){var o,r,a,s,l,u,c;return o=i[e],r=o[0],a=o[1],o=i[t],s=o[0],l=o[1],o=i[n],u=o[0],c=o[1],(c-a)*(s-r)-(l-a)*(u-r)>0}function ii(e,t,n){return(n[0]-t[0])*(e[1]-t[1])<(n[1]-t[1])*(e[0]-t[0])}function oi(e,t,n,i){var o=e[0],r=n[0],a=t[0]-o,s=i[0]-r,l=e[1],u=n[1],c=t[1]-l,d=i[1]-u,h=(s*(l-u)-d*(o-r))/(d*a-s*c);return[o+h*a,l+h*c]}function ri(e,t){var n={list:e.map(function(e,t){return{index:t,x:e[0],y:e[1]}}).sort(function(e,t){return e.y<t.y?-1:e.y>t.y?1:e.x<t.x?-1:e.x>t.x?1:0}),bottomSite:null},i={list:[],leftEnd:null,rightEnd:null,init:function(){i.leftEnd=i.createHalfEdge(null,"l"),i.rightEnd=i.createHalfEdge(null,"l"),i.leftEnd.r=i.rightEnd,i.rightEnd.l=i.leftEnd,i.list.unshift(i.leftEnd,i.rightEnd)},createHalfEdge:function(e,t){return{edge:e,side:t,vertex:null,l:null,r:null}},insert:function(e,t){t.l=e,t.r=e.r,e.r.l=t,e.r=t},leftBound:function(e){var t=i.leftEnd;do t=t.r;while(t!=i.rightEnd&&o.rightOf(t,e));return t=t.l},del:function(e){e.l.r=e.r,e.r.l=e.l,e.edge=null},right:function(e){return e.r},left:function(e){return e.l},leftRegion:function(e){return null==e.edge?n.bottomSite:e.edge.region[e.side]},rightRegion:function(e){return null==e.edge?n.bottomSite:e.edge.region[Bs[e.side]]}},o={bisect:function(e,t){var n={region:{l:e,r:t},ep:{l:null,r:null}},i=t.x-e.x,o=t.y-e.y,r=i>0?i:-i,a=o>0?o:-o;return n.c=e.x*i+e.y*o+.5*(i*i+o*o),r>a?(n.a=1,n.b=o/i,n.c/=i):(n.b=1,n.a=i/o,n.c/=o),n},intersect:function(e,t){var n=e.edge,i=t.edge;if(!n||!i||n.region.r==i.region.r)return null;var o=n.a*i.b-n.b*i.a;if(1e-10>Math.abs(o))return null;var r,a,s=(n.c*i.b-i.c*n.b)/o,l=(i.c*n.a-n.c*i.a)/o,u=n.region.r,c=i.region.r;u.y<c.y||u.y==c.y&&u.x<c.x?(r=e,a=n):(r=t,a=i);var d=s>=a.region.r.x;return d&&"l"===r.side||!d&&"r"===r.side?null:{x:s,y:l}},rightOf:function(e,t){var n=e.edge,i=n.region.r,o=t.x>i.x;if(o&&"l"===e.side)return 1;if(!o&&"r"===e.side)return 0;if(1===n.a){var r=t.y-i.y,a=t.x-i.x,s=0,l=0;if(!o&&0>n.b||o&&n.b>=0?l=s=r>=n.b*a:(l=t.x+t.y*n.b>n.c,0>n.b&&(l=!l),l||(s=1)),!s){var u=i.x-n.region.l.x;l=n.b*(a*a-r*r)<u*r*(1+2*a/u+n.b*n.b),0>n.b&&(l=!l)}}else{var c=n.c-n.a*t.x,d=t.y-c,h=t.x-i.x,p=c-i.y;l=d*d>h*h+p*p}return"l"===e.side?l:!l},endPoint:function(e,n,i){e.ep[n]=i,e.ep[Bs[n]]&&t(e)},distance:function(e,t){var n=e.x-t.x,i=e.y-t.y;return Math.sqrt(n*n+i*i)}},r={list:[],insert:function(e,t,n){e.vertex=t,e.ystar=t.y+n;for(var i=0,o=r.list,a=o.length;a>i;i++){var s=o[i];if(!(e.ystar>s.ystar||e.ystar==s.ystar&&t.x>s.vertex.x))break}o.splice(i,0,e)},del:function(e){for(var t=0,n=r.list,i=n.length;i>t&&n[t]!=e;++t);n.splice(t,1)},empty:function(){return 0===r.list.length},nextEvent:function(e){for(var t=0,n=r.list,i=n.length;i>t;++t)if(n[t]==e)return n[t+1];return null},min:function(){var e=r.list[0];return{x:e.vertex.x,y:e.ystar}},extractMin:function(){return r.list.shift()}};i.init(),n.bottomSite=n.list.shift();for(var a,s,l,u,c,d,h,p,f,m,g,v,y,b=n.list.shift();;)if(r.empty()||(a=r.min()),b&&(r.empty()||b.y<a.y||b.y==a.y&&b.x<a.x))s=i.leftBound(b),l=i.right(s),h=i.rightRegion(s),v=o.bisect(h,b),d=i.createHalfEdge(v,"l"),i.insert(s,d),m=o.intersect(s,d),m&&(r.del(s),r.insert(s,m,o.distance(m,b))),s=d,d=i.createHalfEdge(v,"r"),i.insert(s,d),m=o.intersect(d,l),m&&r.insert(d,m,o.distance(m,b)),b=n.list.shift();else{if(r.empty())break;s=r.extractMin(),u=i.left(s),l=i.right(s),c=i.right(l),h=i.leftRegion(s),p=i.rightRegion(l),g=s.vertex,o.endPoint(s.edge,s.side,g),o.endPoint(l.edge,l.side,g),i.del(s),r.del(l),i.del(l),y="l",h.y>p.y&&(f=h,h=p,p=f,y="r"),v=o.bisect(h,p),d=i.createHalfEdge(v,y),i.insert(u,d),o.endPoint(v,Bs[y],g),m=o.intersect(u,d),m&&(r.del(u),r.insert(u,m,o.distance(m,h))),m=o.intersect(d,c),m&&r.insert(d,m,o.distance(m,h))}for(s=i.right(i.leftEnd);s!=i.rightEnd;s=i.right(s))t(s.edge)}function ai(e){return e.x}function si(e){return e.y}function li(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function ui(e,t,n,i,o,r){if(!e(t,n,i,o,r)){var a=.5*(n+o),s=.5*(i+r),l=t.nodes;l[0]&&ui(e,l[0],n,i,a,s),l[1]&&ui(e,l[1],a,i,o,s),l[2]&&ui(e,l[2],n,s,a,r),l[3]&&ui(e,l[3],a,s,o,r)}}function ci(e,t){e=sa.rgb(e),t=sa.rgb(t);var n=e.r,i=e.g,o=e.b,r=t.r-n,a=t.g-i,s=t.b-o;return function(e){return"#"+it(Math.round(n+r*e))+it(Math.round(i+a*e))+it(Math.round(o+s*e))}}function di(e){var t=[e.a,e.b],n=[e.c,e.d],i=pi(t),o=hi(t,n),r=pi(fi(n,t,-o))||0;t[0]*n[1]<n[0]*t[1]&&(t[0]*=-1,t[1]*=-1,i*=-1,o*=-1),this.rotate=(i?Math.atan2(t[1],t[0]):Math.atan2(-n[0],n[1]))*za,this.translate=[e.e,e.f],this.scale=[i,r],this.skew=r?Math.atan2(o,r)*za:0}function hi(e,t){return e[0]*t[0]+e[1]*t[1]}function pi(e){var t=Math.sqrt(hi(e,e));return t&&(e[0]/=t,e[1]/=t),t}function fi(e,t,n){return e[0]+=n*t[0],e[1]+=n*t[1],e}function mi(e,t){return t-=e=+e,function(n){return e+t*n}}function gi(e,t){var n,i=[],o=[],r=sa.transform(e),a=sa.transform(t),s=r.translate,l=a.translate,u=r.rotate,c=a.rotate,d=r.skew,h=a.skew,p=r.scale,f=a.scale;return s[0]!=l[0]||s[1]!=l[1]?(i.push("translate(",null,",",null,")"),o.push({i:1,x:mi(s[0],l[0])},{i:3,x:mi(s[1],l[1])})):l[0]||l[1]?i.push("translate("+l+")"):i.push(""),u!=c?(u-c>180?c+=360:c-u>180&&(u+=360),o.push({i:i.push(i.pop()+"rotate(",null,")")-2,x:mi(u,c)})):c&&i.push(i.pop()+"rotate("+c+")"),d!=h?o.push({i:i.push(i.pop()+"skewX(",null,")")-2,x:mi(d,h)}):h&&i.push(i.pop()+"skewX("+h+")"),p[0]!=f[0]||p[1]!=f[1]?(n=i.push(i.pop()+"scale(",null,",",null,")"),o.push({i:n-4,x:mi(p[0],f[0])},{i:n-2,x:mi(p[1],f[1])})):(1!=f[0]||1!=f[1])&&i.push(i.pop()+"scale("+f+")"),n=o.length,function(e){for(var t,r=-1;n>++r;)i[(t=o[r]).i]=t.x(e);return i.join("")}}function vi(e,t){var n,i={},o={};for(n in e)n in t?i[n]=wi(n)(e[n],t[n]):o[n]=e[n];for(n in t)n in e||(o[n]=t[n]);return function(e){for(n in i)o[n]=i[n](e);return o}}function yi(e,t){var n,i,o,r,a,s=0,l=0,u=[],c=[];for(e+="",t+="",js.lastIndex=0,i=0;n=js.exec(t);++i)n.index&&u.push(t.substring(s,l=n.index)),c.push({i:u.length,x:n[0]}),u.push(null),s=js.lastIndex;for(t.length>s&&u.push(t.substring(s)),i=0,r=c.length;(n=js.exec(e))&&r>i;++i)if(a=c[i],a.x==n[0]){if(a.i)if(null==u[a.i+1])for(u[a.i-1]+=a.x,u.splice(a.i,1),o=i+1;r>o;++o)c[o].i--;else for(u[a.i-1]+=a.x+u[a.i+1],u.splice(a.i,2),o=i+1;r>o;++o)c[o].i-=2;else if(null==u[a.i+1])u[a.i]=a.x;else for(u[a.i]=a.x+u[a.i+1],u.splice(a.i+1,1),o=i+1;r>o;++o)c[o].i--;c.splice(i,1),r--,i--}else a.x=mi(parseFloat(n[0]),parseFloat(a.x));for(;r>i;)a=c.pop(),null==u[a.i+1]?u[a.i]=a.x:(u[a.i]=a.x+u[a.i+1],u.splice(a.i+1,1)),r--;return 1===u.length?null==u[0]?(a=c[0].x,function(e){return a(e)+""}):function(){return t}:function(e){for(i=0;r>i;++i)u[(a=c[i]).i]=a.x(e);return u.join("")}}function bi(e,t){for(var n,i=sa.interpolators.length;--i>=0&&!(n=sa.interpolators[i](e,t)););return n}function wi(e){return"transform"==e?gi:bi}function xi(e,t){var n,i=[],o=[],r=e.length,a=t.length,s=Math.min(e.length,t.length);for(n=0;s>n;++n)i.push(bi(e[n],t[n]));for(;r>n;++n)o[n]=e[n];for(;a>n;++n)o[n]=t[n];return function(e){for(n=0;s>n;++n)o[n]=i[n](e);return o}}function _i(e){return function(t){return 0>=t?0:t>=1?1:e(t)}}function Ci(e){return function(t){return 1-e(1-t)}}function Si(e){return function(t){return.5*(.5>t?e(2*t):2-e(2-2*t))}}function Ti(e){return e*e}function Ei(e){return e*e*e}function ki(e){if(0>=e)return 0;if(e>=1)return 1;var t=e*e,n=t*e;return 4*(.5>e?n:3*(e-t)+n-.75)}function Ni(e){return function(t){return Math.pow(t,e)}}function Ai(e){return 1-Math.cos(e*Da/2)}function Mi(e){return Math.pow(2,10*(e-1))}function Pi(e){return 1-Math.sqrt(1-e*e)}function Ri(e,t){var n;return 2>arguments.length&&(t=.45),arguments.length?n=t/(2*Da)*Math.asin(1/e):(e=1,n=t/4),function(i){return 1+e*Math.pow(2,10*-i)*Math.sin(2*(i-n)*Da/t)}}function Oi(e){return e||(e=1.70158),function(t){return t*t*((e+1)*t-e)}}function Ii(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}function Di(e,t){e=sa.hcl(e),t=sa.hcl(t);var n=e.h,i=e.c,o=e.l,r=t.h-n,a=t.c-i,s=t.l-o;return isNaN(a)&&(a=0,i=isNaN(i)?t.c:i),isNaN(r)?(r=0,n=isNaN(n)?t.h:n):r>180?r-=360:-180>r&&(r+=360),function(e){return Q(n+r*e,i+a*e,o+s*e)+""}}function Hi(e,t){e=sa.hsl(e),t=sa.hsl(t);var n=e.h,i=e.s,o=e.l,r=t.h-n,a=t.s-i,s=t.l-o;return isNaN(a)&&(a=0,i=isNaN(i)?t.s:i),isNaN(r)?(r=0,n=isNaN(n)?t.h:n):r>180?r-=360:-180>r&&(r+=360),function(e){return z(n+r*e,i+a*e,o+s*e)+""}}function Li(e,t){e=sa.lab(e),t=sa.lab(t);var n=e.l,i=e.a,o=e.b,r=t.l-n,a=t.a-i,s=t.b-o;return function(e){return Y(n+r*e,i+a*e,o+s*e)+""}}function zi(e,t){return t-=e,function(n){return Math.round(e+t*n)}}function Bi(e,t){return t=t-(e=+e)?1/(t-e):0,function(n){return(n-e)*t
}}function Fi(e,t){return t=t-(e=+e)?1/(t-e):0,function(n){return Math.max(0,Math.min(1,(n-e)*t))}}function ji(e){for(var t=e.source,n=e.target,i=Wi(t,n),o=[t];t!==i;)t=t.parent,o.push(t);for(var r=o.length;n!==i;)o.splice(r,0,n),n=n.parent;return o}function Ui(e){for(var t=[],n=e.parent;null!=n;)t.push(e),e=n,n=n.parent;return t.push(e),t}function Wi(e,t){if(e===t)return e;for(var n=Ui(e),i=Ui(t),o=n.pop(),r=i.pop(),a=null;o===r;)a=o,o=n.pop(),r=i.pop();return a}function Vi(e){e.fixed|=2}function $i(e){e.fixed&=-7}function qi(e){e.fixed|=4,e.px=e.x,e.py=e.y}function Qi(e){e.fixed&=-5}function Gi(e,t,n){var i=0,o=0;if(e.charge=0,!e.leaf)for(var r,a=e.nodes,s=a.length,l=-1;s>++l;)r=a[l],null!=r&&(Gi(r,t,n),e.charge+=r.charge,i+=r.charge*r.cx,o+=r.charge*r.cy);if(e.point){e.leaf||(e.point.x+=Math.random()-.5,e.point.y+=Math.random()-.5);var u=t*n[e.point.index];e.charge+=e.pointCharge=u,i+=u*e.point.x,o+=u*e.point.y}e.cx=i/e.charge,e.cy=o/e.charge}function Xi(e,t){return sa.rebind(e,t,"sort","children","value"),e.nodes=e,e.links=Ji,e}function Yi(e){return e.children}function Zi(e){return e.value}function Ki(e,t){return t.value-e.value}function Ji(e){return sa.merge(e.map(function(e){return(e.children||[]).map(function(t){return{source:e,target:t}})}))}function eo(e){return e.x}function to(e){return e.y}function no(e,t,n){e.y0=t,e.y=n}function io(e){return sa.range(e.length)}function oo(e){for(var t=-1,n=e[0].length,i=[];n>++t;)i[t]=0;return i}function ro(e){for(var t,n=1,i=0,o=e[0][1],r=e.length;r>n;++n)(t=e[n][1])>o&&(i=n,o=t);return i}function ao(e){return e.reduce(so,0)}function so(e,t){return e+t[1]}function lo(e,t){return uo(e,Math.ceil(Math.log(t.length)/Math.LN2+1))}function uo(e,t){for(var n=-1,i=+e[0],o=(e[1]-i)/t,r=[];t>=++n;)r[n]=o*n+i;return r}function co(e){return[sa.min(e),sa.max(e)]}function ho(e,t){return e.parent==t.parent?1:2}function po(e){var t=e.children;return t&&t.length?t[0]:e._tree.thread}function fo(e){var t,n=e.children;return n&&(t=n.length)?n[t-1]:e._tree.thread}function mo(e,t){var n=e.children;if(n&&(o=n.length))for(var i,o,r=-1;o>++r;)t(i=mo(n[r],t),e)>0&&(e=i);return e}function go(e,t){return e.x-t.x}function vo(e,t){return t.x-e.x}function yo(e,t){return e.depth-t.depth}function bo(e,t){function n(e,i){var o=e.children;if(o&&(a=o.length))for(var r,a,s=null,l=-1;a>++l;)r=o[l],n(r,s),s=r;t(e,i)}n(e,null)}function wo(e){for(var t,n=0,i=0,o=e.children,r=o.length;--r>=0;)t=o[r]._tree,t.prelim+=n,t.mod+=n,n+=t.shift+(i+=t.change)}function xo(e,t,n){e=e._tree,t=t._tree;var i=n/(t.number-e.number);e.change+=i,t.change-=i,t.shift+=n,t.prelim+=n,t.mod+=n}function _o(e,t,n){return e._tree.ancestor.parent==t.parent?e._tree.ancestor:n}function Co(e,t){return e.value-t.value}function So(e,t){var n=e._pack_next;e._pack_next=t,t._pack_prev=e,t._pack_next=n,n._pack_prev=t}function To(e,t){e._pack_next=t,t._pack_prev=e}function Eo(e,t){var n=t.x-e.x,i=t.y-e.y,o=e.r+t.r;return o*o-n*n-i*i>.001}function ko(e){function t(e){c=Math.min(e.x-e.r,c),d=Math.max(e.x+e.r,d),h=Math.min(e.y-e.r,h),p=Math.max(e.y+e.r,p)}if((n=e.children)&&(u=n.length)){var n,i,o,r,a,s,l,u,c=1/0,d=-1/0,h=1/0,p=-1/0;if(n.forEach(No),i=n[0],i.x=-i.r,i.y=0,t(i),u>1&&(o=n[1],o.x=o.r,o.y=0,t(o),u>2))for(r=n[2],Po(i,o,r),t(r),So(i,r),i._pack_prev=r,So(r,o),o=i._pack_next,a=3;u>a;a++){Po(i,o,r=n[a]);var f=0,m=1,g=1;for(s=o._pack_next;s!==o;s=s._pack_next,m++)if(Eo(s,r)){f=1;break}if(1==f)for(l=i._pack_prev;l!==s._pack_prev&&!Eo(l,r);l=l._pack_prev,g++);f?(g>m||m==g&&o.r<i.r?To(i,o=s):To(i=l,o),a--):(So(i,r),o=r,t(r))}var v=(c+d)/2,y=(h+p)/2,b=0;for(a=0;u>a;a++)r=n[a],r.x-=v,r.y-=y,b=Math.max(b,r.r+Math.sqrt(r.x*r.x+r.y*r.y));e.r=b,n.forEach(Ao)}}function No(e){e._pack_next=e._pack_prev=e}function Ao(e){delete e._pack_next,delete e._pack_prev}function Mo(e,t,n,i){var o=e.children;if(e.x=t+=i*e.x,e.y=n+=i*e.y,e.r*=i,o)for(var r=-1,a=o.length;a>++r;)Mo(o[r],t,n,i)}function Po(e,t,n){var i=e.r+n.r,o=t.x-e.x,r=t.y-e.y;if(i&&(o||r)){var a=t.r+n.r,s=o*o+r*r;a*=a,i*=i;var l=.5+(i-a)/(2*s),u=Math.sqrt(Math.max(0,2*a*(i+s)-(i-=s)*i-a*a))/(2*s);n.x=e.x+l*o+u*r,n.y=e.y+l*r-u*o}else n.x=e.x+i,n.y=e.y}function Ro(e){return 1+sa.max(e,function(e){return e.y})}function Oo(e){return e.reduce(function(e,t){return e+t.x},0)/e.length}function Io(e){var t=e.children;return t&&t.length?Io(t[0]):e}function Do(e){var t,n=e.children;return n&&(t=n.length)?Do(n[t-1]):e}function Ho(e){return{x:e.x,y:e.y,dx:e.dx,dy:e.dy}}function Lo(e,t){var n=e.x+t[3],i=e.y+t[0],o=e.dx-t[1]-t[3],r=e.dy-t[0]-t[2];return 0>o&&(n+=o/2,o=0),0>r&&(i+=r/2,r=0),{x:n,y:i,dx:o,dy:r}}function zo(e){var t=e[0],n=e[e.length-1];return n>t?[t,n]:[n,t]}function Bo(e){return e.rangeExtent?e.rangeExtent():zo(e.range())}function Fo(e,t,n,i){var o=n(e[0],e[1]),r=i(t[0],t[1]);return function(e){return r(o(e))}}function jo(e,t){var n,i=0,o=e.length-1,r=e[i],a=e[o];return r>a&&(n=i,i=o,o=n,n=r,r=a,a=n),(t=t(a-r))&&(e[i]=t.floor(r),e[o]=t.ceil(a)),e}function Uo(e,t,n,i){var o=[],r=[],a=0,s=Math.min(e.length,t.length)-1;for(e[s]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());s>=++a;)o.push(n(e[a-1],e[a])),r.push(i(t[a-1],t[a]));return function(t){var n=sa.bisect(e,t,1,s)-1;return r[n](o[n](t))}}function Wo(e,t,n,i){function o(){var o=Math.min(e.length,t.length)>2?Uo:Fo,l=i?Fi:Bi;return a=o(e,t,l,n),s=o(t,e,l,bi),r}function r(e){return a(e)}var a,s;return r.invert=function(e){return s(e)},r.domain=function(t){return arguments.length?(e=t.map(Number),o()):e},r.range=function(e){return arguments.length?(t=e,o()):t},r.rangeRound=function(e){return r.range(e).interpolate(zi)},r.clamp=function(e){return arguments.length?(i=e,o()):i},r.interpolate=function(e){return arguments.length?(n=e,o()):n},r.ticks=function(t){return Qo(e,t)},r.tickFormat=function(t,n){return Go(e,t,n)},r.nice=function(){return jo(e,$o),o()},r.copy=function(){return Wo(e,t,n,i)},o()}function Vo(e,t){return sa.rebind(e,t,"range","rangeRound","interpolate","clamp")}function $o(e){return e=Math.pow(10,Math.round(Math.log(e)/Math.LN10)-1),e&&{floor:function(t){return Math.floor(t/e)*e},ceil:function(t){return Math.ceil(t/e)*e}}}function qo(e,t){var n=zo(e),i=n[1]-n[0],o=Math.pow(10,Math.floor(Math.log(i/t)/Math.LN10)),r=t/i*o;return.15>=r?o*=10:.35>=r?o*=5:.75>=r&&(o*=2),n[0]=Math.ceil(n[0]/o)*o,n[1]=Math.floor(n[1]/o)*o+.5*o,n[2]=o,n}function Qo(e,t){return sa.range.apply(sa,qo(e,t))}function Go(e,t,n){var i=-Math.floor(Math.log(qo(e,t)[2])/Math.LN10+.01);return sa.format(n?n.replace(ns,function(e,t,n,o,r,a,s,l,u,c){return[t,n,o,r,a,s,l,u||"."+(i-2*("%"===c)),c].join("")}):",."+i+"f")}function Xo(e,t,n,i,o){function r(t){return e(n(t))}function a(){return n===Yo?{floor:s,ceil:l}:{floor:function(e){return-l(-e)},ceil:function(e){return-s(-e)}}}function s(e){return Math.pow(t,Math.floor(Math.log(e)/Math.log(t)))}function l(e){return Math.pow(t,Math.ceil(Math.log(e)/Math.log(t)))}return r.invert=function(t){return i(e.invert(t))},r.domain=function(t){return arguments.length?(0>t[0]?(n=Ko,i=Jo):(n=Yo,i=Zo),e.domain((o=t.map(Number)).map(n)),r):o},r.base=function(e){return arguments.length?(t=+e,r):t},r.nice=function(){return e.domain(jo(o,a).map(n)),r},r.ticks=function(){var o=zo(e.domain()),r=[];if(o.every(isFinite)){var a=Math.log(t),s=Math.floor(o[0]/a),l=Math.ceil(o[1]/a),u=i(o[0]),c=i(o[1]),d=t%1?2:t;if(n===Ko)for(r.push(-Math.pow(t,-s));l>s++;)for(var h=d-1;h>0;h--)r.push(-Math.pow(t,-s)*h);else{for(;l>s;s++)for(var h=1;d>h;h++)r.push(Math.pow(t,s)*h);r.push(Math.pow(t,s))}for(s=0;u>r[s];s++);for(l=r.length;r[l-1]>c;l--);r=r.slice(s,l)}return r},r.tickFormat=function(e,o){if(2>arguments.length&&(o=Ys),!arguments.length)return o;var a,s=Math.log(t),l=Math.max(.1,e/r.ticks().length),u=n===Ko?(a=-1e-12,Math.floor):(a=1e-12,Math.ceil);return function(e){return l>=e/i(s*u(n(e)/s+a))?o(e):""}},r.copy=function(){return Xo(e.copy(),t,n,i,o)},Vo(r,e)}function Yo(e){return Math.log(0>e?0:e)}function Zo(e){return Math.exp(e)}function Ko(e){return-Math.log(e>0?0:-e)}function Jo(e){return-Math.exp(-e)}function er(e,t,n){function i(t){return e(o(t))}var o=tr(t),r=tr(1/t);return i.invert=function(t){return r(e.invert(t))},i.domain=function(t){return arguments.length?(e.domain((n=t.map(Number)).map(o)),i):n},i.ticks=function(e){return Qo(n,e)},i.tickFormat=function(e,t){return Go(n,e,t)},i.nice=function(){return i.domain(jo(n,$o))},i.exponent=function(a){return arguments.length?(o=tr(t=a),r=tr(1/t),e.domain(n.map(o)),i):t},i.copy=function(){return er(e.copy(),t,n)},Vo(i,e)}function tr(e){return function(t){return 0>t?-Math.pow(-t,e):Math.pow(t,e)}}function nr(e,t){function n(t){return a[((r.get(t)||r.set(t,e.push(t)))-1)%a.length]}function i(t,n){return sa.range(e.length).map(function(e){return t+n*e})}var r,a,s;return n.domain=function(i){if(!arguments.length)return e;e=[],r=new o;for(var a,s=-1,l=i.length;l>++s;)r.has(a=i[s])||r.set(a,e.push(a));return n[t.t].apply(n,t.a)},n.range=function(e){return arguments.length?(a=e,s=0,t={t:"range",a:arguments},n):a},n.rangePoints=function(o,r){2>arguments.length&&(r=0);var l=o[0],u=o[1],c=(u-l)/(Math.max(1,e.length-1)+r);return a=i(2>e.length?(l+u)/2:l+c*r/2,c),s=0,t={t:"rangePoints",a:arguments},n},n.rangeBands=function(o,r,l){2>arguments.length&&(r=0),3>arguments.length&&(l=r);var u=o[1]<o[0],c=o[u-0],d=o[1-u],h=(d-c)/(e.length-r+2*l);return a=i(c+h*l,h),u&&a.reverse(),s=h*(1-r),t={t:"rangeBands",a:arguments},n},n.rangeRoundBands=function(o,r,l){2>arguments.length&&(r=0),3>arguments.length&&(l=r);var u=o[1]<o[0],c=o[u-0],d=o[1-u],h=Math.floor((d-c)/(e.length-r+2*l)),p=d-c-(e.length-r)*h;return a=i(c+Math.round(p/2),h),u&&a.reverse(),s=Math.round(h*(1-r)),t={t:"rangeRoundBands",a:arguments},n},n.rangeBand=function(){return s},n.rangeExtent=function(){return zo(t.a[0])},n.copy=function(){return nr(e,t)},n.domain(e)}function ir(e,t){function n(){var n=0,r=t.length;for(o=[];r>++n;)o[n-1]=sa.quantile(e,n/r);return i}function i(e){return isNaN(e=+e)?0/0:t[sa.bisect(o,e)]}var o;return i.domain=function(t){return arguments.length?(e=t.filter(function(e){return!isNaN(e)}).sort(sa.ascending),n()):e},i.range=function(e){return arguments.length?(t=e,n()):t},i.quantiles=function(){return o},i.copy=function(){return ir(e,t)},n()}function or(e,t,n){function i(t){return n[Math.max(0,Math.min(a,Math.floor(r*(t-e))))]}function o(){return r=n.length/(t-e),a=n.length-1,i}var r,a;return i.domain=function(n){return arguments.length?(e=+n[0],t=+n[n.length-1],o()):[e,t]},i.range=function(e){return arguments.length?(n=e,o()):n},i.copy=function(){return or(e,t,n)},o()}function rr(e,t){function n(n){return t[sa.bisect(e,n)]}return n.domain=function(t){return arguments.length?(e=t,n):e},n.range=function(e){return arguments.length?(t=e,n):t},n.copy=function(){return rr(e,t)},n}function ar(e){function t(e){return+e}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=n.map(t),t):e},t.ticks=function(t){return Qo(e,t)},t.tickFormat=function(t,n){return Go(e,t,n)},t.copy=function(){return ar(e)},t}function sr(e){return e.innerRadius}function lr(e){return e.outerRadius}function ur(e){return e.startAngle}function cr(e){return e.endAngle}function dr(e){for(var t,n,i,o=-1,r=e.length;r>++o;)t=e[o],n=t[0],i=t[1]+tl,t[0]=n*Math.cos(i),t[1]=n*Math.sin(i);return e}function hr(e){function t(t){function l(){m.push("M",s(e(v),d),c,u(e(g.reverse()),d),"Z")}for(var h,p,f,m=[],g=[],v=[],y=-1,b=t.length,w=ut(n),x=ut(o),_=n===i?function(){return p}:ut(i),C=o===r?function(){return f}:ut(r);b>++y;)a.call(this,h=t[y],y)?(g.push([p=+w.call(this,h,y),f=+x.call(this,h,y)]),v.push([+_.call(this,h,y),+C.call(this,h,y)])):g.length&&(l(),g=[],v=[]);return g.length&&l(),m.length?m.join(""):null}var n=Dn,i=Dn,o=0,r=Hn,a=Lt,s=Ln,l=s.key,u=s,c="L",d=.7;return t.x=function(e){return arguments.length?(n=i=e,t):i},t.x0=function(e){return arguments.length?(n=e,t):n},t.x1=function(e){return arguments.length?(i=e,t):i},t.y=function(e){return arguments.length?(o=r=e,t):r},t.y0=function(e){return arguments.length?(o=e,t):o},t.y1=function(e){return arguments.length?(r=e,t):r},t.defined=function(e){return arguments.length?(a=e,t):a},t.interpolate=function(e){return arguments.length?(l="function"==typeof e?s=e:(s=Ds.get(e)||Ln).key,u=s.reverse||s,c=s.closed?"M":"L",t):l},t.tension=function(e){return arguments.length?(d=e,t):d},t}function pr(e){return e.radius}function fr(e){return[e.x,e.y]}function mr(e){return function(){var t=e.apply(this,arguments),n=t[0],i=t[1]+tl;return[n*Math.cos(i),n*Math.sin(i)]}}function gr(){return 64}function vr(){return"circle"}function yr(e){var t=Math.sqrt(e/Da);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function br(e,t){return ba(e,sl),e.id=t,e}function wr(e,t,n,i){var o=e.id;return O(e,"function"==typeof n?function(e,r,a){e.__transition__[o].tween.set(t,i(n.call(e,e.__data__,r,a)))}:(n=i(n),function(e){e.__transition__[o].tween.set(t,n)}))}function xr(e){return null==e&&(e=""),function(){this.textContent=e}}function _r(e,t,n,i){var r=e.__transition__||(e.__transition__={active:0,count:0}),a=r[n];if(!a){var s=i.time;return a=r[n]={tween:new o,event:sa.dispatch("start","end"),time:s,ease:i.ease,delay:i.delay,duration:i.duration},++r.count,sa.timer(function(i){function o(i){return r.active>n?u():(r.active=n,h.start.call(e,c,t),a.tween.forEach(function(n,i){(i=i.call(e,c,t))&&m.push(i)}),l(i)||sa.timer(l,0,s),1)}function l(i){if(r.active!==n)return u();for(var o=(i-p)/f,a=d(o),s=m.length;s>0;)m[--s].call(e,a);return o>=1?(u(),h.end.call(e,c,t),1):void 0}function u(){return--r.count?delete r[n]:delete e.__transition__,1}var c=e.__data__,d=a.ease,h=a.event,p=a.delay,f=a.duration,m=[];return i>=p?o(i):sa.timer(o,p,s),1},0,s),a}}function Cr(e,t){e.attr("transform",function(e){return"translate("+t(e)+",0)"})}function Sr(e,t){e.attr("transform",function(e){return"translate(0,"+t(e)+")"})}function Tr(e,t,n){if(i=[],n&&t.length>1){for(var i,o,r,a=zo(e.domain()),s=-1,l=t.length,u=(t[1]-t[0])/++n;l>++s;)for(o=n;--o>0;)(r=+t[s]-o*u)>=a[0]&&i.push(r);for(--s,o=0;n>++o&&(r=+t[s]+o*u)<a[1];)i.push(r)}return i}function Er(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function kr(e,t,n){function i(t){var n=e(t),i=r(n,1);return i-t>t-n?n:i}function o(n){return t(n=e(new fl(n-1)),1),n}function r(e,n){return t(e=new fl(+e),n),e}function a(e,i,r){var a=o(e),s=[];if(r>1)for(;i>a;)n(a)%r||s.push(new Date(+a)),t(a,1);else for(;i>a;)s.push(new Date(+a)),t(a,1);return s}function s(e,t,n){try{fl=Er;var i=new Er;return i._=e,a(i,t,n)}finally{fl=Date}}e.floor=e,e.round=i,e.ceil=o,e.offset=r,e.range=a;var l=e.utc=Nr(e);return l.floor=l,l.round=Nr(i),l.ceil=Nr(o),l.offset=Nr(r),l.range=s,e}function Nr(e){return function(t,n){try{fl=Er;var i=new Er;return i._=t,e(i,n)._}finally{fl=Date}}}function Ar(e,t,n,i){for(var o,r,a=0,s=t.length,l=n.length;s>a;){if(i>=l)return-1;if(o=t.charCodeAt(a++),37===o){if(r=Rl[t.charAt(a++)],!r||0>(i=r(e,n,i)))return-1}else if(o!=n.charCodeAt(i++))return-1}return i}function Mr(e){return RegExp("^(?:"+e.map(sa.requote).join("|")+")","i")}function Pr(e){for(var t=new o,n=-1,i=e.length;i>++n;)t.set(e[n].toLowerCase(),n);return t}function Rr(e,t,n){e+="";var i=e.length;return n>i?Array(n-i+1).join(t)+e:e}function Or(e,t,n){Tl.lastIndex=0;var i=Tl.exec(t.substring(n));return i?n+=i[0].length:-1}function Ir(e,t,n){Sl.lastIndex=0;var i=Sl.exec(t.substring(n));return i?n+=i[0].length:-1}function Dr(e,t,n){Nl.lastIndex=0;var i=Nl.exec(t.substring(n));return i?(e.m=Al.get(i[0].toLowerCase()),n+=i[0].length):-1}function Hr(e,t,n){El.lastIndex=0;var i=El.exec(t.substring(n));return i?(e.m=kl.get(i[0].toLowerCase()),n+=i[0].length):-1}function Lr(e,t,n){return Ar(e,""+Pl.c,t,n)}function zr(e,t,n){return Ar(e,""+Pl.x,t,n)}function Br(e,t,n){return Ar(e,""+Pl.X,t,n)}function Fr(e,t,n){Ol.lastIndex=0;var i=Ol.exec(t.substring(n,n+4));return i?(e.y=+i[0],n+=i[0].length):-1}function jr(e,t,n){Ol.lastIndex=0;var i=Ol.exec(t.substring(n,n+2));return i?(e.y=Ur(+i[0]),n+=i[0].length):-1}function Ur(e){return e+(e>68?1900:2e3)}function Wr(e,t,n){Ol.lastIndex=0;var i=Ol.exec(t.substring(n,n+2));return i?(e.m=i[0]-1,n+=i[0].length):-1}function Vr(e,t,n){Ol.lastIndex=0;var i=Ol.exec(t.substring(n,n+2));return i?(e.d=+i[0],n+=i[0].length):-1}function $r(e,t,n){Ol.lastIndex=0;var i=Ol.exec(t.substring(n,n+2));return i?(e.H=+i[0],n+=i[0].length):-1}function qr(e,t,n){Ol.lastIndex=0;var i=Ol.exec(t.substring(n,n+2));return i?(e.M=+i[0],n+=i[0].length):-1}function Qr(e,t,n){Ol.lastIndex=0;var i=Ol.exec(t.substring(n,n+2));return i?(e.S=+i[0],n+=i[0].length):-1}function Gr(e,t,n){Ol.lastIndex=0;var i=Ol.exec(t.substring(n,n+3));return i?(e.L=+i[0],n+=i[0].length):-1}function Xr(e,t,n){var i=Il.get(t.substring(n,n+=2).toLowerCase());return null==i?-1:(e.p=i,n)}function Yr(e){var t=e.getTimezoneOffset(),n=t>0?"-":"+",i=~~(Math.abs(t)/60),o=Math.abs(t)%60;return n+Rr(i,"0",2)+Rr(o,"0",2)}function Zr(e){return e.toISOString()}function Kr(e,t,n){function i(t){return e(t)}return i.invert=function(t){return Jr(e.invert(t))},i.domain=function(t){return arguments.length?(e.domain(t),i):e.domain().map(Jr)},i.nice=function(e){return i.domain(jo(i.domain(),function(){return e}))},i.ticks=function(n,o){var r=zo(i.domain());if("function"!=typeof n){var a=r[1]-r[0],s=a/n,l=sa.bisect(Hl,s);if(l==Hl.length)return t.year(r,n);if(!l)return e.ticks(n).map(Jr);Math.log(s/Hl[l-1])<Math.log(Hl[l]/s)&&--l,n=t[l],o=n[1],n=n[0].range}return n(r[0],new Date(+r[1]+1),o)},i.tickFormat=function(){return n},i.copy=function(){return Kr(e.copy(),t,n)},Vo(i,e)}function Jr(e){return new Date(e)}function ea(e){return function(t){for(var n=e.length-1,i=e[n];!i[1](t);)i=e[--n];return i[0](t)}}function ta(e){var t=new Date(e,0,1);return t.setFullYear(e),t}function na(e){var t=e.getFullYear(),n=ta(t),i=ta(t+1);return t+(e-n)/(i-n)}function ia(e){var t=new Date(Date.UTC(e,0,1));return t.setUTCFullYear(e),t}function oa(e){var t=e.getUTCFullYear(),n=ia(t),i=ia(t+1);return t+(e-n)/(i-n)}function ra(e){return JSON.parse(e.responseText)}function aa(e){var t=la.createRange();return t.selectNode(la.body),t.createContextualFragment(e.responseText)}var sa={version:"3.1.10"};Date.now||(Date.now=function(){return+new Date});var la=document,ua=window;try{la.createElement("div").style.setProperty("opacity",0,"")}catch(ca){var da=ua.CSSStyleDeclaration.prototype,ha=da.setProperty;da.setProperty=function(e,t,n){ha.call(this,e,t+"",n)}}sa.ascending=function(e,t){return t>e?-1:e>t?1:e>=t?0:0/0},sa.descending=function(e,t){return e>t?-1:t>e?1:t>=e?0:0/0},sa.min=function(e,t){var n,i,o=-1,r=e.length;if(1===arguments.length){for(;r>++o&&(null==(n=e[o])||n!=n);)n=void 0;for(;r>++o;)null!=(i=e[o])&&n>i&&(n=i)}else{for(;r>++o&&(null==(n=t.call(e,e[o],o))||n!=n);)n=void 0;for(;r>++o;)null!=(i=t.call(e,e[o],o))&&n>i&&(n=i)}return n},sa.max=function(e,t){var n,i,o=-1,r=e.length;if(1===arguments.length){for(;r>++o&&(null==(n=e[o])||n!=n);)n=void 0;for(;r>++o;)null!=(i=e[o])&&i>n&&(n=i)}else{for(;r>++o&&(null==(n=t.call(e,e[o],o))||n!=n);)n=void 0;for(;r>++o;)null!=(i=t.call(e,e[o],o))&&i>n&&(n=i)}return n},sa.extent=function(e,t){var n,i,o,r=-1,a=e.length;if(1===arguments.length){for(;a>++r&&(null==(n=o=e[r])||n!=n);)n=o=void 0;for(;a>++r;)null!=(i=e[r])&&(n>i&&(n=i),i>o&&(o=i))}else{for(;a>++r&&(null==(n=o=t.call(e,e[r],r))||n!=n);)n=void 0;for(;a>++r;)null!=(i=t.call(e,e[r],r))&&(n>i&&(n=i),i>o&&(o=i))}return[n,o]},sa.sum=function(e,t){var n,i=0,o=e.length,r=-1;if(1===arguments.length)for(;o>++r;)isNaN(n=+e[r])||(i+=n);else for(;o>++r;)isNaN(n=+t.call(e,e[r],r))||(i+=n);return i},sa.mean=function(t,n){var i,o=t.length,r=0,a=-1,s=0;if(1===arguments.length)for(;o>++a;)e(i=t[a])&&(r+=(i-r)/++s);else for(;o>++a;)e(i=n.call(t,t[a],a))&&(r+=(i-r)/++s);return s?r:void 0},sa.quantile=function(e,t){var n=(e.length-1)*t+1,i=Math.floor(n),o=+e[i-1],r=n-i;return r?o+r*(e[i]-o):o},sa.median=function(t,n){return arguments.length>1&&(t=t.map(n)),t=t.filter(e),t.length?sa.quantile(t.sort(sa.ascending),.5):void 0},sa.bisector=function(e){return{left:function(t,n,i,o){for(3>arguments.length&&(i=0),4>arguments.length&&(o=t.length);o>i;){var r=i+o>>>1;n>e.call(t,t[r],r)?i=r+1:o=r}return i},right:function(t,n,i,o){for(3>arguments.length&&(i=0),4>arguments.length&&(o=t.length);o>i;){var r=i+o>>>1;e.call(t,t[r],r)>n?o=r:i=r+1}return i}}};var pa=sa.bisector(function(e){return e});sa.bisectLeft=pa.left,sa.bisect=sa.bisectRight=pa.right,sa.shuffle=function(e){for(var t,n,i=e.length;i;)n=0|Math.random()*i--,t=e[i],e[i]=e[n],e[n]=t;return e},sa.permute=function(e,t){for(var n=[],i=-1,o=t.length;o>++i;)n[i]=e[t[i]];return n},sa.zip=function(){if(!(o=arguments.length))return[];for(var e=-1,n=sa.min(arguments,t),i=Array(n);n>++e;)for(var o,r=-1,a=i[e]=Array(o);o>++r;)a[r]=arguments[r][e];return i},sa.transpose=function(e){return sa.zip.apply(sa,e)},sa.keys=function(e){var t=[];for(var n in e)t.push(n);return t},sa.values=function(e){var t=[];for(var n in e)t.push(e[n]);return t},sa.entries=function(e){var t=[];for(var n in e)t.push({key:n,value:e[n]});return t},sa.merge=function(e){return Array.prototype.concat.apply([],e)},sa.range=function(e,t,i){if(3>arguments.length&&(i=1,2>arguments.length&&(t=e,e=0)),1/0===(t-e)/i)throw Error("infinite range");var o,r=[],a=n(Math.abs(i)),s=-1;if(e*=a,t*=a,i*=a,0>i)for(;(o=e+i*++s)>t;)r.push(o/a);else for(;t>(o=e+i*++s);)r.push(o/a);return r},sa.map=function(e){var t=new o;for(var n in e)t.set(n,e[n]);return t},i(o,{has:function(e){return fa+e in this},get:function(e){return this[fa+e]},set:function(e,t){return this[fa+e]=t},remove:function(e){return e=fa+e,e in this&&delete this[e]},keys:function(){var e=[];return this.forEach(function(t){e.push(t)}),e},values:function(){var e=[];return this.forEach(function(t,n){e.push(n)}),e},entries:function(){var e=[];return this.forEach(function(t,n){e.push({key:t,value:n})}),e},forEach:function(e){for(var t in this)t.charCodeAt(0)===ma&&e.call(this,t.substring(1),this[t])}});var fa="\0",ma=fa.charCodeAt(0);sa.nest=function(){function e(t,s,l){if(l>=a.length)return i?i.call(r,s):n?s.sort(n):s;for(var u,c,d,h,p=-1,f=s.length,m=a[l++],g=new o;f>++p;)(h=g.get(u=m(c=s[p])))?h.push(c):g.set(u,[c]);return t?(c=t(),d=function(n,i){c.set(n,e(t,i,l))}):(c={},d=function(n,i){c[n]=e(t,i,l)}),g.forEach(d),c}function t(e,n){if(n>=a.length)return e;var i=[],o=s[n++];return e.forEach(function(e,o){i.push({key:e,values:t(o,n)})}),o?i.sort(function(e,t){return o(e.key,t.key)}):i}var n,i,r={},a=[],s=[];return r.map=function(t,n){return e(n,t,0)},r.entries=function(n){return t(e(sa.map,n,0),0)},r.key=function(e){return a.push(e),r},r.sortKeys=function(e){return s[a.length-1]=e,r},r.sortValues=function(e){return n=e,r},r.rollup=function(e){return i=e,r},r},sa.set=function(e){var t=new r;if(e)for(var n=0;e.length>n;n++)t.add(e[n]);return t},i(r,{has:function(e){return fa+e in this},add:function(e){return this[fa+e]=!0,e},remove:function(e){return e=fa+e,e in this&&delete this[e]},values:function(){var e=[];return this.forEach(function(t){e.push(t)}),e},forEach:function(e){for(var t in this)t.charCodeAt(0)===ma&&e.call(this,t.substring(1))}}),sa.behavior={},sa.rebind=function(e,t){for(var n,i=1,o=arguments.length;o>++i;)e[n=arguments[i]]=a(e,t,t[n]);return e},sa.dispatch=function(){for(var e=new s,t=-1,n=arguments.length;n>++t;)e[arguments[t]]=l(e);return e},s.prototype.on=function(e,t){var n=e.indexOf("."),i="";if(n>=0&&(i=e.substring(n+1),e=e.substring(0,n)),e)return 2>arguments.length?this[e].on(i):this[e].on(i,t);if(2===arguments.length){if(null==t)for(e in this)this.hasOwnProperty(e)&&this[e].on(i,null);return this}},sa.event=null,sa.mouse=function(e){return p(e,c())};var ga=/WebKit/.test(ua.navigator.userAgent)?-1:0,va=m;try{va(la.documentElement.childNodes)[0].nodeType}catch(ya){va=f}var ba=[].__proto__?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)e[n]=t[n]};sa.touches=function(e,t){return 2>arguments.length&&(t=c().touches),t?va(t).map(function(t){var n=p(e,t);return n.identifier=t.identifier,n}):[]},sa.behavior.drag=function(){function e(){this.on("mousedown.drag",t).on("touchstart.drag",t)}function t(){function e(){var e=a.parentNode;return null!=c?sa.touches(e).filter(function(e){return e.identifier===c})[0]:sa.mouse(e)}function t(){if(!a.parentNode)return o();var t=e(),n=t[0]-h[0],i=t[1]-h[1];p|=n|i,h=t,u(),s({type:"drag",x:t[0]+r[0],y:t[1]+r[1],dx:n,dy:i})}function o(){s({type:"dragend"}),p&&(u(),sa.event.target===l&&d(f,"click")),f.on(null!=c?"touchmove.drag-"+c:"mousemove.drag",null).on(null!=c?"touchend.drag-"+c:"mouseup.drag",null)}var r,a=this,s=n.of(a,arguments),l=sa.event.target,c=sa.event.touches?sa.event.changedTouches[0].identifier:null,h=e(),p=0,f=sa.select(ua).on(null!=c?"touchmove.drag-"+c:"mousemove.drag",t).on(null!=c?"touchend.drag-"+c:"mouseup.drag",o,!0);i?(r=i.apply(a,arguments),r=[r.x-h[0],r.y-h[1]]):r=[0,0],null==c&&u(),s({type:"dragstart"})}var n=h(e,"drag","dragstart","dragend"),i=null;return e.origin=function(t){return arguments.length?(i=t,e):i},sa.rebind(e,n,"on")};var wa=function(e,t){return t.querySelector(e)},xa=function(e,t){return t.querySelectorAll(e)},_a=la.documentElement,Ca=_a.matchesSelector||_a.webkitMatchesSelector||_a.mozMatchesSelector||_a.msMatchesSelector||_a.oMatchesSelector,Sa=function(e,t){return Ca.call(e,t)};"function"==typeof Sizzle&&(wa=function(e,t){return Sizzle(e,t)[0]||null},xa=function(e,t){return Sizzle.uniqueSort(Sizzle(e,t))},Sa=Sizzle.matchesSelector),sa.selection=function(){return Ma};var Ta=sa.selection.prototype=[];Ta.select=function(e){var t,n,i,o,r=[];"function"!=typeof e&&(e=v(e));for(var a=-1,s=this.length;s>++a;){r.push(t=[]),t.parentNode=(i=this[a]).parentNode;for(var l=-1,u=i.length;u>++l;)(o=i[l])?(t.push(n=e.call(o,o.__data__,l)),n&&"__data__"in o&&(n.__data__=o.__data__)):t.push(null)}return g(r)},Ta.selectAll=function(e){var t,n,i=[];"function"!=typeof e&&(e=y(e));for(var o=-1,r=this.length;r>++o;)for(var a=this[o],s=-1,l=a.length;l>++s;)(n=a[s])&&(i.push(t=va(e.call(n,n.__data__,s))),t.parentNode=n);return g(i)};var Ea={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};sa.ns={prefix:Ea,qualify:function(e){var t=e.indexOf(":"),n=e;return t>=0&&(n=e.substring(0,t),e=e.substring(t+1)),Ea.hasOwnProperty(n)?{space:Ea[n],local:e}:e}},Ta.attr=function(e,t){if(2>arguments.length){if("string"==typeof e){var n=this.node();return e=sa.ns.qualify(e),e.local?n.getAttributeNS(e.space,e.local):n.getAttribute(e)}for(t in e)this.each(b(t,e[t]));return this}return this.each(b(e,t))},sa.requote=function(e){return e.replace(ka,"\\$&")};var ka=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;Ta.classed=function(e,t){if(2>arguments.length){if("string"==typeof e){var n=this.node(),i=(e=e.trim().split(/^|\s+/g)).length,o=-1;if(t=n.classList){for(;i>++o;)if(!t.contains(e[o]))return!1}else for(t=n.getAttribute("class");i>++o;)if(!x(e[o]).test(t))return!1;return!0}for(t in e)this.each(_(t,e[t]));return this}return this.each(_(e,t))},Ta.style=function(e,t,n){var i=arguments.length;if(3>i){if("string"!=typeof e){2>i&&(t="");for(n in e)this.each(S(n,e[n],t));return this}if(2>i)return ua.getComputedStyle(this.node(),null).getPropertyValue(e);n=""}return this.each(S(e,t,n))},Ta.property=function(e,t){if(2>arguments.length){if("string"==typeof e)return this.node()[e];for(t in e)this.each(T(t,e[t]));return this}return this.each(T(e,t))},Ta.text=function(e){return arguments.length?this.each("function"==typeof e?function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}:null==e?function(){this.textContent=""}:function(){this.textContent=e}):this.node().textContent},Ta.html=function(e){return arguments.length?this.each("function"==typeof e?function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}:null==e?function(){this.innerHTML=""}:function(){this.innerHTML=e}):this.node().innerHTML},Ta.append=function(e){function t(){return this.appendChild(la.createElementNS(this.namespaceURI,e))}function n(){return this.appendChild(la.createElementNS(e.space,e.local))}return e=sa.ns.qualify(e),this.select(e.local?n:t)},Ta.insert=function(e,t){function n(n,i){return this.insertBefore(la.createElementNS(this.namespaceURI,e),t.call(this,n,i))}function i(n,i){return this.insertBefore(la.createElementNS(e.space,e.local),t.call(this,n,i))}return e=sa.ns.qualify(e),"function"!=typeof t&&(t=v(t)),this.select(e.local?i:n)},Ta.remove=function(){return this.each(function(){var e=this.parentNode;e&&e.removeChild(this)})},Ta.data=function(e,t){function n(e,n){var i,r,a,s=e.length,d=n.length,h=Math.min(s,d),p=Array(d),f=Array(d),m=Array(s);if(t){var g,v=new o,y=new o,b=[];for(i=-1;s>++i;)g=t.call(r=e[i],r.__data__,i),v.has(g)?m[i]=r:v.set(g,r),b.push(g);for(i=-1;d>++i;)g=t.call(n,a=n[i],i),(r=v.get(g))?(p[i]=r,r.__data__=a):y.has(g)||(f[i]=E(a)),y.set(g,a),v.remove(g);for(i=-1;s>++i;)v.has(b[i])&&(m[i]=e[i])}else{for(i=-1;h>++i;)r=e[i],a=n[i],r?(r.__data__=a,p[i]=r):f[i]=E(a);for(;d>i;++i)f[i]=E(n[i]);for(;s>i;++i)m[i]=e[i]}f.update=p,f.parentNode=p.parentNode=m.parentNode=e.parentNode,l.push(f),u.push(p),c.push(m)}var i,r,a=-1,s=this.length;if(!arguments.length){for(e=Array(s=(i=this[0]).length);s>++a;)(r=i[a])&&(e[a]=r.__data__);return e}var l=I([]),u=g([]),c=g([]);if("function"==typeof e)for(;s>++a;)n(i=this[a],e.call(i,i.parentNode.__data__,a));else for(;s>++a;)n(i=this[a],e);return u.enter=function(){return l},u.exit=function(){return c},u},Ta.datum=function(e){return arguments.length?this.property("__data__",e):this.property("__data__")},Ta.filter=function(e){var t,n,i,o=[];"function"!=typeof e&&(e=k(e));for(var r=0,a=this.length;a>r;r++){o.push(t=[]),t.parentNode=(n=this[r]).parentNode;for(var s=0,l=n.length;l>s;s++)(i=n[s])&&e.call(i,i.__data__,s)&&t.push(i)}return g(o)},Ta.order=function(){for(var e=-1,t=this.length;t>++e;)for(var n,i=this[e],o=i.length-1,r=i[o];--o>=0;)(n=i[o])&&(r&&r!==n.nextSibling&&r.parentNode.insertBefore(n,r),r=n);return this},Ta.sort=function(e){e=N.apply(this,arguments);for(var t=-1,n=this.length;n>++t;)this[t].sort(e);return this.order()},Ta.on=function(e,t,n){var i=arguments.length;if(3>i){if("string"!=typeof e){2>i&&(t=!1);for(n in e)this.each(M(n,e[n],t));return this}if(2>i)return(i=this.node()["__on"+e])&&i._;n=!1}return this.each(M(e,t,n))};var Na=sa.map({mouseenter:"mouseover",mouseleave:"mouseout"});Na.forEach(function(e){"on"+e in la&&Na.remove(e)}),Ta.each=function(e){return O(this,function(t,n,i){e.call(t,t.__data__,n,i)})},Ta.call=function(e){var t=va(arguments);return e.apply(t[0]=this,t),this},Ta.empty=function(){return!this.node()},Ta.node=function(){for(var e=0,t=this.length;t>e;e++)for(var n=this[e],i=0,o=n.length;o>i;i++){var r=n[i];if(r)return r}return null};var Aa=[];sa.selection.enter=I,sa.selection.enter.prototype=Aa,Aa.append=Ta.append,Aa.insert=Ta.insert,Aa.empty=Ta.empty,Aa.node=Ta.node,Aa.select=function(e){for(var t,n,i,o,r,a=[],s=-1,l=this.length;l>++s;){i=(o=this[s]).update,a.push(t=[]),t.parentNode=o.parentNode;for(var u=-1,c=o.length;c>++u;)(r=o[u])?(t.push(i[u]=n=e.call(o.parentNode,r.__data__,u)),n.__data__=r.__data__):t.push(null)}return g(a)},Ta.transition=function(){var e,t,n=ol||++ll,i=[],o=Object.create(ul);o.time=Date.now();for(var r=-1,a=this.length;a>++r;){i.push(e=[]);for(var s=this[r],l=-1,u=s.length;u>++l;)(t=s[l])&&_r(t,l,n,o),e.push(t)}return br(i,n)},sa.select=function(e){var t=["string"==typeof e?wa(e,la):e];return t.parentNode=_a,g([t])},sa.selectAll=function(e){var t=va("string"==typeof e?xa(e,la):e);return t.parentNode=_a,g([t])};var Ma=sa.select(_a);sa.behavior.zoom=function(){function e(){this.on("mousedown.zoom",s).on("mousemove.zoom",c).on(Oa+".zoom",l).on("dblclick.zoom",p).on("touchstart.zoom",f).on("touchmove.zoom",m).on("touchend.zoom",f)}function t(e){return[(e[0]-C[0])/S,(e[1]-C[1])/S]}function n(e){return[e[0]*S+C[0],e[1]*S+C[1]]
}function i(e){S=Math.max(T[0],Math.min(T[1],e))}function o(e,t){t=n(t),C[0]+=e[0]-t[0],C[1]+=e[1]-t[1]}function r(){b&&b.domain(y.range().map(function(e){return(e-C[0])/S}).map(y.invert)),x&&x.domain(w.range().map(function(e){return(e-C[1])/S}).map(w.invert))}function a(e){r(),sa.event.preventDefault(),e({type:"zoom",scale:S,translate:C})}function s(){function e(){l=1,o(sa.mouse(i),h),a(r)}function n(){l&&u(),c.on("mousemove.zoom",null).on("mouseup.zoom",null),l&&sa.event.target===s&&d(c,"click.zoom")}var i=this,r=E.of(i,arguments),s=sa.event.target,l=0,c=sa.select(ua).on("mousemove.zoom",e).on("mouseup.zoom",n),h=t(sa.mouse(i));ua.focus(),u()}function l(){g||(g=t(sa.mouse(this))),i(Math.pow(2,.002*Pa())*S),o(sa.mouse(this),g),a(E.of(this,arguments))}function c(){g=null}function p(){var e=sa.mouse(this),n=t(e),r=Math.log(S)/Math.LN2;i(Math.pow(2,sa.event.shiftKey?Math.ceil(r)-1:Math.floor(r)+1)),o(e,n),a(E.of(this,arguments))}function f(){var e=sa.touches(this),n=Date.now();if(v=S,g={},e.forEach(function(e){g[e.identifier]=t(e)}),u(),1===e.length){if(500>n-_){var r=e[0],s=t(e[0]);i(2*S),o(r,s),a(E.of(this,arguments))}_=n}}function m(){var e=sa.touches(this),t=e[0],n=g[t.identifier];if(r=e[1]){var r,s=g[r.identifier];t=[(t[0]+r[0])/2,(t[1]+r[1])/2],n=[(n[0]+s[0])/2,(n[1]+s[1])/2],i(sa.event.scale*v)}o(t,n),_=null,a(E.of(this,arguments))}var g,v,y,b,w,x,_,C=[0,0],S=1,T=Ra,E=h(e,"zoom");return e.translate=function(t){return arguments.length?(C=t.map(Number),r(),e):C},e.scale=function(t){return arguments.length?(S=+t,r(),e):S},e.scaleExtent=function(t){return arguments.length?(T=null==t?Ra:t.map(Number),e):T},e.x=function(t){return arguments.length?(b=t,y=t.copy(),C=[0,0],S=1,e):b},e.y=function(t){return arguments.length?(x=t,w=t.copy(),C=[0,0],S=1,e):x},sa.rebind(e,E,"on")};var Pa,Ra=[0,1/0],Oa="onwheel"in la?(Pa=function(){return-sa.event.deltaY*(sa.event.deltaMode?120:1)},"wheel"):"onmousewheel"in la?(Pa=function(){return sa.event.wheelDelta},"mousewheel"):(Pa=function(){return-sa.event.detail},"MozMousePixelScroll");D.prototype.toString=function(){return this.rgb()+""},sa.hsl=function(e,t,n){return 1===arguments.length?e instanceof L?H(e.h,e.s,e.l):ot(""+e,rt,H):H(+e,+t,+n)};var Ia=L.prototype=new D;Ia.brighter=function(e){return e=Math.pow(.7,arguments.length?e:1),H(this.h,this.s,this.l/e)},Ia.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),H(this.h,this.s,e*this.l)},Ia.rgb=function(){return z(this.h,this.s,this.l)};var Da=Math.PI,Ha=1e-6,La=Da/180,za=180/Da;sa.hcl=function(e,t,n){return 1===arguments.length?e instanceof q?$(e.h,e.c,e.l):e instanceof X?Z(e.l,e.a,e.b):Z((e=at((e=sa.rgb(e)).r,e.g,e.b)).l,e.a,e.b):$(+e,+t,+n)};var Ba=q.prototype=new D;Ba.brighter=function(e){return $(this.h,this.c,Math.min(100,this.l+Fa*(arguments.length?e:1)))},Ba.darker=function(e){return $(this.h,this.c,Math.max(0,this.l-Fa*(arguments.length?e:1)))},Ba.rgb=function(){return Q(this.h,this.c,this.l).rgb()},sa.lab=function(e,t,n){return 1===arguments.length?e instanceof X?G(e.l,e.a,e.b):e instanceof q?Q(e.l,e.c,e.h):at((e=sa.rgb(e)).r,e.g,e.b):G(+e,+t,+n)};var Fa=18,ja=.95047,Ua=1,Wa=1.08883,Va=X.prototype=new D;Va.brighter=function(e){return G(Math.min(100,this.l+Fa*(arguments.length?e:1)),this.a,this.b)},Va.darker=function(e){return G(Math.max(0,this.l-Fa*(arguments.length?e:1)),this.a,this.b)},Va.rgb=function(){return Y(this.l,this.a,this.b)},sa.rgb=function(e,t,n){return 1===arguments.length?e instanceof nt?tt(e.r,e.g,e.b):ot(""+e,tt,z):tt(~~e,~~t,~~n)};var $a=nt.prototype=new D;$a.brighter=function(e){e=Math.pow(.7,arguments.length?e:1);var t=this.r,n=this.g,i=this.b,o=30;return t||n||i?(t&&o>t&&(t=o),n&&o>n&&(n=o),i&&o>i&&(i=o),tt(Math.min(255,Math.floor(t/e)),Math.min(255,Math.floor(n/e)),Math.min(255,Math.floor(i/e)))):tt(o,o,o)},$a.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),tt(Math.floor(e*this.r),Math.floor(e*this.g),Math.floor(e*this.b))},$a.hsl=function(){return rt(this.r,this.g,this.b)},$a.toString=function(){return"#"+it(this.r)+it(this.g)+it(this.b)};var qa=sa.map({aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"});qa.forEach(function(e,t){qa.set(e,ot(t,tt,z))}),sa.functor=ut,sa.xhr=dt(ct),sa.csv=ft(",","text/csv"),sa.tsv=ft("	","text/tab-separated-values");var Qa,Ga,Xa,Ya;sa.timer=function(e,t,n){if(3>arguments.length){if(2>arguments.length)t=0;else if(!isFinite(t))return;n=Date.now()}var i=n+t,o={callback:e,time:i,next:null};Ga?Ga.next=o:Qa=o,Ga=o,Xa||(Ya=clearTimeout(Ya),Xa=1,Za(mt))},sa.timer.flush=function(){gt(),vt()};var Za=ua.requestAnimationFrame||ua.webkitRequestAnimationFrame||ua.mozRequestAnimationFrame||ua.oRequestAnimationFrame||ua.msRequestAnimationFrame||function(e){setTimeout(e,17)},Ka=".",Ja=",",es=[3,3],ts=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map(yt);sa.formatPrefix=function(e,t){var n=0;return e&&(0>e&&(e*=-1),t&&(e=sa.round(e,bt(e,t))),n=1+Math.floor(1e-12+Math.log(e)/Math.LN10),n=Math.max(-24,Math.min(24,3*Math.floor((0>=n?n+1:n-1)/3)))),ts[8+n/3]},sa.round=function(e,t){return t?Math.round(e*(t=Math.pow(10,t)))/t:Math.round(e)},sa.format=function(e){var t=ns.exec(e),n=t[1]||" ",i=t[2]||">",o=t[3]||"",r=t[4]||"",a=t[5],s=+t[6],l=t[7],u=t[8],c=t[9],d=1,h="",p=!1;switch(u&&(u=+u.substring(1)),(a||"0"===n&&"="===i)&&(a=n="0",i="=",l&&(s-=Math.floor((s-1)/4))),c){case"n":l=!0,c="g";break;case"%":d=100,h="%",c="f";break;case"p":d=100,h="%",c="r";break;case"b":case"o":case"x":case"X":r&&(r="0"+c.toLowerCase());case"c":case"d":p=!0,u=0;break;case"s":d=-1,c="r"}"#"===r&&(r=""),"r"!=c||u||(c="g"),null!=u&&("g"==c?u=Math.max(1,Math.min(21,u)):("e"==c||"f"==c)&&(u=Math.max(0,Math.min(20,u)))),c=is.get(c)||wt;var f=a&&l;return function(e){if(p&&e%1)return"";var t=0>e||0===e&&0>1/e?(e=-e,"-"):o;if(0>d){var m=sa.formatPrefix(e,u);e=m.scale(e),h=m.symbol}else e*=d;e=c(e,u),!a&&l&&(e=os(e));var g=r.length+e.length+(f?0:t.length),v=s>g?Array(g=s-g+1).join(n):"";return f&&(e=os(v+e)),Ka&&e.replace(".",Ka),t+=r,("<"===i?t+e+v:">"===i?v+t+e:"^"===i?v.substring(0,g>>=1)+t+e+v.substring(g):t+(f?e:v+e))+h}};var ns=/(?:([^{])?([<>=^]))?([+\- ])?(#)?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,is=sa.map({b:function(e){return e.toString(2)},c:function(e){return String.fromCharCode(e)},o:function(e){return e.toString(8)},x:function(e){return e.toString(16)},X:function(e){return e.toString(16).toUpperCase()},g:function(e,t){return e.toPrecision(t)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},r:function(e,t){return(e=sa.round(e,bt(e,t))).toFixed(Math.max(0,Math.min(20,bt(e*(1+1e-15),t))))}}),os=ct;if(es){var rs=es.length;os=function(e){for(var t=e.lastIndexOf("."),n=t>=0?"."+e.substring(t+1):(t=e.length,""),i=[],o=0,r=es[0];t>0&&r>0;)i.push(e.substring(t-=r,t+r)),r=es[o=(o+1)%rs];return i.reverse().join(Ja||"")+n}}sa.geo={},sa.geo.stream=function(e,t){e&&as.hasOwnProperty(e.type)?as[e.type](e,t):xt(e,t)};var as={Feature:function(e,t){xt(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,o=n.length;o>++i;)xt(n[i].geometry,t)}},ss={Sphere:function(e,t){t.sphere()},Point:function(e,t){var n=e.coordinates;t.point(n[0],n[1])},MultiPoint:function(e,t){for(var n,i=e.coordinates,o=-1,r=i.length;r>++o;)n=i[o],t.point(n[0],n[1])},LineString:function(e,t){_t(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,o=n.length;o>++i;)_t(n[i],t,0)},Polygon:function(e,t){Ct(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,o=n.length;o>++i;)Ct(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,o=n.length;o>++i;)xt(n[i],t)}};sa.geo.area=function(e){return ls=0,sa.geo.stream(e,cs),ls};var ls,us,cs={sphere:function(){ls+=4*Da},point:A,lineStart:A,lineEnd:A,polygonStart:function(){us=0,cs.lineStart=St},polygonEnd:function(){var e=2*us;ls+=0>e?4*Da+e:e,cs.lineStart=cs.lineEnd=cs.point=A}};sa.geo.bounds=function(){function e(e,t){b.push(w=[c=e,h=e]),d>t&&(d=t),t>p&&(p=t)}function t(t,n){var i=Tt([t*La,n*La]);if(v){var o=kt(v,i),r=[o[1],-o[0],0],a=kt(r,o);Mt(a),a=Pt(a);var l=t-f,u=l>0?1:-1,m=a[0]*za*u,g=Math.abs(l)>180;if(g^(m>u*f&&u*t>m)){var y=a[1]*za;y>p&&(p=y)}else if(m=(m+360)%360-180,g^(m>u*f&&u*t>m)){var y=-a[1]*za;d>y&&(d=y)}else d>n&&(d=n),n>p&&(p=n);g?f>t?s(c,t)>s(c,h)&&(h=t):s(t,h)>s(c,h)&&(c=t):h>=c?(c>t&&(c=t),t>h&&(h=t)):t>f?s(c,t)>s(c,h)&&(h=t):s(t,h)>s(c,h)&&(c=t)}else e(t,n);v=i,f=t}function n(){x.point=t}function i(){w[0]=c,w[1]=h,x.point=e,v=null}function o(e,n){if(v){var i=e-f;y+=Math.abs(i)>180?i+(i>0?360:-360):i}else m=e,g=n;cs.point(e,n),t(e,n)}function r(){cs.lineStart()}function a(){o(m,g),cs.lineEnd(),Math.abs(y)>Ha&&(c=-(h=180)),w[0]=c,w[1]=h,v=null}function s(e,t){return 0>(t-=e)?t+360:t}function l(e,t){return e[0]-t[0]}function u(e,t){return t[0]<=t[1]?e>=t[0]&&t[1]>=e:t[0]>e||e>t[1]}var c,d,h,p,f,m,g,v,y,b,w,x={point:e,lineStart:n,lineEnd:i,polygonStart:function(){x.point=o,x.lineStart=r,x.lineEnd=a,y=0,cs.polygonStart()},polygonEnd:function(){cs.polygonEnd(),x.point=e,x.lineStart=n,x.lineEnd=i,0>us?(c=-(h=180),d=-(p=90)):y>Ha?p=90:-Ha>y&&(d=-90),w[0]=c,w[1]=h}};return function(e){p=h=-(c=d=1/0),b=[],sa.geo.stream(e,x),b.sort(l);for(var t,n=1,i=b.length,o=b[0],r=[o];i>n;++n)t=b[n],u(t[0],o)||u(t[1],o)?(s(o[0],t[1])>s(o[0],o[1])&&(o[1]=t[1]),s(t[0],o[1])>s(o[0],o[1])&&(o[0]=t[0])):r.push(o=t);for(var a,t,f=-1/0,i=r.length-1,n=0,o=r[i];i>=n;o=t,++n)t=r[n],(a=s(o[1],t[0]))>f&&(f=a,c=t[0],h=o[1]);return b=w=null,[[c,d],[h,p]]}}(),sa.geo.centroid=function(e){ds=hs=ps=fs=ms=0,sa.geo.stream(e,gs);var t;return hs&&Math.abs(t=Math.sqrt(ps*ps+fs*fs+ms*ms))>Ha?[Math.atan2(fs,ps)*za,Math.asin(Math.max(-1,Math.min(1,ms/t)))*za]:void 0};var ds,hs,ps,fs,ms,gs={sphere:function(){2>ds&&(ds=2,hs=ps=fs=ms=0)},point:Ot,lineStart:Dt,lineEnd:Ht,polygonStart:function(){2>ds&&(ds=2,hs=ps=fs=ms=0),gs.lineStart=It},polygonEnd:function(){gs.lineStart=Dt}},vs=Ft(Lt,$t,Qt),ys=1e9;sa.geo.projection=Jt,sa.geo.projectionMutator=en,(sa.geo.equirectangular=function(){return Jt(nn)}).raw=nn.invert=nn,sa.geo.rotation=function(e){function t(t){return t=e(t[0]*La,t[1]*La),t[0]*=za,t[1]*=za,t}return e=on(e[0]%360*La,e[1]*La,e.length>2?e[2]*La:0),t.invert=function(t){return t=e.invert(t[0]*La,t[1]*La),t[0]*=za,t[1]*=za,t},t},sa.geo.circle=function(){function e(){var e="function"==typeof i?i.apply(this,arguments):i,t=on(-e[0]*La,-e[1]*La,0).invert,o=[];return n(null,null,1,{point:function(e,n){o.push(e=t(e,n)),e[0]*=za,e[1]*=za}}),{type:"Polygon",coordinates:[o]}}var t,n,i=[0,0],o=6;return e.origin=function(t){return arguments.length?(i=t,e):i},e.angle=function(i){return arguments.length?(n=ln((t=+i)*La,o*La),e):t},e.precision=function(i){return arguments.length?(n=ln(t*La,(o=+i)*La),e):o},e.angle(90)},sa.geo.distance=function(e,t){var n,i=(t[0]-e[0])*La,o=e[1]*La,r=t[1]*La,a=Math.sin(i),s=Math.cos(i),l=Math.sin(o),u=Math.cos(o),c=Math.sin(r),d=Math.cos(r);return Math.atan2(Math.sqrt((n=d*a)*n+(n=u*c-l*d*s)*n),l*c+u*d*s)},sa.geo.graticule=function(){function e(){return{type:"MultiLineString",coordinates:t()}}function t(){return sa.range(Math.ceil(r/g)*g,o,g).map(h).concat(sa.range(Math.ceil(u/v)*v,l,v).map(p)).concat(sa.range(Math.ceil(i/f)*f,n,f).filter(function(e){return Math.abs(e%g)>Ha}).map(c)).concat(sa.range(Math.ceil(s/m)*m,a,m).filter(function(e){return Math.abs(e%v)>Ha}).map(d))}var n,i,o,r,a,s,l,u,c,d,h,p,f=10,m=f,g=90,v=360,y=2.5;return e.lines=function(){return t().map(function(e){return{type:"LineString",coordinates:e}})},e.outline=function(){return{type:"Polygon",coordinates:[h(r).concat(p(l).slice(1),h(o).reverse().slice(1),p(u).reverse().slice(1))]}},e.extent=function(t){return arguments.length?e.majorExtent(t).minorExtent(t):e.minorExtent()},e.majorExtent=function(t){return arguments.length?(r=+t[0][0],o=+t[1][0],u=+t[0][1],l=+t[1][1],r>o&&(t=r,r=o,o=t),u>l&&(t=u,u=l,l=t),e.precision(y)):[[r,u],[o,l]]},e.minorExtent=function(t){return arguments.length?(i=+t[0][0],n=+t[1][0],s=+t[0][1],a=+t[1][1],i>n&&(t=i,i=n,n=t),s>a&&(t=s,s=a,a=t),e.precision(y)):[[i,s],[n,a]]},e.step=function(t){return arguments.length?e.majorStep(t).minorStep(t):e.minorStep()},e.majorStep=function(t){return arguments.length?(g=+t[0],v=+t[1],e):[g,v]},e.minorStep=function(t){return arguments.length?(f=+t[0],m=+t[1],e):[f,m]},e.precision=function(t){return arguments.length?(y=+t,c=cn(s,a,90),d=dn(i,n,y),h=cn(u,l,90),p=dn(r,o,y),e):y},e.majorExtent([[-180,-90+Ha],[180,90-Ha]]).minorExtent([[-180,-80-Ha],[180,80+Ha]])},sa.geo.greatArc=function(){function e(){return{type:"LineString",coordinates:[t||i.apply(this,arguments),n||o.apply(this,arguments)]}}var t,n,i=hn,o=pn;return e.distance=function(){return sa.geo.distance(t||i.apply(this,arguments),n||o.apply(this,arguments))},e.source=function(n){return arguments.length?(i=n,t="function"==typeof n?null:n,e):i},e.target=function(t){return arguments.length?(o=t,n="function"==typeof t?null:t,e):o},e.precision=function(){return arguments.length?e:0},e},sa.geo.interpolate=function(e,t){return fn(e[0]*La,e[1]*La,t[0]*La,t[1]*La)},sa.geo.length=function(e){return bs=0,sa.geo.stream(e,ws),bs};var bs,ws={sphere:A,point:A,lineStart:mn,lineEnd:A,polygonStart:A,polygonEnd:A};(sa.geo.conicEqualArea=function(){return gn(vn)}).raw=vn,sa.geo.albers=function(){return sa.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},sa.geo.albersUsa=function(){function e(e){var r=e[0],a=e[1];return t=null,n(r,a),t||(i(r,a),t)||o(r,a),t}var t,n,i,o,r=sa.geo.albers(),a=sa.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),s=sa.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),l={point:function(e,n){t=[e,n]}};return e.invert=function(e){var t=r.scale(),n=r.translate(),i=(e[0]-n[0])/t,o=(e[1]-n[1])/t;return(o>=.12&&.234>o&&i>=-.425&&-.214>i?a:o>=.166&&.234>o&&i>=-.214&&-.115>i?s:r).invert(e)},e.stream=function(e){var t=r.stream(e),n=a.stream(e),i=s.stream(e);return{point:function(e,o){t.point(e,o),n.point(e,o),i.point(e,o)},sphere:function(){t.sphere(),n.sphere(),i.sphere()},lineStart:function(){t.lineStart(),n.lineStart(),i.lineStart()},lineEnd:function(){t.lineEnd(),n.lineEnd(),i.lineEnd()},polygonStart:function(){t.polygonStart(),n.polygonStart(),i.polygonStart()},polygonEnd:function(){t.polygonEnd(),n.polygonEnd(),i.polygonEnd()}}},e.precision=function(t){return arguments.length?(r.precision(t),a.precision(t),s.precision(t),e):r.precision()},e.scale=function(t){return arguments.length?(r.scale(t),a.scale(.35*t),s.scale(t),e.translate(r.translate())):r.scale()},e.translate=function(t){if(!arguments.length)return r.translate();var u=r.scale(),c=+t[0],d=+t[1];return n=r.translate(t).clipExtent([[c-.455*u,d-.238*u],[c+.455*u,d+.238*u]]).stream(l).point,i=a.translate([c-.307*u,d+.201*u]).clipExtent([[c-.425*u+Ha,d+.12*u+Ha],[c-.214*u-Ha,d+.234*u-Ha]]).stream(l).point,o=s.translate([c-.205*u,d+.212*u]).clipExtent([[c-.214*u+Ha,d+.166*u+Ha],[c-.115*u-Ha,d+.234*u-Ha]]).stream(l).point,e},e.scale(1070)};var xs,_s,Cs,Ss,Ts,Es,ks={point:A,lineStart:A,lineEnd:A,polygonStart:function(){_s=0,ks.lineStart=yn},polygonEnd:function(){ks.lineStart=ks.lineEnd=ks.point=A,xs+=Math.abs(_s/2)}},Ns={point:bn,lineStart:A,lineEnd:A,polygonStart:A,polygonEnd:A},As={point:_n,lineStart:Cn,lineEnd:Sn,polygonStart:function(){As.lineStart=Tn},polygonEnd:function(){As.point=_n,As.lineStart=Cn,As.lineEnd=Sn}};sa.geo.path=function(){function e(e){return e&&sa.geo.stream(e,i(o.pointRadius("function"==typeof r?+r.apply(this,arguments):r))),o.result()}var t,n,i,o,r=4.5;return e.area=function(e){return xs=0,sa.geo.stream(e,i(ks)),xs},e.centroid=function(e){return ds=ps=fs=ms=0,sa.geo.stream(e,i(As)),ms?[ps/ms,fs/ms]:void 0},e.bounds=function(e){return Ts=Es=-(Cs=Ss=1/0),sa.geo.stream(e,i(Ns)),[[Cs,Ss],[Ts,Es]]},e.projection=function(n){return arguments.length?(i=(t=n)?n.stream||kn(n):ct,e):t},e.context=function(t){return arguments.length?(o=null==(n=t)?new wn:new En(t),e):n},e.pointRadius=function(t){return arguments.length?(r="function"==typeof t?t:+t,e):r},e.projection(sa.geo.albersUsa()).context(null)};var Ms=Nn(function(e){return Math.sqrt(2/(1+e))},function(e){return 2*Math.asin(e/2)});(sa.geo.azimuthalEqualArea=function(){return Jt(Ms)}).raw=Ms;var Ps=Nn(function(e){var t=Math.acos(e);return t&&t/Math.sin(t)},ct);(sa.geo.azimuthalEquidistant=function(){return Jt(Ps)}).raw=Ps,(sa.geo.conicConformal=function(){return gn(An)}).raw=An,(sa.geo.conicEquidistant=function(){return gn(Mn)}).raw=Mn;var Rs=Nn(function(e){return 1/e},Math.atan);(sa.geo.gnomonic=function(){return Jt(Rs)}).raw=Rs,Pn.invert=function(e,t){return[e,2*Math.atan(Math.exp(t))-Da/2]},(sa.geo.mercator=function(){return Rn(Pn)}).raw=Pn;var Os=Nn(function(){return 1},Math.asin);(sa.geo.orthographic=function(){return Jt(Os)}).raw=Os;var Is=Nn(function(e){return 1/(1+e)},function(e){return 2*Math.atan(e)});(sa.geo.stereographic=function(){return Jt(Is)}).raw=Is,On.invert=function(e,t){return[Math.atan2(U(e),Math.cos(t)),j(Math.sin(t)/W(e))]},(sa.geo.transverseMercator=function(){return Rn(On)}).raw=On,sa.geom={},sa.svg={},sa.svg.line=function(){return In(ct)};var Ds=sa.map({linear:Ln,"linear-closed":zn,"step-before":Bn,"step-after":Fn,basis:qn,"basis-open":Qn,"basis-closed":Gn,bundle:Xn,cardinal:Wn,"cardinal-open":jn,"cardinal-closed":Un,monotone:ti});Ds.forEach(function(e,t){t.key=e,t.closed=/-closed$/.test(e)});var Hs=[0,2/3,1/3,0],Ls=[0,1/3,2/3,0],zs=[0,1/6,2/3,1/6];sa.geom.hull=function(e){function t(e){if(3>e.length)return[];var t,o,r,a,s,l,u,c,d,h,p,f,m=ut(n),g=ut(i),v=e.length,y=v-1,b=[],w=[],x=0;if(m===Dn&&i===Hn)t=e;else for(r=0,t=[];v>r;++r)t.push([+m.call(this,o=e[r],r),+g.call(this,o,r)]);for(r=1;v>r;++r)(t[r][1]<t[x][1]||t[r][1]==t[x][1]&&t[r][0]<t[x][0])&&(x=r);for(r=0;v>r;++r)r!==x&&(l=t[r][1]-t[x][1],s=t[r][0]-t[x][0],b.push({angle:Math.atan2(l,s),index:r}));for(b.sort(function(e,t){return e.angle-t.angle}),p=b[0].angle,h=b[0].index,d=0,r=1;y>r;++r){if(a=b[r].index,p==b[r].angle){if(s=t[h][0]-t[x][0],l=t[h][1]-t[x][1],u=t[a][0]-t[x][0],c=t[a][1]-t[x][1],s*s+l*l>=u*u+c*c){b[r].index=-1;continue}b[d].index=-1}p=b[r].angle,d=r,h=a}for(w.push(x),r=0,a=0;2>r;++a)b[a].index>-1&&(w.push(b[a].index),r++);for(f=w.length;y>a;++a)if(!(0>b[a].index)){for(;!ni(w[f-2],w[f-1],b[a].index,t);)--f;w[f++]=b[a].index}var _=[];for(r=f-1;r>=0;--r)_.push(e[w[r]]);return _}var n=Dn,i=Hn;return arguments.length?t(e):(t.x=function(e){return arguments.length?(n=e,t):n},t.y=function(e){return arguments.length?(i=e,t):i},t)},sa.geom.polygon=function(e){return e.area=function(){for(var t=0,n=e.length,i=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];n>++t;)i+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return.5*i},e.centroid=function(t){var n,i,o=-1,r=e.length,a=0,s=0,l=e[r-1];for(arguments.length||(t=-1/(6*e.area()));r>++o;)n=l,l=e[o],i=n[0]*l[1]-l[0]*n[1],a+=(n[0]+l[0])*i,s+=(n[1]+l[1])*i;return[a*t,s*t]},e.clip=function(t){for(var n,i,o,r,a,s,l=-1,u=e.length,c=e[u-1];u>++l;){for(n=t.slice(),t.length=0,r=e[l],a=n[(o=n.length)-1],i=-1;o>++i;)s=n[i],ii(s,c,r)?(ii(a,c,r)||t.push(oi(a,s,c,r)),t.push(s)):ii(a,c,r)&&t.push(oi(a,s,c,r)),a=s;c=r}return t},e},sa.geom.delaunay=function(e){var t=e.map(function(){return[]}),n=[];return ri(e,function(n){t[n.region.l.index].push(e[n.region.r.index])}),t.forEach(function(t,i){var o=e[i],r=o[0],a=o[1];t.forEach(function(e){e.angle=Math.atan2(e[0]-r,e[1]-a)}),t.sort(function(e,t){return e.angle-t.angle});for(var s=0,l=t.length-1;l>s;s++)n.push([o,t[s],t[s+1]])}),n},sa.geom.voronoi=function(e){function t(e){var t,i,a,s=e.map(function(){return[]}),l=ut(o),u=ut(r),c=e.length,d=1e6;if(l===Dn&&u===Hn)t=e;else for(t=[],a=0;c>a;++a)t.push([+l.call(this,i=e[a],a),+u.call(this,i,a)]);if(ri(t,function(e){var t,n,i,o,r,a;1===e.a&&e.b>=0?(t=e.ep.r,n=e.ep.l):(t=e.ep.l,n=e.ep.r),1===e.a?(r=t?t.y:-d,i=e.c-e.b*r,a=n?n.y:d,o=e.c-e.b*a):(i=t?t.x:-d,r=e.c-e.a*i,o=n?n.x:d,a=e.c-e.a*o);var l=[i,r],u=[o,a];s[e.region.l.index].push(l,u),s[e.region.r.index].push(l,u)}),s=s.map(function(e,n){var i=t[n][0],o=t[n][1],r=e.map(function(e){return Math.atan2(e[0]-i,e[1]-o)}),a=sa.range(e.length).sort(function(e,t){return r[e]-r[t]});return a.filter(function(e,t){return!t||r[e]-r[a[t-1]]>Ha}).map(function(t){return e[t]})}),s.forEach(function(e,n){var i=e.length;if(!i)return e.push([-d,-d],[-d,d],[d,d],[d,-d]);if(!(i>2)){var o=t[n],r=e[0],a=e[1],s=o[0],l=o[1],u=r[0],c=r[1],h=a[0],p=a[1],f=Math.abs(h-u),m=p-c;if(Ha>Math.abs(m)){var g=c>l?-d:d;e.push([-d,g],[d,g])}else if(Ha>f){var v=u>s?-d:d;e.push([v,-d],[v,d])}else{var g=(u-s)*(p-c)>(h-u)*(c-l)?d:-d,y=Math.abs(m)-f;Ha>Math.abs(y)?e.push([0>m?g:-g,g]):(y>0&&(g*=-1),e.push([-d,g],[d,g]))}}}),n)for(a=0;c>a;++a)n(s[a]);for(a=0;c>a;++a)s[a].point=e[a];return s}var n,i=null,o=Dn,r=Hn;return arguments.length?t(e):(t.x=function(e){return arguments.length?(o=e,t):o},t.y=function(e){return arguments.length?(r=e,t):r},t.size=function(e){return arguments.length?(null==e?n=null:(i=[+e[0],+e[1]],n=sa.geom.polygon([[0,0],[0,i[1]],i,[i[0],0]]).clip),t):i},t.links=function(e){var t,n,i,a=e.map(function(){return[]}),s=[],l=ut(o),u=ut(r),c=e.length;if(l===Dn&&u===Hn)t=e;else for(i=0;c>i;++i)t.push([+l.call(this,n=e[i],i),+u.call(this,n,i)]);return ri(t,function(t){var n=t.region.l.index,i=t.region.r.index;a[n][i]||(a[n][i]=a[i][n]=!0,s.push({source:e[n],target:e[i]}))}),s},t.triangles=function(e){if(o===Dn&&r===Hn)return sa.geom.delaunay(e);var t,n,i,a,s,l=ut(o),u=ut(r);for(a=0,t=[],s=e.length;s>a;++a)n=[+l.call(this,i=e[a],a),+u.call(this,i,a)],n.data=i,t.push(n);return sa.geom.delaunay(t).map(function(e){return e.map(function(e){return e.data})})},t)};var Bs={l:"r",r:"l"};sa.geom.quadtree=function(e,t,n,i,o){function r(e){function r(e,t,n,i,o,r,a,s){if(!isNaN(n)&&!isNaN(i))if(e.leaf){var l=e.x,c=e.y;if(null!=l)if(.01>Math.abs(l-n)+Math.abs(c-i))u(e,t,n,i,o,r,a,s);else{var d=e.point;e.x=e.y=e.point=null,u(e,d,l,c,o,r,a,s),u(e,t,n,i,o,r,a,s)}else e.x=n,e.y=i,e.point=t}else u(e,t,n,i,o,r,a,s)}function u(e,t,n,i,o,a,s,l){var u=.5*(o+s),c=.5*(a+l),d=n>=u,h=i>=c,p=(h<<1)+d;e.leaf=!1,e=e.nodes[p]||(e.nodes[p]=li()),d?o=u:s=u,h?a=c:l=c,r(e,t,n,i,o,a,s,l)}var c,d,h,p,f,m,g,v,y,b=ut(s),w=ut(l);if(null!=t)m=t,g=n,v=i,y=o;else if(v=y=-(m=g=1/0),d=[],h=[],f=e.length,a)for(p=0;f>p;++p)c=e[p],m>c.x&&(m=c.x),g>c.y&&(g=c.y),c.x>v&&(v=c.x),c.y>y&&(y=c.y),d.push(c.x),h.push(c.y);else for(p=0;f>p;++p){var x=+b(c=e[p],p),_=+w(c,p);m>x&&(m=x),g>_&&(g=_),x>v&&(v=x),_>y&&(y=_),d.push(x),h.push(_)}var C=v-m,S=y-g;C>S?y=g+C:v=m+S;var T=li();if(T.add=function(e){r(T,e,+b(e,++p),+w(e,p),m,g,v,y)},T.visit=function(e){ui(e,T,m,g,v,y)},p=-1,null==t){for(;f>++p;)r(T,e[p],d[p],h[p],m,g,v,y);--p}else e.forEach(T.add);return d=h=e=c=null,T}var a,s=Dn,l=Hn;return(a=arguments.length)?(s=ai,l=si,3===a&&(o=n,i=t,n=t=0),r(e)):(r.x=function(e){return arguments.length?(s=e,r):s},r.y=function(e){return arguments.length?(l=e,r):l},r.size=function(e){return arguments.length?(null==e?t=n=i=o=null:(t=n=0,i=+e[0],o=+e[1]),r):null==t?null:[i,o]},r)},sa.interpolateRgb=ci,sa.transform=function(e){var t=la.createElementNS(sa.ns.prefix.svg,"g");return(sa.transform=function(e){if(null!=e){t.setAttribute("transform",e);var n=t.transform.baseVal.consolidate()}return new di(n?n.matrix:Fs)})(e)},di.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var Fs={a:1,b:0,c:0,d:1,e:0,f:0};sa.interpolateNumber=mi,sa.interpolateTransform=gi,sa.interpolateObject=vi,sa.interpolateString=yi;var js=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g;sa.interpolate=bi,sa.interpolators=[function(e,t){var n=typeof t;return("string"===n?qa.has(t)||/^(#|rgb\(|hsl\()/.test(t)?ci:yi:t instanceof D?ci:"object"===n?Array.isArray(t)?xi:vi:mi)(e,t)}],sa.interpolateArray=xi;var Us=function(){return ct},Ws=sa.map({linear:Us,poly:Ni,quad:function(){return Ti},cubic:function(){return Ei},sin:function(){return Ai},exp:function(){return Mi},circle:function(){return Pi},elastic:Ri,back:Oi,bounce:function(){return Ii}}),Vs=sa.map({"in":ct,out:Ci,"in-out":Si,"out-in":function(e){return Si(Ci(e))}});sa.ease=function(e){var t=e.indexOf("-"),n=t>=0?e.substring(0,t):e,i=t>=0?e.substring(t+1):"in";return n=Ws.get(n)||Us,i=Vs.get(i)||ct,_i(i(n.apply(null,Array.prototype.slice.call(arguments,1))))},sa.interpolateHcl=Di,sa.interpolateHsl=Hi,sa.interpolateLab=Li,sa.interpolateRound=zi,sa.layout={},sa.layout.bundle=function(){return function(e){for(var t=[],n=-1,i=e.length;i>++n;)t.push(ji(e[n]));return t}},sa.layout.chord=function(){function e(){var e,u,d,h,p,f={},m=[],g=sa.range(r),v=[];for(n=[],i=[],e=0,h=-1;r>++h;){for(u=0,p=-1;r>++p;)u+=o[h][p];m.push(u),v.push(sa.range(r)),e+=u}for(a&&g.sort(function(e,t){return a(m[e],m[t])}),s&&v.forEach(function(e,t){e.sort(function(e,n){return s(o[t][e],o[t][n])})}),e=(2*Da-c*r)/e,u=0,h=-1;r>++h;){for(d=u,p=-1;r>++p;){var y=g[h],b=v[y][p],w=o[y][b],x=u,_=u+=w*e;f[y+"-"+b]={index:y,subindex:b,startAngle:x,endAngle:_,value:w}}i[y]={index:y,startAngle:d,endAngle:u,value:(u-d)/e},u+=c}for(h=-1;r>++h;)for(p=h-1;r>++p;){var C=f[h+"-"+p],S=f[p+"-"+h];(C.value||S.value)&&n.push(C.value<S.value?{source:S,target:C}:{source:C,target:S})}l&&t()}function t(){n.sort(function(e,t){return l((e.source.value+e.target.value)/2,(t.source.value+t.target.value)/2)})}var n,i,o,r,a,s,l,u={},c=0;return u.matrix=function(e){return arguments.length?(r=(o=e)&&o.length,n=i=null,u):o},u.padding=function(e){return arguments.length?(c=e,n=i=null,u):c},u.sortGroups=function(e){return arguments.length?(a=e,n=i=null,u):a},u.sortSubgroups=function(e){return arguments.length?(s=e,n=null,u):s},u.sortChords=function(e){return arguments.length?(l=e,n&&t(),u):l},u.chords=function(){return n||e(),n},u.groups=function(){return i||e(),i},u},sa.layout.force=function(){function e(e){return function(t,n,i,o){if(t.point!==e){var r=t.cx-e.x,a=t.cy-e.y,s=1/Math.sqrt(r*r+a*a);if(m>(o-n)*s){var l=t.charge*s*s;return e.px-=r*l,e.py-=a*l,!0}if(t.point&&isFinite(s)){var l=t.pointCharge*s*s;e.px-=r*l,e.py-=a*l}}return!t.charge}}function t(e){e.px=sa.event.x,e.py=sa.event.y,s.resume()}var n,i,o,r,a,s={},l=sa.dispatch("start","tick","end"),u=[1,1],c=.9,d=$s,h=qs,p=-30,f=.1,m=.8,g=[],v=[];return s.tick=function(){if(.005>(i*=.99))return l.end({type:"end",alpha:i=0}),!0;var t,n,s,d,h,m,y,b,w,x=g.length,_=v.length;for(n=0;_>n;++n)s=v[n],d=s.source,h=s.target,b=h.x-d.x,w=h.y-d.y,(m=b*b+w*w)&&(m=i*r[n]*((m=Math.sqrt(m))-o[n])/m,b*=m,w*=m,h.x-=b*(y=d.weight/(h.weight+d.weight)),h.y-=w*y,d.x+=b*(y=1-y),d.y+=w*y);if((y=i*f)&&(b=u[0]/2,w=u[1]/2,n=-1,y))for(;x>++n;)s=g[n],s.x+=(b-s.x)*y,s.y+=(w-s.y)*y;if(p)for(Gi(t=sa.geom.quadtree(g),i,a),n=-1;x>++n;)(s=g[n]).fixed||t.visit(e(s));for(n=-1;x>++n;)s=g[n],s.fixed?(s.x=s.px,s.y=s.py):(s.x-=(s.px-(s.px=s.x))*c,s.y-=(s.py-(s.py=s.y))*c);l.tick({type:"tick",alpha:i})},s.nodes=function(e){return arguments.length?(g=e,s):g},s.links=function(e){return arguments.length?(v=e,s):v},s.size=function(e){return arguments.length?(u=e,s):u},s.linkDistance=function(e){return arguments.length?(d="function"==typeof e?e:+e,s):d},s.distance=s.linkDistance,s.linkStrength=function(e){return arguments.length?(h="function"==typeof e?e:+e,s):h},s.friction=function(e){return arguments.length?(c=+e,s):c},s.charge=function(e){return arguments.length?(p="function"==typeof e?e:+e,s):p},s.gravity=function(e){return arguments.length?(f=+e,s):f},s.theta=function(e){return arguments.length?(m=+e,s):m},s.alpha=function(e){return arguments.length?(e=+e,i?i=e>0?e:0:e>0&&(l.start({type:"start",alpha:i=e}),sa.timer(s.tick)),s):i},s.start=function(){function e(e,i){for(var o,r=t(n),a=-1,s=r.length;s>++a;)if(!isNaN(o=r[a][e]))return o;return Math.random()*i}function t(){if(!l){for(l=[],i=0;f>i;++i)l[i]=[];for(i=0;m>i;++i){var e=v[i];l[e.source.index].push(e.target),l[e.target.index].push(e.source)}}return l[n]}var n,i,l,c,f=g.length,m=v.length,y=u[0],b=u[1];for(n=0;f>n;++n)(c=g[n]).index=n,c.weight=0;for(n=0;m>n;++n)c=v[n],"number"==typeof c.source&&(c.source=g[c.source]),"number"==typeof c.target&&(c.target=g[c.target]),++c.source.weight,++c.target.weight;for(n=0;f>n;++n)c=g[n],isNaN(c.x)&&(c.x=e("x",y)),isNaN(c.y)&&(c.y=e("y",b)),isNaN(c.px)&&(c.px=c.x),isNaN(c.py)&&(c.py=c.y);if(o=[],"function"==typeof d)for(n=0;m>n;++n)o[n]=+d.call(this,v[n],n);else for(n=0;m>n;++n)o[n]=d;if(r=[],"function"==typeof h)for(n=0;m>n;++n)r[n]=+h.call(this,v[n],n);else for(n=0;m>n;++n)r[n]=h;if(a=[],"function"==typeof p)for(n=0;f>n;++n)a[n]=+p.call(this,g[n],n);else for(n=0;f>n;++n)a[n]=p;return s.resume()},s.resume=function(){return s.alpha(.1)},s.stop=function(){return s.alpha(0)},s.drag=function(){return n||(n=sa.behavior.drag().origin(ct).on("dragstart.force",Vi).on("drag.force",t).on("dragend.force",$i)),arguments.length?(this.on("mouseover.force",qi).on("mouseout.force",Qi).call(n),void 0):n},sa.rebind(s,l,"on")};var $s=20,qs=1;sa.layout.hierarchy=function(){function e(t,a,s){var l=o.call(n,t,a);if(t.depth=a,s.push(t),l&&(u=l.length)){for(var u,c,d=-1,h=t.children=[],p=0,f=a+1;u>++d;)c=e(l[d],f,s),c.parent=t,h.push(c),p+=c.value;i&&h.sort(i),r&&(t.value=p)}else r&&(t.value=+r.call(n,t,a)||0);
return t}function t(e,i){var o=e.children,a=0;if(o&&(s=o.length))for(var s,l=-1,u=i+1;s>++l;)a+=t(o[l],u);else r&&(a=+r.call(n,e,i)||0);return r&&(e.value=a),a}function n(t){var n=[];return e(t,0,n),n}var i=Ki,o=Yi,r=Zi;return n.sort=function(e){return arguments.length?(i=e,n):i},n.children=function(e){return arguments.length?(o=e,n):o},n.value=function(e){return arguments.length?(r=e,n):r},n.revalue=function(e){return t(e,0),e},n},sa.layout.partition=function(){function e(t,n,i,o){var r=t.children;if(t.x=n,t.y=t.depth*o,t.dx=i,t.dy=o,r&&(a=r.length)){var a,s,l,u=-1;for(i=t.value?i/t.value:0;a>++u;)e(s=r[u],n,l=s.value*i,o),n+=l}}function t(e){var n=e.children,i=0;if(n&&(o=n.length))for(var o,r=-1;o>++r;)i=Math.max(i,t(n[r]));return 1+i}function n(n,r){var a=i.call(this,n,r);return e(a[0],0,o[0],o[1]/t(a[0])),a}var i=sa.layout.hierarchy(),o=[1,1];return n.size=function(e){return arguments.length?(o=e,n):o},Xi(n,i)},sa.layout.pie=function(){function e(r){var a=r.map(function(n,i){return+t.call(e,n,i)}),s=+("function"==typeof i?i.apply(this,arguments):i),l=(("function"==typeof o?o.apply(this,arguments):o)-s)/sa.sum(a),u=sa.range(r.length);null!=n&&u.sort(n===Qs?function(e,t){return a[t]-a[e]}:function(e,t){return n(r[e],r[t])});var c=[];return u.forEach(function(e){var t;c[e]={data:r[e],value:t=a[e],startAngle:s,endAngle:s+=t*l}}),c}var t=Number,n=Qs,i=0,o=2*Da;return e.value=function(n){return arguments.length?(t=n,e):t},e.sort=function(t){return arguments.length?(n=t,e):n},e.startAngle=function(t){return arguments.length?(i=t,e):i},e.endAngle=function(t){return arguments.length?(o=t,e):o},e};var Qs={};sa.layout.stack=function(){function e(s,l){var u=s.map(function(n,i){return t.call(e,n,i)}),c=u.map(function(t){return t.map(function(t,n){return[r.call(e,t,n),a.call(e,t,n)]})}),d=n.call(e,c,l);u=sa.permute(u,d),c=sa.permute(c,d);var h,p,f,m=i.call(e,c,l),g=u.length,v=u[0].length;for(p=0;v>p;++p)for(o.call(e,u[0][p],f=m[p],c[0][p][1]),h=1;g>h;++h)o.call(e,u[h][p],f+=c[h-1][p][1],c[h][p][1]);return s}var t=ct,n=io,i=oo,o=no,r=eo,a=to;return e.values=function(n){return arguments.length?(t=n,e):t},e.order=function(t){return arguments.length?(n="function"==typeof t?t:Gs.get(t)||io,e):n},e.offset=function(t){return arguments.length?(i="function"==typeof t?t:Xs.get(t)||oo,e):i},e.x=function(t){return arguments.length?(r=t,e):r},e.y=function(t){return arguments.length?(a=t,e):a},e.out=function(t){return arguments.length?(o=t,e):o},e};var Gs=sa.map({"inside-out":function(e){var t,n,i=e.length,o=e.map(ro),r=e.map(ao),a=sa.range(i).sort(function(e,t){return o[e]-o[t]}),s=0,l=0,u=[],c=[];for(t=0;i>t;++t)n=a[t],l>s?(s+=r[n],u.push(n)):(l+=r[n],c.push(n));return c.reverse().concat(u)},reverse:function(e){return sa.range(e.length).reverse()},"default":io}),Xs=sa.map({silhouette:function(e){var t,n,i,o=e.length,r=e[0].length,a=[],s=0,l=[];for(n=0;r>n;++n){for(t=0,i=0;o>t;t++)i+=e[t][n][1];i>s&&(s=i),a.push(i)}for(n=0;r>n;++n)l[n]=(s-a[n])/2;return l},wiggle:function(e){var t,n,i,o,r,a,s,l,u,c=e.length,d=e[0],h=d.length,p=[];for(p[0]=l=u=0,n=1;h>n;++n){for(t=0,o=0;c>t;++t)o+=e[t][n][1];for(t=0,r=0,s=d[n][0]-d[n-1][0];c>t;++t){for(i=0,a=(e[t][n][1]-e[t][n-1][1])/(2*s);t>i;++i)a+=(e[i][n][1]-e[i][n-1][1])/s;r+=a*e[t][n][1]}p[n]=l-=o?r/o*s:0,u>l&&(u=l)}for(n=0;h>n;++n)p[n]-=u;return p},expand:function(e){var t,n,i,o=e.length,r=e[0].length,a=1/o,s=[];for(n=0;r>n;++n){for(t=0,i=0;o>t;t++)i+=e[t][n][1];if(i)for(t=0;o>t;t++)e[t][n][1]/=i;else for(t=0;o>t;t++)e[t][n][1]=a}for(n=0;r>n;++n)s[n]=0;return s},zero:oo});sa.layout.histogram=function(){function e(e,r){for(var a,s,l=[],u=e.map(n,this),c=i.call(this,u,r),d=o.call(this,c,u,r),r=-1,h=u.length,p=d.length-1,f=t?1:1/h;p>++r;)a=l[r]=[],a.dx=d[r+1]-(a.x=d[r]),a.y=0;if(p>0)for(r=-1;h>++r;)s=u[r],s>=c[0]&&c[1]>=s&&(a=l[sa.bisect(d,s,1,p)-1],a.y+=f,a.push(e[r]));return l}var t=!0,n=Number,i=co,o=lo;return e.value=function(t){return arguments.length?(n=t,e):n},e.range=function(t){return arguments.length?(i=ut(t),e):i},e.bins=function(t){return arguments.length?(o="number"==typeof t?function(e){return uo(e,t)}:ut(t),e):o},e.frequency=function(n){return arguments.length?(t=!!n,e):t},e},sa.layout.tree=function(){function e(e,o){function r(e,t){var i=e.children,o=e._tree;if(i&&(a=i.length)){for(var a,l,u,c=i[0],d=c,h=-1;a>++h;)u=i[h],r(u,l),d=s(u,l,d),l=u;wo(e);var p=.5*(c._tree.prelim+u._tree.prelim);t?(o.prelim=t._tree.prelim+n(e,t),o.mod=o.prelim-p):o.prelim=p}else t&&(o.prelim=t._tree.prelim+n(e,t))}function a(e,t){e.x=e._tree.prelim+t;var n=e.children;if(n&&(i=n.length)){var i,o=-1;for(t+=e._tree.mod;i>++o;)a(n[o],t)}}function s(e,t,i){if(t){for(var o,r=e,a=e,s=t,l=e.parent.children[0],u=r._tree.mod,c=a._tree.mod,d=s._tree.mod,h=l._tree.mod;s=fo(s),r=po(r),s&&r;)l=po(l),a=fo(a),a._tree.ancestor=e,o=s._tree.prelim+d-r._tree.prelim-u+n(s,r),o>0&&(xo(_o(s,e,i),e,o),u+=o,c+=o),d+=s._tree.mod,u+=r._tree.mod,h+=l._tree.mod,c+=a._tree.mod;s&&!fo(a)&&(a._tree.thread=s,a._tree.mod+=d-c),r&&!po(l)&&(l._tree.thread=r,l._tree.mod+=u-h,i=e)}return i}var l=t.call(this,e,o),u=l[0];bo(u,function(e,t){e._tree={ancestor:e,prelim:0,mod:0,change:0,shift:0,number:t?t._tree.number+1:0}}),r(u),a(u,-u._tree.prelim);var c=mo(u,vo),d=mo(u,go),h=mo(u,yo),p=c.x-n(c,d)/2,f=d.x+n(d,c)/2,m=h.depth||1;return bo(u,function(e){e.x=(e.x-p)/(f-p)*i[0],e.y=e.depth/m*i[1],delete e._tree}),l}var t=sa.layout.hierarchy().sort(null).value(null),n=ho,i=[1,1];return e.separation=function(t){return arguments.length?(n=t,e):n},e.size=function(t){return arguments.length?(i=t,e):i},Xi(e,t)},sa.layout.pack=function(){function e(e,o){var r=t.call(this,e,o),a=r[0];a.x=0,a.y=0,bo(a,function(e){e.r=Math.sqrt(e.value)}),bo(a,ko);var s=i[0],l=i[1],u=Math.max(2*a.r/s,2*a.r/l);if(n>0){var c=n*u/2;bo(a,function(e){e.r+=c}),bo(a,ko),bo(a,function(e){e.r-=c}),u=Math.max(2*a.r/s,2*a.r/l)}return Mo(a,s/2,l/2,1/u),r}var t=sa.layout.hierarchy().sort(Co),n=0,i=[1,1];return e.size=function(t){return arguments.length?(i=t,e):i},e.padding=function(t){return arguments.length?(n=+t,e):n},Xi(e,t)},sa.layout.cluster=function(){function e(e,o){var r,a=t.call(this,e,o),s=a[0],l=0;bo(s,function(e){var t=e.children;t&&t.length?(e.x=Oo(t),e.y=Ro(t)):(e.x=r?l+=n(e,r):0,e.y=0,r=e)});var u=Io(s),c=Do(s),d=u.x-n(u,c)/2,h=c.x+n(c,u)/2;return bo(s,function(e){e.x=(e.x-d)/(h-d)*i[0],e.y=(1-(s.y?e.y/s.y:1))*i[1]}),a}var t=sa.layout.hierarchy().sort(null).value(null),n=ho,i=[1,1];return e.separation=function(t){return arguments.length?(n=t,e):n},e.size=function(t){return arguments.length?(i=t,e):i},Xi(e,t)},sa.layout.treemap=function(){function e(e,t){for(var n,i,o=-1,r=e.length;r>++o;)i=(n=e[o]).value*(0>t?0:t),n.area=isNaN(i)||0>=i?0:i}function t(n){var r=n.children;if(r&&r.length){var a,s,l,u=d(n),c=[],h=r.slice(),f=1/0,m="slice"===p?u.dx:"dice"===p?u.dy:"slice-dice"===p?1&n.depth?u.dy:u.dx:Math.min(u.dx,u.dy);for(e(h,u.dx*u.dy/n.value),c.area=0;(l=h.length)>0;)c.push(a=h[l-1]),c.area+=a.area,"squarify"!==p||f>=(s=i(c,m))?(h.pop(),f=s):(c.area-=c.pop().area,o(c,m,u,!1),m=Math.min(u.dx,u.dy),c.length=c.area=0,f=1/0);c.length&&(o(c,m,u,!0),c.length=c.area=0),r.forEach(t)}}function n(t){var i=t.children;if(i&&i.length){var r,a=d(t),s=i.slice(),l=[];for(e(s,a.dx*a.dy/t.value),l.area=0;r=s.pop();)l.push(r),l.area+=r.area,null!=r.z&&(o(l,r.z?a.dx:a.dy,a,!s.length),l.length=l.area=0);i.forEach(n)}}function i(e,t){for(var n,i=e.area,o=0,r=1/0,a=-1,s=e.length;s>++a;)(n=e[a].area)&&(r>n&&(r=n),n>o&&(o=n));return i*=i,t*=t,i?Math.max(t*o*f/i,i/(t*r*f)):1/0}function o(e,t,n,i){var o,r=-1,a=e.length,s=n.x,u=n.y,c=t?l(e.area/t):0;if(t==n.dx){for((i||c>n.dy)&&(c=n.dy);a>++r;)o=e[r],o.x=s,o.y=u,o.dy=c,s+=o.dx=Math.min(n.x+n.dx-s,c?l(o.area/c):0);o.z=!0,o.dx+=n.x+n.dx-s,n.y+=c,n.dy-=c}else{for((i||c>n.dx)&&(c=n.dx);a>++r;)o=e[r],o.x=s,o.y=u,o.dx=c,u+=o.dy=Math.min(n.y+n.dy-u,c?l(o.area/c):0);o.z=!1,o.dy+=n.y+n.dy-u,n.x+=c,n.dx-=c}}function r(i){var o=a||s(i),r=o[0];return r.x=0,r.y=0,r.dx=u[0],r.dy=u[1],a&&s.revalue(r),e([r],r.dx*r.dy/r.value),(a?n:t)(r),h&&(a=o),o}var a,s=sa.layout.hierarchy(),l=Math.round,u=[1,1],c=null,d=Ho,h=!1,p="squarify",f=.5*(1+Math.sqrt(5));return r.size=function(e){return arguments.length?(u=e,r):u},r.padding=function(e){function t(t){var n=e.call(r,t,t.depth);return null==n?Ho(t):Lo(t,"number"==typeof n?[n,n,n,n]:n)}function n(t){return Lo(t,e)}if(!arguments.length)return c;var i;return d=null==(c=e)?Ho:"function"==(i=typeof e)?t:"number"===i?(e=[e,e,e,e],n):n,r},r.round=function(e){return arguments.length?(l=e?Math.round:Number,r):l!=Number},r.sticky=function(e){return arguments.length?(h=e,a=null,r):h},r.ratio=function(e){return arguments.length?(f=e,r):f},r.mode=function(e){return arguments.length?(p=e+"",r):p},Xi(r,s)},sa.random={normal:function(e,t){var n=arguments.length;return 2>n&&(t=1),1>n&&(e=0),function(){var n,i,o;do n=2*Math.random()-1,i=2*Math.random()-1,o=n*n+i*i;while(!o||o>1);return e+t*n*Math.sqrt(-2*Math.log(o)/o)}},logNormal:function(){var e=sa.random.normal.apply(sa,arguments);return function(){return Math.exp(e())}},irwinHall:function(e){return function(){for(var t=0,n=0;e>n;n++)t+=Math.random();return t/e}}},sa.scale={},sa.scale.linear=function(){return Wo([0,1],[0,1],bi,!1)},sa.scale.log=function(){return Xo(sa.scale.linear().domain([0,Math.LN10]),10,Yo,Zo,[1,10])};var Ys=sa.format(".0e");sa.scale.pow=function(){return er(sa.scale.linear(),1,[0,1])},sa.scale.sqrt=function(){return sa.scale.pow().exponent(.5)},sa.scale.ordinal=function(){return nr([],{t:"range",a:[[]]})},sa.scale.category10=function(){return sa.scale.ordinal().range(Zs)},sa.scale.category20=function(){return sa.scale.ordinal().range(Ks)},sa.scale.category20b=function(){return sa.scale.ordinal().range(Js)},sa.scale.category20c=function(){return sa.scale.ordinal().range(el)};var Zs=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],Ks=["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],Js=["#393b79","#5254a3","#6b6ecf","#9c9ede","#637939","#8ca252","#b5cf6b","#cedb9c","#8c6d31","#bd9e39","#e7ba52","#e7cb94","#843c39","#ad494a","#d6616b","#e7969c","#7b4173","#a55194","#ce6dbd","#de9ed6"],el=["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"];sa.scale.quantile=function(){return ir([],[])},sa.scale.quantize=function(){return or(0,1,[0,1])},sa.scale.threshold=function(){return rr([.5],[0,1])},sa.scale.identity=function(){return ar([0,1])},sa.svg.arc=function(){function e(){var e=t.apply(this,arguments),r=n.apply(this,arguments),a=i.apply(this,arguments)+tl,s=o.apply(this,arguments)+tl,l=(a>s&&(l=a,a=s,s=l),s-a),u=Da>l?"0":"1",c=Math.cos(a),d=Math.sin(a),h=Math.cos(s),p=Math.sin(s);return l>=nl?e?"M0,"+r+"A"+r+","+r+" 0 1,1 0,"+-r+"A"+r+","+r+" 0 1,1 0,"+r+"M0,"+e+"A"+e+","+e+" 0 1,0 0,"+-e+"A"+e+","+e+" 0 1,0 0,"+e+"Z":"M0,"+r+"A"+r+","+r+" 0 1,1 0,"+-r+"A"+r+","+r+" 0 1,1 0,"+r+"Z":e?"M"+r*c+","+r*d+"A"+r+","+r+" 0 "+u+",1 "+r*h+","+r*p+"L"+e*h+","+e*p+"A"+e+","+e+" 0 "+u+",0 "+e*c+","+e*d+"Z":"M"+r*c+","+r*d+"A"+r+","+r+" 0 "+u+",1 "+r*h+","+r*p+"L0,0"+"Z"}var t=sr,n=lr,i=ur,o=cr;return e.innerRadius=function(n){return arguments.length?(t=ut(n),e):t},e.outerRadius=function(t){return arguments.length?(n=ut(t),e):n},e.startAngle=function(t){return arguments.length?(i=ut(t),e):i},e.endAngle=function(t){return arguments.length?(o=ut(t),e):o},e.centroid=function(){var e=(t.apply(this,arguments)+n.apply(this,arguments))/2,r=(i.apply(this,arguments)+o.apply(this,arguments))/2+tl;return[Math.cos(r)*e,Math.sin(r)*e]},e};var tl=-Da/2,nl=2*Da-1e-6;sa.svg.line.radial=function(){var e=In(dr);return e.radius=e.x,delete e.x,e.angle=e.y,delete e.y,e},Bn.reverse=Fn,Fn.reverse=Bn,sa.svg.area=function(){return hr(ct)},sa.svg.area.radial=function(){var e=hr(dr);return e.radius=e.x,delete e.x,e.innerRadius=e.x0,delete e.x0,e.outerRadius=e.x1,delete e.x1,e.angle=e.y,delete e.y,e.startAngle=e.y0,delete e.y0,e.endAngle=e.y1,delete e.y1,e},sa.svg.chord=function(){function e(e,s){var l=t(this,r,e,s),u=t(this,a,e,s);return"M"+l.p0+i(l.r,l.p1,l.a1-l.a0)+(n(l,u)?o(l.r,l.p1,l.r,l.p0):o(l.r,l.p1,u.r,u.p0)+i(u.r,u.p1,u.a1-u.a0)+o(u.r,u.p1,l.r,l.p0))+"Z"}function t(e,t,n,i){var o=t.call(e,n,i),r=s.call(e,o,i),a=l.call(e,o,i)+tl,c=u.call(e,o,i)+tl;return{r:r,a0:a,a1:c,p0:[r*Math.cos(a),r*Math.sin(a)],p1:[r*Math.cos(c),r*Math.sin(c)]}}function n(e,t){return e.a0==t.a0&&e.a1==t.a1}function i(e,t,n){return"A"+e+","+e+" 0 "+ +(n>Da)+",1 "+t}function o(e,t,n,i){return"Q 0,0 "+i}var r=hn,a=pn,s=pr,l=ur,u=cr;return e.radius=function(t){return arguments.length?(s=ut(t),e):s},e.source=function(t){return arguments.length?(r=ut(t),e):r},e.target=function(t){return arguments.length?(a=ut(t),e):a},e.startAngle=function(t){return arguments.length?(l=ut(t),e):l},e.endAngle=function(t){return arguments.length?(u=ut(t),e):u},e},sa.svg.diagonal=function(){function e(e,o){var r=t.call(this,e,o),a=n.call(this,e,o),s=(r.y+a.y)/2,l=[r,{x:r.x,y:s},{x:a.x,y:s},a];return l=l.map(i),"M"+l[0]+"C"+l[1]+" "+l[2]+" "+l[3]}var t=hn,n=pn,i=fr;return e.source=function(n){return arguments.length?(t=ut(n),e):t},e.target=function(t){return arguments.length?(n=ut(t),e):n},e.projection=function(t){return arguments.length?(i=t,e):i},e},sa.svg.diagonal.radial=function(){var e=sa.svg.diagonal(),t=fr,n=e.projection;return e.projection=function(e){return arguments.length?n(mr(t=e)):t},e},sa.svg.symbol=function(){function e(e,i){return(il.get(t.call(this,e,i))||yr)(n.call(this,e,i))}var t=vr,n=gr;return e.type=function(n){return arguments.length?(t=ut(n),e):t},e.size=function(t){return arguments.length?(n=ut(t),e):n},e};var il=sa.map({circle:yr,cross:function(e){var t=Math.sqrt(e/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z"},diamond:function(e){var t=Math.sqrt(e/(2*al)),n=t*al;return"M0,"+-t+"L"+n+",0"+" 0,"+t+" "+-n+",0"+"Z"},square:function(e){var t=Math.sqrt(e)/2;return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z"},"triangle-down":function(e){var t=Math.sqrt(e/rl),n=t*rl/2;return"M0,"+n+"L"+t+","+-n+" "+-t+","+-n+"Z"},"triangle-up":function(e){var t=Math.sqrt(e/rl),n=t*rl/2;return"M0,"+-n+"L"+t+","+n+" "+-t+","+n+"Z"}});sa.svg.symbolTypes=il.keys();var ol,rl=Math.sqrt(3),al=Math.tan(30*La),sl=[],ll=0,ul={ease:ki,delay:0,duration:250};sl.call=Ta.call,sl.empty=Ta.empty,sl.node=Ta.node,sa.transition=function(e){return arguments.length?ol?e.transition():e:Ma.transition()},sa.transition.prototype=sl,sl.select=function(e){var t,n,i,o=this.id,r=[];"function"!=typeof e&&(e=v(e));for(var a=-1,s=this.length;s>++a;){r.push(t=[]);for(var l=this[a],u=-1,c=l.length;c>++u;)(i=l[u])&&(n=e.call(i,i.__data__,u))?("__data__"in i&&(n.__data__=i.__data__),_r(n,u,o,i.__transition__[o]),t.push(n)):t.push(null)}return br(r,o)},sl.selectAll=function(e){var t,n,i,o,r,a=this.id,s=[];"function"!=typeof e&&(e=y(e));for(var l=-1,u=this.length;u>++l;)for(var c=this[l],d=-1,h=c.length;h>++d;)if(i=c[d]){r=i.__transition__[a],n=e.call(i,i.__data__,d),s.push(t=[]);for(var p=-1,f=n.length;f>++p;)_r(o=n[p],p,a,r),t.push(o)}return br(s,a)},sl.filter=function(e){var t,n,i,o=[];"function"!=typeof e&&(e=k(e));for(var r=0,a=this.length;a>r;r++){o.push(t=[]);for(var n=this[r],s=0,l=n.length;l>s;s++)(i=n[s])&&e.call(i,i.__data__,s)&&t.push(i)}return br(o,this.id,this.time).ease(this.ease())},sl.tween=function(e,t){var n=this.id;return 2>arguments.length?this.node().__transition__[n].tween.get(e):O(this,null==t?function(t){t.__transition__[n].tween.remove(e)}:function(i){i.__transition__[n].tween.set(e,t)})},sl.attr=function(e,t){function n(){this.removeAttribute(s)}function i(){this.removeAttributeNS(s.space,s.local)}function o(e){return null==e?n:(e+="",function(){var t,n=this.getAttribute(s);return n!==e&&(t=a(n,e),function(e){this.setAttribute(s,t(e))})})}function r(e){return null==e?i:(e+="",function(){var t,n=this.getAttributeNS(s.space,s.local);return n!==e&&(t=a(n,e),function(e){this.setAttributeNS(s.space,s.local,t(e))})})}if(2>arguments.length){for(t in e)this.attr(t,e[t]);return this}var a=wi(e),s=sa.ns.qualify(e);return wr(this,"attr."+e,t,s.local?r:o)},sl.attrTween=function(e,t){function n(e,n){var i=t.call(this,e,n,this.getAttribute(o));return i&&function(e){this.setAttribute(o,i(e))}}function i(e,n){var i=t.call(this,e,n,this.getAttributeNS(o.space,o.local));return i&&function(e){this.setAttributeNS(o.space,o.local,i(e))}}var o=sa.ns.qualify(e);return this.tween("attr."+e,o.local?i:n)},sl.style=function(e,t,n){function i(){this.style.removeProperty(e)}function o(t){return null==t?i:(t+="",function(){var i,o=ua.getComputedStyle(this,null).getPropertyValue(e);return o!==t&&(i=a(o,t),function(t){this.style.setProperty(e,i(t),n)})})}var r=arguments.length;if(3>r){if("string"!=typeof e){2>r&&(t="");for(n in e)this.style(n,e[n],t);return this}n=""}var a=wi(e);return wr(this,"style."+e,t,o)},sl.styleTween=function(e,t,n){function i(i,o){var r=t.call(this,i,o,ua.getComputedStyle(this,null).getPropertyValue(e));return r&&function(t){this.style.setProperty(e,r(t),n)}}return 3>arguments.length&&(n=""),this.tween("style."+e,i)},sl.text=function(e){return wr(this,"text",e,xr)},sl.remove=function(){return this.each("end.transition",function(){var e;!this.__transition__&&(e=this.parentNode)&&e.removeChild(this)})},sl.ease=function(e){var t=this.id;return 1>arguments.length?this.node().__transition__[t].ease:("function"!=typeof e&&(e=sa.ease.apply(sa,arguments)),O(this,function(n){n.__transition__[t].ease=e}))},sl.delay=function(e){var t=this.id;return O(this,"function"==typeof e?function(n,i,o){n.__transition__[t].delay=0|e.call(n,n.__data__,i,o)}:(e|=0,function(n){n.__transition__[t].delay=e}))},sl.duration=function(e){var t=this.id;return O(this,"function"==typeof e?function(n,i,o){n.__transition__[t].duration=Math.max(1,0|e.call(n,n.__data__,i,o))}:(e=Math.max(1,0|e),function(n){n.__transition__[t].duration=e}))},sl.each=function(e,t){var n=this.id;if(2>arguments.length){var i=ul,o=ol;ol=n,O(this,function(t,i,o){ul=t.__transition__[n],e.call(t,t.__data__,i,o)}),ul=i,ol=o}else O(this,function(i){i.__transition__[n].event.on(e,t)});return this},sl.transition=function(){for(var e,t,n,i,o=this.id,r=++ll,a=[],s=0,l=this.length;l>s;s++){a.push(e=[]);for(var t=this[s],u=0,c=t.length;c>u;u++)(n=t[u])&&(i=Object.create(n.__transition__[o]),i.delay+=i.duration,_r(n,u,r,i)),e.push(n)}return br(a,r)},sa.svg.axis=function(){function e(e){e.each(function(){var e,d=sa.select(this),h=null==u?n.ticks?n.ticks.apply(n,l):n.domain():u,p=null==t?n.tickFormat?n.tickFormat.apply(n,l):String:t,f=Tr(n,h,c),m=d.selectAll(".tick.minor").data(f,String),g=m.enter().insert("line",".tick").attr("class","tick minor").style("opacity",1e-6),v=sa.transition(m.exit()).style("opacity",1e-6).remove(),y=sa.transition(m).style("opacity",1),b=d.selectAll(".tick.major").data(h,String),w=b.enter().insert("g","path").attr("class","tick major").style("opacity",1e-6),x=sa.transition(b.exit()).style("opacity",1e-6).remove(),_=sa.transition(b).style("opacity",1),C=Bo(n),S=d.selectAll(".domain").data([0]),T=(S.enter().append("path").attr("class","domain"),sa.transition(S)),E=n.copy(),k=this.__chart__||E;this.__chart__=E,w.append("line"),w.append("text");var N=w.select("line"),A=_.select("line"),M=b.select("text").text(p),P=w.select("text"),R=_.select("text");switch(i){case"bottom":e=Cr,g.attr("y2",r),y.attr("x2",0).attr("y2",r),N.attr("y2",o),P.attr("y",Math.max(o,0)+s),A.attr("x2",0).attr("y2",o),R.attr("x",0).attr("y",Math.max(o,0)+s),M.attr("dy",".71em").style("text-anchor","middle"),T.attr("d","M"+C[0]+","+a+"V0H"+C[1]+"V"+a);break;case"top":e=Cr,g.attr("y2",-r),y.attr("x2",0).attr("y2",-r),N.attr("y2",-o),P.attr("y",-(Math.max(o,0)+s)),A.attr("x2",0).attr("y2",-o),R.attr("x",0).attr("y",-(Math.max(o,0)+s)),M.attr("dy","0em").style("text-anchor","middle"),T.attr("d","M"+C[0]+","+-a+"V0H"+C[1]+"V"+-a);break;case"left":e=Sr,g.attr("x2",-r),y.attr("x2",-r).attr("y2",0),N.attr("x2",-o),P.attr("x",-(Math.max(o,0)+s)),A.attr("x2",-o).attr("y2",0),R.attr("x",-(Math.max(o,0)+s)).attr("y",0),M.attr("dy",".32em").style("text-anchor","end"),T.attr("d","M"+-a+","+C[0]+"H0V"+C[1]+"H"+-a);break;case"right":e=Sr,g.attr("x2",r),y.attr("x2",r).attr("y2",0),N.attr("x2",o),P.attr("x",Math.max(o,0)+s),A.attr("x2",o).attr("y2",0),R.attr("x",Math.max(o,0)+s).attr("y",0),M.attr("dy",".32em").style("text-anchor","start"),T.attr("d","M"+a+","+C[0]+"H0V"+C[1]+"H"+a)}if(n.ticks)w.call(e,k),_.call(e,E),x.call(e,E),g.call(e,k),y.call(e,E),v.call(e,E);else{var O=E.rangeBand()/2,I=function(e){return E(e)+O};w.call(e,I),_.call(e,I)}})}var t,n=sa.scale.linear(),i=cl,o=6,r=6,a=6,s=3,l=[10],u=null,c=0;return e.scale=function(t){return arguments.length?(n=t,e):n},e.orient=function(t){return arguments.length?(i=t in dl?t+"":cl,e):i},e.ticks=function(){return arguments.length?(l=arguments,e):l},e.tickValues=function(t){return arguments.length?(u=t,e):u},e.tickFormat=function(n){return arguments.length?(t=n,e):t},e.tickSize=function(t,n){if(!arguments.length)return o;var i=arguments.length-1;return o=+t,r=i>1?+n:o,a=i>0?+arguments[i]:o,e},e.tickPadding=function(t){return arguments.length?(s=+t,e):s},e.tickSubdivide=function(t){return arguments.length?(c=+t,e):c},e};var cl="bottom",dl={top:1,right:1,bottom:1,left:1};sa.svg.brush=function(){function e(r){r.each(function(){var r,a=sa.select(this),u=a.selectAll(".background").data([0]),d=a.selectAll(".extent").data([0]),h=a.selectAll(".resize").data(c,String);a.style("pointer-events","all").on("mousedown.brush",o).on("touchstart.brush",o),u.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),d.enter().append("rect").attr("class","extent").style("cursor","move"),h.enter().append("g").attr("class",function(e){return"resize "+e}).style("cursor",function(e){return hl[e]}).append("rect").attr("x",function(e){return/[ew]$/.test(e)?-3:null}).attr("y",function(e){return/^[ns]/.test(e)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),h.style("display",e.empty()?"none":null),h.exit().remove(),s&&(r=Bo(s),u.attr("x",r[0]).attr("width",r[1]-r[0]),n(a)),l&&(r=Bo(l),u.attr("y",r[0]).attr("height",r[1]-r[0]),i(a)),t(a)})}function t(e){e.selectAll(".resize").attr("transform",function(e){return"translate("+d[+/e$/.test(e)][0]+","+d[+/^s/.test(e)][1]+")"})}function n(e){e.select(".extent").attr("x",d[0][0]),e.selectAll(".extent,.n>rect,.s>rect").attr("width",d[1][0]-d[0][0])}function i(e){e.select(".extent").attr("y",d[0][1]),e.selectAll(".extent,.e>rect,.w>rect").attr("height",d[1][1]-d[0][1])}function o(){function o(){var e=sa.event.changedTouches;return e?sa.touches(y,e)[0]:sa.mouse(y)}function c(){32==sa.event.keyCode&&(T||(g=null,E[0]-=d[1][0],E[1]-=d[1][1],T=2),u())}function h(){32==sa.event.keyCode&&2==T&&(E[0]+=d[1][0],E[1]+=d[1][1],T=0,u())}function p(){var e=o(),r=!1;v&&(e[0]+=v[0],e[1]+=v[1]),T||(sa.event.altKey?(g||(g=[(d[0][0]+d[1][0])/2,(d[0][1]+d[1][1])/2]),E[0]=d[+(e[0]<g[0])][0],E[1]=d[+(e[1]<g[1])][1]):g=null),C&&f(e,s,0)&&(n(x),r=!0),S&&f(e,l,1)&&(i(x),r=!0),r&&(t(x),w({type:"brush",mode:T?"move":"resize"}))}function f(e,t,n){var i,o,a=Bo(t),s=a[0],l=a[1],u=E[n],c=d[1][n]-d[0][n];return T&&(s-=u,l-=c+u),i=Math.max(s,Math.min(l,e[n])),T?o=(i+=u)+c:(g&&(u=Math.max(s,Math.min(l,2*g[n]-i))),i>u?(o=i,i=u):o=u),d[0][n]!==i||d[1][n]!==o?(r=null,d[0][n]=i,d[1][n]=o,!0):void 0}function m(){p(),x.style("pointer-events","all").selectAll(".resize").style("display",e.empty()?"none":null),sa.select("body").style("cursor",null),k.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),w({type:"brushend"}),u()}var g,v,y=this,b=sa.select(sa.event.target),w=a.of(y,arguments),x=sa.select(y),_=b.datum(),C=!/^(n|s)$/.test(_)&&s,S=!/^(e|w)$/.test(_)&&l,T=b.classed("extent"),E=o(),k=sa.select(ua).on("mousemove.brush",p).on("mouseup.brush",m).on("touchmove.brush",p).on("touchend.brush",m).on("keydown.brush",c).on("keyup.brush",h);if(T)E[0]=d[0][0]-E[0],E[1]=d[0][1]-E[1];else if(_){var N=+/w$/.test(_),A=+/^n/.test(_);v=[d[1-N][0]-E[0],d[1-A][1]-E[1]],E[0]=d[N][0],E[1]=d[A][1]}else sa.event.altKey&&(g=E.slice());x.style("pointer-events","none").selectAll(".resize").style("display",null),sa.select("body").style("cursor",b.style("cursor")),w({type:"brushstart"}),p(),u()}var r,a=h(e,"brushstart","brush","brushend"),s=null,l=null,c=pl[0],d=[[0,0],[0,0]];return e.x=function(t){return arguments.length?(s=t,c=pl[!s<<1|!l],e):s},e.y=function(t){return arguments.length?(l=t,c=pl[!s<<1|!l],e):l},e.extent=function(t){var n,i,o,a,u;return arguments.length?(r=[[0,0],[0,0]],s&&(n=t[0],i=t[1],l&&(n=n[0],i=i[0]),r[0][0]=n,r[1][0]=i,s.invert&&(n=s(n),i=s(i)),n>i&&(u=n,n=i,i=u),d[0][0]=0|n,d[1][0]=0|i),l&&(o=t[0],a=t[1],s&&(o=o[1],a=a[1]),r[0][1]=o,r[1][1]=a,l.invert&&(o=l(o),a=l(a)),o>a&&(u=o,o=a,a=u),d[0][1]=0|o,d[1][1]=0|a),e):(t=r||d,s&&(n=t[0][0],i=t[1][0],r||(n=d[0][0],i=d[1][0],s.invert&&(n=s.invert(n),i=s.invert(i)),n>i&&(u=n,n=i,i=u))),l&&(o=t[0][1],a=t[1][1],r||(o=d[0][1],a=d[1][1],l.invert&&(o=l.invert(o),a=l.invert(a)),o>a&&(u=o,o=a,a=u))),s&&l?[[n,o],[i,a]]:s?[n,i]:l&&[o,a])},e.clear=function(){return r=null,d[0][0]=d[0][1]=d[1][0]=d[1][1]=0,e},e.empty=function(){return s&&d[0][0]===d[1][0]||l&&d[0][1]===d[1][1]},sa.rebind(e,a,"on")};var hl={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},pl=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]];sa.time={};var fl=Date,ml=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];Er.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){gl.setUTCDate.apply(this._,arguments)},setDay:function(){gl.setUTCDay.apply(this._,arguments)},setFullYear:function(){gl.setUTCFullYear.apply(this._,arguments)},setHours:function(){gl.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){gl.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){gl.setUTCMinutes.apply(this._,arguments)},setMonth:function(){gl.setUTCMonth.apply(this._,arguments)},setSeconds:function(){gl.setUTCSeconds.apply(this._,arguments)},setTime:function(){gl.setTime.apply(this._,arguments)}};var gl=Date.prototype,vl="%a %b %e %X %Y",yl="%m/%d/%Y",bl="%H:%M:%S",wl=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],xl=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],_l=["January","February","March","April","May","June","July","August","September","October","November","December"],Cl=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];sa.time.year=kr(function(e){return e=sa.time.day(e),e.setMonth(0,1),e},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e){return e.getFullYear()}),sa.time.years=sa.time.year.range,sa.time.years.utc=sa.time.year.utc.range,sa.time.day=kr(function(e){var t=new fl(1970,0);return t.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),t},function(e,t){e.setDate(e.getDate()+t)},function(e){return e.getDate()-1}),sa.time.days=sa.time.day.range,sa.time.days.utc=sa.time.day.utc.range,sa.time.dayOfYear=function(e){var t=sa.time.year(e);return Math.floor((e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/864e5)},ml.forEach(function(e,t){e=e.toLowerCase(),t=7-t;var n=sa.time[e]=kr(function(e){return(e=sa.time.day(e)).setDate(e.getDate()-(e.getDay()+t)%7),e},function(e,t){e.setDate(e.getDate()+7*Math.floor(t))},function(e){var n=sa.time.year(e).getDay();return Math.floor((sa.time.dayOfYear(e)+(n+t)%7)/7)-(n!==t)});sa.time[e+"s"]=n.range,sa.time[e+"s"].utc=n.utc.range,sa.time[e+"OfYear"]=function(e){var n=sa.time.year(e).getDay();return Math.floor((sa.time.dayOfYear(e)+(n+t)%7)/7)}}),sa.time.week=sa.time.sunday,sa.time.weeks=sa.time.sunday.range,sa.time.weeks.utc=sa.time.sunday.utc.range,sa.time.weekOfYear=sa.time.sundayOfYear,sa.time.format=function(e){function t(t){for(var i,o,r,a=[],s=-1,l=0;n>++s;)37===e.charCodeAt(s)&&(a.push(e.substring(l,s)),null!=(o=Ml[i=e.charAt(++s)])&&(i=e.charAt(++s)),(r=Pl[i])&&(i=r(t,null==o?"e"===i?" ":"0":o)),a.push(i),l=s+1);return a.push(e.substring(l,s)),a.join("")}var n=e.length;return t.parse=function(t){var n={y:1900,m:0,d:1,H:0,M:0,S:0,L:0},i=Ar(n,e,t,0);if(i!=t.length)return null;"p"in n&&(n.H=n.H%12+12*n.p);var o=new fl;return o.setFullYear(n.y,n.m,n.d),o.setHours(n.H,n.M,n.S,n.L),o},t.toString=function(){return e},t};var Sl=Mr(wl),Tl=Mr(xl),El=Mr(_l),kl=Pr(_l),Nl=Mr(Cl),Al=Pr(Cl),Ml={"-":"",_:" ",0:"0"},Pl={a:function(e){return xl[e.getDay()]},A:function(e){return wl[e.getDay()]},b:function(e){return Cl[e.getMonth()]},B:function(e){return _l[e.getMonth()]},c:sa.time.format(vl),d:function(e,t){return Rr(e.getDate(),t,2)},e:function(e,t){return Rr(e.getDate(),t,2)},H:function(e,t){return Rr(e.getHours(),t,2)},I:function(e,t){return Rr(e.getHours()%12||12,t,2)},j:function(e,t){return Rr(1+sa.time.dayOfYear(e),t,3)},L:function(e,t){return Rr(e.getMilliseconds(),t,3)},m:function(e,t){return Rr(e.getMonth()+1,t,2)},M:function(e,t){return Rr(e.getMinutes(),t,2)},p:function(e){return e.getHours()>=12?"PM":"AM"},S:function(e,t){return Rr(e.getSeconds(),t,2)},U:function(e,t){return Rr(sa.time.sundayOfYear(e),t,2)},w:function(e){return e.getDay()},W:function(e,t){return Rr(sa.time.mondayOfYear(e),t,2)},x:sa.time.format(yl),X:sa.time.format(bl),y:function(e,t){return Rr(e.getFullYear()%100,t,2)},Y:function(e,t){return Rr(e.getFullYear()%1e4,t,4)},Z:Yr,"%":function(){return"%"}},Rl={a:Or,A:Ir,b:Dr,B:Hr,c:Lr,d:Vr,e:Vr,H:$r,I:$r,L:Gr,m:Wr,M:qr,p:Xr,S:Qr,x:zr,X:Br,y:jr,Y:Fr},Ol=/^\s*\d+/,Il=sa.map({am:0,pm:1});sa.time.format.utc=function(e){function t(e){try{fl=Er;var t=new fl;return t._=e,n(t)}finally{fl=Date}}var n=sa.time.format(e);return t.parse=function(e){try{fl=Er;var t=n.parse(e);return t&&t._}finally{fl=Date}},t.toString=n.toString,t};var Dl=sa.time.format.utc("%Y-%m-%dT%H:%M:%S.%LZ");sa.time.format.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?Zr:Dl,Zr.parse=function(e){var t=new Date(e);return isNaN(t)?null:t},Zr.toString=Dl.toString,sa.time.second=kr(function(e){return new fl(1e3*Math.floor(e/1e3))},function(e,t){e.setTime(e.getTime()+1e3*Math.floor(t))},function(e){return e.getSeconds()}),sa.time.seconds=sa.time.second.range,sa.time.seconds.utc=sa.time.second.utc.range,sa.time.minute=kr(function(e){return new fl(6e4*Math.floor(e/6e4))},function(e,t){e.setTime(e.getTime()+6e4*Math.floor(t))},function(e){return e.getMinutes()}),sa.time.minutes=sa.time.minute.range,sa.time.minutes.utc=sa.time.minute.utc.range,sa.time.hour=kr(function(e){var t=e.getTimezoneOffset()/60;return new fl(36e5*(Math.floor(e/36e5-t)+t))},function(e,t){e.setTime(e.getTime()+36e5*Math.floor(t))},function(e){return e.getHours()}),sa.time.hours=sa.time.hour.range,sa.time.hours.utc=sa.time.hour.utc.range,sa.time.month=kr(function(e){return e=sa.time.day(e),e.setDate(1),e},function(e,t){e.setMonth(e.getMonth()+t)},function(e){return e.getMonth()}),sa.time.months=sa.time.month.range,sa.time.months.utc=sa.time.month.utc.range;var Hl=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],Ll=[[sa.time.second,1],[sa.time.second,5],[sa.time.second,15],[sa.time.second,30],[sa.time.minute,1],[sa.time.minute,5],[sa.time.minute,15],[sa.time.minute,30],[sa.time.hour,1],[sa.time.hour,3],[sa.time.hour,6],[sa.time.hour,12],[sa.time.day,1],[sa.time.day,2],[sa.time.week,1],[sa.time.month,1],[sa.time.month,3],[sa.time.year,1]],zl=[[sa.time.format("%Y"),Lt],[sa.time.format("%B"),function(e){return e.getMonth()
}],[sa.time.format("%b %d"),function(e){return 1!=e.getDate()}],[sa.time.format("%a %d"),function(e){return e.getDay()&&1!=e.getDate()}],[sa.time.format("%I %p"),function(e){return e.getHours()}],[sa.time.format("%I:%M"),function(e){return e.getMinutes()}],[sa.time.format(":%S"),function(e){return e.getSeconds()}],[sa.time.format(".%L"),function(e){return e.getMilliseconds()}]],Bl=sa.scale.linear(),Fl=ea(zl);Ll.year=function(e,t){return Bl.domain(e.map(na)).ticks(t).map(ta)},sa.time.scale=function(){return Kr(sa.scale.linear(),Ll,Fl)};var jl=Ll.map(function(e){return[e[0].utc,e[1]]}),Ul=[[sa.time.format.utc("%Y"),Lt],[sa.time.format.utc("%B"),function(e){return e.getUTCMonth()}],[sa.time.format.utc("%b %d"),function(e){return 1!=e.getUTCDate()}],[sa.time.format.utc("%a %d"),function(e){return e.getUTCDay()&&1!=e.getUTCDate()}],[sa.time.format.utc("%I %p"),function(e){return e.getUTCHours()}],[sa.time.format.utc("%I:%M"),function(e){return e.getUTCMinutes()}],[sa.time.format.utc(":%S"),function(e){return e.getUTCSeconds()}],[sa.time.format.utc(".%L"),function(e){return e.getUTCMilliseconds()}]],Wl=ea(Ul);return jl.year=function(e,t){return Bl.domain(e.map(oa)).ticks(t).map(ia)},sa.time.scale.utc=function(){return Kr(sa.scale.linear(),jl,Wl)},sa.text=dt(function(e){return e.responseText}),sa.json=function(e,t){return ht(e,"application/json",ra,t)},sa.html=function(e,t){return ht(e,"text/html",aa,t)},sa.xml=dt(function(e){return e.responseXML}),sa}(),/*! URI.js v1.11.2 http://medialize.github.com/URI.js/ */
function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.IPv6=t(e)}(this,function(e){var t=e&&e.IPv6;return{best:function(e){e=e.toLowerCase().split(":");var t=e.length,n=8;""===e[0]&&""===e[1]&&""===e[2]?(e.shift(),e.shift()):""===e[0]&&""===e[1]?e.shift():""===e[t-1]&&""===e[t-2]&&e.pop(),t=e.length,-1!==e[t-1].indexOf(".")&&(n=7);var i;for(i=0;t>i&&""!==e[i];i++);if(n>i)for(e.splice(i,1,"0000");n>e.length;)e.splice(i,0,"0000");for(i=0;n>i;i++){for(var t=e[i].split(""),o=0;3>o&&"0"===t[0]&&t.length>1;o++)t.splice(0,1);e[i]=t.join("")}var t=-1,r=o=0,a=-1,s=!1;for(i=0;n>i;i++)s?"0"===e[i]?r+=1:(s=!1,r>o&&(t=a,o=r)):"0"==e[i]&&(s=!0,a=i,r=1);for(r>o&&(t=a,o=r),o>1&&e.splice(t,o,""),t=e.length,n="",""===e[0]&&(beststr=":"),i=0;t>i&&(n+=e[i],i!==t-1);i++)n+=":";return""===e[t-1]&&(n+=":"),n},noConflict:function(){return e.IPv6===this&&(e.IPv6=t),this}}}),function(e){function t(e){throw RangeError(T[e])}function n(e,t){for(var n=e.length;n--;)e[n]=t(e[n]);return e}function i(e){for(var t,n,i=[],o=0,r=e.length;r>o;)t=e.charCodeAt(o++),t>=55296&&56319>=t&&r>o?(n=e.charCodeAt(o++),56320==(64512&n)?i.push(((1023&t)<<10)+(1023&n)+65536):(i.push(t),o--)):i.push(t);return i}function o(e){return n(e,function(e){var t="";return e>65535&&(e-=65536,t+=N(55296|1023&e>>>10),e=56320|1023&e),t+=N(e)}).join("")}function r(e,t,n){var i=0;for(e=n?k(e/y):e>>1,e+=k(e/t);e>E*g>>1;i+=f)e=k(e/E);return k(i+(E+1)*e/(e+v))}function a(e){var n,i,a,s,l,u,c=[],d=e.length,h=0,v=w,y=b;for(i=e.lastIndexOf(x),0>i&&(i=0),a=0;i>a;++a)e.charCodeAt(a)>=128&&t("not-basic"),c.push(e.charCodeAt(a));for(i=i>0?i+1:0;d>i;){for(a=h,n=1,s=f;i>=d&&t("invalid-input"),l=e.charCodeAt(i++),l=10>l-48?l-22:26>l-65?l-65:26>l-97?l-97:f,(l>=f||l>k((p-h)/n))&&t("overflow"),h+=l*n,u=y>=s?m:s>=y+g?g:s-y,!(u>l);s+=f)l=f-u,n>k(p/l)&&t("overflow"),n*=l;n=c.length+1,y=r(h-a,n,0==a),k(h/n)>p-v&&t("overflow"),v+=k(h/n),h%=n,c.splice(h++,0,v)}return o(c)}function s(e){var n,o,a,s,l,u,c,d,h,v,y,_,C=[];for(e=i(e),v=e.length,n=w,o=0,l=b,u=0;v>u;++u)h=e[u],128>h&&C.push(N(h));for((a=s=C.length)&&C.push(x);v>a;){for(c=p,u=0;v>u;++u)h=e[u],h>=n&&c>h&&(c=h);for(y=a+1,c-n>k((p-o)/y)&&t("overflow"),o+=(c-n)*y,n=c,u=0;v>u;++u)if(h=e[u],n>h&&++o>p&&t("overflow"),h==n){for(d=o,c=f;h=l>=c?m:c>=l+g?g:c-l,!(h>d);c+=f)_=d-h,d=f-h,C.push(N(h+_%d+22+75*(26>h+_%d)-0)),d=k(_/d);C.push(N(d+22+75*(26>d)-0)),l=r(o,y,a==s),o=0,++a}++o,++n}return C.join("")}var l="object"==typeof exports&&exports,u="object"==typeof module&&module&&module.exports==l&&module,c="object"==typeof global&&global;(c.global===c||c.window===c)&&(e=c);var d,h,p=2147483647,f=36,m=1,g=26,v=38,y=700,b=72,w=128,x="-",_=/^xn--/,C=/[^ -~]/,S=/\x2E|\u3002|\uFF0E|\uFF61/g,T={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},E=f-m,k=Math.floor,N=String.fromCharCode;if(d={version:"1.2.3",ucs2:{decode:i,encode:o},decode:a,encode:s,toASCII:function(e){return n(e.split(S),function(e){return C.test(e)?"xn--"+s(e):e}).join(".")},toUnicode:function(e){return n(e.split(S),function(e){return _.test(e)?a(e.slice(4).toLowerCase()):e}).join(".")}},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define(function(){return d});else if(l&&!l.nodeType)if(u)u.exports=d;else for(h in d)d.hasOwnProperty(h)&&(l[h]=d[h]);else e.punycode=d}(this),function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.SecondLevelDomains=t(e)}(this,function(e){var t=e&&e.SecondLevelDomains,n=Object.prototype.hasOwnProperty,i={list:{ac:"com|gov|mil|net|org",ae:"ac|co|gov|mil|name|net|org|pro|sch",af:"com|edu|gov|net|org",al:"com|edu|gov|mil|net|org",ao:"co|ed|gv|it|og|pb",ar:"com|edu|gob|gov|int|mil|net|org|tur",at:"ac|co|gv|or",au:"asn|com|csiro|edu|gov|id|net|org",ba:"co|com|edu|gov|mil|net|org|rs|unbi|unmo|unsa|untz|unze",bb:"biz|co|com|edu|gov|info|net|org|store|tv",bh:"biz|cc|com|edu|gov|info|net|org",bn:"com|edu|gov|net|org",bo:"com|edu|gob|gov|int|mil|net|org|tv",br:"adm|adv|agr|am|arq|art|ato|b|bio|blog|bmd|cim|cng|cnt|com|coop|ecn|edu|eng|esp|etc|eti|far|flog|fm|fnd|fot|fst|g12|ggf|gov|imb|ind|inf|jor|jus|lel|mat|med|mil|mus|net|nom|not|ntr|odo|org|ppg|pro|psc|psi|qsl|rec|slg|srv|tmp|trd|tur|tv|vet|vlog|wiki|zlg",bs:"com|edu|gov|net|org",bz:"du|et|om|ov|rg",ca:"ab|bc|mb|nb|nf|nl|ns|nt|nu|on|pe|qc|sk|yk",ck:"biz|co|edu|gen|gov|info|net|org",cn:"ac|ah|bj|com|cq|edu|fj|gd|gov|gs|gx|gz|ha|hb|he|hi|hl|hn|jl|js|jx|ln|mil|net|nm|nx|org|qh|sc|sd|sh|sn|sx|tj|tw|xj|xz|yn|zj",co:"com|edu|gov|mil|net|nom|org",cr:"ac|c|co|ed|fi|go|or|sa",cy:"ac|biz|com|ekloges|gov|ltd|name|net|org|parliament|press|pro|tm","do":"art|com|edu|gob|gov|mil|net|org|sld|web",dz:"art|asso|com|edu|gov|net|org|pol",ec:"com|edu|fin|gov|info|med|mil|net|org|pro",eg:"com|edu|eun|gov|mil|name|net|org|sci",er:"com|edu|gov|ind|mil|net|org|rochest|w",es:"com|edu|gob|nom|org",et:"biz|com|edu|gov|info|name|net|org",fj:"ac|biz|com|info|mil|name|net|org|pro",fk:"ac|co|gov|net|nom|org",fr:"asso|com|f|gouv|nom|prd|presse|tm",gg:"co|net|org",gh:"com|edu|gov|mil|org",gn:"ac|com|gov|net|org",gr:"com|edu|gov|mil|net|org",gt:"com|edu|gob|ind|mil|net|org",gu:"com|edu|gov|net|org",hk:"com|edu|gov|idv|net|org",id:"ac|co|go|mil|net|or|sch|web",il:"ac|co|gov|idf|k12|muni|net|org","in":"ac|co|edu|ernet|firm|gen|gov|i|ind|mil|net|nic|org|res",iq:"com|edu|gov|i|mil|net|org",ir:"ac|co|dnssec|gov|i|id|net|org|sch",it:"edu|gov",je:"co|net|org",jo:"com|edu|gov|mil|name|net|org|sch",jp:"ac|ad|co|ed|go|gr|lg|ne|or",ke:"ac|co|go|info|me|mobi|ne|or|sc",kh:"com|edu|gov|mil|net|org|per",ki:"biz|com|de|edu|gov|info|mob|net|org|tel",km:"asso|com|coop|edu|gouv|k|medecin|mil|nom|notaires|pharmaciens|presse|tm|veterinaire",kn:"edu|gov|net|org",kr:"ac|busan|chungbuk|chungnam|co|daegu|daejeon|es|gangwon|go|gwangju|gyeongbuk|gyeonggi|gyeongnam|hs|incheon|jeju|jeonbuk|jeonnam|k|kg|mil|ms|ne|or|pe|re|sc|seoul|ulsan",kw:"com|edu|gov|net|org",ky:"com|edu|gov|net|org",kz:"com|edu|gov|mil|net|org",lb:"com|edu|gov|net|org",lk:"assn|com|edu|gov|grp|hotel|int|ltd|net|ngo|org|sch|soc|web",lr:"com|edu|gov|net|org",lv:"asn|com|conf|edu|gov|id|mil|net|org",ly:"com|edu|gov|id|med|net|org|plc|sch",ma:"ac|co|gov|m|net|org|press",mc:"asso|tm",me:"ac|co|edu|gov|its|net|org|priv",mg:"com|edu|gov|mil|nom|org|prd|tm",mk:"com|edu|gov|inf|name|net|org|pro",ml:"com|edu|gov|net|org|presse",mn:"edu|gov|org",mo:"com|edu|gov|net|org",mt:"com|edu|gov|net|org",mv:"aero|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|pro",mw:"ac|co|com|coop|edu|gov|int|museum|net|org",mx:"com|edu|gob|net|org",my:"com|edu|gov|mil|name|net|org|sch",nf:"arts|com|firm|info|net|other|per|rec|store|web",ng:"biz|com|edu|gov|mil|mobi|name|net|org|sch",ni:"ac|co|com|edu|gob|mil|net|nom|org",np:"com|edu|gov|mil|net|org",nr:"biz|com|edu|gov|info|net|org",om:"ac|biz|co|com|edu|gov|med|mil|museum|net|org|pro|sch",pe:"com|edu|gob|mil|net|nom|org|sld",ph:"com|edu|gov|i|mil|net|ngo|org",pk:"biz|com|edu|fam|gob|gok|gon|gop|gos|gov|net|org|web",pl:"art|bialystok|biz|com|edu|gda|gdansk|gorzow|gov|info|katowice|krakow|lodz|lublin|mil|net|ngo|olsztyn|org|poznan|pwr|radom|slupsk|szczecin|torun|warszawa|waw|wroc|wroclaw|zgora",pr:"ac|biz|com|edu|est|gov|info|isla|name|net|org|pro|prof",ps:"com|edu|gov|net|org|plo|sec",pw:"belau|co|ed|go|ne|or",ro:"arts|com|firm|info|nom|nt|org|rec|store|tm|www",rs:"ac|co|edu|gov|in|org",sb:"com|edu|gov|net|org",sc:"com|edu|gov|net|org",sh:"co|com|edu|gov|net|nom|org",sl:"com|edu|gov|net|org",st:"co|com|consulado|edu|embaixada|gov|mil|net|org|principe|saotome|store",sv:"com|edu|gob|org|red",sz:"ac|co|org",tr:"av|bbs|bel|biz|com|dr|edu|gen|gov|info|k12|name|net|org|pol|tel|tsk|tv|web",tt:"aero|biz|cat|co|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel",tw:"club|com|ebiz|edu|game|gov|idv|mil|net|org",mu:"ac|co|com|gov|net|or|org",mz:"ac|co|edu|gov|org",na:"co|com",nz:"ac|co|cri|geek|gen|govt|health|iwi|maori|mil|net|org|parliament|school",pa:"abo|ac|com|edu|gob|ing|med|net|nom|org|sld",pt:"com|edu|gov|int|net|nome|org|publ",py:"com|edu|gov|mil|net|org",qa:"com|edu|gov|mil|net|org",re:"asso|com|nom",ru:"ac|adygeya|altai|amur|arkhangelsk|astrakhan|bashkiria|belgorod|bir|bryansk|buryatia|cbg|chel|chelyabinsk|chita|chukotka|chuvashia|com|dagestan|e-burg|edu|gov|grozny|int|irkutsk|ivanovo|izhevsk|jar|joshkar-ola|kalmykia|kaluga|kamchatka|karelia|kazan|kchr|kemerovo|khabarovsk|khakassia|khv|kirov|koenig|komi|kostroma|kranoyarsk|kuban|kurgan|kursk|lipetsk|magadan|mari|mari-el|marine|mil|mordovia|mosreg|msk|murmansk|nalchik|net|nnov|nov|novosibirsk|nsk|omsk|orenburg|org|oryol|penza|perm|pp|pskov|ptz|rnd|ryazan|sakhalin|samara|saratov|simbirsk|smolensk|spb|stavropol|stv|surgut|tambov|tatarstan|tom|tomsk|tsaritsyn|tsk|tula|tuva|tver|tyumen|udm|udmurtia|ulan-ude|vladikavkaz|vladimir|vladivostok|volgograd|vologda|voronezh|vrn|vyatka|yakutia|yamal|yekaterinburg|yuzhno-sakhalinsk",rw:"ac|co|com|edu|gouv|gov|int|mil|net",sa:"com|edu|gov|med|net|org|pub|sch",sd:"com|edu|gov|info|med|net|org|tv",se:"a|ac|b|bd|c|d|e|f|g|h|i|k|l|m|n|o|org|p|parti|pp|press|r|s|t|tm|u|w|x|y|z",sg:"com|edu|gov|idn|net|org|per",sn:"art|com|edu|gouv|org|perso|univ",sy:"com|edu|gov|mil|net|news|org",th:"ac|co|go|in|mi|net|or",tj:"ac|biz|co|com|edu|go|gov|info|int|mil|name|net|nic|org|test|web",tn:"agrinet|com|defense|edunet|ens|fin|gov|ind|info|intl|mincom|nat|net|org|perso|rnrt|rns|rnu|tourism",tz:"ac|co|go|ne|or",ua:"biz|cherkassy|chernigov|chernovtsy|ck|cn|co|com|crimea|cv|dn|dnepropetrovsk|donetsk|dp|edu|gov|if|in|ivano-frankivsk|kh|kharkov|kherson|khmelnitskiy|kiev|kirovograd|km|kr|ks|kv|lg|lugansk|lutsk|lviv|me|mk|net|nikolaev|od|odessa|org|pl|poltava|pp|rovno|rv|sebastopol|sumy|te|ternopil|uzhgorod|vinnica|vn|zaporizhzhe|zhitomir|zp|zt",ug:"ac|co|go|ne|or|org|sc",uk:"ac|bl|british-library|co|cym|gov|govt|icnet|jet|lea|ltd|me|mil|mod|national-library-scotland|nel|net|nhs|nic|nls|org|orgn|parliament|plc|police|sch|scot|soc",us:"dni|fed|isa|kids|nsn",uy:"com|edu|gub|mil|net|org",ve:"co|com|edu|gob|info|mil|net|org|web",vi:"co|com|k12|net|org",vn:"ac|biz|com|edu|gov|health|info|int|name|net|org|pro",ye:"co|com|gov|ltd|me|net|org|plc",yu:"ac|co|edu|gov|org",za:"ac|agric|alt|bourse|city|co|cybernet|db|edu|gov|grondar|iaccess|imt|inca|landesign|law|mil|net|ngo|nis|nom|olivetti|org|pix|school|tm|web",zm:"ac|co|com|edu|gov|net|org|sch"},has_expression:null,is_expression:null,has:function(e){return!!e.match(i.has_expression)},is:function(e){return!!e.match(i.is_expression)},get:function(e){return(e=e.match(i.has_expression))&&e[1]||null},noConflict:function(){return e.SecondLevelDomains===this&&(e.SecondLevelDomains=t),this},init:function(){var e,t="";for(e in i.list)n.call(i.list,e)&&(t+="|("+("("+i.list[e]+")."+e)+")");i.has_expression=RegExp("\\.("+t.substr(1)+")$","i"),i.is_expression=RegExp("^("+t.substr(1)+")$","i")}};return i.init(),i}),function(e,t){"object"==typeof exports?module.exports=t(require("./punycode"),require("./IPv6"),require("./SecondLevelDomains")):"function"==typeof define&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],t):e.URI=t(e.punycode,e.IPv6,e.SecondLevelDomains,e)}(this,function(e,t,n,i){function o(e,t){return this instanceof o?(void 0===e&&(e="undefined"!=typeof location?location.href+"":""),this.href(e),void 0!==t?this.absoluteTo(t):this):new o(e,t)}function r(e){return e.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function a(e){return void 0===e?"Undefined":(Object.prototype.toString.call(e)+"").slice(8,-1)}function s(e){return"Array"===a(e)}function l(e,t){var n,i;if(s(t)){for(n=0,i=t.length;i>n;n++)if(!l(e,t[n]))return!1;return!0}var o=a(t);for(n=0,i=e.length;i>n;n++)if("RegExp"===o){if("string"==typeof e[n]&&e[n].match(t))return!0}else if(e[n]===t)return!0;return!1}function u(e,t){if(!s(e)||!s(t)||e.length!==t.length)return!1;e.sort(),t.sort();for(var n=0,i=e.length;i>n;n++)if(e[n]!==t[n])return!1;return!0}function c(e){return escape(e)}function d(e){return encodeURIComponent(e).replace(/[!'()*]/g,c).replace(/\*/g,"%2A")}var h=i&&i.URI,p=o.prototype,f=Object.prototype.hasOwnProperty;o._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:o.duplicateQueryParameters,escapeQuerySpace:o.escapeQuerySpace}},o.duplicateQueryParameters=!1,o.escapeQuerySpace=!0,o.protocol_expression=/^[a-z][a-z0-9-+-]*$/i,o.idn_expression=/[^a-z0-9\.-]/i,o.punycode_expression=/(xn--)/i,o.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,o.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,o.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u2018\u2019]))/gi,o.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},o.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/,o.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src"},o.getDomAttribute=function(e){if(e&&e.nodeName){var t=e.nodeName.toLowerCase();return"input"===t&&"image"!==e.type?void 0:o.domAttributes[t]}},o.encode=d,o.decode=decodeURIComponent,o.iso8859=function(){o.encode=escape,o.decode=unescape},o.unicode=function(){o.encode=d,o.decode=decodeURIComponent},o.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}}},o.encodeQuery=function(e,t){var n=o.encode(e+"");return t?n.replace(/%20/g,"+"):n},o.decodeQuery=function(e,t){e+="";try{return o.decode(t?e.replace(/\+/g,"%20"):e)}catch(n){return e}},o.recodePath=function(e){e=(e+"").split("/");for(var t=0,n=e.length;n>t;t++)e[t]=o.encodePathSegment(o.decode(e[t]));return e.join("/")},o.decodePath=function(e){e=(e+"").split("/");for(var t=0,n=e.length;n>t;t++)e[t]=o.decodePathSegment(e[t]);return e.join("/")};var m,g={encode:"encode",decode:"decode"},v=function(e,t){return function(n){return o[t](n+"").replace(o.characters[e][t].expression,function(n){return o.characters[e][t].map[n]})}};for(m in g)o[m+"PathSegment"]=v("pathname",g[m]);o.encodeReserved=v("reserved","encode"),o.parse=function(e,t){var n;return t||(t={}),n=e.indexOf("#"),n>-1&&(t.fragment=e.substring(n+1)||null,e=e.substring(0,n)),n=e.indexOf("?"),n>-1&&(t.query=e.substring(n+1)||null,e=e.substring(0,n)),"//"===e.substring(0,2)?(t.protocol=null,e=e.substring(2),e=o.parseAuthority(e,t)):(n=e.indexOf(":"),n>-1&&(t.protocol=e.substring(0,n)||null,t.protocol&&!t.protocol.match(o.protocol_expression)?t.protocol=void 0:"file"===t.protocol?e=e.substring(n+3):"//"===e.substring(n+1,n+3)?(e=e.substring(n+3),e=o.parseAuthority(e,t)):(e=e.substring(n+1),t.urn=!0))),t.path=e,t},o.parseHost=function(e,t){var n,i=e.indexOf("/");return-1===i&&(i=e.length),"["===e.charAt(0)?(n=e.indexOf("]"),t.hostname=e.substring(1,n)||null,t.port=e.substring(n+2,i)||null):e.indexOf(":")!==e.lastIndexOf(":")?(t.hostname=e.substring(0,i)||null,t.port=null):(n=e.substring(0,i).split(":"),t.hostname=n[0]||null,t.port=n[1]||null),t.hostname&&"/"!==e.substring(i).charAt(0)&&(i++,e="/"+e),e.substring(i)||"/"},o.parseAuthority=function(e,t){return e=o.parseUserinfo(e,t),o.parseHost(e,t)},o.parseUserinfo=function(e,t){var n=e.indexOf("/"),i=n>-1?e.lastIndexOf("@",n):e.indexOf("@");return i>-1&&(-1===n||n>i)?(n=e.substring(0,i).split(":"),t.username=n[0]?o.decode(n[0]):null,n.shift(),t.password=n[0]?o.decode(n.join(":")):null,e=e.substring(i+1)):(t.username=null,t.password=null),e},o.parseQuery=function(e,t){if(!e)return{};if(e=e.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!e)return{};for(var n,i,r={},a=e.split("&"),s=a.length,l=0;s>l;l++)n=a[l].split("="),i=o.decodeQuery(n.shift(),t),n=n.length?o.decodeQuery(n.join("="),t):null,r[i]?("string"==typeof r[i]&&(r[i]=[r[i]]),r[i].push(n)):r[i]=n;return r},o.build=function(e){var t="";return e.protocol&&(t+=e.protocol+":"),e.urn||!t&&!e.hostname||(t+="//"),t+=o.buildAuthority(e)||"","string"==typeof e.path&&("/"!==e.path.charAt(0)&&"string"==typeof e.hostname&&(t+="/"),t+=e.path),"string"==typeof e.query&&e.query&&(t+="?"+e.query),"string"==typeof e.fragment&&e.fragment&&(t+="#"+e.fragment),t},o.buildHost=function(e){var t="";return e.hostname?(o.ip6_expression.test(e.hostname)?t=e.port?t+("["+e.hostname+"]:"+e.port):t+e.hostname:(t+=e.hostname,e.port&&(t+=":"+e.port)),t):""},o.buildAuthority=function(e){return o.buildUserinfo(e)+o.buildHost(e)},o.buildUserinfo=function(e){var t="";return e.username&&(t+=o.encode(e.username),e.password&&(t+=":"+o.encode(e.password)),t+="@"),t},o.buildQuery=function(e,t,n){var i,r,a,l,u="";for(r in e)if(f.call(e,r)&&r)if(s(e[r]))for(i={},a=0,l=e[r].length;l>a;a++)void 0!==e[r][a]&&void 0===i[e[r][a]+""]&&(u+="&"+o.buildQueryParameter(r,e[r][a],n),!0!==t&&(i[e[r][a]+""]=!0));else void 0!==e[r]&&(u+="&"+o.buildQueryParameter(r,e[r],n));return u.substring(1)},o.buildQueryParameter=function(e,t,n){return o.encodeQuery(e,n)+(null!==t?"="+o.encodeQuery(t,n):"")},o.addQuery=function(e,t,n){if("object"==typeof t)for(var i in t)f.call(t,i)&&o.addQuery(e,i,t[i]);else{if("string"!=typeof t)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");void 0===e[t]?e[t]=n:("string"==typeof e[t]&&(e[t]=[e[t]]),s(n)||(n=[n]),e[t]=e[t].concat(n))}},o.removeQuery=function(e,t,n){var i;if(s(t))for(n=0,i=t.length;i>n;n++)e[t[n]]=void 0;else if("object"==typeof t)for(i in t)f.call(t,i)&&o.removeQuery(e,i,t[i]);else{if("string"!=typeof t)throw new TypeError("URI.addQuery() accepts an object, string as the first parameter");if(void 0!==n){if(e[t]===n)e[t]=void 0;else if(s(e[t])){i=e[t];var r,a,l={};if(s(n))for(r=0,a=n.length;a>r;r++)l[n[r]]=!0;else l[n]=!0;for(r=0,a=i.length;a>r;r++)void 0!==l[i[r]]&&(i.splice(r,1),a--,r--);e[t]=i}}else e[t]=void 0}},o.hasQuery=function(e,t,n,i){if("object"==typeof t){for(var r in t)if(f.call(t,r)&&!o.hasQuery(e,r,t[r]))return!1;return!0}if("string"!=typeof t)throw new TypeError("URI.hasQuery() accepts an object, string as the name parameter");switch(a(n)){case"Undefined":return t in e;case"Boolean":return e=Boolean(s(e[t])?e[t].length:e[t]),n===e;case"Function":return!!n(e[t],t,e);case"Array":return s(e[t])?(i?l:u)(e[t],n):!1;case"RegExp":return s(e[t])?i?l(e[t],n):!1:Boolean(e[t]&&e[t].match(n));case"Number":n+="";case"String":return s(e[t])?i?l(e[t],n):!1:e[t]===n;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},o.commonPath=function(e,t){var n,i=Math.min(e.length,t.length);for(n=0;i>n;n++)if(e.charAt(n)!==t.charAt(n)){n--;break}return 1>n?e.charAt(0)===t.charAt(0)&&"/"===e.charAt(0)?"/":"":(("/"!==e.charAt(n)||"/"!==t.charAt(n))&&(n=e.substring(0,n).lastIndexOf("/")),e.substring(0,n+1))},o.withinString=function(e,t){return e.replace(o.find_uri_expression,t)},o.ensureValidHostname=function(t){if(t.match(o.invalid_hostname_characters)){if(!e)throw new TypeError("Hostname '"+t+"' contains characters other than [A-Z0-9.-] and Punycode.js is not available");if(e.toASCII(t).match(o.invalid_hostname_characters))throw new TypeError("Hostname '"+t+"' contains characters other than [A-Z0-9.-]")}},o.noConflict=function(e){return e?(e={URI:this.noConflict()},URITemplate&&"function"==typeof URITemplate.noConflict&&(e.URITemplate=URITemplate.noConflict()),t&&"function"==typeof t.noConflict&&(e.IPv6=t.noConflict()),SecondLevelDomains&&"function"==typeof SecondLevelDomains.noConflict&&(e.SecondLevelDomains=SecondLevelDomains.noConflict()),e):(i.URI===this&&(i.URI=h),this)},p.build=function(e){return!0===e?this._deferred_build=!0:(void 0===e||this._deferred_build)&&(this._string=o.build(this._parts),this._deferred_build=!1),this},p.clone=function(){return new o(this)},p.valueOf=p.toString=function(){return this.build(!1)._string},g={protocol:"protocol",username:"username",password:"password",hostname:"hostname",port:"port"},v=function(e){return function(t,n){return void 0===t?this._parts[e]||"":(this._parts[e]=t||null,this.build(!n),this)}};for(m in g)p[m]=v(g[m]);g={query:"?",fragment:"#"},v=function(e,t){return function(n,i){return void 0===n?this._parts[e]||"":(null!==n&&(n+="",n.charAt(0)===t&&(n=n.substring(1))),this._parts[e]=n,this.build(!i),this)}};for(m in g)p[m]=v(m,g[m]);g={search:["?","query"],hash:["#","fragment"]},v=function(e,t){return function(n,i){var o=this[e](n,i);return"string"==typeof o&&o.length?t+o:o}};for(m in g)p[m]=v(g[m][1],g[m][0]);p.pathname=function(e,t){if(void 0===e||!0===e){var n=this._parts.path||(this._parts.hostname?"/":"");return e?o.decodePath(n):n}return this._parts.path=e?o.recodePath(e):"/",this.build(!t),this},p.path=p.pathname,p.href=function(e,t){var n;if(void 0===e)return""+this;this._string="",this._parts=o._parts();var i=e instanceof o,r="object"==typeof e&&(e.hostname||e.path||e.pathname);if(e.nodeName&&(r=o.getDomAttribute(e),e=e[r]||"",r=!1),!i&&r&&void 0!==e.pathname&&(e=""+e),"string"==typeof e)this._parts=o.parse(e,this._parts);else{if(!i&&!r)throw new TypeError("invalid input");for(n in i=i?e._parts:e)f.call(this._parts,n)&&(this._parts[n]=i[n])}return this.build(!t),this},p.is=function(e){var t=!1,i=!1,r=!1,a=!1,s=!1,l=!1,u=!1,c=!this._parts.urn;switch(this._parts.hostname&&(c=!1,i=o.ip4_expression.test(this._parts.hostname),r=o.ip6_expression.test(this._parts.hostname),t=i||r,s=(a=!t)&&n&&n.has(this._parts.hostname),l=a&&o.idn_expression.test(this._parts.hostname),u=a&&o.punycode_expression.test(this._parts.hostname)),e.toLowerCase()){case"relative":return c;case"absolute":return!c;case"domain":case"name":return a;case"sld":return s;case"ip":return t;case"ip4":case"ipv4":case"inet4":return i;case"ip6":case"ipv6":case"inet6":return r;case"idn":return l;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return u}return null};var y=p.protocol,b=p.port,w=p.hostname;p.protocol=function(e,t){if(void 0!==e&&e&&(e=e.replace(/:(\/\/)?$/,""),e.match(/[^a-zA-z0-9\.+-]/)))throw new TypeError("Protocol '"+e+"' contains characters other than [A-Z0-9.+-]");return y.call(this,e,t)},p.scheme=p.protocol,p.port=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0!==e&&(0===e&&(e=null),e&&(e+="",":"===e.charAt(0)&&(e=e.substring(1)),e.match(/[^0-9]/))))throw new TypeError("Port '"+e+"' contains characters other than [0-9]");return b.call(this,e,t)},p.hostname=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0!==e){var n={};o.parseHost(e,n),e=n.hostname}return w.call(this,e,t)},p.host=function(e,t){return this._parts.urn?void 0===e?"":this:void 0===e?this._parts.hostname?o.buildHost(this._parts):"":(o.parseHost(e,this._parts),this.build(!t),this)},p.authority=function(e,t){return this._parts.urn?void 0===e?"":this:void 0===e?this._parts.hostname?o.buildAuthority(this._parts):"":(o.parseAuthority(e,this._parts),this.build(!t),this)},p.userinfo=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){if(!this._parts.username)return"";var n=o.buildUserinfo(this._parts);return n.substring(0,n.length-1)}return"@"!==e[e.length-1]&&(e+="@"),o.parseUserinfo(e,this._parts),this.build(!t),this},p.resource=function(e,t){var n;return void 0===e?this.path()+this.search()+this.hash():(n=o.parse(e),this._parts.path=n.path,this._parts.query=n.query,this._parts.fragment=n.fragment,this.build(!t),this)},p.subdomain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,n)||""}return n=this._parts.hostname.length-this.domain().length,n=this._parts.hostname.substring(0,n),n=RegExp("^"+r(n)),e&&"."!==e.charAt(e.length-1)&&(e+="."),e&&o.ensureValidHostname(e),this._parts.hostname=this._parts.hostname.replace(n,e),this.build(!t),this},p.domain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"==typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.match(/\./g);return n&&2>n.length?this._parts.hostname:(n=this._parts.hostname.length-this.tld(t).length-1,n=this._parts.hostname.lastIndexOf(".",n-1)+1,this._parts.hostname.substring(n)||"")}if(!e)throw new TypeError("cannot set domain empty");return o.ensureValidHostname(e),!this._parts.hostname||this.is("IP")?this._parts.hostname=e:(n=RegExp(r(this.domain())+"$"),this._parts.hostname=this._parts.hostname.replace(n,e)),this.build(!t),this},p.tld=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"==typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var i=this._parts.hostname.lastIndexOf("."),i=this._parts.hostname.substring(i+1);return!0!==t&&n&&n.list[i.toLowerCase()]?n.get(this._parts.hostname)||i:i}if(!e)throw new TypeError("cannot set TLD empty");if(e.match(/[^a-zA-Z0-9-]/)){if(!n||!n.is(e))throw new TypeError("TLD '"+e+"' contains characters other than [A-Z0-9]");i=RegExp(r(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(i,e)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");i=RegExp(r(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(i,e)}return this.build(!t),this},p.directory=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||!0===e){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var n=this._parts.path.length-this.filename().length-1,n=this._parts.path.substring(0,n)||(this._parts.hostname?"/":"");return e?o.decodePath(n):n}return n=this._parts.path.length-this.filename().length,n=this._parts.path.substring(0,n),n=RegExp("^"+r(n)),this.is("relative")||(e||(e="/"),"/"!==e.charAt(0)&&(e="/"+e)),e&&"/"!==e.charAt(e.length-1)&&(e+="/"),e=o.recodePath(e),this._parts.path=this._parts.path.replace(n,e),this.build(!t),this},p.filename=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||!0===e){if(!this._parts.path||"/"===this._parts.path)return"";var n=this._parts.path.lastIndexOf("/"),n=this._parts.path.substring(n+1);return e?o.decodePathSegment(n):n}n=!1,"/"===e.charAt(0)&&(e=e.substring(1)),e.match(/\.?\//)&&(n=!0);var i=RegExp(r(this.filename())+"$");return e=o.recodePath(e),this._parts.path=this._parts.path.replace(i,e),n?this.normalizePath(t):this.build(!t),this},p.suffix=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||!0===e){if(!this._parts.path||"/"===this._parts.path)return"";var n=this.filename(),i=n.lastIndexOf(".");return-1===i?"":(n=n.substring(i+1),n=/^[a-z0-9%]+$/i.test(n)?n:"",e?o.decodePathSegment(n):n)}if("."===e.charAt(0)&&(e=e.substring(1)),n=this.suffix())i=e?RegExp(r(n)+"$"):RegExp(r("."+n)+"$");else{if(!e)return this;this._parts.path+="."+o.recodePath(e)}return i&&(e=o.recodePath(e),this._parts.path=this._parts.path.replace(i,e)),this.build(!t),this},p.segment=function(e,t,n){var i=this._parts.urn?":":"/",o=this.path(),r="/"===o.substring(0,1),o=o.split(i);if(void 0!==e&&"number"!=typeof e&&(n=t,t=e,e=void 0),void 0!==e&&"number"!=typeof e)throw Error("Bad segment '"+e+"', must be 0-based integer");if(r&&o.shift(),0>e&&(e=Math.max(o.length+e,0)),void 0===t)return void 0===e?o:o[e];if(null===e||void 0===o[e])if(s(t)){o=[],e=0;for(var a=t.length;a>e;e++)(t[e].length||o.length&&o[o.length-1].length)&&(o.length&&!o[o.length-1].length&&o.pop(),o.push(t[e]))}else(t||"string"==typeof t)&&(""===o[o.length-1]?o[o.length-1]=t:o.push(t));else t||"string"==typeof t&&t.length?o[e]=t:o.splice(e,1);return r&&o.unshift(""),this.path(o.join(i),n)},p.segmentCoded=function(e,t,n){var i,r;if("number"!=typeof e&&(n=t,t=e,e=void 0),void 0===t){if(e=this.segment(e,t,n),s(e))for(i=0,r=e.length;r>i;i++)e[i]=o.decode(e[i]);else e=void 0!==e?o.decode(e):void 0;return e}if(s(t))for(i=0,r=t.length;r>i;i++)t[i]=o.decode(t[i]);else t="string"==typeof t?o.encode(t):t;return this.segment(e,t,n)};var x=p.query;return p.query=function(e,t){if(!0===e)return o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof e){var n=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace),i=e.call(this,n);return this._parts.query=o.buildQuery(i||n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this}return void 0!==e&&"string"!=typeof e?(this._parts.query=o.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this):x.call(this,e,t)},p.setQuery=function(e,t,n){var i=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("object"==typeof e)for(var r in e)f.call(e,r)&&(i[r]=e[r]);else{if("string"!=typeof e)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");i[e]=void 0!==t?t:null}return this._parts.query=o.buildQuery(i,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(n=t),this.build(!n),this},p.addQuery=function(e,t,n){var i=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.addQuery(i,e,void 0===t?null:t),this._parts.query=o.buildQuery(i,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(n=t),this.build(!n),this},p.removeQuery=function(e,t,n){var i=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.removeQuery(i,e,t),this._parts.query=o.buildQuery(i,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(n=t),this.build(!n),this},p.hasQuery=function(e,t,n){var i=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.hasQuery(i,e,t,n)},p.setSearch=p.setQuery,p.addSearch=p.addQuery,p.removeSearch=p.removeQuery,p.hasSearch=p.hasQuery,p.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},p.normalizeProtocol=function(e){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!e)),this},p.normalizeHostname=function(n){return this._parts.hostname&&(this.is("IDN")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is("IPv6")&&t&&(this._parts.hostname=t.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!n)),this
},p.normalizePort=function(e){return"string"==typeof this._parts.protocol&&this._parts.port===o.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!e)),this},p.normalizePath=function(e){if(this._parts.urn||!this._parts.path||"/"===this._parts.path)return this;var t,n,i,r=this._parts.path;for("/"!==r.charAt(0)&&(t=!0,r="/"+r),r=r.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/");n=r.indexOf("/../"),-1!==n;){if(0===n){r=r.substring(3);break}i=r.substring(0,n).lastIndexOf("/"),-1===i&&(i=n),r=r.substring(0,i)+r.substring(n+3)}return t&&this.is("relative")&&(r=r.substring(1)),r=o.recodePath(r),this._parts.path=r,this.build(!e),this},p.normalizePathname=p.normalizePath,p.normalizeQuery=function(e){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(o.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!e)),this},p.normalizeFragment=function(e){return this._parts.fragment||(this._parts.fragment=null,this.build(!e)),this},p.normalizeSearch=p.normalizeQuery,p.normalizeHash=p.normalizeFragment,p.iso8859=function(){var e=o.encode,t=o.decode;return o.encode=escape,o.decode=decodeURIComponent,this.normalize(),o.encode=e,o.decode=t,this},p.unicode=function(){var e=o.encode,t=o.decode;return o.encode=d,o.decode=unescape,this.normalize(),o.encode=e,o.decode=t,this},p.readable=function(){var t=this.clone();t.username("").password("").normalize();var n="";if(t._parts.protocol&&(n+=t._parts.protocol+"://"),t._parts.hostname&&(t.is("punycode")&&e?(n+=e.toUnicode(t._parts.hostname),t._parts.port&&(n+=":"+t._parts.port)):n+=t.host()),t._parts.hostname&&t._parts.path&&"/"!==t._parts.path.charAt(0)&&(n+="/"),n+=t.path(!0),t._parts.query){for(var i="",r=0,a=t._parts.query.split("&"),s=a.length;s>r;r++){var l=(a[r]||"").split("="),i=i+("&"+o.decodeQuery(l[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"));void 0!==l[1]&&(i+="="+o.decodeQuery(l[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}n+="?"+i.substring(1)}return n+=o.decodeQuery(t.hash(),!0)},p.absoluteTo=function(e){var t,n,i=this.clone(),r=["protocol","username","password","hostname","port"];if(this._parts.urn)throw Error("URNs do not have any generally defined hierarchical components");if(e instanceof o||(e=new o(e)),i._parts.protocol||(i._parts.protocol=e._parts.protocol),this._parts.hostname)return i;for(t=0;n=r[t];t++)i._parts[n]=e._parts[n];for(r=["query","path"],t=0;n=r[t];t++)!i._parts[n]&&e._parts[n]&&(i._parts[n]=e._parts[n]);return"/"!==i.path().charAt(0)&&(e=e.directory(),i._parts.path=(e?e+"/":"")+i._parts.path,i.normalizePath()),i.build(),i},p.relativeTo=function(e){var t,n,i,r,a=this.clone().normalize();if(a._parts.urn)throw Error("URNs do not have any generally defined hierarchical components");if(e=new o(e).normalize(),t=a._parts,n=e._parts,i=a.path(),r=e.path(),"/"!==i.charAt(0))throw Error("URI is already relative");if("/"!==r.charAt(0))throw Error("Cannot calculate a URI relative to another relative URI");return t.protocol===n.protocol&&(t.protocol=null),t.username!==n.username||t.password!==n.password||null!==t.protocol||null!==t.username||null!==t.password||t.hostname!==n.hostname||t.port!==n.port?a.build():(t.hostname=null,t.port=null,i===r?(t.path="",a.build()):(e=o.commonPath(a.path(),e.path()))?(n=n.path.substring(e.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../"),t.path=n+t.path.substring(e.length),a.build()):a.build())},p.equals=function(e){var t=this.clone();e=new o(e);var n,i={},r={},a={};if(t.normalize(),e.normalize(),""+t==""+e)return!0;if(i=t.query(),r=e.query(),t.query(""),e.query(""),""+t!=""+e||i.length!==r.length)return!1;i=o.parseQuery(i,this._parts.escapeQuerySpace),r=o.parseQuery(r,this._parts.escapeQuerySpace);for(n in i)if(f.call(i,n)){if(s(i[n])){if(!u(i[n],r[n]))return!1}else if(i[n]!==r[n])return!1;a[n]=!0}for(n in r)if(f.call(r,n)&&!a[n])return!1;return!0},p.duplicateQueryParameters=function(e){return this._parts.duplicateQueryParameters=!!e,this},p.escapeQuerySpace=function(e){return this._parts.escapeQuerySpace=!!e,this},o}),function(e,t){"object"==typeof exports?module.exports=t(require("./URI")):"function"==typeof define&&define.amd?define(["./URI"],t):e.URITemplate=t(e.URI,e)}(this,function(e,t){function n(e){return n._cache[e]?n._cache[e]:this instanceof n?(this.expression=e,n._cache[e]=this,this):new n(e)}function i(e){this.data=e,this.cache={}}var o=t&&t.URITemplate,r=Object.prototype.hasOwnProperty,a=n.prototype,s={"":{prefix:"",separator:",",named:!1,empty_name_separator:!1,encode:"encode"},"+":{prefix:"",separator:",",named:!1,empty_name_separator:!1,encode:"encodeReserved"},"#":{prefix:"#",separator:",",named:!1,empty_name_separator:!1,encode:"encodeReserved"},".":{prefix:".",separator:".",named:!1,empty_name_separator:!1,encode:"encode"},"/":{prefix:"/",separator:"/",named:!1,empty_name_separator:!1,encode:"encode"},";":{prefix:";",separator:";",named:!0,empty_name_separator:!1,encode:"encode"},"?":{prefix:"?",separator:"&",named:!0,empty_name_separator:!0,encode:"encode"},"&":{prefix:"&",separator:"&",named:!0,empty_name_separator:!0,encode:"encode"}};return n._cache={},n.EXPRESSION_PATTERN=/\{([^a-zA-Z0-9%_]?)([^\}]+)(\}|$)/g,n.VARIABLE_PATTERN=/^([^*:]+)((\*)|:(\d+))?$/,n.VARIABLE_NAME_PATTERN=/[^a-zA-Z0-9%_]/,n.expand=function(e,t){var i,o,r,a=s[e.operator],l=a.named?"Named":"Unnamed",u=e.variables,c=[];for(r=0;o=u[r];r++)i=t.get(o.name),i.val.length?c.push(n["expand"+l](i,a,o.explode,o.explode&&a.separator||",",o.maxlength,o.name)):i.type&&c.push("");return c.length?a.prefix+c.join(a.separator):""},n.expandNamed=function(t,n,i,o,r,a){var s="",l=n.encode;n=n.empty_name_separator;var u,c,d,h=!t[l].length,p=2===t.type?"":e[l](a);for(c=0,d=t.val.length;d>c;c++)r?(u=e[l](t.val[c][1].substring(0,r)),2===t.type&&(p=e[l](t.val[c][0].substring(0,r)))):h?(u=e[l](t.val[c][1]),2===t.type?(p=e[l](t.val[c][0]),t[l].push([p,u])):t[l].push([void 0,u])):(u=t[l][c][1],2===t.type&&(p=t[l][c][0])),s&&(s+=o),i?s+=p+(n||u?"=":"")+u:(c||(s+=e[l](a)+(n||u?"=":"")),2===t.type&&(s+=p+","),s+=u);return s},n.expandUnnamed=function(t,n,i,o,r,a){a="";var s=n.encode;n=n.empty_name_separator;var l,u,c,d,h=!t[s].length;for(c=0,d=t.val.length;d>c;c++)r?u=e[s](t.val[c][1].substring(0,r)):h?(u=e[s](t.val[c][1]),t[s].push([2===t.type?e[s](t.val[c][0]):void 0,u])):u=t[s][c][1],a&&(a+=o),2===t.type&&(l=r?e[s](t.val[c][0].substring(0,r)):t[s][c][0],a+=l,a=i?a+(n||u?"=":""):a+","),a+=u;return a},n.noConflict=function(){return t.URITemplate===n&&(t.URITemplate=o),n},a.expand=function(e){var t="";this.parts&&this.parts.length||this.parse(),e instanceof i||(e=new i(e));for(var o=0,r=this.parts.length;r>o;o++)t+="string"==typeof this.parts[o]?this.parts[o]:n.expand(this.parts[o],e);return t},a.parse=function(){var e,t,i,o=this.expression,r=n.EXPRESSION_PATTERN,a=n.VARIABLE_PATTERN,l=n.VARIABLE_NAME_PATTERN,u=[],c=0;for(r.lastIndex=0;;){if(t=r.exec(o),null===t){u.push(o.substring(c));break}if(u.push(o.substring(c,t.index)),c=t.index+t[0].length,!s[t[1]])throw Error('Unknown Operator "'+t[1]+'" in "'+t[0]+'"');if(!t[3])throw Error('Unclosed Expression "'+t[0]+'"');e=t[2].split(",");for(var d=0,h=e.length;h>d;d++){if(i=e[d].match(a),null===i)throw Error('Invalid Variable "'+e[d]+'" in "'+t[0]+'"');if(i[1].match(l))throw Error('Invalid Variable Name "'+i[1]+'" in "'+t[0]+'"');e[d]={name:i[1],explode:!!i[3],maxlength:i[4]&&parseInt(i[4],10)}}if(!e.length)throw Error('Expression Missing Variable(s) "'+t[0]+'"');u.push({expression:t[0],operator:t[1],variables:e})}return u.length||u.push(o),this.parts=u,this},i.prototype.get=function(e){var t,n=this.data,i={type:0,val:[],encode:[],encodeReserved:[]};if(void 0!==this.cache[e])return this.cache[e];if(this.cache[e]=i,n="[object Function]"==Object.prototype.toString.call(n)+""?n(e):"[object Function]"==Object.prototype.toString.call(n[e])+""?n[e](e):n[e],void 0!==n&&null!==n)if("[object Array]"==Object.prototype.toString.call(n)+""){for(t=0,e=n.length;e>t;t++)void 0!==n[t]&&null!==n[t]&&i.val.push([void 0,n[t]+""]);i.val.length&&(i.type=3)}else if("[object Object]"==Object.prototype.toString.call(n)+""){for(t in n)r.call(n,t)&&void 0!==n[t]&&null!==n[t]&&i.val.push([t,n[t]+""]);i.val.length&&(i.type=2)}else i.type=1,i.val.push([void 0,n+""]);return i},e.expand=function(t,i){var o=new n(t).expand(i);return new e(o)},n});var findChild,getNodeName,getNodePosition,simpleXPathJQuery,simpleXPathPure;simpleXPathJQuery=function(e){var t;return t=this.map(function(){var t,n,i,o;for(i="",t=this;(null!=t?t.nodeType:void 0)===Node.ELEMENT_NODE&&t!==e;)o=t.tagName.replace(":","\\:"),n=$(t.parentNode).children(o).index(t)+1,n="["+n+"]",i="/"+t.tagName.toLowerCase()+n+i,t=t.parentNode;return i}),t.get()},simpleXPathPure=function(e){var t,n,i,o;return t=function(e){var t,n;return t=getNodeName(e),n=getNodePosition(e),""+t+"["+n+"]"},o=e,n=function(e){var n;for(n="";e!==o;){if(null==e)throw Error("Called getPathTo on a node which was not a descendant of @rootNode. "+o);n=t(e)+"/"+n,e=e.parentNode}return n="/"+n,n=n.replace(/\/$/,"")},i=this.map(function(){var e;return e=n(this)}),i.get()},findChild=function(e,t,n){var i,o,r,a,s,l;if(!e.hasChildNodes())throw Error("XPath error: node has no children!");for(o=e.childNodes,r=0,s=0,l=o.length;l>s;s++)if(i=o[s],a=getNodeName(i),a===t&&(r+=1,r===n))return i;throw Error("XPath error: wanted child not found.")},getNodeName=function(e){var t;switch(t=e.nodeName.toLowerCase()){case"#text":return"text()";case"#comment":return"comment()";case"#cdata-section":return"cdata-section()";default:return t}},getNodePosition=function(e){var t,n;for(t=0,n=e;n;)n.nodeName===e.nodeName&&t++,n=n.previousSibling;return t};var $,Util,gettext,_gettext,_ref,_t;gettext=null,"undefined"!=typeof Gettext&&null!==Gettext?(_gettext=new Gettext({domain:"annotator"}),gettext=function(e){return _gettext.gettext(e)}):gettext=function(e){return e},_t=function(e){return gettext(e)},("undefined"!=typeof jQuery&&null!==jQuery?null!=(_ref=jQuery.fn)?_ref.jquery:void 0:void 0)||console.error(_t("Annotator requires jQuery: have you included lib/vendor/jquery.js?")),JSON&&JSON.parse&&JSON.stringify||console.error(_t("Annotator requires a JSON implementation: have you included lib/vendor/json2.js?")),$=jQuery,Util={},Util.flatten=function(e){var t;return t=function(e){var n,i,o,r;for(i=[],o=0,r=e.length;r>o;o++)n=e[o],i=i.concat(n&&$.isArray(n)?t(n):n);return i},t(e)},Util.contains=function(e,t){var n;for(n=t;null!=n;){if(n===e)return!0;n=n.parentNode}return!1},Util.getTextNodes=function(e){var t;return t=function(e){var n;if(e&&e.nodeType!==Node.TEXT_NODE){if(n=[],e.nodeType!==Node.COMMENT_NODE)for(e=e.lastChild;e;)n.push(t(e)),e=e.previousSibling;return n.reverse()}return e},e.map(function(){return Util.flatten(t(this))})},Util.getLastTextNodeUpTo=function(e){var t;switch(e.nodeType){case Node.TEXT_NODE:return e;case Node.ELEMENT_NODE:if(null!=e.lastChild&&(t=Util.getLastTextNodeUpTo(e.lastChild),null!=t))return t}return e=e.previousSibling,null!=e?Util.getLastTextNodeUpTo(e):null},Util.getFirstTextNodeNotBefore=function(e){var t;switch(e.nodeType){case Node.TEXT_NODE:return e;case Node.ELEMENT_NODE:if(null!=e.firstChild&&(t=Util.getFirstTextNodeNotBefore(e.firstChild),null!=t))return t}return e=e.nextSibling,null!=e?Util.getFirstTextNodeNotBefore(e):null},Util.readRangeViaSelection=function(e){var t;return t=Util.getGlobal().getSelection(),t.removeAllRanges(),t.addRange(e.toRange()),""+t},Util.xpathFromNode=function(e,t){var n,i;try{i=simpleXPathJQuery.call(e,t)}catch(o){n=o,console.log("jQuery-based XPath construction failed! Falling back to manual."),i=simpleXPathPure.call(e,t)}return i},Util.nodeFromXPath=function(e,t){var n,i,o,r,a,s,l,u;for(a=e.substring(1).split("/"),o=t,s=0,l=a.length;l>s;s++)r=a[s],u=r.split("["),i=u[0],n=u[1],n=null!=n?parseInt((null!=n?n.split("]"):void 0)[0]):1,o=findChild(o,i.toLowerCase(),n);return o},Util.escape=function(e){return e.replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},Util.uuid=function(){var e;return e=0,function(){return e++}}(),Util.getGlobal=function(){return function(){return this}()},Util.maxZIndex=function(e){var t,n;return t=function(){var t,i,o;for(o=[],t=0,i=e.length;i>t;t++)n=e[t],"static"===$(n).css("position")?o.push(-1):o.push(parseInt($(n).css("z-index"),10)||-1);return o}(),Math.max.apply(Math,t)},Util.mousePosition=function(e,t){var n,i;return"absolute"!==(i=$(t).css("position"))&&"fixed"!==i&&"relative"!==i&&(t=$(t).offsetParent()[0]),n=$(t).offset(),{top:e.pageY-n.top,left:e.pageX-n.left}},Util.preventEventDefault=function(e){return null!=e?"function"==typeof e.preventDefault?e.preventDefault():void 0:void 0};var fn,functions,_i,_j,_len,_len1,__slice=[].slice;if(functions=["log","debug","info","warn","exception","assert","dir","dirxml","trace","group","groupEnd","groupCollapsed","time","timeEnd","profile","profileEnd","count","clear","table","error","notifyFirebug","firebug","userObjects"],"undefined"!=typeof console&&null!==console)for(null==console.group&&(console.group=function(e){return console.log("GROUP: ",e)}),null==console.groupCollapsed&&(console.groupCollapsed=console.group),_i=0,_len=functions.length;_len>_i;_i++)fn=functions[_i],null==console[fn]&&(console[fn]=function(){return console.log(_t("Not implemented:")+(" console."+name))});else{for(this.console={},_j=0,_len1=functions.length;_len1>_j;_j++)fn=functions[_j],this.console[fn]=function(){};this.console.error=function(){var e;return e=arguments.length>=1?__slice.call(arguments,0):[],alert("ERROR: "+e.join(", "))},this.console.warn=function(){var e;return e=arguments.length>=1?__slice.call(arguments,0):[],alert("WARNING: "+e.join(", "))}}var Delegator,__slice=[].slice,__hasProp={}.hasOwnProperty;Delegator=function(){function e(e,t){this.options=$.extend(!0,{},this.options,t),this.element=$(e),this._closures={},this.on=this.subscribe,this.addEvents()}return e.prototype.events={},e.prototype.options={},e.prototype.element=null,e.prototype.addEvents=function(){var t,n,i,o,r;for(o=e._parseEvents(this.events),r=[],n=0,i=o.length;i>n;n++)t=o[n],r.push(this._addEvent(t.selector,t.event,t.functionName));return r},e.prototype.removeEvents=function(){var t,n,i,o,r;for(o=e._parseEvents(this.events),r=[],n=0,i=o.length;i>n;n++)t=o[n],r.push(this._removeEvent(t.selector,t.event,t.functionName));return r},e.prototype._addEvent=function(t,n,i){var o,r=this;return o=function(){return r[i].apply(r,arguments)},""===t&&e._isCustomEvent(n)?this.subscribe(n,o):this.element.delegate(t,n,o),this._closures[""+t+"/"+n+"/"+i]=o,this},e.prototype._removeEvent=function(t,n,i){var o;return o=this._closures[""+t+"/"+n+"/"+i],""===t&&e._isCustomEvent(n)?this.unsubscribe(n,o):this.element.undelegate(t,n,o),delete this._closures[""+t+"/"+n+"/"+i],this},e.prototype.publish=function(){return this.element.triggerHandler.apply(this.element,arguments),this},e.prototype.subscribe=function(e,t){var n;return n=function(){return t.apply(this,[].slice.call(arguments,1))},n.guid=t.guid=$.guid+=1,this.element.bind(e,n),this},e.prototype.unsubscribe=function(){return this.element.unbind.apply(this.element,arguments),this},e}(),Delegator._parseEvents=function(e){var t,n,i,o,r,a,s;n=[];for(o in e)i=e[o],s=o.split(" "),r=s.length>=2?__slice.call(s,0,a=s.length-1):(a=0,[]),t=s[a++],n.push({selector:r.join(" "),event:t,functionName:i});return n},Delegator.natives=function(){var e,t,n;return t=function(){var t,i;t=jQuery.event.special,i=[];for(e in t)__hasProp.call(t,e)&&(n=t[e],i.push(e));return i}(),"blur focus focusin focusout load resize scroll unload click dblclick\nmousedown mouseup mousemove mouseover mouseout mouseenter mouseleave\nchange select submit keydown keypress keyup error".split(/[^a-z]+/).concat(t)}(),Delegator._isCustomEvent=function(e){return e=e.split(".")[0],-1===$.inArray(e,Delegator.natives)};var Range,__hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var i in t)__hasProp.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};Range={},Range.sniff=function(e){return null!=e.commonAncestorContainer?new Range.BrowserRange(e):"string"==typeof e.start?new Range.SerializedRange(e):e.start&&"object"==typeof e.start?new Range.NormalizedRange(e):(console.error(_t("Could not sniff range type")),!1)},Range.nodeFromXPath=function(e,t){var n,i,o,r,a;return null==t&&(t=document),i=function(e,n){var i;null==n&&(n=null);try{return document.evaluate("."+e,t,n,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}catch(o){return i=o,console.log("XPath evaluation failed."),console.log("Trying fallback..."),Util.nodeFromXPath(e,t)}},$.isXMLDoc(document.documentElement)?(n=document.createNSResolver(null===document.ownerDocument?document.documentElement:document.ownerDocument.documentElement),r=i(e,n),r||(e=function(){var t,n,i,o;for(i=e.split("/"),o=[],t=0,n=i.length;n>t;t++)a=i[t],a&&-1===a.indexOf(":")?o.push(a.replace(/^([a-z]+)/,"xhtml:$1")):o.push(a);return o}().join("/"),o=document.lookupNamespaceURI(null),n=function(e){return"xhtml"===e?o:document.documentElement.getAttribute("xmlns:"+e)},r=i(e,n)),r):i(e)},Range.RangeError=function(e){function t(e,n,i){this.type=e,this.message=n,this.parent=null!=i?i:null,t.__super__.constructor.call(this,this.message)}return __extends(t,e),t}(Error),Range.BrowserRange=function(){function e(e){this.commonAncestorContainer=e.commonAncestorContainer,this.startContainer=e.startContainer,this.startOffset=e.startOffset,this.endContainer=e.endContainer,this.endOffset=e.endOffset}return e.prototype.normalize=function(){var e,t,n,i;if(this.tainted)return console.error(_t("You may only call normalize() once on a BrowserRange!")),!1;if(this.tainted=!0,i={},this.startContainer.nodeType===Node.ELEMENT_NODE?(i.start=Util.getFirstTextNodeNotBefore(this.startContainer.childNodes[this.startOffset]),i.startOffset=0):(i.start=this.startContainer,i.startOffset=this.startOffset),this.endContainer.nodeType===Node.ELEMENT_NODE){if(t=this.endContainer.childNodes[this.endOffset],null!=t){for(e=t;null!=e&&e.nodeType!==Node.TEXT_NODE;)e=e.firstChild;null!=e&&(i.end=e,i.endOffset=0)}null==i.end&&(t=this.endContainer.childNodes[this.endOffset-1],i.end=Util.getLastTextNodeUpTo(t),i.endOffset=i.end.nodeValue.length)}else i.end=this.endContainer,i.endOffset=this.endOffset;for(n={},n.start=i.startOffset>0?i.start.nodeValue.length>i.startOffset?i.start.splitText(i.startOffset):i.start.nextSibling:i.start,i.start===i.end?(n.start.nodeValue.length>i.endOffset-i.startOffset&&n.start.splitText(i.endOffset-i.startOffset),n.end=n.start):(i.end.nodeValue.length>i.endOffset&&i.end.splitText(i.endOffset),n.end=i.end),n.commonAncestor=this.commonAncestorContainer;n.commonAncestor.nodeType!==Node.ELEMENT_NODE;)n.commonAncestor=n.commonAncestor.parentNode;return new Range.NormalizedRange(n)},e.prototype.serialize=function(e,t){return this.normalize(e).serialize(e,t)},e}(),Range.NormalizedRange=function(){function e(e){this.commonAncestor=e.commonAncestor,this.start=e.start,this.end=e.end}return e.prototype.normalize=function(){return this},e.prototype.limit=function(e){var t,n,i,o,r,a;if(t=$.grep(this.textNodes(),function(t){return t.parentNode===e||$.contains(e,t.parentNode)}),!t.length)return null;for(this.start=t[0],this.end=t[t.length-1],i=$(this.start).parents(),a=$(this.end).parents(),o=0,r=a.length;r>o;o++)if(n=a[o],-1!==i.index(n)){this.commonAncestor=n;break}return this},e.prototype.serialize=function(e,t){var n,i,o;return i=function(n,i){var o,r,a,s,l,u,c,d;for(s=t?$(n).parents(":not("+t+")").eq(0):$(n).parent(),u=Util.xpathFromNode(s,e)[0],l=Util.getTextNodes(s),r=l.slice(0,l.index(n)),a=0,c=0,d=r.length;d>c;c++)o=r[c],a+=o.nodeValue.length;return i?[u,a+n.nodeValue.length]:[u,a]},o=i(this.start),n=i(this.end,!0),new Range.SerializedRange({start:o[0],end:n[0],startOffset:o[1],endOffset:n[1]})},e.prototype.text=function(){var e;return function(){var t,n,i,o;for(i=this.textNodes(),o=[],t=0,n=i.length;n>t;t++)e=i[t],o.push(e.nodeValue);return o}.call(this).join("")},e.prototype.textNodes=function(){var e,t,n,i;return n=Util.getTextNodes($(this.commonAncestor)),i=[n.index(this.start),n.index(this.end)],t=i[0],e=i[1],$.makeArray(n.slice(t,+e+1||9e9))},e.prototype.toRange=function(){var e;return e=document.createRange(),e.setStartBefore(this.start),e.setEndAfter(this.end),e},e}(),Range.SerializedRange=function(){function e(e){this.start=e.start,this.startOffset=e.startOffset,this.end=e.end,this.endOffset=e.endOffset}return e.prototype.normalize=function(e){var t,n,i,o,r,a,s,l,u,c,d,h,p,f;for(a={},p=["start","end"],u=0,d=p.length;d>u;u++){r=p[u];try{o=Range.nodeFromXPath(this[r],e)}catch(m){throw n=m,new Range.RangeError(r,"Error while finding "+r+" node: "+this[r]+": "+n,n)}if(!o)throw new Range.RangeError(r,"Couldn't find "+r+" node: "+this[r]);for(i=0,s=this[r+"Offset"],"end"===r&&s--,f=Util.getTextNodes($(o)),c=0,h=f.length;h>c;c++){if(l=f[c],i+l.nodeValue.length>s){a[r+"Container"]=l,a[r+"Offset"]=this[r+"Offset"]-i;break}i+=l.nodeValue.length}if(null==a[r+"Offset"])throw new Range.RangeError(""+r+"offset","Couldn't find offset "+this[r+"Offset"]+" in element "+this[r])}return t=null==document.compareDocumentPosition?function(e,t){return e.contains(t)}:function(e,t){return 16&e.compareDocumentPosition(t)},$(a.startContainer).parents().each(function(){return t(this,a.endContainer)?(a.commonAncestorContainer=this,!1):void 0}),new Range.BrowserRange(a).normalize(e)},e.prototype.serialize=function(e,t){return this.normalize(e).serialize(e,t)},e.prototype.toObject=function(){return{start:this.start,startOffset:this.startOffset,end:this.end,endOffset:this.endOffset}},e}();var Annotator,g,_Annotator,_ref,__bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var i in t)__hasProp.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};_Annotator=this.Annotator,Annotator=function(e){function t(){return this.onDeleteAnnotation=__bind(this.onDeleteAnnotation,this),this.onEditAnnotation=__bind(this.onEditAnnotation,this),this.onAdderClick=__bind(this.onAdderClick,this),this.onAdderMousedown=__bind(this.onAdderMousedown,this),this.onHighlightMouseover=__bind(this.onHighlightMouseover,this),this.checkForEndSelection=__bind(this.checkForEndSelection,this),this.checkForStartSelection=__bind(this.checkForStartSelection,this),this.clearViewerHideTimer=__bind(this.clearViewerHideTimer,this),this.startViewerHideTimer=__bind(this.startViewerHideTimer,this),this.showViewer=__bind(this.showViewer,this),this.onEditorSubmit=__bind(this.onEditorSubmit,this),this.onEditorHide=__bind(this.onEditorHide,this),this.showEditor=__bind(this.showEditor,this),t.__super__.constructor.apply(this,arguments),this.plugins={},t.supported()?(this.options.readOnly||this._setupDocumentEvents(),this._setupWrapper()._setupViewer()._setupEditor(),this._setupDynamicStyle(),this.adder=$(this.html.adder).appendTo(this.wrapper).hide(),t._instances.push(this),void 0):this}return __extends(t,e),t.prototype.events={".annotator-adder button click":"onAdderClick",".annotator-adder button mousedown":"onAdderMousedown",".annotator-hl mouseover":"onHighlightMouseover",".annotator-hl mouseout":"startViewerHideTimer"},t.prototype.html={adder:'<div class="annotator-adder"><button>'+_t("Annotate")+"</button></div>",wrapper:'<div class="annotator-wrapper"></div>'},t.prototype.options={readOnly:!1},t.prototype.plugins={},t.prototype.editor=null,t.prototype.viewer=null,t.prototype.selectedRanges=null,t.prototype.mouseIsDown=!1,t.prototype.ignoreMouseup=!1,t.prototype.viewerHideTimer=null,t.prototype._setupWrapper=function(){return this.wrapper=$(this.html.wrapper),this.element.find("script").remove(),this.element.wrapInner(this.wrapper),this.wrapper=this.element.find(".annotator-wrapper"),this},t.prototype._setupViewer=function(){var e=this;return this.viewer=new t.Viewer({readOnly:this.options.readOnly}),this.viewer.hide().on("edit",this.onEditAnnotation).on("delete",this.onDeleteAnnotation).addField({load:function(t,n){return n.text?$(t).html(Util.escape(n.text)):$(t).html("<i>"+_t("No Comment")+"</i>"),e.publish("annotationViewerTextField",[t,n])}}).element.appendTo(this.wrapper).bind({mouseover:this.clearViewerHideTimer,mouseout:this.startViewerHideTimer}),this},t.prototype._setupEditor=function(){return this.editor=new t.Editor,this.editor.hide().on("hide",this.onEditorHide).on("save",this.onEditorSubmit).addField({type:"textarea",label:_t("Comments")+"…",load:function(e,t){return $(e).find("textarea").val(t.text||"")},submit:function(e,t){return t.text=$(e).find("textarea").val()}}),this.editor.element.appendTo(this.wrapper),this},t.prototype._setupDocumentEvents=function(){return $(document).bind({mouseup:this.checkForEndSelection,mousedown:this.checkForStartSelection}),this},t.prototype._setupDynamicStyle=function(){var e,t,n,i;return n=$("#annotator-dynamic-style"),n.length||(n=$('<style id="annotator-dynamic-style"></style>').appendTo(document.head)),t="*"+function(){var e,t,n,o;for(n=["adder","outer","notice","filter"],o=[],e=0,t=n.length;t>e;e++)i=n[e],o.push(":not(.annotator-"+i+")");return o}().join(""),e=Util.maxZIndex($(document.body).find(t)),e=Math.max(e,1e3),n.text([".annotator-adder, .annotator-outer, .annotator-notice {","  z-index: "+(e+20)+";","}",".annotator-filter {","  z-index: "+(e+10)+";","}"].join("\n")),this},t.prototype.destroy=function(){var e,n,i,o;$(document).unbind({mouseup:this.checkForEndSelection,mousedown:this.checkForStartSelection}),$("#annotator-dynamic-style").remove(),this.adder.remove(),this.viewer.destroy(),this.editor.destroy(),this.wrapper.find(".annotator-hl").each(function(){return $(this).contents().insertBefore(this),$(this).remove()}),this.wrapper.contents().insertBefore(this.wrapper),this.wrapper.remove(),this.element.data("annotator",null),o=this.plugins;for(n in o)i=o[n],this.plugins[n].destroy();return this.removeEvents(),e=t._instances.indexOf(this),-1!==e?t._instances.splice(e,1):void 0},t.prototype.getSelectedRanges=function(){var e,t,n,i,o,r,a,s,l;for(a=Util.getGlobal().getSelection(),o=[],r=[],a.isCollapsed||(o=function(){var o,s,l;for(l=[],t=o=0,s=a.rangeCount;s>=0?s>o:o>s;t=s>=0?++o:--o)i=a.getRangeAt(t),e=new Range.BrowserRange(i),n=e.normalize().limit(this.wrapper[0]),null===n&&r.push(i),l.push(n);return l}.call(this),a.removeAllRanges()),s=0,l=r.length;l>s;s++)i=r[s],a.addRange(i);return $.grep(o,function(e){return e&&a.addRange(e.toRange()),e})},t.prototype.createAnnotation=function(){var e;return e={},this.publish("beforeAnnotationCreated",[e]),e},t.prototype.setupAnnotation=function(e){var t,n,i,o,r,a,s,l,u,c;for(r=this.wrapper[0],e.ranges||(e.ranges=this.selectedRanges),i=[],c=e.ranges,a=0,l=c.length;l>a;a++){o=c[a];try{i.push(Range.sniff(o).normalize(r))}catch(d){if(t=d,!(t instanceof Range.RangeError))throw t;this.publish("rangeNormalizeFail",[e,o,t])}}if(0!==i.length){for(e.quote=[],e.ranges=[],e.highlights=[],s=0,u=i.length;u>s;s++)n=i[s],e.quote.push($.trim(n.text())),e.ranges.push(n.serialize(this.wrapper[0],".annotator-hl")),$.merge(e.highlights,this.highlightRange(n));e.quote=e.quote.join(" / "),$(e.highlights).data("annotation",e)}return e},t.prototype.updateAnnotation=function(e){return this.publish("beforeAnnotationUpdated",[e]),this.publish("annotationUpdated",[e]),e},t.prototype.deleteAnnotation=function(e){var t,n,i,o,r;if(null!=e.highlights)for(r=e.highlights,i=0,o=r.length;o>i;i++)n=r[i],null!=n.parentNode&&(t=n.childNodes[0],$(n).replaceWith(n.childNodes));return this.publish("annotationDeleted",[e]),e},t.prototype.loadAnnotations=function(e){var t,n,i=this;return null==e&&(e=[]),n=function(e){var o,r,a,s;for(null==e&&(e=[]),r=e.splice(0,10),a=0,s=r.length;s>a;a++)o=r[a],i.setupAnnotation(o);return e.length>0?setTimeout(function(){return n(e)},10):i.publish("annotationsLoaded",[t])},t=e.slice(),e.length?n(e):i.publish("annotationsLoaded",[t]),this},t.prototype.dumpAnnotations=function(){return this.plugins.Store?this.plugins.Store.dumpAnnotations():(console.warn(_t("Can't dump annotations without Store plugin.")),!1)},t.prototype.highlightRange=function(e,t){var n,i,o,r,a,s,l;for(null==t&&(t="annotator-hl"),o=/^\s*$/,n=$("<span class='"+t+"'></span>"),s=e.textNodes(),l=[],r=0,a=s.length;a>r;r++)i=s[r],o.test(i.nodeValue)||l.push($(i).wrapAll(n).parent().show()[0]);return l},t.prototype.highlightRanges=function(e,t){var n,i,o,r;for(null==t&&(t="annotator-hl"),n=[],o=0,r=e.length;r>o;o++)i=e[o],$.merge(n,this.highlightRange(i,t));return n},t.prototype.addPlugin=function(e,n){var i,o;return this.plugins[e]?console.error(_t("You cannot have more than one instance of any plugin.")):(i=t.Plugin[e],"function"==typeof i?(this.plugins[e]=new i(this.element[0],n),this.plugins[e].annotator=this,"function"==typeof(o=this.plugins[e]).pluginInit&&o.pluginInit()):console.error(_t("Could not load ")+e+_t(" plugin. Have you included the appropriate <script> tag?"))),this},t.prototype.showEditor=function(e,t){return this.editor.element.css(t),this.editor.load(e),this.publish("annotationEditorShown",[this.editor,e]),this},t.prototype.onEditorHide=function(){return this.publish("annotationEditorHidden",[this.editor]),this.ignoreMouseup=!1},t.prototype.onEditorSubmit=function(e){return this.publish("annotationEditorSubmit",[this.editor,e])},t.prototype.showViewer=function(e,t){return this.viewer.element.css(t),this.viewer.load(e),this.publish("annotationViewerShown",[this.viewer,e])},t.prototype.startViewerHideTimer=function(){return this.viewerHideTimer?void 0:this.viewerHideTimer=setTimeout(this.viewer.hide,250)},t.prototype.clearViewerHideTimer=function(){return clearTimeout(this.viewerHideTimer),this.viewerHideTimer=!1},t.prototype.checkForStartSelection=function(e){return e&&this.isAnnotator(e.target)||this.startViewerHideTimer(),this.mouseIsDown=!0},t.prototype.checkForEndSelection=function(e){var t,n,i,o,r;if(this.mouseIsDown=!1,!this.ignoreMouseup){for(this.selectedRanges=this.getSelectedRanges(),r=this.selectedRanges,i=0,o=r.length;o>i;i++)if(n=r[i],t=n.commonAncestor,$(t).hasClass("annotator-hl")&&(t=$(t).parents("[class!=annotator-hl]")[0]),this.isAnnotator(t))return;return e&&this.selectedRanges.length?this.adder.css(Util.mousePosition(e,this.wrapper[0])).show():this.adder.hide()}},t.prototype.isAnnotator=function(e){return!!$(e).parents().andSelf().filter("[class^=annotator-]").not(this.wrapper).length},t.prototype.onHighlightMouseover=function(e){var t;return this.clearViewerHideTimer(),this.mouseIsDown||this.viewer.isShown()?!1:(t=$(e.target).parents(".annotator-hl").andSelf().map(function(){return $(this).data("annotation")}),this.showViewer($.makeArray(t),Util.mousePosition(e,this.wrapper[0])))},t.prototype.onAdderMousedown=function(e){return null!=e&&e.preventDefault(),this.ignoreMouseup=!0},t.prototype.onAdderClick=function(e){var t,n,i,o,r,a=this;return null!=e&&e.preventDefault(),o=this.adder.position(),this.adder.hide(),t=this.setupAnnotation(this.createAnnotation()),$(t.highlights).addClass("annotator-hl-temporary"),r=function(){return i(),$(t.highlights).removeClass("annotator-hl-temporary"),a.publish("annotationCreated",[t])},n=function(){return i(),a.deleteAnnotation(t)},i=function(){return a.unsubscribe("annotationEditorHidden",n),a.unsubscribe("annotationEditorSubmit",r)},this.subscribe("annotationEditorHidden",n),this.subscribe("annotationEditorSubmit",r),this.showEditor(t,o)},t.prototype.onEditAnnotation=function(e){var t,n,i,o=this;return n=this.viewer.element.position(),i=function(){return t(),o.updateAnnotation(e)},t=function(){return o.unsubscribe("annotationEditorHidden",t),o.unsubscribe("annotationEditorSubmit",i)},this.subscribe("annotationEditorHidden",t),this.subscribe("annotationEditorSubmit",i),this.viewer.hide(),this.showEditor(e,n)
},t.prototype.onDeleteAnnotation=function(e){return this.viewer.hide(),this.deleteAnnotation(e)},t}(Delegator),Annotator.Plugin=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.pluginInit=function(){},t.prototype.destroy=function(){return this.removeEvents()},t}(Delegator),g=Util.getGlobal(),null==(null!=(_ref=g.document)?_ref.evaluate:void 0)&&$.getScript("http://assets.annotateit.org/vendor/xpath.min.js"),null==g.getSelection&&$.getScript("http://assets.annotateit.org/vendor/ierange.min.js"),null==g.JSON&&$.getScript("http://assets.annotateit.org/vendor/json2.min.js"),null==g.Node&&(g.Node={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12}),Annotator.$=$,Annotator.Delegator=Delegator,Annotator.Range=Range,Annotator.Util=Util,Annotator._instances=[],Annotator._t=_t,Annotator.supported=function(){return function(){return!!this.getSelection}()},Annotator.noConflict=function(){return Util.getGlobal().Annotator=_Annotator,this},$.fn.annotator=function(e){var t;return t=Array.prototype.slice.call(arguments,1),this.each(function(){var n;return n=$.data(this,"annotator"),n?e&&n[e].apply(n,t):(n=new Annotator(this,e),$.data(this,"annotator",n))})},this.Annotator=Annotator;var __hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var i in t)__hasProp.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};Annotator.Widget=function(e){function t(){t.__super__.constructor.apply(this,arguments),this.classes=$.extend({},Annotator.Widget.prototype.classes,this.classes)}return __extends(t,e),t.prototype.classes={hide:"annotator-hide",invert:{x:"annotator-invert-x",y:"annotator-invert-y"}},t.prototype.destroy=function(){return this.removeEvents(),this.element.remove()},t.prototype.checkOrientation=function(){var e,t,n,i,o;return this.resetOrientation(),o=$(Annotator.Util.getGlobal()),i=this.element.children(":first"),t=i.offset(),n={top:o.scrollTop(),right:o.width()+o.scrollLeft()},e={top:t.top,right:t.left+i.width()},0>e.top-n.top&&this.invertY(),e.right-n.right>0&&this.invertX(),this},t.prototype.resetOrientation=function(){return this.element.removeClass(this.classes.invert.x).removeClass(this.classes.invert.y),this},t.prototype.invertX=function(){return this.element.addClass(this.classes.invert.x),this},t.prototype.invertY=function(){return this.element.addClass(this.classes.invert.y),this},t.prototype.isInvertedY=function(){return this.element.hasClass(this.classes.invert.y)},t.prototype.isInvertedX=function(){return this.element.hasClass(this.classes.invert.x)},t}(Delegator);var __bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var i in t)__hasProp.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};Annotator.Editor=function(e){function t(e){this.onCancelButtonMouseover=__bind(this.onCancelButtonMouseover,this),this.processKeypress=__bind(this.processKeypress,this),this.submit=__bind(this.submit,this),this.load=__bind(this.load,this),this.hide=__bind(this.hide,this),this.show=__bind(this.show,this),t.__super__.constructor.call(this,$(this.html)[0],e),this.fields=[],this.annotation={}}return __extends(t,e),t.prototype.events={"form submit":"submit",".annotator-save click":"submit",".annotator-cancel click":"hide",".annotator-cancel mouseover":"onCancelButtonMouseover","textarea keydown":"processKeypress"},t.prototype.classes={hide:"annotator-hide",focus:"annotator-focus"},t.prototype.html='<div class="annotator-outer annotator-editor">\n  <form class="annotator-widget">\n    <ul class="annotator-listing"></ul>\n    <div class="annotator-controls">\n      <a href="#cancel" class="annotator-cancel">'+_t("Cancel")+'</a>\n<a href="#save" class="annotator-save annotator-focus">'+_t("Save")+"</a>\n    </div>\n  </form>\n</div>",t.prototype.options={},t.prototype.show=function(e){return Annotator.Util.preventEventDefault(e),this.element.removeClass(this.classes.hide),this.element.find(".annotator-save").addClass(this.classes.focus),this.checkOrientation(),this.element.find(":input:first").focus(),this.setupDraggables(),this.publish("show")},t.prototype.hide=function(e){return Annotator.Util.preventEventDefault(e),this.element.addClass(this.classes.hide),this.publish("hide")},t.prototype.load=function(e){var t,n,i,o;for(this.annotation=e,this.publish("load",[this.annotation]),o=this.fields,n=0,i=o.length;i>n;n++)t=o[n],t.load(t.element,this.annotation);return this.show()},t.prototype.submit=function(e){var t,n,i,o;for(Annotator.Util.preventEventDefault(e),o=this.fields,n=0,i=o.length;i>n;n++)t=o[n],t.submit(t.element,this.annotation);return this.publish("save",[this.annotation]),this.hide()},t.prototype.addField=function(e){var t,n,i;switch(n=$.extend({id:"annotator-field-"+Annotator.Util.uuid(),type:"input",label:"",load:function(){},submit:function(){}},e),i=null,t=$('<li class="annotator-item" />'),n.element=t[0],n.type){case"textarea":i=$("<textarea />");break;case"input":case"checkbox":i=$("<input />");break;case"select":i=$("<select />")}return t.append(i),i.attr({id:n.id,placeholder:n.label}),"checkbox"===n.type&&(i[0].type="checkbox",t.addClass("annotator-checkbox"),t.append($("<label />",{"for":n.id,html:n.label}))),this.element.find("ul:first").append(t),this.fields.push(n),n.element},t.prototype.checkOrientation=function(){var e,n;return t.__super__.checkOrientation.apply(this,arguments),n=this.element.find("ul"),e=this.element.find(".annotator-controls"),this.element.hasClass(this.classes.invert.y)?e.insertBefore(n):e.is(":first-child")&&e.insertAfter(n),this},t.prototype.processKeypress=function(e){return 27===e.keyCode?this.hide():13!==e.keyCode||e.shiftKey?void 0:this.submit()},t.prototype.onCancelButtonMouseover=function(){return this.element.find("."+this.classes.focus).removeClass(this.classes.focus)},t.prototype.setupDraggables=function(){var e,t,n,i,o,r,a,s,l,u,c;return this.element.find(".annotator-resize").remove(),n=this.element.hasClass(this.classes.invert.y)?this.element.find(".annotator-item:last"):this.element.find(".annotator-item:first"),n&&$('<span class="annotator-resize"></span>').appendTo(n),o=null,e=this.classes,i=this.element,u=null,l=i.find(".annotator-resize"),t=i.find(".annotator-controls"),c=!1,r=function(e){return e.target===this?(o={element:this,top:e.pageY,left:e.pageX},u=i.find("textarea:first"),$(window).bind({"mouseup.annotator-editor-resize":s,"mousemove.annotator-editor-resize":a}),e.preventDefault()):void 0},s=function(){return o=null,$(window).unbind(".annotator-editor-resize")},a=function(n){var r,a,s,d,h;return o&&c===!1?(r={top:n.pageY-o.top,left:n.pageX-o.left},o.element===l[0]?(d=u.outerHeight(),h=u.outerWidth(),a=i.hasClass(e.invert.x)?-1:1,s=i.hasClass(e.invert.y)?1:-1,u.height(d+r.top*s),u.width(h+r.left*a),u.outerHeight()!==d&&(o.top=n.pageY),u.outerWidth()!==h&&(o.left=n.pageX)):o.element===t[0]&&(i.css({top:parseInt(i.css("top"),10)+r.top,left:parseInt(i.css("left"),10)+r.left}),o.top=n.pageY,o.left=n.pageX),c=!0,setTimeout(function(){return c=!1},1e3/60)):void 0},l.bind("mousedown",r),t.bind("mousedown",r)},t}(Annotator.Widget);var LinkParser,__bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var i in t)__hasProp.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};Annotator.Viewer=function(e){function t(e){this.onDeleteClick=__bind(this.onDeleteClick,this),this.onEditClick=__bind(this.onEditClick,this),this.load=__bind(this.load,this),this.hide=__bind(this.hide,this),this.show=__bind(this.show,this),t.__super__.constructor.call(this,$(this.html.element)[0],e),this.item=$(this.html.item)[0],this.fields=[],this.annotations=[]}return __extends(t,e),t.prototype.events={".annotator-edit click":"onEditClick",".annotator-delete click":"onDeleteClick"},t.prototype.classes={hide:"annotator-hide",showControls:"annotator-visible"},t.prototype.html={element:'<div class="annotator-outer annotator-viewer">\n  <ul class="annotator-widget annotator-listing"></ul>\n</div>',item:'<li class="annotator-annotation annotator-item">\n  <span class="annotator-controls">\n    <a href="#" title="View as webpage" class="annotator-link">View as webpage</a>\n    <button title="Edit" class="annotator-edit">Edit</button>\n    <button title="Delete" class="annotator-delete">Delete</button>\n  </span>\n</li>'},t.prototype.options={readOnly:!1},t.prototype.show=function(e){var t,n=this;return Annotator.Util.preventEventDefault(e),t=this.element.find(".annotator-controls").addClass(this.classes.showControls),setTimeout(function(){return t.removeClass(n.classes.showControls)},500),this.element.removeClass(this.classes.hide),this.checkOrientation().publish("show")},t.prototype.isShown=function(){return!this.element.hasClass(this.classes.hide)},t.prototype.hide=function(e){return Annotator.Util.preventEventDefault(e),this.element.addClass(this.classes.hide),this.publish("hide")},t.prototype.load=function(e){var t,n,i,o,r,a,s,l,u,c,d,h,p,f,m,g,v;for(this.annotations=e||[],d=this.element.find("ul:first").empty(),g=this.annotations,h=0,f=g.length;f>h;h++)for(t=g[h],l=$(this.item).clone().appendTo(d).data("annotation",t),i=l.find(".annotator-controls"),u=i.find(".annotator-link"),r=i.find(".annotator-edit"),o=i.find(".annotator-delete"),c=new LinkParser(t.links||[]).get("alternate",{type:"text/html"}),0===c.length||null==c[0].href?u.remove():u.attr("href",c[0].href),this.options.readOnly?(r.remove(),o.remove()):n={showEdit:function(){return r.removeAttr("disabled")},hideEdit:function(){return r.attr("disabled","disabled")},showDelete:function(){return o.removeAttr("disabled")},hideDelete:function(){return o.attr("disabled","disabled")}},v=this.fields,p=0,m=v.length;m>p;p++)s=v[p],a=$(s.element).clone().appendTo(l)[0],s.load(a,t,n);return this.publish("load",[this.annotations]),this.show()},t.prototype.addField=function(e){var t;return t=$.extend({load:function(){}},e),t.element=$("<div />")[0],this.fields.push(t),t.element,this},t.prototype.onEditClick=function(e){return this.onButtonClick(e,"edit")},t.prototype.onDeleteClick=function(e){return this.onButtonClick(e,"delete")},t.prototype.onButtonClick=function(e,t){var n;return n=$(e.target).parents(".annotator-annotation"),this.publish(t,[n.data("annotation")])},t}(Annotator.Widget),LinkParser=function(){function e(e){this.data=e}return e.prototype.get=function(e,t){var n,i,o,r,a,s,l,u,c;for(null==t&&(t={}),t=$.extend({},t,{rel:e}),o=function(){var e;e=[];for(i in t)__hasProp.call(t,i)&&(a=t[i],e.push(i));return e}(),u=this.data,c=[],s=0,l=u.length;l>s;s++)n=u[s],r=o.reduce(function(e,i){return e&&n[i]===t[i]},!0),r&&c.push(n);return c},e}();var Annotator,__bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var i in t)__hasProp.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};Annotator=Annotator||{},Annotator.Notification=function(e){function t(e){this.hide=__bind(this.hide,this),this.show=__bind(this.show,this),t.__super__.constructor.call(this,$(this.options.html).appendTo(document.body)[0],e)}return __extends(t,e),t.prototype.events={click:"hide"},t.prototype.options={html:"<div class='annotator-notice'></div>",classes:{show:"annotator-notice-show",info:"annotator-notice-info",success:"annotator-notice-success",error:"annotator-notice-error"}},t.prototype.show=function(e,t){return null==t&&(t=Annotator.Notification.INFO),$(this.element).addClass(this.options.classes.show).addClass(this.options.classes[t]).html(Util.escape(e||"")),setTimeout(this.hide,5e3),this},t.prototype.hide=function(){return $(this.element).removeClass(this.options.classes.show),this},t}(Delegator),Annotator.Notification.INFO="show",Annotator.Notification.SUCCESS="success",Annotator.Notification.ERROR="error",$(function(){var e;return e=new Annotator.Notification,Annotator.showNotification=e.show,Annotator.hideNotification=e.hide});var _ref,__hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var i in t)__hasProp.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};Annotator.Plugin.Unsupported=function(e){function t(){return _ref=t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.options={message:Annotator._t("Sorry your current browser does not support the Annotator")},t.prototype.pluginInit=function(){var e=this;return Annotator.supported()?void 0:$(function(){return Annotator.showNotification(e.options.message),void 0===window.XMLHttpRequest&&void 0!==ActiveXObject?$("html").addClass("ie6"):void 0})},t}(Annotator.Plugin);var base64Decode,base64UrlDecode,createDateFromISO8601,parseToken,__hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var i in t)__hasProp.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};createDateFromISO8601=function(e){var t,n,i,o,r,a;return o="([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(\\.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?",t=e.match(RegExp(o)),i=0,n=new Date(t[1],0,1),t[3]&&n.setMonth(t[3]-1),t[5]&&n.setDate(t[5]),t[7]&&n.setHours(t[7]),t[8]&&n.setMinutes(t[8]),t[10]&&n.setSeconds(t[10]),t[12]&&n.setMilliseconds(1e3*Number("0."+t[12])),t[14]&&(i=60*Number(t[16])+Number(t[17]),i*=null!=(a="-"===t[15])?a:{1:-1}),i-=n.getTimezoneOffset(),r=Number(n)+1e3*60*i,n.setTime(Number(r)),n},base64Decode=function(e){var t,n,i,o,r,a,s,l,u,c,d,h,p;if("undefined"!=typeof atob&&null!==atob)return atob(e);if(n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u=0,t=0,o="",p=[],!e)return e;for(e+="";e.length>u;)r=n.indexOf(e.charAt(u++)),a=n.indexOf(e.charAt(u++)),s=n.indexOf(e.charAt(u++)),l=n.indexOf(e.charAt(u++)),i=r<<18|a<<12|s<<6|l,c=255&i>>16,d=255&i>>8,h=255&i,p[t++]=64===s?String.fromCharCode(c):64===l?String.fromCharCode(c,d):String.fromCharCode(c,d,h);return p.join("")},base64UrlDecode=function(e){var t,n,i,o;if(n=e.length%4,0!==n)for(t=i=0,o=4-n;o>=0?o>i:i>o;t=o>=0?++i:--i)e+="=";return e=e.replace(/-/g,"+"),e=e.replace(/_/g,"/"),base64Decode(e)},parseToken=function(e){var t,n,i,o;return o=e.split("."),t=o[0],n=o[1],i=o[2],JSON.parse(base64UrlDecode(n))},Annotator.Plugin.Auth=function(e){function t(){t.__super__.constructor.apply(this,arguments),this.waitingForToken=[],this.options.token?this.setToken(this.options.token):this.requestToken()}return __extends(t,e),t.prototype.options={token:null,tokenUrl:"/auth/token",autoFetch:!0},t.prototype.requestToken=function(){var e=this;return this.requestInProgress=!0,$.ajax({url:this.options.tokenUrl,dataType:"text",xhrFields:{withCredentials:!0}}).done(function(t){return e.setToken(t)}).fail(function(e,t,n){var i;return i=Annotator._t("Couldn't get auth token:"),console.error(""+i+" "+n,e),Annotator.showNotification(""+i+" "+e.responseText,Annotator.Notification.ERROR)}).always(function(){return e.requestInProgress=!1})},t.prototype.setToken=function(e){var t,n=this;if(this.token=e,this._unsafeToken=parseToken(e),this.haveValidToken()){for(this.options.autoFetch&&(this.refreshTimeout=setTimeout(function(){return n.requestToken()},1e3*(this.timeToExpiry()-2))),this.updateHeaders(),t=[];this.waitingForToken.length>0;)t.push(this.waitingForToken.pop()(this._unsafeToken));return t}return console.warn(Annotator._t("Didn't get a valid token.")),this.options.autoFetch?(console.warn(Annotator._t("Getting a new token in 10s.")),setTimeout(function(){return n.requestToken()},1e4)):void 0},t.prototype.haveValidToken=function(){var e;return e=this._unsafeToken&&this._unsafeToken.issuedAt&&this._unsafeToken.ttl&&this._unsafeToken.consumerKey,e&&this.timeToExpiry()>0?!0:!1},t.prototype.timeToExpiry=function(){var e,t,n,i;return n=(new Date).getTime()/1e3,t=createDateFromISO8601(this._unsafeToken.issuedAt).getTime()/1e3,e=t+this._unsafeToken.ttl,i=e-n,i>0?i:0},t.prototype.updateHeaders=function(){var e;return e=this.element.data("annotator:headers"),this.element.data("annotator:headers",$.extend(e,{"x-annotator-auth-token":this.token}))},t.prototype.withToken=function(e){return null!=e?this.haveValidToken()?e(this._unsafeToken):(this.waitingForToken.push(e),this.requestInProgress?void 0:this.requestToken()):void 0},t}(Annotator.Plugin);var __bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var i in t)__hasProp.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},__indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};Annotator.Plugin.Store=function(e){function t(){this._onError=__bind(this._onError,this),this._onLoadAnnotationsFromSearch=__bind(this._onLoadAnnotationsFromSearch,this),this._onLoadAnnotations=__bind(this._onLoadAnnotations,this),this._getAnnotations=__bind(this._getAnnotations,this),t.__super__.constructor.apply(this,arguments),this.annotations=[]}return __extends(t,e),t.prototype.events={annotationCreated:"annotationCreated",annotationDeleted:"annotationDeleted",annotationUpdated:"annotationUpdated"},t.prototype.options={annotationData:{},emulateHTTP:!1,loadFromSearch:!1,prefix:"/store",urls:{create:"/annotations",read:"/annotations/:id",update:"/annotations/:id",destroy:"/annotations/:id",search:"/search"}},t.prototype.pluginInit=function(){return Annotator.supported()?this.annotator.plugins.Auth?this.annotator.plugins.Auth.withToken(this._getAnnotations):this._getAnnotations():void 0},t.prototype._getAnnotations=function(){return this.options.loadFromSearch?this.loadAnnotationsFromSearch(this.options.loadFromSearch):this.loadAnnotations()},t.prototype.annotationCreated=function(e){var t=this;return 0>__indexOf.call(this.annotations,e)?(this.registerAnnotation(e),this._apiRequest("create",e,function(n){return null==n.id&&console.warn(Annotator._t("Warning: No ID returned from server for annotation "),e),t.updateAnnotation(e,n)})):this.updateAnnotation(e,{})},t.prototype.annotationUpdated=function(e){var t=this;return __indexOf.call(this.annotations,e)>=0?this._apiRequest("update",e,function(n){return t.updateAnnotation(e,n)}):void 0},t.prototype.annotationDeleted=function(e){var t=this;return __indexOf.call(this.annotations,e)>=0?this._apiRequest("destroy",e,function(){return t.unregisterAnnotation(e)}):void 0},t.prototype.registerAnnotation=function(e){return this.annotations.push(e)},t.prototype.unregisterAnnotation=function(e){return this.annotations.splice(this.annotations.indexOf(e),1)},t.prototype.updateAnnotation=function(e,t){return 0>__indexOf.call(this.annotations,e)?console.error(Annotator._t("Trying to update unregistered annotation!")):$.extend(e,t),$(e.highlights).data("annotation",e)},t.prototype.loadAnnotations=function(){return this._apiRequest("read",null,this._onLoadAnnotations)},t.prototype._onLoadAnnotations=function(e){var t,n,i,o,r,a,s,l,u;for(null==e&&(e=[]),i={},u=this.annotations,r=0,s=u.length;s>r;r++)t=u[r],i[t.id]=t;for(o=[],a=0,l=e.length;l>a;a++)t=e[a],i[t.id]?(n=i[t.id],this.updateAnnotation(n,t)):o.push(t);return this.annotations=this.annotations.concat(o),this.annotator.loadAnnotations(o.slice())},t.prototype.loadAnnotationsFromSearch=function(e){return this._apiRequest("search",e,this._onLoadAnnotationsFromSearch)},t.prototype._onLoadAnnotationsFromSearch=function(e){return null==e&&(e={}),this._onLoadAnnotations(e.rows||[])},t.prototype.dumpAnnotations=function(){var e,t,n,i,o;for(i=this.annotations,o=[],t=0,n=i.length;n>t;t++)e=i[t],o.push(JSON.parse(this._dataFor(e)));return o},t.prototype._apiRequest=function(e,t,n){var i,o,r,a;return i=t&&t.id,a=this._urlFor(e,i),o=this._apiRequestOptions(e,t,n),r=$.ajax(a,o),r._id=i,r._action=e,r},t.prototype._apiRequestOptions=function(e,t,n){var i,o,r;return o=this._methodFor(e),r={type:o,headers:this.element.data("annotator:headers"),dataType:"json",success:n||function(){},error:this._onError},!this.options.emulateHTTP||"PUT"!==o&&"DELETE"!==o||(r.headers=$.extend(r.headers,{"X-HTTP-Method-Override":o}),r.type="POST"),"search"===e?r=$.extend(r,{data:t}):(i=t&&this._dataFor(t),this.options.emulateJSON?(r.data={json:i},this.options.emulateHTTP&&(r.data._method=o),r):r=$.extend(r,{data:i,contentType:"application/json; charset=utf-8"}))},t.prototype._urlFor=function(e,t){var n;return n=null!=this.options.prefix?this.options.prefix:"",n+=this.options.urls[e],n=n.replace(/\/:id/,null!=t?"/"+t:""),n=n.replace(/:id/,null!=t?t:"")},t.prototype._methodFor=function(e){var t;return t={create:"POST",read:"GET",update:"PUT",destroy:"DELETE",search:"GET"},t[e]},t.prototype._dataFor=function(e){var t,n;return n=e.highlights,delete e.highlights,$.extend(e,this.options.annotationData),t=JSON.stringify(e),n&&(e.highlights=n),t},t.prototype._onError=function(e){var t,n;switch(t=e._action,n=Annotator._t("Sorry we could not ")+t+Annotator._t(" this annotation"),"search"===e._action?n=Annotator._t("Sorry we could not search the store for annotations"):"read"!==e._action||e._id||(n=Annotator._t("Sorry we could not ")+t+Annotator._t(" the annotations from the store")),e.status){case 401:n=Annotator._t("Sorry you are not allowed to ")+t+Annotator._t(" this annotation");break;case 404:n=Annotator._t("Sorry we could not connect to the annotations store");break;case 500:n=Annotator._t("Sorry something went wrong with the annotation store")}return Annotator.showNotification(n,Annotator.Notification.ERROR),console.error(Annotator._t("API request failed:")+(" '"+e.status+"'"))},t}(Annotator.Plugin);var __bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var i in t)__hasProp.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};Annotator.Plugin.Permissions=function(e){function t(){this._setAuthFromToken=__bind(this._setAuthFromToken,this),this.updateViewer=__bind(this.updateViewer,this),this.updateAnnotationPermissions=__bind(this.updateAnnotationPermissions,this),this.updatePermissionsField=__bind(this.updatePermissionsField,this),this.addFieldsToAnnotation=__bind(this.addFieldsToAnnotation,this),t.__super__.constructor.apply(this,arguments),this.options.user&&(this.setUser(this.options.user),delete this.options.user)}return __extends(t,e),t.prototype.events={beforeAnnotationCreated:"addFieldsToAnnotation"},t.prototype.options={showViewPermissionsCheckbox:!0,showEditPermissionsCheckbox:!0,userId:function(e){return e},userString:function(e){return e},userAuthorize:function(e,t,n){var i,o,r,a;if(t.permissions){if(o=t.permissions[e]||[],0===o.length)return!0;for(r=0,a=o.length;a>r;r++)if(i=o[r],this.userId(n)===i)return!0;return!1}return t.user?n?this.userId(n)===this.userId(t.user):!1:!0},user:"",permissions:{read:[],update:[],"delete":[],admin:[]}},t.prototype.pluginInit=function(){var e,t,n=this;if(Annotator.supported())return t=this,e=function(e,n){return function(i,o){return t[e].call(t,n,i,o)}},!this.user&&this.annotator.plugins.Auth&&this.annotator.plugins.Auth.withToken(this._setAuthFromToken),this.options.showViewPermissionsCheckbox===!0&&this.annotator.editor.addField({type:"checkbox",label:Annotator._t("Allow anyone to <strong>view</strong> this annotation"),load:e("updatePermissionsField","read"),submit:e("updateAnnotationPermissions","read")}),this.options.showEditPermissionsCheckbox===!0&&this.annotator.editor.addField({type:"checkbox",label:Annotator._t("Allow anyone to <strong>edit</strong> this annotation"),load:e("updatePermissionsField","update"),submit:e("updateAnnotationPermissions","update")}),this.annotator.viewer.addField({load:this.updateViewer}),this.annotator.plugins.Filter?this.annotator.plugins.Filter.addFilter({label:Annotator._t("User"),property:"user",isFiltered:function(e,t){var i,o,r,a;if(t=n.options.userString(t),!e||!t)return!1;for(a=e.split(/\s*/),o=0,r=a.length;r>o;o++)if(i=a[o],-1===t.indexOf(i))return!1;return!0}}):void 0},t.prototype.setUser=function(e){return this.user=e},t.prototype.addFieldsToAnnotation=function(e){return e&&(e.permissions=this.options.permissions,this.user)?e.user=this.user:void 0},t.prototype.authorize=function(e,t,n){return void 0===n&&(n=this.user),this.options.userAuthorize?this.options.userAuthorize.call(this.options,e,t,n):!0},t.prototype.updatePermissionsField=function(e,t,n){var i;return t=$(t).show(),i=t.find("input").removeAttr("disabled"),this.authorize("admin",n)||t.hide(),this.authorize(e,n||{},null)?i.attr("checked","checked"):i.removeAttr("checked")},t.prototype.updateAnnotationPermissions=function(e,t,n){var i;return n.permissions||(n.permissions=this.options.permissions),i=e+"-permissions",n.permissions[e]=$(t).find("input").is(":checked")?[]:[this.user]},t.prototype.updateViewer=function(e,t,n){var i,o;return e=$(e),o=this.options.userString(t.user),t.user&&o&&"string"==typeof o?(i=Annotator.Util.escape(this.options.userString(t.user)),e.html(i).addClass("annotator-user")):e.remove(),n&&(this.authorize("update",t)||n.hideEdit(),!this.authorize("delete",t))?n.hideDelete():void 0},t.prototype._setAuthFromToken=function(e){return this.setUser(e.userId)},t}(Annotator.Plugin);var _ref,__bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var i in t)__hasProp.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},__indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};Annotator.Plugin.AnnotateItPermissions=function(e){function t(){return this._setAuthFromToken=__bind(this._setAuthFromToken,this),this.updateAnnotationPermissions=__bind(this.updateAnnotationPermissions,this),this.updatePermissionsField=__bind(this.updatePermissionsField,this),this.addFieldsToAnnotation=__bind(this.addFieldsToAnnotation,this),_ref=t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.options={showViewPermissionsCheckbox:!0,showEditPermissionsCheckbox:!0,groups:{world:"group:__world__",authenticated:"group:__authenticated__",consumer:"group:__consumer__"},userId:function(e){return e.userId},userString:function(e){return e.userId},userAuthorize:function(e,t,n){var i,o,r,a,s,l;return o=t.permissions||{},i=o[e]||[],r=this.groups.world,__indexOf.call(i,r)>=0?!0:null!=n&&null!=n.userId&&null!=n.consumerKey?n.userId===t.user&&n.consumerKey===t.consumer?!0:(a=this.groups.authenticated,__indexOf.call(i,a)>=0?!0:n.consumerKey===t.consumer&&(s=this.groups.consumer,__indexOf.call(i,s)>=0)?!0:n.consumerKey===t.consumer&&(l=n.userId,__indexOf.call(i,l)>=0)?!0:n.consumerKey===t.consumer&&n.admin?!0:!1):!1},permissions:{read:["group:__world__"],update:[],"delete":[],admin:[]}},t.prototype.addFieldsToAnnotation=function(e){return e&&(e.permissions=this.options.permissions,this.user)?(e.user=this.user.userId,e.consumer=this.user.consumerKey):void 0},t.prototype.updatePermissionsField=function(e,t,n){var i;return t=$(t).show(),i=t.find("input").removeAttr("disabled"),this.authorize("admin",n)||t.hide(),this.user&&this.authorize(e,n||{},{userId:"__nonexistentuser__",consumerKey:this.user.consumerKey})?i.attr("checked","checked"):i.removeAttr("checked")},t.prototype.updateAnnotationPermissions=function(e,t,n){var i;return n.permissions||(n.permissions=this.options.permissions),i=e+"-permissions",n.permissions[e]=$(t).find("input").is(":checked")?["read"===e?this.options.groups.world:this.options.groups.consumer]:[]},t.prototype._setAuthFromToken=function(e){return this.setUser(e)},t}(Annotator.Plugin.Permissions);var __bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var i in t)__hasProp.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};Annotator.Plugin.Filter=function(e){function t(e,n){this._onPreviousClick=__bind(this._onPreviousClick,this),this._onNextClick=__bind(this._onNextClick,this),this._onFilterKeyup=__bind(this._onFilterKeyup,this),this._onFilterBlur=__bind(this._onFilterBlur,this),this._onFilterFocus=__bind(this._onFilterFocus,this),this.updateHighlights=__bind(this.updateHighlights,this);var i;e=$(this.html.element).appendTo((null!=n?n.appendTo:void 0)||this.options.appendTo),t.__super__.constructor.call(this,e,n),(i=this.options).filters||(i.filters=[]),this.filter=$(this.html.filter),this.filters=[],this.current=0}return __extends(t,e),t.prototype.events={".annotator-filter-property input focus":"_onFilterFocus",".annotator-filter-property input blur":"_onFilterBlur",".annotator-filter-property input keyup":"_onFilterKeyup",".annotator-filter-previous click":"_onPreviousClick",".annotator-filter-next click":"_onNextClick",".annotator-filter-clear click":"_onClearClick"},t.prototype.classes={active:"annotator-filter-active",hl:{hide:"annotator-hl-filtered",active:"annotator-hl-active"}},t.prototype.html={element:'<div class="annotator-filter">\n  <strong>'+Annotator._t("Navigate:")+'</strong>\n<span class="annotator-filter-navigation">\n  <button class="annotator-filter-previous">'+Annotator._t("Previous")+'</button>\n<button class="annotator-filter-next">'+Annotator._t("Next")+"</button>\n</span>\n<strong>"+Annotator._t("Filter by:")+"</strong>\n</div>",filter:'<span class="annotator-filter-property">\n  <label></label>\n  <input/>\n  <button class="annotator-filter-clear">'+Annotator._t("Clear")+"</button>\n</span>"},t.prototype.options={appendTo:"body",filters:[],addAnnotationFilter:!0,isFiltered:function(e,t){var n,i,o,r;if(!e||!t)return!1;for(r=e.split(/\s*/),i=0,o=r.length;o>i;i++)if(n=r[i],-1===t.indexOf(n))return!1;return!0}},t.prototype.pluginInit=function(){var e,t,n,i;for(i=this.options.filters,t=0,n=i.length;n>t;t++)e=i[t],this.addFilter(e);return this.updateHighlights(),this._setupListeners()._insertSpacer(),this.options.addAnnotationFilter===!0?this.addFilter({label:Annotator._t("Annotation"),property:"text"}):void 0},t.prototype.destroy=function(){var e,n;return t.__super__.destroy.apply(this,arguments),n=$("html"),e=parseInt(n.css("padding-top"),10)||0,n.css("padding-top",e-this.element.outerHeight()),this.element.remove()},t.prototype._insertSpacer=function(){var e,t;return t=$("html"),e=parseInt(t.css("padding-top"),10)||0,t.css("padding-top",e+this.element.outerHeight()),this},t.prototype._setupListeners=function(){var e,t,n,i;for(t=["annotationsLoaded","annotationCreated","annotationUpdated","annotationDeleted"],n=0,i=t.length;i>n;n++)e=t[n],this.annotator.subscribe(e,this.updateHighlights);return this},t.prototype.addFilter=function(e){var t,n;return n=$.extend({label:"",property:"",isFiltered:this.options.isFiltered},e),function(){var e,i,o,r;for(o=this.filters,r=[],e=0,i=o.length;i>e;e++)t=o[e],t.property===n.property&&r.push(t);return r}.call(this).length||(n.id="annotator-filter-"+n.property,n.annotations=[],n.element=this.filter.clone().appendTo(this.element),n.element.find("label").html(n.label).attr("for",n.id),n.element.find("input").attr({id:n.id,placeholder:Annotator._t("Filter by ")+n.label+"…"}),n.element.find("button").hide(),n.element.data("filter",n),this.filters.push(n)),this},t.prototype.updateFilter=function(e){var t,n,i,o,r,a,s;
if(e.annotations=[],this.updateHighlights(),this.resetHighlights(),i=$.trim(e.element.find("input").val())){for(n=this.highlights.map(function(){return $(this).data("annotation")}),s=$.makeArray(n),r=0,a=s.length;a>r;r++)t=s[r],o=t[e.property],e.isFiltered(i,o)&&e.annotations.push(t);return this.filterHighlights()}},t.prototype.updateHighlights=function(){return this.highlights=this.annotator.element.find(".annotator-hl:visible"),this.filtered=this.highlights.not(this.classes.hl.hide)},t.prototype.filterHighlights=function(){var e,t,n,i,o,r,a,s,l,u;for(e=$.grep(this.filters,function(e){return!!e.annotations.length}),i=(null!=(u=e[0])?u.annotations:void 0)||[],e.length>1&&(n=[],$.each(e,function(){return $.merge(n,this.annotations)}),a=[],i=[],$.each(n,function(){return-1===$.inArray(this,a)?a.push(this):i.push(this)})),o=this.highlights,r=s=0,l=i.length;l>s;r=++s)t=i[r],o=o.not(t.highlights);return o.addClass(this.classes.hl.hide),this.filtered=this.highlights.not(this.classes.hl.hide),this},t.prototype.resetHighlights=function(){return this.highlights.removeClass(this.classes.hl.hide),this.filtered=this.highlights,this},t.prototype._onFilterFocus=function(e){var t;return t=$(e.target),t.parent().addClass(this.classes.active),t.next("button").show()},t.prototype._onFilterBlur=function(e){var t;return e.target.value?void 0:(t=$(e.target),t.parent().removeClass(this.classes.active),t.next("button").hide())},t.prototype._onFilterKeyup=function(e){var t;return t=$(e.target).parent().data("filter"),t?this.updateFilter(t):void 0},t.prototype._findNextHighlight=function(e){var t,n,i,o,r,a,s,l;return this.highlights.length?(a=e?0:-1,l=e?-1:0,s=e?"lt":"gt",t=this.highlights.not("."+this.classes.hl.hide),i=t.filter("."+this.classes.hl.active),i.length||(i=t.eq(a)),n=i.data("annotation"),o=t.index(i[0]),r=t.filter(":"+s+"("+o+")").not(n.highlights).eq(l),r.length||(r=t.eq(l)),this._scrollToHighlight(r.data("annotation").highlights)):this},t.prototype._onNextClick=function(){return this._findNextHighlight()},t.prototype._onPreviousClick=function(){return this._findNextHighlight(!0)},t.prototype._scrollToHighlight=function(e){return e=$(e),this.highlights.removeClass(this.classes.hl.active),e.addClass(this.classes.hl.active),$("html, body").animate({scrollTop:e.offset().top-(this.element.height()+20)},150)},t.prototype._onClearClick=function(e){return $(e.target).prev("input").val("").keyup().blur()},t}(Annotator.Plugin);var __bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var i in t)__hasProp.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};Annotator.Plugin.Markdown=function(e){function t(){this.updateTextField=__bind(this.updateTextField,this),null!=("undefined"!=typeof Showdown&&null!==Showdown?Showdown.converter:void 0)?(t.__super__.constructor.apply(this,arguments),this.converter=new Showdown.converter):console.error(Annotator._t("To use the Markdown plugin, you must include Showdown into the page first."))}return __extends(t,e),t.prototype.events={annotationViewerTextField:"updateTextField"},t.prototype.updateTextField=function(e,t){var n;return n=Annotator.Util.escape(t.text||""),$(e).html(this.convert(n))},t.prototype.convert=function(e){return this.converter.makeHtml(e)},t}(Annotator.Plugin);var _ref,__bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var i in t)__hasProp.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};Annotator.Plugin.Tags=function(e){function t(){return this.setAnnotationTags=__bind(this.setAnnotationTags,this),this.updateField=__bind(this.updateField,this),_ref=t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.options={parseTags:function(e){var t;return e=$.trim(e),t=[],e&&(t=e.split(/\s+/)),t},stringifyTags:function(e){return e.join(" ")}},t.prototype.field=null,t.prototype.input=null,t.prototype.pluginInit=function(){return Annotator.supported()?(this.field=this.annotator.editor.addField({label:Annotator._t("Add some tags here")+"…",load:this.updateField,submit:this.setAnnotationTags}),this.annotator.viewer.addField({load:this.updateViewer}),this.annotator.plugins.Filter&&this.annotator.plugins.Filter.addFilter({label:Annotator._t("Tag"),property:"tags",isFiltered:Annotator.Plugin.Tags.filterCallback}),this.input=$(this.field).find(":input")):void 0},t.prototype.parseTags=function(e){return this.options.parseTags(e)},t.prototype.stringifyTags=function(e){return this.options.stringifyTags(e)},t.prototype.updateField=function(e,t){var n;return n="",t.tags&&(n=this.stringifyTags(t.tags)),this.input.val(n)},t.prototype.setAnnotationTags=function(e,t){return t.tags=this.parseTags(this.input.val())},t.prototype.updateViewer=function(e,t){return e=$(e),t.tags&&$.isArray(t.tags)&&t.tags.length?e.addClass("annotator-tags").html(function(){var e;return e=$.map(t.tags,function(e){return'<span class="annotator-tag">'+Annotator.Util.escape(e)+"</span>"}).join(" ")}):e.remove()},t}(Annotator.Plugin),Annotator.Plugin.Tags.filterCallback=function(e,t){var n,i,o,r,a,s,l,u;if(null==t&&(t=[]),o=0,i=[],e)for(i=e.split(/\s+/g),a=0,l=i.length;l>a;a++)if(n=i[a],t.length)for(s=0,u=t.length;u>s;s++)r=t[s],-1!==r.indexOf(n)&&(o+=1);return o===i.length};var __hasProp={}.hasOwnProperty,__indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};Annotator.prototype.setupPlugins=function(e,t){var n,i,o,r,a,s,l,u,c;null==e&&(e={}),null==t&&(t={}),s=Annotator.Util.getGlobal(),r=["Unsupported","Auth","Tags","Filter","Store","AnnotateItPermissions"],s.Showdown&&r.push("Markdown"),a=s.location.href.split(/#|\?/).shift()||"",o={Tags:{},Filter:{filters:[{label:Annotator._t("User"),property:"user"},{label:Annotator._t("Tags"),property:"tags"}]},Auth:{tokenUrl:e.tokenUrl||"http://annotateit.org/api/token"},Store:{prefix:e.storeUrl||"http://annotateit.org/api",annotationData:{uri:a},loadFromSearch:{uri:a}}};for(n in t)__hasProp.call(t,n)&&(i=t[n],0>__indexOf.call(r,n)&&r.push(n));for($.extend(!0,o,t),c=[],l=0,u=r.length;u>l;l++)n=r[l],n in o&&!o[n]?c.push(void 0):c.push(this.addPlugin(n,o[n]));return c};var _ref,__bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var i in t)__hasProp.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};Annotator.Plugin.Share=function(e){function t(e,n){return n!==void 0&&(this.options.shareIn=n.shareIn!==void 0?n.shareIn:this.options.shareIn),this.buildHTMLShareButton=__bind(this.buildHTMLShareButton,this),this.runningAPI=__bind(this.runningAPI,this),this.updateViewer=__bind(this.updateViewer,this),_ref=t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.options={shareIn:["facebook","twitter","email","google"],getUrl:{facebook:function(e,t,n){return"https://www.facebook.com/sharer/sharer.php?s=100&p[url]="+t+"&p[title]="+encodeURIComponent("Open Video Annotation")+"&p[summary]="+n},twitter:function(e,t){return"https://twitter.com/intent/tweet?original_referer="+t+"&source=tweetbutton&url="+t+"&via=OpenVideoAnnotation&text="+encodeURIComponent("I want to share the next Open Video Annotation: ")},google:function(e,t){return"https://plus.google.com/share?url="+t},email:function(e,t){return"mailto:?subject="+e+"&body="+t}},baseUrl:""},t.prototype.field=null,t.prototype.input=null,t.prototype.pluginInit=function(){if(console.log("Share-pluginInit"),Annotator.supported()){this.field=this.annotator.editor.addField({type:"input"});var e=Annotator.$('<li class="annotator-item">'+this.buildHTMLShareButton("Share without saving:")+"</li>");Annotator.$(this.field).replaceWith(e),this.field=e[0],this.buttonsActions(this.field,2,this.options.baseUrl);var t=this.initAPI();return this.runAPI(t),this.annotator.viewer.addField({load:this.updateViewer}),this.input=$(this.field).find(":input")}},t.prototype.buildHTMLShareButton=function(e,t){var e=e||"",t=t!==void 0?'annotationId="'+t+'"':"",n=""!=e?'<div class="share-text-annotator">'+e+"</div>":"",i='<div class="share-button-annotator share-button" '+t+"></div>",o='<div class="share-popup-overlay-bg" style="z-index:30000000000"><div class="share-popup"><div class="share-popup-items"></div><div class="close-btn">Close</div></div></div>';return'<div class="share-container-annotator">'+n+i+o+"</div>"},t.prototype.buildHTMLPopup=function(e){var t="";this.options.shareIn!==void 0&&this.options.shareIn.forEach(function(e){t+='<div class="share-'+e+'-annotator share-button">'+e.charAt(0).toUpperCase()+e.slice(1)+"</div>"}),this.uri=this.uri!==void 0?this.uri:"";var e='<div class="share-popup-title">'+e.replace(":","")+"</div>",n='<div class="share-popup-copy">Copy and Share:</div>',i='<input type="text" class="share-popup-uri" onclick="javascript:this.select();" readonly="true" value="'+this.uri+'">',o=e+t+n+i;return o},t.prototype.buttonsActions=function(e,t,n){var i=this;$(e).find(".close-btn").click(function(){$(".share-popup-overlay-bg").hide()}),$(e).find(".share-popup-overlay-bg").click(function(){$(".share-popup-overlay-bg").hide()}),$(e).find(".share-popup").click(function(){return!1}),$(e).find(".share-button-annotator.share-button").click(function(){event.preventDefault();var e=this,o=$(this).attr("annotationId"),r=1==t?"Share":"Share without saving";i.uri=i.createAPIURL(t,o,n),$(this).parent().find(".share-popup-overlay-bg").show(),$(this).parent().find(".share-popup-items").html(i.buildHTMLPopup(r)),i.options.shareIn!==void 0&&i.options.shareIn.forEach(function(n){$(e).parent().find(".share-"+n+"-annotator.share-button").click(function(){var e=i.createAPIURL(t,o,e),r="Sharing a annotation with Open Video Annotation";if(link=encodeURIComponent(e),noteText=i.getSource("ovaText"),finalUrl="",1==t){var a=i.annotator.viewer,s=$(a.element).find("div:first").html();noteText=encodeURIComponent(s)}finalUrl=i.options.getUrl[n]!==void 0?i.options.getUrl[n](r,link,noteText):"",i.options.getUrl[n]!==void 0&&window.open(finalUrl)})})})},t.prototype.createAPIURL=function(e,t,n){var i=this.annotator,o=i.editor,e=e||1,n=n||window.location.href;if(n+=n.indexOf("?")>=0?"&":"?",1===e){var t=t!==void 0?t:"";n+="ovaId="+t}else if(2===e){var r=this.getSource("ovaText")||" ";if(n+="ovaText="+r,o.VideoJS!==void 0&&-1!==o.VideoJS){var a=this.getSource("ovaStart")||" ",s=this.getSource("ovaEnd")||" ",l=this.getSource("ovaContainer")||" ",u=this.getSource("ovaSrc")||" ";n+="&ovaStart="+a+"&ovaEnd="+s+"&ovaContainer="+l+"&ovaSrc="+u}else if(o.OpenSeaDragon!==void 0&&-1!==o.OpenSeaDragon){var c=this.getSource("ovaLeft")||" ",d=this.getSource("ovaTop")||" ",h=this.getSource("ovaWidth")||" ",p=this.getSource("ovaHeight")||" ",f=this.getSource("ovaLeftZoom")||" ",m=this.getSource("ovaTopZoom")||" ",g=this.getSource("ovaWidthZoom")||" ",v=this.getSource("ovaHeightZoom")||" ",l=this.getSource("ovaContainer")||" ",u=this.getSource("ovaSrc")||" ";n+="&ovaLeft="+c+"&ovaTop="+d+"&ovaWidth="+h+"&ovaHeight="+p+"&ovaLeftZoom="+f+"&ovaTopZoom="+m+"&ovaWidthZoom="+g+"&ovaHeightZoom="+v+"&ovaContainer="+l+"&ovaSrc="+u}else{var a=this.getSource("ovaStart")||" ",s=this.getSource("ovaEnd")||" ",y=this.getSource("ovastartOffset")||" ",b=this.getSource("ovaendOffset")||" ";n+="&ovaStart="+a+"&ovaEnd="+s+"&ovastartOffset="+y+"&ovaendOffset="+b}}return n},t.prototype.getSource=function(e){var e=e||"";if("ovaId"==e)e=this.annotation.id;else{var t=this.annotator,n=t.editor,i=$(n.element).find("textarea")[0];if("ovaText"==e&&(e=i.value),n.VideoJS!==void 0&&-1!==n.VideoJS)"ovaContainer"==e?e=n.VideoJS:"ovaSrc"==e?e=t.mplayer[n.VideoJS].tech.options_.source.src:"ovaStart"==e?e=t.mplayer[n.VideoJS].rangeslider.getValues().start:"ovaEnd"==e&&(e=t.mplayer[n.VideoJS].rangeslider.getValues().end);else if(n.OpenSeaDragon!==void 0&&-1!==n.OpenSeaDragon){var o=n.annotation;if("ovaLeft"==e)e=t.osda.rectPosition.left;else if("ovaTop"==e)e=t.osda.rectPosition.top;else if("ovaWidth"==e)e=t.osda.rectPosition.width;else if("ovaHeight"==e)e=t.osda.rectPosition.height;else if("ovaLeftZoom"==e)e=t.osda.viewer.drawer.viewport.getBounds().x;else if("ovaTopZoom"==e)e=t.osda.viewer.drawer.viewport.getBounds().y;else if("ovaWidthZoom"==e)e=t.osda.viewer.drawer.viewport.getBounds().width;else if("ovaHeightZoom"==e)e=t.osda.viewer.drawer.viewport.getBounds().height;else if("ovaContainer"==e)e=t.osda.viewer.id;else if("ovaSrc"==e){var e=t.osda.viewer.source,r=e.tilesUrl!==void 0?e.tilesUrl:"",a=e.getTileUrl!==void 0?e.getTileUrl:"";e=""!=r?r:(""+a).replace(/\s+/g," ")}}else{var o=n.annotation;"ovastartOffset"==e?e=o.ranges[0].startOffset:"ovaendOffset"==e?e=o.ranges[0].endOffset:"ovaStart"==e?e=o.ranges[0].start:"ovaEnd"==e&&(e=o.ranges[0].end)}}return encodeURIComponent(e)},t.prototype.initAPI=function(){console.log("initAPI");var e={},t=this.getParameterByName("ovaId"),n=this.getParameterByName("ovaStart"),i=this.getParameterByName("ovaEnd"),o=this.getParameterByName("ovaContainer"),r=this.getParameterByName("ovaSrc"),a=this.getParameterByName("ovaText"),s=this.getParameterByName("ovaUser"),l=this.getParameterByName("ovaLeft"),u=this.getParameterByName("ovaTop"),c=this.getParameterByName("ovaWidth"),d=this.getParameterByName("ovaHeight"),h=this.getParameterByName("ovaLeftZoom"),p=this.getParameterByName("ovaTopZoom"),f=this.getParameterByName("ovaWidthZoom"),m=this.getParameterByName("ovaHeightZoom"),g=this.getParameterByName("ovastartOffset"),v=this.getParameterByName("ovaendOffset"),y=top.location.href;return""!=t&&(y=this.removeVariableFromURL(y,"ovaId")),""!=n&&(y=this.removeVariableFromURL(y,"ovaStart")),""!=i&&(y=this.removeVariableFromURL(y,"ovaEnd")),""!=o&&(y=this.removeVariableFromURL(y,"ovaContainer")),""!=r&&(y=this.removeVariableFromURL(y,"ovaSrc")),""!=a&&(y=this.removeVariableFromURL(y,"ovaText")),""!=s&&(y=this.removeVariableFromURL(y,"ovaUser")),""!=l&&(y=this.removeVariableFromURL(y,"ovaLeft")),""!=u&&(y=this.removeVariableFromURL(y,"ovaTop")),""!=c&&(y=this.removeVariableFromURL(y,"ovaWidth")),""!=d&&(y=this.removeVariableFromURL(y,"ovaHeight")),""!=h&&(y=this.removeVariableFromURL(y,"ovaLeftZoom")),""!=p&&(y=this.removeVariableFromURL(y,"ovaTopZoom")),""!=f&&(y=this.removeVariableFromURL(y,"ovaWidthZoom")),""!=m&&(y=this.removeVariableFromURL(y,"ovaHeightZoom")),""!=g&&(y=this.removeVariableFromURL(y,"ovastartOffset")),""!=v&&(y=this.removeVariableFromURL(y,"ovaendOffset")),window.history.pushState("object or string","Title",y),""!=t&&$.extend(e,{method:1,ovaId:t}),""!=n&&""!=i&&""!=o&&""!=r?$.extend(e,{method:2,start:n,end:i,container:o,src:r,text:a,user:s}):""!=l&&""!=u&&""!=c&&""!=d&&""!=h&&""!=p&&""!=f&&""!=m?$.extend(e,{method:2,Left:l,Top:u,Width:c,Height:d,leftZoom:h,topZoom:p,widthZoom:f,heightZoom:m,container:o,src:r,text:a,user:s}):""!=n&&""!=i&&""!=g&&""!=v&&$.extend(e,{method:2,start:n,end:i,startOffset:g,endOffset:v,text:a,user:s}),e},t.prototype.runningAPI=function(e,t){function n(){if(f=annotator.osda!==void 0&&annotator.osda.viewer!==void 0,c===void 0&&(c=u),f){if(d=s[c],$(d.highlights).parent().find(".annotator-hl").removeClass("api"),$(d.highlights).addClass("api"),"undefined"!=typeof annotator&&annotator.osda!==void 0){var e=annotator.osda.viewer.drawer.viewport.getBounds(),t=d.bounds!==void 0?d.bounds:{};t.x!==void 0&&(e.x=t.x),t.y!==void 0&&(e.y=t.y),t.width!==void 0&&(e.width=t.width),t.height!==void 0&&(e.height=t.height),annotator.osda.viewer.drawer.viewport.fitBounds(e)}$("html,body").animate({scrollTop:$(annotator.osda.viewer.element).offset().top},"slow")}else setTimeout(n,200)}function n(){if(f=annotator.osda!==void 0&&annotator.osda.viewer!==void 0){annotator.plugins.Store.annotations.push(d),annotator.osda.viewer.annotationInstance.drawRect(d),$(d.highlights).addClass("api");var e=annotator.osda.viewer.drawer.viewport.getBounds(),t=d.bounds!==void 0?d.bounds:{};t.x!==void 0&&(e.x=t.x),t.y!==void 0&&(e.y=t.y),t.width!==void 0&&(e.width=t.width),t.height!==void 0&&(e.height=t.height),annotator.osda.viewer.drawer.viewport.fitBounds(e),$("html,body").animate({scrollTop:$(annotator.osda.viewer.element).offset().top},"slow")}else setTimeout(n,200)}var i,o,r=$(".annotator-wrapper").parent()[0],a=this;if($.data(r,"annotator",a.annotator),annotator=window.annotator=$.data(r,"annotator"),i=annotator.mplayer!==void 0?annotator.mplayer:[],o=annotator.osda!==void 0?annotator.osda:[],t!==void 0&&t.method!==void 0&&("1"==t.method||"2"==t.method))if("1"==t.method){var s=annotator.plugins.Store.annotations,l=decodeURIComponent(t.ovaId);for(var u in s){var c,d=s[u];if(d.id!==void 0&&d.id==l)if(a._isVideo(d)){if(i[d.target.container]!==void 0){var h=i[d.target.container];if(h.id_==d.target.container){var p=d;videojs(h.id_).ready(function(){"Youtube"!=h.techName&&h.preload("auto"),h.autoPlayAPI=p,h.play()})}}}else if("image"==d.media){if($("div#"+d.target.container).length){var f=annotator.osda!==void 0&&annotator.osda.viewer!==void 0;n()}}else{var m=d.ranges!==void 0&&d.ranges[0]!==void 0,g=m?d.ranges[0].startOffset:"",v=m?d.ranges[0].endOffset:"";g!==void 0&&v!==void 0&&($(d.highlights).addClass("api"),$("html,body").animate({scrollTop:$(d.highlights[0]).offset().top},"slow"))}}}else if("2"==t.method){if(i!==void 0){var y=decodeURIComponent(t.container),h=i[y],b=h!==void 0&&y==h.id_,w=!isNaN(parseFloat(t.start))&&isFinite(t.start)&&!isNaN(parseFloat(t.end))&&isFinite(t.end),x=!1;if(b){var _=decodeURIComponent(t.src),C=_.substring(0,_.lastIndexOf(".")),S=""==h.tech.options_.source.src?h.tag.currentSrc:h.tech.options_.source.src;S=S.substring(0,S.lastIndexOf(".")),x=C==S}if(b&&w&&x){var T={rangeTime:{start:t.start,end:t.end},created:(new Date).toISOString(),updated:(new Date).toISOString(),target:{container:y,src:_},media:"video",text:decodeURIComponent(t.text),user:decodeURIComponent(t.user)};videojs(h.id_).ready(function(){"Youtube"!=h.techName&&h.preload("auto"),h.autoPlayAPI=T,h.play()})}}var g=t.startOffset,v=t.endOffset;if(!b&&g!==void 0&&v!==void 0){var T={ranges:[{start:decodeURIComponent(t.start),end:decodeURIComponent(t.end),startOffset:decodeURIComponent(t.startOffset),endOffset:decodeURIComponent(t.endOffset)}],created:(new Date).toISOString(),updated:(new Date).toISOString(),media:"text",text:decodeURIComponent(t.text),user:decodeURIComponent(t.user)};annotator.setupAnnotation(T),$(T.highlights).addClass("api"),$("html,body").animate({scrollTop:$(T.highlights[0]).offset().top},"slow")}var E=t.Left,k=t.Top,N=t.Width,A=t.Height,M=t.leftZoom,P=t.topZoom,R=t.widthZoom,O=t.heightZoom;if(!b&&E!==void 0&&k!==void 0&&N!==void 0&&A!==void 0&&M!==void 0&&P!==void 0&&R!==void 0&&O!==void 0){var d={rangePosition:{width:parseFloat(decodeURIComponent(t.Width)),top:parseFloat(decodeURIComponent(t.Top)),left:parseFloat(decodeURIComponent(t.Left)),height:parseFloat(decodeURIComponent(t.Height))},bounds:{width:parseFloat(decodeURIComponent(t.widthZoom)),x:parseFloat(decodeURIComponent(t.leftZoom)),y:parseFloat(decodeURIComponent(t.topZoom)),height:parseFloat(decodeURIComponent(t.heightZoom))},target:{container:t.container,src:t.src},created:(new Date).toISOString(),updated:(new Date).toISOString(),media:"image",text:decodeURIComponent(t.text),user:decodeURIComponent(t.user)},f=annotator.osda!==void 0&&annotator.osda.viewer!==void 0;n()}}annotator.isShareLoaded=!0,annotator.publish("shareloaded")},t.prototype.runAPI=function(e){var t=this,n=function(i){t.runningAPI(i,e),t.annotator.unsubscribe("annotationsLoaded",n)};this.annotator.subscribe("annotationsLoaded",n)},t.prototype._isVideo=function(e){var e=e||{};return rt=e.rangeTime,isVideo=e.media!==void 0&&"video"==e.media,hasContainer=e.target!==void 0&&e.target.container!==void 0,isNumber="undefined"!=typeof rt&&!isNaN(parseFloat(rt.start))&&isFinite(rt.start)&&!isNaN(parseFloat(rt.end))&&isFinite(rt.end),isVideo&&hasContainer&&isNumber},t.prototype._isImage=function(e){var t=$(".annotator-wrapper").parent()[0],n=window.annotator=$.data(t,"annotator"),i=e.rangePosition,o=n.osda!==void 0,r=e.target!==void 0&&e.target.container!==void 0,a=e.media!==void 0&&"image"==e.media,s=i!==void 0;return o&&r&&a&&s},t.prototype.getParameterByName=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec("?"+window.location.href.split("?")[1]);return null==n?"":decodeURIComponent(n[1].replace(/\+/g," "))},t.prototype.removeVariableFromURL=function(e,t){var n=e+"",i=RegExp("\\?"+t+"=[^&]*&?","gi");return n=n.replace(i,"?"),i=RegExp("\\&"+t+"=[^&]*&?","gi"),n=n.replace(i,"&"),n=n.replace(/(\?|&)$/,""),i=null,n},t.prototype.updateViewer=function(e,t){this.annotation=t;var n=this,e=$(e),i=e.addClass("share-viewer-annotator").html(function(){return n.buildHTMLShareButton("Share:",n.getSource("ovaId"))});return this.buttonsActions(e[0],1,this.options.baseUrl),i},t}(Annotator.Plugin);var _ref,__bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var i in t)__hasProp.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};Annotator.Plugin.Geolocation=function(e){function t(){return this.pluginSubmit=__bind(this.pluginSubmit,this),this.updateViewer=__bind(this.updateViewer,this),_ref=t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.field=null,t.prototype.input=null,t.prototype.pluginInit=function(){if(console.log("Geolocation-pluginInit"),Annotator.supported()){this.field=this.annotator.editor.addField({type:"checkbox",label:Annotator._t("Add my current location"),submit:this.pluginSubmit});var e=this;return $(this.field).mouseup(function(){e.getCurrentPosition(e)}),this.annotator.viewer.addField({load:this.updateViewer}),this.input=$(this.field).find(":input")}},t.prototype.pluginSubmit=function(e,t){var n=1==$(e).find("input:checked").length?!0:!1;return n&&(t.geolocation===void 0&&(t.geolocation={}),t.geolocation.longitude=this.longitude,t.geolocation.latitude=this.latitude,t.geolocation.altitude=this.altitude,t.geolocation.accuracy=this.accuracy,this.goterror!==void 0&&this.goterror&&alert("You want to save your current location. But you did not accept the location in your browser or maybe your browser is not able to use your current location"),this.publish("newgeolocation",[e,t])),t.geolocation},t.prototype.getCurrentPosition=function(e){function t(t){e.longitude=t.coords.longitude,e.latitude=t.coords.latitude,e.altitude=t.coords.altitude,e.accuracy=t.coords.accuracy}function n(t){e.goterror=!0,console.warn("ERROR("+t.code+"): "+t.message)}var i={enableHighAccuracy:!0,timeout:5e3,maximumAge:0};navigator.geolocation.getCurrentPosition(t,n,i)},t.prototype.updateViewer=function(e,t){$(e).remove();var n=t.geolocation!==void 0;if(n){var i=$(this.annotator.viewer.element.find(".annotator-controls")).parent();i.prepend('<button title="The user annotation location" class="geolocation-viewer-annotator">');var o=i.find(".geolocation-viewer-annotator"),r=this;o.click(function(){i.append('<div class="map-viewer-annotator">');var e=i.find(".map-viewer-annotator")[0],n=t.geolocation.latitude,o=t.geolocation.longitude;r.showPosition(e,n,o)}),o.addClass("annotator-visible"),setTimeout(function(){return o.removeClass("annotator-visible")},500)}},t.prototype.showPosition=function(e,t,n){var i=t+","+n,o=parseInt($(e).css("width")),r=parseInt($(e).css("height")),a="http://maps.googleapis.com/maps/api/staticmap?center="+i+"&zoom=14&size="+o+"x"+r+"&sensor=false&markers=color:green%7Clabel:G%7C"+i;e.innerHTML="<img src='"+a+"'>",e.style.visibility="hidden",setInterval(function(){e.style.visibility="visible",e.style.width=$(e).find("img").css("width")},100)},t}(Annotator.Plugin),!function(e,t){"use strict";function n(e,t){for(var n,i=[],r=0;e.length>r;++r){if(n=a[e[r]]||o(e[r]),!n)throw"module definition dependecy not found: "+e[r];i.push(n)}t.apply(null,i)}function i(e,i,o){if("string"!=typeof e)throw"invalid module definition, module id must be defined and be a string";if(i===t)throw"invalid module definition, dependencies must be specified";if(o===t)throw"invalid module definition, definition function must be specified";n(i,function(){a[e]=o.apply(null,arguments)})}function o(t){for(var n=e,i=t.split(/[.\/]/),o=0;i.length>o;++o){if(!n[i[o]])return;n=n[i[o]]}return n}function r(n){for(var i=0;n.length>i;i++){for(var o=e,r=n[i],s=r.split(/[.\/]/),l=0;s.length-1>l;++l)o[s[l]]===t&&(o[s[l]]={}),o=o[s[l]];o[s[s.length-1]]=a[r]}}var a={},s="tinymce/dom/Sizzle",l="tinymce/html/Styles",u="tinymce/dom/EventUtils",c="tinymce/dom/TreeWalker",d="tinymce/util/Tools",h="tinymce/dom/Range",p="tinymce/html/Entities",f="tinymce/Env",m="tinymce/dom/DOMUtils",g="tinymce/dom/ScriptLoader",v="tinymce/AddOnManager",y="tinymce/html/Node",b="tinymce/html/Schema",w="tinymce/html/SaxParser",x="tinymce/html/DomParser",_="tinymce/html/Writer",C="tinymce/html/Serializer",S="tinymce/dom/Serializer",T="tinymce/dom/TridentSelection",E="tinymce/util/VK",k="tinymce/dom/ControlSelection",N="tinymce/dom/Selection",A="tinymce/dom/RangeUtils",M="tinymce/Formatter",P="tinymce/UndoManager",R="tinymce/EnterKey",O="tinymce/ForceBlocks",I="tinymce/EditorCommands",D="tinymce/util/URI",H="tinymce/util/Class",L="tinymce/ui/Selector",z="tinymce/ui/Collection",B="tinymce/ui/DomUtils",F="tinymce/ui/Control",j="tinymce/ui/Factory",U="tinymce/ui/Container",W="tinymce/ui/DragHelper",V="tinymce/ui/Scrollable",$="tinymce/ui/Panel",q="tinymce/ui/Movable",Q="tinymce/ui/Resizable",G="tinymce/ui/FloatPanel",X="tinymce/ui/KeyboardNavigation",Y="tinymce/ui/Window",Z="tinymce/ui/MessageBox",K="tinymce/WindowManager",J="tinymce/util/Quirks",et="tinymce/util/Observable",tt="tinymce/Shortcuts",nt="tinymce/Editor",it="tinymce/util/I18n",ot="tinymce/FocusManager",rt="tinymce/EditorManager",at="tinymce/LegacyInput",st="tinymce/util/XHR",lt="tinymce/util/JSON",ut="tinymce/util/JSONRequest",ct="tinymce/util/JSONP",dt="tinymce/util/LocalStorage",ht="tinymce/Compat",pt="tinymce/ui/Layout",ft="tinymce/ui/AbsoluteLayout",mt="tinymce/ui/Tooltip",gt="tinymce/ui/Widget",vt="tinymce/ui/Button",yt="tinymce/ui/ButtonGroup",bt="tinymce/ui/Checkbox",wt="tinymce/ui/PanelButton",xt="tinymce/ui/ColorButton",_t="tinymce/ui/ComboBox",Ct="tinymce/ui/Path",St="tinymce/ui/ElementPath",Tt="tinymce/ui/FormItem",Et="tinymce/ui/Form",kt="tinymce/ui/FieldSet",Nt="tinymce/ui/FilePicker",At="tinymce/ui/FitLayout",Mt="tinymce/ui/FlexLayout",Pt="tinymce/ui/FlowLayout",Rt="tinymce/ui/FormatControls",Ot="tinymce/ui/GridLayout",It="tinymce/ui/Iframe",Dt="tinymce/ui/Label",Ht="tinymce/ui/Toolbar",Lt="tinymce/ui/MenuBar",zt="tinymce/ui/MenuButton",Bt="tinymce/ui/ListBox",Ft="tinymce/ui/MenuItem",jt="tinymce/ui/Menu",Ut="tinymce/ui/Radio",Wt="tinymce/ui/ResizeHandle",Vt="tinymce/ui/Spacer",$t="tinymce/ui/SplitButton",qt="tinymce/ui/StackLayout",Qt="tinymce/ui/TabPanel",Gt="tinymce/ui/TextBox",Xt="tinymce/ui/Throbber";i(s,[],function(){function e(e,n,i,o){return t.find(e,n,i,o)}if(!window.jQuery)throw Error("Load jQuery first");var t=jQuery;return e.matches=function(e,n){return t(n).is(e)?n:[]},e}),i(l,[],function(){return function(e,t){function n(e,t,n,i){function o(e){return e=parseInt(e,10).toString(16),e.length>1?e:"0"+e}return"#"+o(t)+o(n)+o(i)}var i,o,r,a=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/gi,s=/(?:url(?:(?:\(\s*\"([^\"]+)\"\s*\))|(?:\(\s*\'([^\']+)\'\s*\))|(?:\(\s*([^)\s]+)\s*\))))|(?:\'([^\']+)\')|(?:\"([^\"]+)\")/gi,l=/\s*([^:]+):\s*([^;]+);?/g,u=/\s+$/,c={},d="﻿";for(e=e||{},r=("\\\" \\' \\; \\: ; : "+d).split(" "),o=0;r.length>o;o++)c[r[o]]=d+o,c[d+o]=r[o];return{toHex:function(e){return e.replace(a,n)},parse:function(t){function i(e,t){var n,i,o,r;n=y[e+"-top"+t],n&&(i=y[e+"-right"+t],n==i&&(o=y[e+"-bottom"+t],i==o&&(r=y[e+"-left"+t],o==r&&(y[e+t]=r,delete y[e+"-top"+t],delete y[e+"-right"+t],delete y[e+"-bottom"+t],delete y[e+"-left"+t]))))}function o(e){var t,n=y[e];if(n&&!(0>n.indexOf(" "))){for(n=n.split(" "),t=n.length;t--;)if(n[t]!==n[0])return!1;return y[e]=n[0],!0}}function r(e,t,n,i){o(t)&&o(n)&&o(i)&&(y[e]=y[t]+" "+y[n]+" "+y[i],delete y[t],delete y[n],delete y[i])}function d(e){return v=!0,c[e]}function h(e,t){return v&&(e=e.replace(/\uFEFF[0-9]/g,function(e){return c[e]})),t||(e=e.replace(/\\([\'\";:])/g,"$1")),e}function p(e,t,n,i,o,r){return(o=o||r)?(o=h(o),"'"+o.replace(/\'/g,"\\'")+"'"):(t=h(t||n||i),b&&(t=b.call(w,t,"style")),"url('"+t.replace(/\'/g,"\\'")+"')")}var f,m,g,v,y={},b=e.url_converter,w=e.url_converter_scope||this;if(t){for(t=t.replace(/\\[\"\';:\uFEFF]/g,d).replace(/\"[^\"]+\"|\'[^\']+\'/g,function(e){return e.replace(/[;:]/g,d)});f=l.exec(t);)m=f[1].replace(u,"").toLowerCase(),g=f[2].replace(u,""),m&&g.length>0&&("font-weight"===m&&"700"===g?g="bold":("color"===m||"background-color"===m)&&(g=g.toLowerCase()),g=g.replace(a,n),g=g.replace(s,p),y[m]=v?h(g,!0):g),l.lastIndex=f.index+f[0].length;i("border",""),i("border","-width"),i("border","-color"),i("border","-style"),i("padding",""),i("margin",""),r("border","border-width","border-style","border-color"),"medium none"===y.border&&delete y.border}return y},serialize:function(e,n){function o(n){var o,r,a,l;if(o=t.styles[n])for(r=0,a=o.length;a>r;r++)n=o[r],l=e[n],l!==i&&l.length>0&&(s+=(s.length>0?" ":"")+n+": "+l+";")}var r,a,s="";if(n&&t&&t.styles)o("*"),o(n);else for(r in e)a=e[r],a!==i&&a.length>0&&(s+=(s.length>0?" ":"")+r+": "+a+";");return s}}}}),i(u,[],function(){function e(e,t,n,i){e.addEventListener?e.addEventListener(t,n,i||!1):e.attachEvent&&e.attachEvent("on"+t,n)}function t(e,t,n,i){e.removeEventListener?e.removeEventListener(t,n,i||!1):e.detachEvent&&e.detachEvent("on"+t,n)}function n(e,t){function n(){return!1}function i(){return!0}var o,r,l=t||{};for(o in e)s[o]||(l[o]=e[o]);if(l.target||(l.target=l.srcElement||document),e&&a.test(e.type)&&e.pageX===r&&e.clientX!==r){var u=l.target.ownerDocument||document,c=u.documentElement,d=u.body;l.pageX=e.clientX+(c&&c.scrollLeft||d&&d.scrollLeft||0)-(c&&c.clientLeft||d&&d.clientLeft||0),l.pageY=e.clientY+(c&&c.scrollTop||d&&d.scrollTop||0)-(c&&c.clientTop||d&&d.clientTop||0)}return l.preventDefault=function(){l.isDefaultPrevented=i,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},l.stopPropagation=function(){l.isPropagationStopped=i,e&&(e.stopPropagation?e.stopPropagation():e.cancelBubble=!0)},l.stopImmediatePropagation=function(){l.isImmediatePropagationStopped=i,l.stopPropagation()},l.isDefaultPrevented||(l.isDefaultPrevented=n,l.isPropagationStopped=n,l.isImmediatePropagationStopped=n),l}function i(n,i,o){function r(){o.domLoaded||(o.domLoaded=!0,i(u))}function a(){"complete"===l.readyState&&(t(l,"readystatechange",a),r())}function s(){try{l.documentElement.doScroll("left")}catch(e){return setTimeout(s,0),void 0}r()}var l=n.document,u={type:"ready"};return o.domLoaded?(i(u),void 0):(l.addEventListener?e(n,"DOMContentLoaded",r):(e(l,"readystatechange",a),l.documentElement.doScroll&&n===n.top&&s()),e(n,"load",r),void 0)}function o(){function o(e,t){var n,i,o,r;if(n=h[t][e.type])for(i=0,o=n.length;o>i;i++)if(r=n[i],r&&r.func.call(r.scope,e)===!1&&e.preventDefault(),e.isImmediatePropagationStopped())return}var a,s,l,u,c,d=this,h={};s=r+(+new Date).toString(32),u="onmouseenter"in document.documentElement,l="onfocusin"in document.documentElement,c={mouseenter:"mouseover",mouseleave:"mouseout"},a=1,d.domLoaded=!1,d.events=h,d.bind=function(t,r,p,f){function m(e){o(n(e||C.event),g)}var g,v,y,b,w,x,_,C=window;if(t&&3!==t.nodeType&&8!==t.nodeType){for(t[s]?g=t[s]:(g=a++,t[s]=g,h[g]={}),f=f||t,r=r.split(" "),y=r.length;y--;)b=r[y],x=m,w=_=!1,"DOMContentLoaded"===b&&(b="ready"),d.domLoaded&&"ready"===b&&"complete"==t.readyState?p.call(f,n({type:b})):(u||(w=c[b],w&&(x=function(e){var t,i;
if(t=e.currentTarget,i=e.relatedTarget,i&&t.contains)i=t.contains(i);else for(;i&&i!==t;)i=i.parentNode;i||(e=n(e||C.event),e.type="mouseout"===e.type?"mouseleave":"mouseenter",e.target=t,o(e,g))})),l||"focusin"!==b&&"focusout"!==b||(_=!0,w="focusin"===b?"focus":"blur",x=function(e){e=n(e||C.event),e.type="focus"===e.type?"focusin":"focusout",o(e,g)}),v=h[g][b],v?"ready"===b&&d.domLoaded?p({type:b}):v.push({func:p,scope:f}):(h[g][b]=v=[{func:p,scope:f}],v.fakeName=w,v.capture=_,v.nativeHandler=x,"ready"===b?i(t,x,d):e(t,w||b,x,_)));return t=v=0,p}},d.unbind=function(e,n,i){var o,r,a,l,u,c;if(!e||3===e.nodeType||8===e.nodeType)return d;if(o=e[s]){if(c=h[o],n){for(n=n.split(" "),a=n.length;a--;)if(u=n[a],r=c[u]){if(i)for(l=r.length;l--;)r[l].func===i&&r.splice(l,1);i&&0!==r.length||(delete c[u],t(e,r.fakeName||u,r.nativeHandler,r.capture))}}else{for(u in c)r=c[u],t(e,r.fakeName||u,r.nativeHandler,r.capture);c={}}for(u in c)return d;delete h[o];try{delete e[s]}catch(p){e[s]=null}}return d},d.fire=function(e,t,i){var r;if(!e||3===e.nodeType||8===e.nodeType)return d;i=n(null,i),i.type=t,i.target=e;do r=e[s],r&&o(i,r),e=e.parentNode||e.ownerDocument||e.defaultView||e.parentWindow;while(e&&!i.isPropagationStopped());return d},d.clean=function(e){var t,n,i=d.unbind;if(!e||3===e.nodeType||8===e.nodeType)return d;if(e[s]&&i(e),e.getElementsByTagName||(e=e.document),e&&e.getElementsByTagName)for(i(e),n=e.getElementsByTagName("*"),t=n.length;t--;)e=n[t],e[s]&&i(e);return d},d.destroy=function(){h={}},d.cancel=function(e){return e&&(e.preventDefault(),e.stopImmediatePropagation()),!1}}var r="mce-data-",a=/^(?:mouse|contextmenu)|click/,s={keyLocation:1,layerX:1,layerY:1};return o.Event=new o,o.Event.bind(window,"ready",function(){}),o}),i(c,[],function(){return function(e,t){function n(e,n,i,o){var r,a;if(e){if(!o&&e[n])return e[n];if(e!=t){if(r=e[i])return r;for(a=e.parentNode;a&&a!=t;a=a.parentNode)if(r=a[i])return r}}}var i=e;this.current=function(){return i},this.next=function(e){return i=n(i,"firstChild","nextSibling",e)},this.prev=function(e){return i=n(i,"lastChild","previousSibling",e)}}}),i(d,[],function(){function e(e,n){return n?"array"==n&&g(e)?!0:typeof e==n:e!==t}function n(e){var t,n,i=[];for(t=0,n=e.length;n>t;t++)i[t]=e[t];return i}function i(e,t,n){var i;for(e=e||[],t=t||",","string"==typeof e&&(e=e.split(t)),n=n||{},i=e.length;i--;)n[e[i]]={};return n}function o(e,n,i){var o,r;if(!e)return 0;if(i=i||e,e.length!==t){for(o=0,r=e.length;r>o;o++)if(n.call(i,e[o],o,e)===!1)return 0}else for(o in e)if(e.hasOwnProperty(o)&&n.call(i,e[o],o,e)===!1)return 0;return 1}function r(e,t){var n=[];return o(e,function(e){n.push(t(e))}),n}function a(e,t){var n=[];return o(e,function(e){(!t||t(e))&&n.push(e)}),n}function s(e,t,n){var i,o,r,a,s,l=this,u=0;if(e=/^((static) )?([\w.]+)(:([\w.]+))?/.exec(e),r=e[3].match(/(^|\.)(\w+)$/i)[2],o=l.createNS(e[3].replace(/\.\w+$/,""),n),!o[r]){if("static"==e[2])return o[r]=t,this.onCreate&&this.onCreate(e[2],e[3],o[r]),void 0;t[r]||(t[r]=function(){},u=1),o[r]=t[r],l.extend(o[r].prototype,t),e[5]&&(i=l.resolve(e[5]).prototype,a=e[5].match(/\.(\w+)$/i)[1],s=o[r],o[r]=u?function(){return i[a].apply(this,arguments)}:function(){return this.parent=i[a],s.apply(this,arguments)},o[r].prototype[r]=o[r],l.each(i,function(e,t){o[r].prototype[t]=i[t]}),l.each(t,function(e,t){i[t]?o[r].prototype[t]=function(){return this.parent=i[t],e.apply(this,arguments)}:t!=r&&(o[r].prototype[t]=e)})),l.each(t["static"],function(e,t){o[r][t]=e})}}function l(e,t){var n,i;if(e)for(n=0,i=e.length;i>n;n++)if(e[n]===t)return n;return-1}function u(e,n){var i,o,r,a,s=arguments;for(i=1,o=s.length;o>i;i++){n=s[i];for(r in n)n.hasOwnProperty(r)&&(a=n[r],a!==t&&(e[r]=a))}return e}function c(e,t,n,i){i=i||this,e&&(n&&(e=e[n]),o(e,function(e,o){return t.call(i,e,o,n)===!1?!1:(c(e,t,n,i),void 0)}))}function d(e,t){var n,i;for(t=t||window,e=e.split("."),n=0;e.length>n;n++)i=e[n],t[i]||(t[i]={}),t=t[i];return t}function h(e,t){var n,i;for(t=t||window,e=e.split("."),n=0,i=e.length;i>n&&(t=t[e[n]]);n++);return t}function p(t,n){return!t||e(t,"array")?t:r(t.split(n||","),m)}var f=/^\s*|\s*$/g,m=function(e){return null===e||e===t?"":(""+e).replace(f,"")},g=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};return{trim:m,isArray:g,is:e,toArray:n,makeMap:i,each:o,map:r,grep:a,inArray:l,extend:u,create:s,walk:c,createNS:d,resolve:h,explode:p}}),i(h,[d],function(e){function t(n){function i(){return D.createDocumentFragment()}function o(e,t){C(B,e,t)}function r(e,t){C(F,e,t)}function a(e){o(e.parentNode,q(e))}function s(e){o(e.parentNode,q(e)+1)}function l(e){r(e.parentNode,q(e))}function u(e){r(e.parentNode,q(e)+1)}function c(e){e?(I[W]=I[U],I[V]=I[j]):(I[U]=I[W],I[j]=I[V]),I.collapsed=B}function d(e){a(e),u(e)}function h(e){o(e,0),r(e,1===e.nodeType?e.childNodes.length:e.nodeValue.length)}function p(e,t){var n=I[U],i=I[j],o=I[W],r=I[V],a=t.startContainer,s=t.startOffset,l=t.endContainer,u=t.endOffset;return 0===e?_(n,i,a,s):1===e?_(o,r,a,s):2===e?_(o,r,l,u):3===e?_(n,i,l,u):void 0}function f(){S(z)}function m(){return S(H)}function g(){return S(L)}function v(e){var t,i,o=this[U],r=this[j];3!==o.nodeType&&4!==o.nodeType||!o.nodeValue?(o.childNodes.length>0&&(i=o.childNodes[r]),i?o.insertBefore(e,i):o.appendChild(e)):r?r>=o.nodeValue.length?n.insertAfter(e,o):(t=o.splitText(r),o.parentNode.insertBefore(e,t)):o.parentNode.insertBefore(e,o)}function y(e){var t=I.extractContents();I.insertNode(e),e.appendChild(t),I.selectNode(e)}function b(){return $(new t(n),{startContainer:I[U],startOffset:I[j],endContainer:I[W],endOffset:I[V],collapsed:I.collapsed,commonAncestorContainer:I.commonAncestorContainer})}function w(e,t){var n;if(3==e.nodeType)return e;if(0>t)return e;for(n=e.firstChild;n&&t>0;)--t,n=n.nextSibling;return n?n:e}function x(){return I[U]==I[W]&&I[j]==I[V]}function _(e,t,i,o){var r,a,s,l,u,c;if(e==i)return t==o?0:o>t?-1:1;for(r=i;r&&r.parentNode!=e;)r=r.parentNode;if(r){for(a=0,s=e.firstChild;s!=r&&t>a;)a++,s=s.nextSibling;return a>=t?-1:1}for(r=e;r&&r.parentNode!=i;)r=r.parentNode;if(r){for(a=0,s=i.firstChild;s!=r&&o>a;)a++,s=s.nextSibling;return o>a?-1:1}for(l=n.findCommonAncestor(e,i),u=e;u&&u.parentNode!=l;)u=u.parentNode;for(u||(u=l),c=i;c&&c.parentNode!=l;)c=c.parentNode;if(c||(c=l),u==c)return 0;for(s=l.firstChild;s;){if(s==u)return-1;if(s==c)return 1;s=s.nextSibling}}function C(e,t,i){var o,r;for(e?(I[U]=t,I[j]=i):(I[W]=t,I[V]=i),o=I[W];o.parentNode;)o=o.parentNode;for(r=I[U];r.parentNode;)r=r.parentNode;r==o?_(I[U],I[j],I[W],I[V])>0&&I.collapse(e):I.collapse(e),I.collapsed=x(),I.commonAncestorContainer=n.findCommonAncestor(I[U],I[W])}function S(e){var t,n,i,o,r,a,s,l=0,u=0;if(I[U]==I[W])return T(e);for(t=I[W],n=t.parentNode;n;t=n,n=n.parentNode){if(n==I[U])return E(t,e);++l}for(t=I[U],n=t.parentNode;n;t=n,n=n.parentNode){if(n==I[W])return k(t,e);++u}for(i=u-l,o=I[U];i>0;)o=o.parentNode,i--;for(r=I[W];0>i;)r=r.parentNode,i++;for(a=o.parentNode,s=r.parentNode;a!=s;a=a.parentNode,s=s.parentNode)o=a,r=s;return N(o,r,e)}function T(e){var t,n,o,r,a,s,l,u,c;if(e!=z&&(t=i()),I[j]==I[V])return t;if(3==I[U].nodeType){if(n=I[U].nodeValue,o=n.substring(I[j],I[V]),e!=L&&(r=I[U],u=I[j],c=I[V]-I[j],0===u&&c>=r.nodeValue.length-1?r.parentNode.removeChild(r):r.deleteData(u,c),I.collapse(B)),e==z)return;return o.length>0&&t.appendChild(D.createTextNode(o)),t}for(r=w(I[U],I[j]),a=I[V]-I[j];r&&a>0;)s=r.nextSibling,l=R(r,e),t&&t.appendChild(l),--a,r=s;return e!=L&&I.collapse(B),t}function E(e,t){var n,o,r,a,s,l;if(t!=z&&(n=i()),o=A(e,t),n&&n.appendChild(o),r=q(e),a=r-I[j],0>=a)return t!=L&&(I.setEndBefore(e),I.collapse(F)),n;for(o=e.previousSibling;a>0;)s=o.previousSibling,l=R(o,t),n&&n.insertBefore(l,n.firstChild),--a,o=s;return t!=L&&(I.setEndBefore(e),I.collapse(F)),n}function k(e,t){var n,o,r,a,s,l;for(t!=z&&(n=i()),r=M(e,t),n&&n.appendChild(r),o=q(e),++o,a=I[V]-o,r=e.nextSibling;r&&a>0;)s=r.nextSibling,l=R(r,t),n&&n.appendChild(l),--a,r=s;return t!=L&&(I.setStartAfter(e),I.collapse(B)),n}function N(e,t,n){var o,r,a,s,l,u,c,d;for(n!=z&&(r=i()),o=M(e,n),r&&r.appendChild(o),a=e.parentNode,s=q(e),l=q(t),++s,u=l-s,c=e.nextSibling;u>0;)d=c.nextSibling,o=R(c,n),r&&r.appendChild(o),c=d,--u;return o=A(t,n),r&&r.appendChild(o),n!=L&&(I.setStartAfter(e),I.collapse(B)),r}function A(e,t){var n,i,o,r,a,s=w(I[W],I[V]-1),l=s!=I[W];if(s==e)return P(s,l,F,t);for(n=s.parentNode,i=P(n,F,F,t);n;){for(;s;)o=s.previousSibling,r=P(s,l,F,t),t!=z&&i.insertBefore(r,i.firstChild),l=B,s=o;if(n==e)return i;s=n.previousSibling,n=n.parentNode,a=P(n,F,F,t),t!=z&&a.appendChild(i),i=a}}function M(e,t){var n,i,o,r,a,s=w(I[U],I[j]),l=s!=I[U];if(s==e)return P(s,l,B,t);for(n=s.parentNode,i=P(n,F,B,t);n;){for(;s;)o=s.nextSibling,r=P(s,l,B,t),t!=z&&i.appendChild(r),l=B,s=o;if(n==e)return i;s=n.nextSibling,n=n.parentNode,a=P(n,F,B,t),t!=z&&a.appendChild(i),i=a}}function P(e,t,i,o){var r,a,s,l,u;if(t)return R(e,o);if(3==e.nodeType){if(r=e.nodeValue,i?(l=I[j],a=r.substring(l),s=r.substring(0,l)):(l=I[V],a=r.substring(0,l),s=r.substring(l)),o!=L&&(e.nodeValue=s),o==z)return;return u=n.clone(e,F),u.nodeValue=a,u}return o!=z?n.clone(e,F):void 0}function R(e,t){return t!=z?t==L?n.clone(e,B):e:(e.parentNode.removeChild(e),void 0)}function O(){return n.create("body",null,g()).outerText}var I=this,D=n.doc,H=0,L=1,z=2,B=!0,F=!1,j="startOffset",U="startContainer",W="endContainer",V="endOffset",$=e.extend,q=n.nodeIndex;return $(I,{startContainer:D,startOffset:0,endContainer:D,endOffset:0,collapsed:B,commonAncestorContainer:D,START_TO_START:0,START_TO_END:1,END_TO_END:2,END_TO_START:3,setStart:o,setEnd:r,setStartBefore:a,setStartAfter:s,setEndBefore:l,setEndAfter:u,collapse:c,selectNode:d,selectNodeContents:h,compareBoundaryPoints:p,deleteContents:f,extractContents:m,cloneContents:g,insertNode:v,surroundContents:y,cloneRange:b,toStringIE:O}),I}return t.prototype.toString=function(){return this.toStringIE()},t}),i(p,[d],function(e){function t(e){var t;return t=document.createElement("div"),t.innerHTML=e,t.textContent||t.innerText||e}function n(e,t){var n,i,r,a={};if(e){for(e=e.split(","),t=t||10,n=0;e.length>n;n+=2)i=String.fromCharCode(parseInt(e[n],t)),o[i]||(r="&"+e[n+1]+";",a[i]=r,a[r]=i);return a}}var i,o,r,a=e.makeMap,s=/[&<>\"\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,l=/[<>&\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,u=/[<>&\"\']/g,c=/&(#x|#)?([\w]+);/g,d={128:"€",130:"‚",131:"ƒ",132:"„",133:"…",134:"†",135:"‡",136:"ˆ",137:"‰",138:"Š",139:"‹",140:"Œ",142:"Ž",145:"‘",146:"’",147:"“",148:"”",149:"•",150:"–",151:"—",152:"˜",153:"™",154:"š",155:"›",156:"œ",158:"ž",159:"Ÿ"};o={'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;","&":"&amp;"},r={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&apos;":"'"},i=n("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32);var h={encodeRaw:function(e,t){return e.replace(t?s:l,function(e){return o[e]||e})},encodeAllRaw:function(e){return(""+e).replace(u,function(e){return o[e]||e})},encodeNumeric:function(e,t){return e.replace(t?s:l,function(e){return e.length>1?"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";":o[e]||"&#"+e.charCodeAt(0)+";"})},encodeNamed:function(e,t,n){return n=n||i,e.replace(t?s:l,function(e){return o[e]||n[e]||e})},getEncodeFunc:function(e,t){function r(e,n){return e.replace(n?s:l,function(e){return o[e]||t[e]||"&#"+e.charCodeAt(0)+";"||e})}function u(e,n){return h.encodeNamed(e,n,t)}return t=n(t)||i,e=a(e.replace(/\+/g,",")),e.named&&e.numeric?r:e.named?t?u:h.encodeNamed:e.numeric?h.encodeNumeric:h.encodeRaw},decode:function(e){return e.replace(c,function(e,n,o){return n?(o=parseInt(o,2===n.length?16:10),o>65535?(o-=65536,String.fromCharCode(55296+(o>>10),56320+(1023&o))):d[o]||String.fromCharCode(o)):r[e]||i[e]||t(e)})}};return h}),i(f,[],function(){var e,t,n,i,o,r,a,s=navigator,l=s.userAgent;e=window.opera&&window.opera.buildNumber,t=/WebKit/.test(l),n=!t&&!e&&/MSIE/gi.test(l)&&/Explorer/gi.test(s.appName),n=n&&/MSIE (\w+)\./.exec(l)[1],i=-1!=l.indexOf("Trident")?11:!1,n=n||i,o=!t&&/Gecko/.test(l),r=-1!=l.indexOf("Mac"),a=/(iPad|iPhone)/.test(l);var u=!a||l.match(/AppleWebKit\/(\d*)/)[1]>=534;return{opera:e,webkit:t,ie:n,gecko:o,mac:r,iOS:a,contentEditable:u,transparentSrc:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",caretAfter:8!=n,range:window.getSelection&&"Range"in window,documentMode:n?document.documentMode||7:10}}),i(m,[s,l,u,c,h,p,f,d],function(e,n,i,o,r,a,s,l){function u(e,t){var o,r=this;r.doc=e,r.win=window,r.files={},r.counter=0,r.stdMode=!g||e.documentMode>=8,r.boxModel=!g||"CSS1Compat"==e.compatMode||r.stdMode,r.hasOuterHTML="outerHTML"in e.createElement("a"),r.settings=t=f({keep_values:!1,hex_colors:1},t),r.schema=t.schema,r.styles=new n({url_converter:t.url_converter,url_converter_scope:t.url_converter_scope},t.schema),r.fixDoc(e),r.events=t.ownEvents?new i(t.proxy):i.Event,o=t.schema?t.schema.getBlockElements():{},r.isBlock=function(e){if(!e)return!1;var t=e.nodeType;return t?!(1!==t||!o[e.nodeName]):!!o[e]}}var c=l.each,d=l.is,h=l.grep,p=l.trim,f=l.extend,m=s.webkit,g=s.ie,v=/^([a-z0-9],?)+$/i,y=/^[ \t\r\n]*$/,b=l.makeMap("fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom"," ");return u.prototype={root:null,props:{"for":"htmlFor","class":"className",className:"className",checked:"checked",disabled:"disabled",maxlength:"maxLength",readonly:"readOnly",selected:"selected",value:"value",id:"id",name:"name",type:"type"},fixDoc:function(e){var t,n=this.settings;if(g&&n.schema){"abbr article aside audio canvas details figcaption figure footer header hgroup mark menu meter nav output progress section summary time video".replace(/\w+/g,function(t){e.createElement(t)});for(t in n.schema.getCustomElements())e.createElement(t)}},clone:function(e,t){var n,i,o=this;return!g||1!==e.nodeType||t?e.cloneNode(t):(i=o.doc,t?n.firstChild:(n=i.createElement(e.nodeName),c(o.getAttribs(e),function(t){o.setAttrib(n,t.nodeName,o.getAttrib(e,t.nodeName))}),n))},getRoot:function(){var e=this;return e.get(e.settings.root_element)||e.doc.body},getViewPort:function(e){var t,n;return e=e?e:this.win,t=e.document,n=this.boxModel?t.documentElement:t.body,{x:e.pageXOffset||n.scrollLeft,y:e.pageYOffset||n.scrollTop,w:e.innerWidth||n.clientWidth,h:e.innerHeight||n.clientHeight}},getRect:function(e){var t,n,i=this;return e=i.get(e),t=i.getPos(e),n=i.getSize(e),{x:t.x,y:t.y,w:n.w,h:n.h}},getSize:function(e){var t,n,i=this;return e=i.get(e),t=i.getStyle(e,"width"),n=i.getStyle(e,"height"),-1===t.indexOf("px")&&(t=0),-1===n.indexOf("px")&&(n=0),{w:parseInt(t,10)||e.offsetWidth||e.clientWidth,h:parseInt(n,10)||e.offsetHeight||e.clientHeight}},getParent:function(e,t,n){return this.getParents(e,t,n,!1)},getParents:function(e,n,i,o){var r,a=this,s=[];for(e=a.get(e),o=o===t,i=i||("BODY"!=a.getRoot().nodeName?a.getRoot().parentNode:null),d(n,"string")&&(r=n,n="*"===n?function(e){return 1==e.nodeType}:function(e){return a.is(e,r)});e&&e!=i&&e.nodeType&&9!==e.nodeType;){if(!n||n(e)){if(!o)return e;s.push(e)}e=e.parentNode}return o?s:null},get:function(e){var t;return e&&this.doc&&"string"==typeof e&&(t=e,e=this.doc.getElementById(e),e&&e.id!==t)?this.doc.getElementsByName(t)[1]:e},getNext:function(e,t){return this._findSib(e,t,"nextSibling")},getPrev:function(e,t){return this._findSib(e,t,"previousSibling")},select:function(t,n){var i=this;return e(t,i.get(n)||i.get(i.settings.root_element)||i.doc,[])},is:function(n,i){var o;if(n.length===t){if("*"===i)return 1==n.nodeType;if(v.test(i)){for(i=i.toLowerCase().split(/,/),n=n.nodeName.toLowerCase(),o=i.length-1;o>=0;o--)if(i[o]==n)return!0;return!1}}return n.nodeType&&1!=n.nodeType?!1:e.matches(i,n.nodeType?[n]:n).length>0},add:function(e,t,n,i,o){var r=this;return this.run(e,function(e){var a;return a=d(t,"string")?r.doc.createElement(t):t,r.setAttribs(a,n),i&&(i.nodeType?a.appendChild(i):r.setHTML(a,i)),o?a:e.appendChild(a)})},create:function(e,t,n){return this.add(this.doc.createElement(e),e,t,n,1)},createHTML:function(e,t,n){var i,o="";o+="<"+e;for(i in t)t.hasOwnProperty(i)&&null!==t[i]&&(o+=" "+i+'="'+this.encode(t[i])+'"');return n!==void 0?o+">"+n+"</"+e+">":o+" />"},createFragment:function(e){var t,n,i,o=this.doc;for(i=o.createElement("div"),t=o.createDocumentFragment(),e&&(i.innerHTML=e);n=i.firstChild;)t.appendChild(n);return t},remove:function(e,t){return this.run(e,function(e){var n,i=e.parentNode;if(!i)return null;if(t)for(;n=e.firstChild;)!g||3!==n.nodeType||n.nodeValue?i.insertBefore(n,e):e.removeChild(n);return i.removeChild(e)})},setStyle:function(e,t,n){return this.run(e,function(e){var i,o,r=this;if(t)if("string"==typeof t){i=e.style,t=t.replace(/-(\D)/g,function(e,t){return t.toUpperCase()}),"number"!=typeof n||b[t]||(n+="px"),"opacity"===t&&e.runtimeStyle&&e.runtimeStyle.opacity===void 0&&(i.filter=""===n?"":"alpha(opacity="+100*n+")"),"float"==t&&(t="cssFloat"in e.style?"cssFloat":"styleFloat");try{i[t]=n}catch(a){}r.settings.update_styles&&e.removeAttribute("data-mce-style")}else for(o in t)r.setStyle(e,o,t[o])})},getStyle:function(e,n,i){if(e=this.get(e)){if(this.doc.defaultView&&i){n=n.replace(/[A-Z]/g,function(e){return"-"+e});try{return this.doc.defaultView.getComputedStyle(e,null).getPropertyValue(n)}catch(o){return null}}return n=n.replace(/-(\D)/g,function(e,t){return t.toUpperCase()}),"float"==n&&(n=g?"styleFloat":"cssFloat"),e.currentStyle&&i?e.currentStyle[n]:e.style?e.style[n]:t}},setStyles:function(e,t){this.setStyle(e,t)},css:function(e,t,n){this.setStyle(e,t,n)},removeAllAttribs:function(e){return this.run(e,function(e){var t,n=e.attributes;for(t=n.length-1;t>=0;t--)e.removeAttributeNode(n.item(t))})},setAttrib:function(e,t,n){var i=this;return e&&t?this.run(e,function(e){var o=i.settings,r=e.getAttribute(t);if(null!==n)switch(t){case"style":if(!d(n,"string"))return c(n,function(t,n){i.setStyle(e,n,t)}),void 0;o.keep_values&&(n?e.setAttribute("data-mce-style",n,2):e.removeAttribute("data-mce-style",2)),e.style.cssText=n;break;case"class":e.className=n||"";break;case"src":case"href":o.keep_values&&(o.url_converter&&(n=o.url_converter.call(o.url_converter_scope||i,n,t,e)),i.setAttrib(e,"data-mce-"+t,n,2));break;case"shape":e.setAttribute("data-mce-style",n)}d(n)&&null!==n&&0!==n.length?e.setAttribute(t,""+n,2):e.removeAttribute(t,2),r!=n&&o.onSetAttrib&&o.onSetAttrib({attrElm:e,attrName:t,attrValue:n})}):void 0},setAttribs:function(e,t){var n=this;return this.run(e,function(e){c(t,function(t,i){n.setAttrib(e,i,t)})})},getAttrib:function(e,t,n){var i,o,r=this;if(e=r.get(e),!e||1!==e.nodeType)return n===o?!1:n;if(d(n)||(n=""),/^(src|href|style|coords|shape)$/.test(t)&&(i=e.getAttribute("data-mce-"+t)))return i;if(g&&r.props[t]&&(i=e[r.props[t]],i=i&&i.nodeValue?i.nodeValue:i),i||(i=e.getAttribute(t,2)),/^(checked|compact|declare|defer|disabled|ismap|multiple|nohref|noshade|nowrap|readonly|selected)$/.test(t))return e[r.props[t]]===!0&&""===i?t:i?t:"";if("FORM"===e.nodeName&&e.getAttributeNode(t))return e.getAttributeNode(t).nodeValue;if("style"===t&&(i=i||e.style.cssText,i&&(i=r.serializeStyle(r.parseStyle(i),e.nodeName),r.settings.keep_values&&e.setAttribute("data-mce-style",i))),m&&"class"===t&&i&&(i=i.replace(/(apple|webkit)\-[a-z\-]+/gi,"")),g)switch(t){case"rowspan":case"colspan":1===i&&(i="");break;case"size":("+0"===i||20===i||0===i)&&(i="");break;case"width":case"height":case"vspace":case"checked":case"disabled":case"readonly":0===i&&(i="");break;case"hspace":-1===i&&(i="");break;case"maxlength":case"tabindex":(32768===i||2147483647===i||"32768"===i)&&(i="");break;case"multiple":case"compact":case"noshade":case"nowrap":return 65535===i?t:n;case"shape":i=i.toLowerCase();break;default:0===t.indexOf("on")&&i&&(i=(""+i).replace(/^function\s+\w+\(\)\s+\{\s+(.*)\s+\}$/,"$1"))}return i!==o&&null!==i&&""!==i?""+i:n},getPos:function(e,t){var n,i,o=this,r=0,a=0,s=o.doc;if(e=o.get(e),t=t||s.body,e){if(t===s.body&&e.getBoundingClientRect)return i=e.getBoundingClientRect(),t=o.boxModel?s.documentElement:s.body,r=i.left+(s.documentElement.scrollLeft||s.body.scrollLeft)-t.clientTop,a=i.top+(s.documentElement.scrollTop||s.body.scrollTop)-t.clientLeft,{x:r,y:a};for(n=e;n&&n!=t&&n.nodeType;)r+=n.offsetLeft||0,a+=n.offsetTop||0,n=n.offsetParent;for(n=e.parentNode;n&&n!=t&&n.nodeType;)r-=n.scrollLeft||0,a-=n.scrollTop||0,n=n.parentNode}return{x:r,y:a}},parseStyle:function(e){return this.styles.parse(e)},serializeStyle:function(e,t){return this.styles.serialize(e,t)},addStyle:function(e){var t,n,i=this,o=i.doc;if(i!==u.DOM&&o===document){var r=u.DOM.addedStyles;if(r=r||[],r[e])return;r[e]=!0,u.DOM.addedStyles=r}n=o.getElementById("mceDefaultStyles"),n||(n=o.createElement("style"),n.id="mceDefaultStyles",n.type="text/css",t=o.getElementsByTagName("head")[0],t.firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n)),n.styleSheet?n.styleSheet.cssText+=e:n.appendChild(o.createTextNode(e))},loadCSS:function(e){var t,n=this,i=n.doc;return n!==u.DOM&&i===document?(u.DOM.loadCSS(e),void 0):(e||(e=""),t=i.getElementsByTagName("head")[0],c(e.split(","),function(e){var o;n.files[e]||(n.files[e]=!0,o=n.create("link",{rel:"stylesheet",href:e}),g&&i.documentMode&&i.recalc&&(o.onload=function(){i.recalc&&i.recalc(),o.onload=null}),t.appendChild(o))}),void 0)},addClass:function(e,t){return this.run(e,function(e){var n;return t?this.hasClass(e,t)?e.className:(n=this.removeClass(e,t),e.className=n=(""!==n?n+" ":"")+t,n):0})},removeClass:function(e,t){var n,i=this;return i.run(e,function(e){var o;return i.hasClass(e,t)?(n||(n=RegExp("(^|\\s+)"+t+"(\\s+|$)","g")),o=e.className.replace(n," "),o=p(" "!=o?o:""),e.className=o,o||(e.removeAttribute("class"),e.removeAttribute("className")),o):e.className})},hasClass:function(e,t){return e=this.get(e),e&&t?-1!==(" "+e.className+" ").indexOf(" "+t+" "):!1},toggleClass:function(e,n,i){i=i===t?!this.hasClass(e,n):i,this.hasClass(e,n)!==i&&(i?this.addClass(e,n):this.removeClass(e,n))},show:function(e){return this.setStyle(e,"display","block")},hide:function(e){return this.setStyle(e,"display","none")},isHidden:function(e){return e=this.get(e),!e||"none"==e.style.display||"none"==this.getStyle(e,"display")},uniqueId:function(e){return(e?e:"mce_")+this.counter++},setHTML:function(e,t){var n=this;return n.run(e,function(e){if(g){for(;e.firstChild;)e.removeChild(e.firstChild);try{e.innerHTML="<br />"+t,e.removeChild(e.firstChild)}catch(i){var o=n.create("div");o.innerHTML="<br />"+t,c(h(o.childNodes),function(t,n){n&&e.canHaveHTML&&e.appendChild(t)})}}else e.innerHTML=t;return t})},getOuterHTML:function(e){var t,n=this;return(e=n.get(e))?1===e.nodeType&&n.hasOuterHTML?e.outerHTML:(t=(e.ownerDocument||n.doc).createElement("body"),t.appendChild(e.cloneNode(!0)),t.innerHTML):null},setOuterHTML:function(e,t,n){var i=this;return i.run(e,function(e){function o(){var o,r;for(r=n.createElement("body"),r.innerHTML=t,o=r.lastChild;o;)i.insertAfter(o.cloneNode(!0),e),o=o.previousSibling;i.remove(e)}if(1==e.nodeType)if(n=n||e.ownerDocument||i.doc,g)try{1==e.nodeType&&i.hasOuterHTML?e.outerHTML=t:o()}catch(r){o()}else o()})},decode:a.decode,encode:a.encodeAllRaw,insertAfter:function(e,t){return t=this.get(t),this.run(e,function(e){var n,i;return n=t.parentNode,i=t.nextSibling,i?n.insertBefore(e,i):n.appendChild(e),e})},replace:function(e,t,n){var i=this;return i.run(t,function(t){return d(t,"array")&&(e=e.cloneNode(!0)),n&&c(h(t.childNodes),function(t){e.appendChild(t)}),t.parentNode.replaceChild(e,t)})},rename:function(e,t){var n,i=this;return e.nodeName!=t.toUpperCase()&&(n=i.create(t),c(i.getAttribs(e),function(t){i.setAttrib(n,t.nodeName,i.getAttrib(e,t.nodeName))}),i.replace(n,e,1)),n||e},findCommonAncestor:function(e,t){for(var n,i=e;i;){for(n=t;n&&i!=n;)n=n.parentNode;if(i==n)break;i=i.parentNode}return!i&&e.ownerDocument?e.ownerDocument.documentElement:i},toHex:function(e){return this.styles.toHex(l.trim(e))},run:function(e,t,n){var i,o=this;return"string"==typeof e&&(e=o.get(e)),e?(n=n||this,e.nodeType||!e.length&&0!==e.length?t.call(n,e):(i=[],c(e,function(e,r){e&&("string"==typeof e&&(e=o.get(e)),i.push(t.call(n,e,r)))}),i)):!1},getAttribs:function(e){var t;if(e=this.get(e),!e)return[];if(g){if(t=[],"OBJECT"==e.nodeName)return e.attributes;"OPTION"===e.nodeName&&this.getAttrib(e,"selected")&&t.push({specified:1,nodeName:"selected"});var n=/<\/?[\w:\-]+ ?|=[\"][^\"]+\"|=\'[^\']+\'|=[\w\-]+|>/gi;return e.cloneNode(!1).outerHTML.replace(n,"").replace(/[\w:\-]+/gi,function(e){t.push({specified:1,nodeName:e})}),t}return e.attributes},isEmpty:function(e,t){var n,i,r,a,s,l=this,u=0;if(e=e.firstChild){a=new o(e,e.parentNode),t=t||l.schema?l.schema.getNonEmptyElements():null;do{if(r=e.nodeType,1===r){if(e.getAttribute("data-mce-bogus"))continue;if(s=e.nodeName.toLowerCase(),t&&t[s]){if("br"===s){u++;continue}return!1}for(i=l.getAttribs(e),n=e.attributes.length;n--;)if(s=e.attributes[n].nodeName,"name"===s||"data-mce-bookmark"===s)return!1}if(8==r)return!1;if(3===r&&!y.test(e.nodeValue))return!1}while(e=a.next())}return 1>=u},createRng:function(){var e=this.doc;return e.createRange?e.createRange():new r(this)},nodeIndex:function(e,t){var n,i,o,r=0;if(e)for(n=e.nodeType,e=e.previousSibling,i=e;e;e=e.previousSibling)o=e.nodeType,(!t||3!=o||o!=n&&e.nodeValue.length)&&(r++,n=o);return r},split:function(e,t,n){function i(e){function t(e){var t=e.previousSibling&&"SPAN"==e.previousSibling.nodeName,n=e.nextSibling&&"SPAN"==e.nextSibling.nodeName;return t&&n}var n,o=e.childNodes,r=e.nodeType;if(1!=r||"bookmark"!=e.getAttribute("data-mce-type")){for(n=o.length-1;n>=0;n--)i(o[n]);if(9!=r){if(3==r&&e.nodeValue.length>0){var a=p(e.nodeValue).length;if(!s.isBlock(e.parentNode)||a>0||0===a&&t(e))return}else if(1==r&&(o=e.childNodes,1==o.length&&o[0]&&1==o[0].nodeType&&"bookmark"==o[0].getAttribute("data-mce-type")&&e.parentNode.insertBefore(o[0],e),o.length||/^(br|hr|input|img)$/i.test(e.nodeName)))return;s.remove(e)}return e}}var o,r,a,s=this,l=s.createRng();return e&&t?(l.setStart(e.parentNode,s.nodeIndex(e)),l.setEnd(t.parentNode,s.nodeIndex(t)),o=l.extractContents(),l=s.createRng(),l.setStart(t.parentNode,s.nodeIndex(t)+1),l.setEnd(e.parentNode,s.nodeIndex(e)+1),r=l.extractContents(),a=e.parentNode,a.insertBefore(i(o),e),n?a.replaceChild(n,t):a.insertBefore(t,e),a.insertBefore(i(r),e),s.remove(e),n||t):void 0},bind:function(e,t,n,i){return this.events.bind(e,t,n,i||this)},unbind:function(e,t,n){return this.events.unbind(e,t,n)},fire:function(e,t,n){return this.events.fire(e,t,n)},getContentEditable:function(e){var t;return 1!=e.nodeType?null:(t=e.getAttribute("data-mce-contenteditable"),t&&"inherit"!==t?t:"inherit"!==e.contentEditable?e.contentEditable:null)},destroy:function(){var e=this;e.win=e.doc=e.root=e.events=e.frag=null},dumpRng:function(e){return"startContainer: "+e.startContainer.nodeName+", startOffset: "+e.startOffset+", endContainer: "+e.endContainer.nodeName+", endOffset: "+e.endOffset},_findSib:function(e,t,n){var i=this,o=t;if(e)for("string"==typeof o&&(o=function(e){return i.is(e,t)}),e=e[n];e;e=e[n])if(o(e))return e;return null}},u.DOM=new u(document),u}),i(g,[m,d],function(e,t){function n(){function e(e,t){function n(){s.remove(a),r&&(r.onreadystatechange=r.onload=r=null),t()}function o(){"undefined"!=typeof console&&console.log&&console.log("Failed to load: "+e)}var r,a,s=i;a=s.uniqueId(),r=document.createElement("script"),r.id=a,r.type="text/javascript",r.src=e,"onreadystatechange"in r?r.onreadystatechange=function(){/loaded|complete/.test(r.readyState)&&n()}:r.onload=n,r.onerror=o,(document.getElementsByTagName("head")[0]||document.body).appendChild(r)}var t,n=0,a=1,s=2,l={},u=[],c={},d=[],h=0;this.isDone=function(e){return l[e]==s},this.markDone=function(e){l[e]=s},this.add=this.load=function(e,i,o){var r=l[e];r==t&&(u.push(e),l[e]=n),i&&(c[e]||(c[e]=[]),c[e].push({func:i,scope:o||this}))},this.loadQueue=function(e,t){this.loadScripts(u,e,t)},this.loadScripts=function(n,i,u){function p(e){o(c[e],function(e){e.func.call(e.scope)}),c[e]=t}var f;d.push({func:i,scope:u||this}),f=function(){var t=r(n);n.length=0,o(t,function(t){return l[t]==s?(p(t),void 0):(l[t]!=a&&(l[t]=a,h++,e(t,function(){l[t]=s,h--,p(t),f()})),void 0)}),h||(o(d,function(e){e.func.call(e.scope)}),d.length=0)},f()}}var i=e.DOM,o=t.each,r=t.grep;return n.ScriptLoader=new n,n}),i(v,[g,d],function(e,n){function i(){var e=this;e.items=[],e.urls={},e.lookup={}}var o=n.each;return i.prototype={get:function(e){return this.lookup[e]?this.lookup[e].instance:t},dependencies:function(e){var t;return this.lookup[e]&&(t=this.lookup[e].dependencies),t||[]},requireLangPack:function(t){var n=i.settings;n&&n.language&&n.language_load!==!1&&e.ScriptLoader.add(this.urls[t]+"/langs/"+n.language+".js")},add:function(e,t,n){return this.items.push(t),this.lookup[e]={instance:t,dependencies:n},t},createUrl:function(e,t){return"object"==typeof t?t:{prefix:e.prefix,resource:t,suffix:e.suffix}},addComponents:function(t,n){var i=this.urls[t];o(n,function(t){e.ScriptLoader.add(i+"/"+t)})},load:function(n,r,a,s){function l(){var i=u.dependencies(n);o(i,function(e){var n=u.createUrl(r,e);u.load(n.resource,n,t,t)}),a&&(s?a.call(s):a.call(e))}var u=this,c=r;u.urls[n]||("object"==typeof r&&(c=r.prefix+r.resource+r.suffix),0!==c.indexOf("/")&&-1==c.indexOf("://")&&(c=i.baseURL+"/"+c),u.urls[n]=c.substring(0,c.lastIndexOf("/")),u.lookup[n]?l():e.ScriptLoader.add(c,l,s))}},i.PluginManager=new i,i.ThemeManager=new i,i}),i(y,[],function(){function e(e,t,n){var i,o,r=n?"lastChild":"firstChild",a=n?"prev":"next";if(e[r])return e[r];if(e!==t){if(i=e[a])return i;for(o=e.parent;o&&o!==t;o=o.parent)if(i=o[a])return i}}function t(e,t){this.name=e,this.type=t,1===t&&(this.attributes=[],this.attributes.map={})}var n=/^[ \t\r\n]*$/,i={"#text":3,"#comment":8,"#cdata":4,"#pi":7,"#doctype":10,"#document-fragment":11};
return t.prototype={replace:function(e){var t=this;return e.parent&&e.remove(),t.insert(e,t),t.remove(),t},attr:function(e,t){var n,i,o,r=this;if("string"!=typeof e){for(i in e)r.attr(i,e[i]);return r}if(n=r.attributes){if(t!==o){if(null===t){if(e in n.map)for(delete n.map[e],i=n.length;i--;)if(n[i].name===e)return n=n.splice(i,1),r;return r}if(e in n.map){for(i=n.length;i--;)if(n[i].name===e){n[i].value=t;break}}else n.push({name:e,value:t});return n.map[e]=t,r}return n.map[e]}},clone:function(){var e,n,i,o,r,a=this,s=new t(a.name,a.type);if(i=a.attributes){for(r=[],r.map={},e=0,n=i.length;n>e;e++)o=i[e],"id"!==o.name&&(r[r.length]={name:o.name,value:o.value},r.map[o.name]=o.value);s.attributes=r}return s.value=a.value,s.shortEnded=a.shortEnded,s},wrap:function(e){var t=this;return t.parent.insert(e,t),e.append(t),t},unwrap:function(){var e,t,n=this;for(e=n.firstChild;e;)t=e.next,n.insert(e,n,!0),e=t;n.remove()},remove:function(){var e=this,t=e.parent,n=e.next,i=e.prev;return t&&(t.firstChild===e?(t.firstChild=n,n&&(n.prev=null)):i.next=n,t.lastChild===e?(t.lastChild=i,i&&(i.next=null)):n.prev=i,e.parent=e.next=e.prev=null),e},append:function(e){var t,n=this;return e.parent&&e.remove(),t=n.lastChild,t?(t.next=e,e.prev=t,n.lastChild=e):n.lastChild=n.firstChild=e,e.parent=n,e},insert:function(e,t,n){var i;return e.parent&&e.remove(),i=t.parent||this,n?(t===i.firstChild?i.firstChild=e:t.prev.next=e,e.prev=t.prev,e.next=t,t.prev=e):(t===i.lastChild?i.lastChild=e:t.next.prev=e,e.next=t.next,e.prev=t,t.next=e),e.parent=i,e},getAll:function(t){var n,i=this,o=[];for(n=i.firstChild;n;n=e(n,i))n.name===t&&o.push(n);return o},empty:function(){var t,n,i,o=this;if(o.firstChild){for(t=[],i=o.firstChild;i;i=e(i,o))t.push(i);for(n=t.length;n--;)i=t[n],i.parent=i.firstChild=i.lastChild=i.next=i.prev=null}return o.firstChild=o.lastChild=null,o},isEmpty:function(t){var i,o,r=this,a=r.firstChild;if(a)do{if(1===a.type){if(a.attributes.map["data-mce-bogus"])continue;if(t[a.name])return!1;for(i=a.attributes.length;i--;)if(o=a.attributes[i].name,"name"===o||0===o.indexOf("data-mce-"))return!1}if(8===a.type)return!1;if(3===a.type&&!n.test(a.value))return!1}while(a=e(a,r));return!0},walk:function(t){return e(this,null,t)}},t.create=function(e,n){var o,r;if(o=new t(e,i[e]||1),n)for(r in n)o.attr(r,n[r]);return o},t}),i(b,[d],function(e){function t(e,t){return e?e.split(t||" "):[]}function n(e){function n(e,n,i){function o(e){var t,n,i={};for(t=0,n=e.length;n>t;t++)i[e[t]]={};return i}var r,s,l,u=arguments;for(i=i||[],n=n||"","string"==typeof i&&(i=t(i)),s=3;u.length>s;s++)"string"==typeof u[s]&&(u[s]=t(u[s])),i.push.apply(i,u[s]);for(e=t(e),r=e.length;r--;)l=[].concat(a,t(n)),p[e[r]]={attributes:o(l),attributesOrder:l,children:o(i)}}function o(e,n){var i,o,r,a;for(e=t(e),i=e.length,n=t(n);i--;)for(o=p[e[i]],r=0,a=n.length;a>r;r++)o.attributes[n[r]]={},o.attributesOrder.push(n[r])}var a,s,l,u,c,d,h,p={};return i[e]?i[e]:(a=t("id accesskey class dir lang style tabindex title"),s=t("onabort onblur oncancel oncanplay oncanplaythrough onchange onclick onclose oncontextmenu oncuechange ondblclick ondrag ondragend ondragenter ondragleave ondragover ondragstart ondrop ondurationchange onemptied onended onerror onfocus oninput oninvalid onkeydown onkeypress onkeyup onload onloadeddata onloadedmetadata onloadstart onmousedown onmousemove onmouseout onmouseover onmouseup onmousewheel onpause onplay onplaying onprogress onratechange onreset onscroll onseeked onseeking onseeking onselect onshow onstalled onsubmit onsuspend ontimeupdate onvolumechange onwaiting"),l=t("address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul"),u=t("a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd label map noscript object q s samp script select small span strong sub sup textarea u var #text #comment"),"html4"!=e&&(a.push.apply(a,t("contenteditable contextmenu draggable dropzone hidden spellcheck translate")),l.push.apply(l,t("article aside details dialog figure header footer hgroup section nav")),u.push.apply(u,t("audio canvas command datalist mark meter output progress time wbr video ruby bdi keygen"))),"html5-strict"!=e&&(a.push("xml:lang"),h=t("acronym applet basefont big font strike tt"),u.push.apply(u,h),r(h,function(e){n(e,"",u)}),d=t("center dir isindex noframes"),l.push.apply(l,d),c=[].concat(l,u),r(d,function(e){n(e,"",c)})),c=c||[].concat(l,u),n("html","manifest","head body"),n("head","","base command link meta noscript script style title"),n("title hr noscript br"),n("base","href target"),n("link","href rel media hreflang type sizes hreflang"),n("meta","name http-equiv content charset"),n("style","media type scoped"),n("script","src async defer type charset"),n("body","onafterprint onbeforeprint onbeforeunload onblur onerror onfocus onhashchange onload onmessage onoffline ononline onpagehide onpageshow onpopstate onresize onscroll onstorage onunload",c),n("address dt dd div caption","",c),n("h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn","",u),n("blockquote","cite",c),n("ol","reversed start type","li"),n("ul","","li"),n("li","value",c),n("dl","","dt dd"),n("a","href target rel media hreflang type",u),n("q","cite",u),n("ins del","cite datetime",c),n("img","src alt usemap ismap width height"),n("iframe","src name width height",c),n("embed","src type width height"),n("object","data type typemustmatch name usemap form width height",c,"param"),n("param","name value"),n("map","name",c,"area"),n("area","alt coords shape href target rel media hreflang type"),n("table","border","caption colgroup thead tfoot tbody tr"+("html4"==e?" col":"")),n("colgroup","span","col"),n("col","span"),n("tbody thead tfoot","","tr"),n("tr","","td th"),n("td","colspan rowspan headers",c),n("th","colspan rowspan headers scope abbr",c),n("form","accept-charset action autocomplete enctype method name novalidate target",c),n("fieldset","disabled form name",c,"legend"),n("label","form for",u),n("input","accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate formtarget height list max maxlength min multiple name pattern readonly required size src step type value width"),n("button","disabled form formaction formenctype formmethod formnovalidate formtarget name type value","html4"==e?c:u),n("select","disabled form multiple name required size","option optgroup"),n("optgroup","disabled label","option"),n("option","disabled label selected value"),n("textarea","cols dirname disabled form maxlength name readonly required rows wrap"),n("menu","type label",c,"li"),n("noscript","",c),"html4"!=e&&(n("wbr"),n("ruby","",u,"rt rp"),n("figcaption","",c),n("mark rt rp summary bdi","",u),n("canvas","width height",c),n("video","src crossorigin poster preload autoplay mediagroup loop muted controls width height",c,"track source"),n("audio","src crossorigin preload autoplay mediagroup loop muted controls",c,"track source"),n("source","src type media"),n("track","kind src srclang label default"),n("datalist","",u,"option"),n("article section nav aside header footer","",c),n("hgroup","","h1 h2 h3 h4 h5 h6"),n("figure","",c,"figcaption"),n("time","datetime",u),n("dialog","open",c),n("command","type label icon disabled checked radiogroup command"),n("output","for form name",u),n("progress","value max",u),n("meter","value min max low high optimum",u),n("details","open",c,"summary"),n("keygen","autofocus challenge disabled form keytype name")),"html5-strict"!=e&&(o("script","language xml:space"),o("style","xml:space"),o("object","declare classid codebase codetype archive standby align border hspace vspace"),o("param","valuetype type"),o("a","charset name rev shape coords"),o("br","clear"),o("applet","codebase archive code object alt name width height align hspace vspace"),o("img","name longdesc align border hspace vspace"),o("iframe","longdesc frameborder marginwidth marginheight scrolling align"),o("font basefont","size color face"),o("input","usemap align"),o("select","onchange"),o("textarea"),o("h1 h2 h3 h4 h5 h6 div p legend caption","align"),o("ul","type compact"),o("li","type"),o("ol dl menu dir","compact"),o("pre","width xml:space"),o("hr","align noshade size width"),o("isindex","prompt"),o("table","summary width frame rules cellspacing cellpadding align bgcolor"),o("col","width align char charoff valign"),o("colgroup","width align char charoff valign"),o("thead","align char charoff valign"),o("tr","align char charoff valign bgcolor"),o("th","axis align char charoff valign nowrap bgcolor width height"),o("form","accept"),o("td","abbr axis scope align char charoff valign nowrap bgcolor width height"),o("tfoot","align char charoff valign"),o("tbody","align char charoff valign"),o("area","nohref"),o("body","background bgcolor text link vlink alink")),"html4"!=e&&(o("input button select textarea","autofocus"),o("input textarea","placeholder"),o("a","download"),o("link script img","crossorigin"),o("iframe","srcdoc sandbox seamless allowfullscreen")),r(t("a form meter progress dfn"),function(e){p[e]&&delete p[e].children[e]}),delete p.caption.children.table,i[e]=p,p)}var i={},o=e.makeMap,r=e.each,a=e.extend,s=e.explode,l=e.inArray;return function(e){function u(t,n,r){var s=e[t];return s?s=o(s,",",o(s.toUpperCase()," ")):(s=i[t],s||(s=o(n," ",o(n.toUpperCase()," ")),s=a(s,r),i[t]=s)),s}function c(e){return RegExp("^"+e.replace(/([?+*])/g,".$1")+"$")}function d(e){var n,i,r,a,s,u,d,h,p,f,m,g,v,y,b,w,x,_,C,S=/^([#+\-])?([^\[!\/]+)(?:\/([^\[!]+))?(?:(!?)\[([^\]]+)\])?$/,T=/^([!\-])?(\w+::\w+|[^=:<]+)?(?:([=:<])(.*))?$/,k=/[*?+]/;if(e)for(e=t(e,","),E["@"]&&(w=E["@"].attributes,x=E["@"].attributesOrder),n=0,i=e.length;i>n;n++)if(s=S.exec(e[n])){if(y=s[1],p=s[2],b=s[3],h=s[5],g={},v=[],u={attributes:g,attributesOrder:v},"#"===y&&(u.paddEmpty=!0),"-"===y&&(u.removeEmpty=!0),"!"===s[4]&&(u.removeEmptyAttrs=!0),w){for(_ in w)g[_]=w[_];v.push.apply(v,x)}if(h)for(h=t(h,"|"),r=0,a=h.length;a>r;r++)if(s=T.exec(h[r])){if(d={},m=s[1],f=s[2].replace(/::/g,":"),y=s[3],C=s[4],"!"===m&&(u.attributesRequired=u.attributesRequired||[],u.attributesRequired.push(f),d.required=!0),"-"===m){delete g[f],v.splice(l(v,f),1);continue}y&&("="===y&&(u.attributesDefault=u.attributesDefault||[],u.attributesDefault.push({name:f,value:C}),d.defaultValue=C),":"===y&&(u.attributesForced=u.attributesForced||[],u.attributesForced.push({name:f,value:C}),d.forcedValue=C),"<"===y&&(d.validValues=o(C,"?"))),k.test(f)?(u.attributePatterns=u.attributePatterns||[],d.pattern=c(f),u.attributePatterns.push(d)):(g[f]||v.push(f),g[f]=d)}w||"@"!=p||(w=g,x=v),b&&(u.outputName=p,E[b]=u),k.test(p)?(u.pattern=c(p),N.push(u)):E[p]=u}}function h(e){E={},N=[],d(e),r(v,function(e,t){k[t]=e.children})}function p(e){var n=/^(~)?(.+)$/;e&&r(t(e,","),function(e){var t=n.exec(e),i="~"===t[1],o=i?"span":"div",s=t[2];if(k[s]=k[o],A[s]=o,i||(_[s.toUpperCase()]={},_[s]={}),!E[s]){var l=E[o];l=a({},l),delete l.removeEmptyAttrs,delete l.removeEmpty,E[s]=l}r(k,function(e){e[o]&&(e[s]=e[o])})})}function f(e){var n=/^([+\-]?)(\w+)\[([^\]]+)\]$/;e&&r(t(e,","),function(e){var i,o,a=n.exec(e);a&&(o=a[1],i=o?k[a[2]]:k[a[2]]={"#comment":{}},i=k[a[2]],r(t(a[3],"|"),function(e){"-"===o?delete i[e]:i[e]={}}))})}function m(e){var t,n=E[e];if(n)return n;for(t=N.length;t--;)if(n=N[t],n.pattern.test(e))return n}var g,v,y,b,w,x,_,C,S,T=this,E={},k={},N=[],A={},M={};e=e||{},v=n(e.schema),e.verify_html===!1&&(e.valid_elements="*[*]"),e.valid_styles&&(g={},r(e.valid_styles,function(e,t){g[t]=s(e)})),y=u("whitespace_elements","pre script noscript style textarea video audio iframe object"),b=u("self_closing_elements","colgroup dd dt li option p td tfoot th thead tr"),w=u("short_ended_elements","area base basefont br col frame hr img input isindex link meta param embed source wbr track"),x=u("boolean_attributes","checked compact declare defer disabled ismap multiple nohref noresize noshade nowrap readonly selected autoplay loop controls"),C=u("non_empty_elements","td th iframe video audio object",w),S=u("text_block_elements","h1 h2 h3 h4 h5 h6 p div address pre form blockquote center dir fieldset header footer article section hgroup aside nav figure"),_=u("block_elements","hr table tbody thead tfoot th tr td li ol ul caption dl dt dd noscript menu isindex samp option datalist select optgroup",S),r((e.special||"script noscript style textarea").split(" "),function(e){M[e]=RegExp("</"+e+"[^>]*>","gi")}),e.valid_elements?h(e.valid_elements):(r(v,function(e,t){E[t]={attributes:e.attributes,attributesOrder:e.attributesOrder},k[t]=e.children}),"html5"!=e.schema&&r(t("strong/b em/i"),function(e){e=t(e,"/"),E[e[1]].outputName=e[0]}),E.img.attributesDefault=[{name:"alt",value:""}],r(t("ol ul sub sup blockquote span font a table tbody tr strong em b i"),function(e){E[e]&&(E[e].removeEmpty=!0)}),r(t("p h1 h2 h3 h4 h5 h6 th td pre div address caption"),function(e){E[e].paddEmpty=!0}),r(t("span"),function(e){E[e].removeEmptyAttrs=!0})),p(e.custom_elements),f(e.valid_children),d(e.extended_valid_elements),f("+ol[ul|ol],+ul[ul|ol]"),e.invalid_elements&&r(s(e.invalid_elements),function(e){E[e]&&delete E[e]}),m("span")||d("span[!data-mce-type|*]"),T.children=k,T.styles=g,T.getBoolAttrs=function(){return x},T.getBlockElements=function(){return _},T.getTextBlockElements=function(){return S},T.getShortEndedElements=function(){return w},T.getSelfClosingElements=function(){return b},T.getNonEmptyElements=function(){return C},T.getWhiteSpaceElements=function(){return y},T.getSpecialElements=function(){return M},T.isValidChild=function(e,t){var n=k[e];return!(!n||!n[t])},T.isValid=function(e,t){var n,i,o=m(e);if(o){if(!t)return!0;if(o.attributes[t])return!0;if(n=o.attributePatterns)for(i=n.length;i--;)if(n[i].pattern.test(e))return!0}return!1},T.getElementRule=m,T.getCustomElements=function(){return A},T.addValidElements=d,T.setValidElements=h,T.addCustomElements=p,T.addValidChildren=f,T.elements=E}}),i(w,[b,p,d],function(e,t,n){var i=n.each;return function(n,o){var r=this,a=function(){};n=n||{},r.schema=o=o||new e,n.fix_self_closing!==!1&&(n.fix_self_closing=!0),i("comment cdata text start end pi doctype".split(" "),function(e){e&&(r[e]=n[e]||a)}),r.parse=function(e){function i(e){var t,n;for(t=L.length;t--&&L[t].name!==e;);if(t>=0){for(n=L.length-1;n>=t;n--)e=L[n],e.valid&&D.end(e.name);L.length=t}}function r(e,t,n,i,o){var r,a;if(t=t.toLowerCase(),n=t in g?t:B(n||i||o||""),y&&!p&&0!==t.indexOf("data-")){if(r=C[t],!r&&S){for(a=S.length;a--&&(r=S[a],!r.pattern.test(t)););-1===a&&(r=null)}if(!r)return;if(r.validValues&&!(n in r.validValues))return}u.map[t]=n,u.push({name:t,value:n})}var a,s,l,u,c,d,h,p,f,m,g,v,y,b,w,x,_,C,S,T,E,k,N,A,M,P,R,O,I,D=this,H=0,L=[],z=0,B=t.decode;for(M=RegExp("<(?:(?:!--([\\w\\W]*?)-->)|(?:!\\[CDATA\\[([\\w\\W]*?)\\]\\]>)|(?:!DOCTYPE([\\w\\W]*?)>)|(?:\\?([^\\s\\/<>]+) ?([\\w\\W]*?)[?/]>)|(?:\\/([^>]+)>)|(?:([A-Za-z0-9\\-\\:\\.]+)((?:\\s+[^\"'>]+(?:(?:\"[^\"]*\")|(?:'[^']*')|[^>]*))*|\\/|\\s+)>))","g"),P=/([\w:\-]+)(?:\s*=\s*(?:(?:\"((?:[^\"])*)\")|(?:\'((?:[^\'])*)\')|([^>\s]+)))?/g,m=o.getShortEndedElements(),A=n.self_closing_elements||o.getSelfClosingElements(),g=o.getBoolAttrs(),y=n.validate,f=n.remove_internals,I=n.fix_self_closing,R=o.getSpecialElements();a=M.exec(e);){if(a.index>H&&D.text(B(e.substr(H,a.index-H))),s=a[6])s=s.toLowerCase(),":"===s.charAt(0)&&(s=s.substr(1)),i(s);else if(s=a[7]){if(s=s.toLowerCase(),":"===s.charAt(0)&&(s=s.substr(1)),v=s in m,I&&A[s]&&L.length>0&&L[L.length-1].name===s&&i(s),!y||(b=o.getElementRule(s))){if(w=!0,y&&(C=b.attributes,S=b.attributePatterns),(_=a[8])?(p=-1!==_.indexOf("data-mce-type"),p&&f&&(w=!1),u=[],u.map={},_.replace(P,r)):(u=[],u.map={}),y&&!p){if(T=b.attributesRequired,E=b.attributesDefault,k=b.attributesForced,N=b.removeEmptyAttrs,N&&!u.length&&(w=!1),k)for(c=k.length;c--;)x=k[c],h=x.name,O=x.value,"{$uid}"===O&&(O="mce_"+z++),u.map[h]=O,u.push({name:h,value:O});if(E)for(c=E.length;c--;)x=E[c],h=x.name,h in u.map||(O=x.value,"{$uid}"===O&&(O="mce_"+z++),u.map[h]=O,u.push({name:h,value:O}));if(T){for(c=T.length;c--&&!(T[c]in u.map););-1===c&&(w=!1)}u.map["data-mce-bogus"]&&(w=!1)}w&&D.start(s,u,v)}else w=!1;if(l=R[s]){l.lastIndex=H=a.index+a[0].length,(a=l.exec(e))?(w&&(d=e.substr(H,a.index-H)),H=a.index+a[0].length):(d=e.substr(H),H=e.length),w&&(d.length>0&&D.text(d,!0),D.end(s)),M.lastIndex=H;continue}v||(_&&_.indexOf("/")==_.length-1?w&&D.end(s):L.push({name:s,valid:w}))}else(s=a[1])?D.comment(s):(s=a[2])?D.cdata(s):(s=a[3])?D.doctype(s):(s=a[4])&&D.pi(s,a[5]);H=a.index+a[0].length}for(e.length>H&&D.text(B(e.substr(H))),c=L.length-1;c>=0;c--)s=L[c],s.valid&&D.end(s.name)}}}),i(x,[y,b,w,d],function(e,t,n,i){var o=i.makeMap,r=i.each,a=i.explode,s=i.extend;return function(i,l){function u(t){var n,i,r,a,s,u,d,h,p,f,m,g,v,y;for(m=o("tr,td,th,tbody,thead,tfoot,table"),f=l.getNonEmptyElements(),g=l.getTextBlockElements(),n=0;t.length>n;n++)if(i=t[n],i.parent&&!i.fixed)if(g[i.name]&&"li"==i.parent.name){for(v=i.next;v&&g[v.name];)v.name="li",v.fixed=!0,i.parent.insert(v,i.parent),v=v.next;i.unwrap(i)}else{for(a=[i],r=i.parent;r&&!l.isValidChild(r.name,i.name)&&!m[r.name];r=r.parent)a.push(r);if(r&&a.length>1){for(a.reverse(),s=u=c.filterNode(a[0].clone()),p=0;a.length-1>p;p++){for(l.isValidChild(u.name,a[p].name)?(d=c.filterNode(a[p].clone()),u.append(d)):d=u,h=a[p].firstChild;h&&h!=a[p+1];)y=h.next,d.append(h),h=y;u=d}s.isEmpty(f)?r.insert(i,a[0],!0):(r.insert(s,a[0],!0),r.insert(i,s)),r=a[0],(r.isEmpty(f)||r.firstChild===r.lastChild&&"br"===r.firstChild.name)&&r.empty().remove()}else if(i.parent){if("li"===i.name){if(v=i.prev,v&&("ul"===v.name||"ul"===v.name)){v.append(i);continue}if(v=i.next,v&&("ul"===v.name||"ul"===v.name)){v.insert(i,v.firstChild,!0);continue}i.wrap(c.filterNode(new e("ul",1)));continue}l.isValidChild(i.parent.name,"div")&&l.isValidChild("div",i.name)?i.wrap(c.filterNode(new e("div",1))):"style"===i.name||"script"===i.name?i.empty().remove():i.unwrap()}}}var c=this,d={},h=[],p={},f={};i=i||{},i.validate="validate"in i?i.validate:!0,i.root_name=i.root_name||"body",c.schema=l=l||new t,c.filterNode=function(e){var t,n,i;n in d&&(i=p[n],i?i.push(e):p[n]=[e]),t=h.length;for(;t--;)n=h[t].name,n in e.attributes.map&&(i=f[n],i?i.push(e):f[n]=[e]);return e},c.addNodeFilter=function(e,t){r(a(e),function(e){var n=d[e];n||(d[e]=n=[]),n.push(t)})},c.addAttributeFilter=function(e,t){r(a(e),function(e){var n;for(n=0;h.length>n;n++)if(h[n].name===e)return h[n].callbacks.push(t),void 0;h.push({name:e,callbacks:[t]})})},c.parse=function(t,r){function a(){function e(e){e&&(i=e.firstChild,i&&3==i.type&&(i.value=i.value.replace(A,"")),i=e.lastChild,i&&3==i.type&&(i.value=i.value.replace(P,"")))}var t,n,i=y.firstChild;if(l.isValidChild(y.name,L.toLowerCase())){for(;i;)t=i.next,3==i.type||1==i.type&&"p"!==i.name&&!N[i.name]&&!i.attr("data-mce-type")?n?n.append(i):(n=c(L,1),y.insert(n,i),n.append(i)):(e(n),n=null),i=t;e(n)}}function c(t,n){var i,o=new e(t,n);return t in d&&(i=p[t],i?i.push(o):p[t]=[o]),o}function m(e){var t,n,i;for(t=e.prev;t&&3===t.type;)n=t.value.replace(P,""),n.length>0?(t.value=n,t=t.prev):(i=t.prev,t.remove(),t=i)}function g(e){var t,n={};for(t in e)"li"!==t&&"p"!=t&&(n[t]=e[t]);return n}var v,y,b,w,x,_,C,S,T,E,k,N,A,M,P,R,O,I,D,H,L,z=[];if(r=r||{},p={},f={},N=s(o("script,style,head,html,body,title,meta,param"),l.getBlockElements()),H=l.getNonEmptyElements(),D=l.children,k=i.validate,L="forced_root_block"in r?r.forced_root_block:i.forced_root_block,I=l.getWhiteSpaceElements(),A=/^[ \t\r\n]+/,P=/[ \t\r\n]+$/,R=/[ \t\r\n]+/g,O=/^[ \t\r\n]+$/,v=new n({validate:k,self_closing_elements:g(l.getSelfClosingElements()),cdata:function(e){b.append(c("#cdata",4)).value=e},text:function(e,t){var n;M||(e=e.replace(R," "),b.lastChild&&N[b.lastChild.name]&&(e=e.replace(A,""))),0!==e.length&&(n=c("#text",3),n.raw=!!t,b.append(n).value=e)},comment:function(e){b.append(c("#comment",8)).value=e},pi:function(e,t){b.append(c(e,7)).value=t,m(b)},doctype:function(e){var t;t=b.append(c("#doctype",10)),t.value=e,m(b)},start:function(e,t,n){var i,o,r,a,s;if(r=k?l.getElementRule(e):{}){for(i=c(r.outputName||e,1),i.attributes=t,i.shortEnded=n,b.append(i),s=D[b.name],s&&D[i.name]&&!s[i.name]&&z.push(i),o=h.length;o--;)a=h[o].name,a in t.map&&(T=f[a],T?T.push(i):f[a]=[i]);N[e]&&m(i),n||(b=i),!M&&I[e]&&(M=!0)}},end:function(t){var n,i,o,r,a;if(i=k?l.getElementRule(t):{}){if(N[t]&&!M){if(n=b.firstChild,n&&3===n.type)if(o=n.value.replace(A,""),o.length>0)n.value=o,n=n.next;else for(r=n.next,n.remove(),n=r;n&&3===n.type;)o=n.value,r=n.next,(0===o.length||O.test(o))&&(n.remove(),n=r),n=r;if(n=b.lastChild,n&&3===n.type)if(o=n.value.replace(P,""),o.length>0)n.value=o,n=n.prev;else for(r=n.prev,n.remove(),n=r;n&&3===n.type;)o=n.value,r=n.prev,(0===o.length||O.test(o))&&(n.remove(),n=r),n=r}if(M&&I[t]&&(M=!1),(i.removeEmpty||i.paddEmpty)&&b.isEmpty(H))if(i.paddEmpty)b.empty().append(new e("#text","3")).value=" ";else if(!b.attributes.map.name&&!b.attributes.map.id)return a=b.parent,b.empty().remove(),b=a,void 0;b=b.parent}}},l),y=b=new e(r.context||i.root_name,11),v.parse(t),k&&z.length&&(r.context?r.invalid=!0:u(z)),L&&("body"==y.name||r.isRootContent)&&a(),!r.invalid){for(E in p){for(T=d[E],w=p[E],C=w.length;C--;)w[C].parent||w.splice(C,1);for(x=0,_=T.length;_>x;x++)T[x](w,E,r)}for(x=0,_=h.length;_>x;x++)if(T=h[x],T.name in f){for(w=f[T.name],C=w.length;C--;)w[C].parent||w.splice(C,1);for(C=0,S=T.callbacks.length;S>C;C++)T.callbacks[C](w,T.name,r)}}return y},i.remove_trailing_brs&&c.addNodeFilter("br",function(t){var n,i,o,r,a,u,c,d,h=t.length,p=s({},l.getBlockElements()),f=l.getNonEmptyElements();for(p.body=1,n=0;h>n;n++)if(i=t[n],o=i.parent,p[i.parent.name]&&i===o.lastChild){for(a=i.prev;a;){if(u=a.name,"span"!==u||"bookmark"!==a.attr("data-mce-type")){if("br"!==u)break;if("br"===u){i=null;break}}a=a.prev}i&&(i.remove(),o.isEmpty(f)&&(c=l.getElementRule(o.name),c&&(c.removeEmpty?o.remove():c.paddEmpty&&(o.empty().append(new e("#text",3)).value=" "))))}else{for(r=i;o&&o.firstChild===r&&o.lastChild===r&&(r=o,!p[o.name]);)o=o.parent;r===o&&(d=new e("#text",3),d.value=" ",i.replace(d))}}),i.allow_html_in_named_anchor||c.addAttributeFilter("id,name",function(e){for(var t,n,i,o,r=e.length;r--;)if(o=e[r],"a"===o.name&&o.firstChild&&!o.attr("href")){i=o.parent,t=o.lastChild;do n=t.prev,i.insert(t,o),t=n;while(t)}})}}),i(_,[p,d],function(e,t){var n=t.makeMap;return function(t){var i,o,r,a,s,l=[];return t=t||{},i=t.indent,o=n(t.indent_before||""),r=n(t.indent_after||""),a=e.getEncodeFunc(t.entity_encoding||"raw",t.entities),s="html"==t.element_format,{start:function(e,t,n){var u,c,d,h;if(i&&o[e]&&l.length>0&&(h=l[l.length-1],h.length>0&&"\n"!==h&&l.push("\n")),l.push("<",e),t)for(u=0,c=t.length;c>u;u++)d=t[u],l.push(" ",d.name,'="',a(d.value,!0),'"');l[l.length]=!n||s?">":" />",n&&i&&r[e]&&l.length>0&&(h=l[l.length-1],h.length>0&&"\n"!==h&&l.push("\n"))},end:function(e){var t;l.push("</",e,">"),i&&r[e]&&l.length>0&&(t=l[l.length-1],t.length>0&&"\n"!==t&&l.push("\n"))},text:function(e,t){e.length>0&&(l[l.length]=t?e:a(e))},cdata:function(e){l.push("<![CDATA[",e,"]]>")},comment:function(e){l.push("<!--",e,"-->")},pi:function(e,t){t?l.push("<?",e," ",t,"?>"):l.push("<?",e,"?>"),i&&l.push("\n")},doctype:function(e){l.push("<!DOCTYPE",e,">",i?"\n":"")},reset:function(){l.length=0},getContent:function(){return l.join("").replace(/\n$/,"")}}}}),i(C,[_,b],function(e,t){return function(n,i){var o=this,r=new e(n);n=n||{},n.validate="validate"in n?n.validate:!0,o.schema=i=i||new t,o.writer=r,o.serialize=function(e){function t(e){var n,s,l,u,c,d,h,p,f,m=o[e.type];if(m)m(e);else{if(n=e.name,s=e.shortEnded,l=e.attributes,a&&l&&l.length>1){for(d=[],d.map={},f=i.getElementRule(e.name),h=0,p=f.attributesOrder.length;p>h;h++)u=f.attributesOrder[h],u in l.map&&(c=l.map[u],d.map[u]=c,d.push({name:u,value:c}));for(h=0,p=l.length;p>h;h++)u=l[h].name,u in d.map||(c=l.map[u],d.map[u]=c,d.push({name:u,value:c}));l=d}if(r.start(e.name,l,s),!s){if(e=e.firstChild)do t(e);while(e=e.next);r.end(n)}}}var o,a;return a=n.validate,o={3:function(e){r.text(e.value,e.raw)},8:function(e){r.comment(e.value)},7:function(e){r.pi(e.name,e.value)},10:function(e){r.doctype(e.value)},4:function(e){r.cdata(e.value)},11:function(e){if(e=e.firstChild)do t(e);while(e=e.next)}},r.reset(),1!=e.type||n.inner?o[11](e):t(e),r.getContent()}}}),i(S,[m,x,p,C,y,b,f,d],function(e,t,n,i,o,r,a,s){var l=s.each,u=s.trim,c=e.DOM;return function(e,o){var s,d,h;return o&&(s=o.dom,d=o.schema),s=s||c,d=d||new r(e),e.entity_encoding=e.entity_encoding||"named",e.remove_trailing_brs="remove_trailing_brs"in e?e.remove_trailing_brs:!0,h=new t(e,d),h.addAttributeFilter("src,href,style",function(t,n){for(var i,o,r,a=t.length,l="data-mce-"+n,u=e.url_converter,c=e.url_converter_scope;a--;)i=t[a],o=i.attributes.map[l],o!==r?(i.attr(n,o.length>0?o:null),i.attr(l,null)):(o=i.attributes.map[n],"style"===n?o=s.serializeStyle(s.parseStyle(o),i.name):u&&(o=u.call(c,o,n,i.name)),i.attr(n,o.length>0?o:null))}),h.addAttributeFilter("class",function(e){for(var t,n,i=e.length;i--;)t=e[i],n=t.attr("class").replace(/(?:^|\s)mce-item-\w+(?!\S)/g,""),t.attr("class",n.length>0?n:null)}),h.addAttributeFilter("data-mce-type",function(e,t,n){for(var i,o=e.length;o--;)i=e[o],"bookmark"!==i.attributes.map["data-mce-type"]||n.cleanup||i.remove()}),h.addAttributeFilter("data-mce-expando",function(e,t){for(var n=e.length;n--;)e[n].attr(t,null)}),h.addNodeFilter("noscript",function(e){for(var t,i=e.length;i--;)t=e[i].firstChild,t&&(t.value=n.decode(t.value))}),h.addNodeFilter("script,style",function(e,t){function n(e){return e.replace(/(<!--\[CDATA\[|\]\]-->)/g,"\n").replace(/^[\r\n]*|[\r\n]*$/g,"").replace(/^\s*((<!--)?(\s*\/\/)?\s*<!\[CDATA\[|(<!--\s*)?\/\*\s*<!\[CDATA\[\s*\*\/|(\/\/)?\s*<!--|\/\*\s*<!--\s*\*\/)\s*[\r\n]*/gi,"").replace(/\s*(\/\*\s*\]\]>\s*\*\/(-->)?|\s*\/\/\s*\]\]>(-->)?|\/\/\s*(-->)?|\]\]>|\/\*\s*-->\s*\*\/|\s*-->\s*)\s*$/g,"")}for(var i,o,r=e.length;r--;)if(i=e[r],o=i.firstChild?i.firstChild.value:"","script"===t){var a=(i.attr("type")||"text/javascript").replace(/^mce\-/,"");i.attr("type","text/javascript"===a?null:a),o.length>0&&(i.firstChild.value="// <![CDATA[\n"+n(o)+"\n// ]]>")}else o.length>0&&(i.firstChild.value="<!--\n"+n(o)+"\n-->")}),h.addNodeFilter("#comment",function(e){for(var t,n=e.length;n--;)t=e[n],0===t.value.indexOf("[CDATA[")?(t.name="#cdata",t.type=4,t.value=t.value.replace(/^\[CDATA\[|\]\]$/g,"")):0===t.value.indexOf("mce:protected ")&&(t.name="#text",t.type=3,t.raw=!0,t.value=unescape(t.value).substr(14))}),h.addNodeFilter("xml:namespace,input",function(e,t){for(var n,i=e.length;i--;)n=e[i],7===n.type?n.remove():1===n.type&&("input"!==t||"type"in n.attributes.map||n.attr("type","text"))}),e.fix_list_elements&&h.addNodeFilter("ul,ol",function(e){for(var t,n,i=e.length;i--;)t=e[i],n=t.parent,("ul"===n.name||"ol"===n.name)&&t.prev&&"li"===t.prev.name&&t.prev.append(t)}),h.addAttributeFilter("data-mce-src,data-mce-href,data-mce-style,data-mce-selected",function(e,t){for(var n=e.length;n--;)e[n].attr(t,null)}),{schema:d,addNodeFilter:h.addNodeFilter,addAttributeFilter:h.addAttributeFilter,serialize:function(t,n){var o,r,c,p,f,m=this;return a.ie&&s.select("script,style,select,map").length>0?(f=t.innerHTML,t=t.cloneNode(!1),s.setHTML(t,f)):t=t.cloneNode(!0),o=t.ownerDocument.implementation,o.createHTMLDocument&&(r=o.createHTMLDocument(""),l("BODY"==t.nodeName?t.childNodes:[t],function(e){r.body.appendChild(r.importNode(e,!0))}),t="BODY"!=t.nodeName?r.body.firstChild:r.body,c=s.doc,s.doc=r),n=n||{},n.format=n.format||"html",n.selection&&(n.forced_root_block=""),n.no_events||(n.node=t,m.onPreProcess(n)),p=new i(e,d),n.content=p.serialize(h.parse(u(n.getInner?t.innerHTML:s.getOuterHTML(t)),n)),n.cleanup||(n.content=n.content.replace(/\uFEFF/g,"")),n.no_events||m.onPostProcess(n),c&&(s.doc=c),n.node=null,n.content},addRules:function(e){d.addValidElements(e)},setRules:function(e){d.setValidElements(e)},onPreProcess:function(e){o&&o.fire("PreProcess",e)},onPostProcess:function(e){o&&o.fire("PostProcess",e)}}}}),i(T,[],function(){function e(e){function t(t,n){var i,o,r,a,s,l,u,c,d=0,h=-1;if(i=t.duplicate(),i.collapse(n),c=i.parentElement(),c.ownerDocument===e.dom.doc){for(;"false"===c.contentEditable;)c=c.parentNode;if(!c.hasChildNodes())return{node:c,inside:1};for(a=c.children,o=a.length-1;o>=d;)if(u=Math.floor((d+o)/2),s=a[u],i.moveToElementText(s),h=i.compareEndPoints(n?"StartToStart":"EndToEnd",t),h>0)o=u-1;else{if(!(0>h))return{node:s};d=u+1}if(0>h)for(s?i.collapse(!1):(i.moveToElementText(c),i.collapse(!0),s=c,r=!0),l=0;0!==i.compareEndPoints(n?"StartToStart":"StartToEnd",t)&&0!==i.move("character",1)&&c==i.parentElement();)l++;else for(i.collapse(!0),l=0;0!==i.compareEndPoints(n?"StartToStart":"StartToEnd",t)&&0!==i.move("character",-1)&&c==i.parentElement();)l++;return{node:s,position:h,offset:l,inside:r}}}function n(){function n(e){var n,i,o,r,a,s=t(c,e),l=0;if(n=s.node,i=s.offset,s.inside&&!n.hasChildNodes())return d[e?"setStart":"setEnd"](n,0),void 0;if(i===r)return d[e?"setStartBefore":"setEndAfter"](n),void 0;if(0>s.position){if(o=s.inside?n.firstChild:n.nextSibling,!o)return d[e?"setStartAfter":"setEndAfter"](n),void 0;if(!i)return 3==o.nodeType?d[e?"setStart":"setEnd"](o,0):d[e?"setStartBefore":"setEndBefore"](o),void 0;for(;o;){if(a=o.nodeValue,l+=a.length,l>=i){n=o,l-=i,l=a.length-l;break}o=o.nextSibling}}else{if(o=n.previousSibling,!o)return d[e?"setStartBefore":"setEndBefore"](n);if(!i)return 3==n.nodeType?d[e?"setStart":"setEnd"](o,n.nodeValue.length):d[e?"setStartAfter":"setEndAfter"](o),void 0;for(;o;){if(l+=o.nodeValue.length,l>=i){n=o,l-=i;break}o=o.previousSibling}}d[e?"setStart":"setEnd"](n,l)}var r,a,s,l,u,c=e.getRng(),d=o.createRng();if(r=c.item?c.item(0):c.parentElement(),r.ownerDocument!=o.doc)return d;if(a=e.isCollapsed(),c.item)return d.setStart(r.parentNode,o.nodeIndex(r)),d.setEnd(d.startContainer,d.startOffset+1),d;try{n(!0),a||n()}catch(h){if(-2147024809!=h.number)throw h;u=i.getBookmark(2),s=c.duplicate(),s.collapse(!0),r=s.parentElement(),a||(s=c.duplicate(),s.collapse(!1),l=s.parentElement(),l.innerHTML=l.innerHTML),r.innerHTML=r.innerHTML,i.moveToBookmark(u),c=e.getRng(),n(!0),a||n()}return d}var i=this,o=e.dom,r=!1;this.getBookmark=function(n){function i(e){var t,n,i,r,a=[];for(t=e.parentNode,n=o.getRoot().parentNode;t!=n&&9!==t.nodeType;){for(i=t.children,r=i.length;r--;)if(e===i[r]){a.push(r);break}e=t,t=t.parentNode}return a}function r(e){var n;return n=t(a,e),n?{position:n.position,offset:n.offset,indexes:i(n.node),inside:n.inside}:void 0}var a=e.getRng(),s={};return 2===n&&(a.item?s.start={ctrl:!0,indexes:i(a.item(0))}:(s.start=r(!0),e.isCollapsed()||(s.end=r()))),s},this.moveToBookmark=function(e){function t(e){var t,n,i,r;for(t=o.getRoot(),n=e.length-1;n>=0;n--)r=t.children,i=e[n],r.length-1>=i&&(t=r[i]);return t}function n(n){var o,a,s,l,u=e[n?"start":"end"];u&&(o=u.position>0,a=r.createTextRange(),a.moveToElementText(t(u.indexes)),l=u.offset,l!==s?(a.collapse(u.inside||o),a.moveStart("character",o?-l:l)):a.collapse(n),i.setEndPoint(n?"StartToStart":"EndToStart",a),n&&i.collapse(!0))}var i,r=o.doc.body;e.start&&(e.start.ctrl?(i=r.createControlRange(),i.addElement(t(e.start.indexes)),i.select()):(i=r.createTextRange(),n(!0),n(),i.select()))},this.addRange=function(t){function n(e){var t,n,a,d,h;a=o.create("a"),t=e?s:u,n=e?l:c,d=i.duplicate(),(t==f||t==f.documentElement)&&(t=m,n=0),3==t.nodeType?(t.parentNode.insertBefore(a,t),d.moveToElementText(a),d.moveStart("character",n),o.remove(a),i.setEndPoint(e?"StartToStart":"EndToEnd",d)):(h=t.childNodes,h.length?(n>=h.length?o.insertAfter(a,h[h.length-1]):t.insertBefore(a,h[n]),d.moveToElementText(a)):t.canHaveHTML&&(t.innerHTML="<span>&#xFEFF;</span>",a=t.firstChild,d.moveToElementText(a),d.collapse(r)),i.setEndPoint(e?"StartToStart":"EndToEnd",d),o.remove(a))}var i,a,s,l,u,c,d,h,p,f=e.dom.doc,m=f.body;
if(s=t.startContainer,l=t.startOffset,u=t.endContainer,c=t.endOffset,i=m.createTextRange(),s==u&&1==s.nodeType){if(l==c&&!s.hasChildNodes()){if(s.canHaveHTML)return d=s.previousSibling,d&&!d.hasChildNodes()&&o.isBlock(d)?d.innerHTML="&#xFEFF;":d=null,s.innerHTML="<span>&#xFEFF;</span><span>&#xFEFF;</span>",i.moveToElementText(s.lastChild),i.select(),o.doc.selection.clear(),s.innerHTML="",d&&(d.innerHTML=""),void 0;l=o.nodeIndex(s),s=s.parentNode}if(l==c-1)try{if(p=s.childNodes[l],a=m.createControlRange(),a.addElement(p),a.select(),h=e.getRng(),h.item&&p===h.item(0))return}catch(g){}}n(!0),n(),i.select()},this.getRangeAt=n}return e}),i(E,[f],function(e){return{BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,LEFT:37,RIGHT:39,SPACEBAR:32,TAB:9,UP:38,modifierPressed:function(e){return e.shiftKey||e.ctrlKey||e.altKey},metaKeyPressed:function(t){return(e.mac?t.ctrlKey||t.metaKey:t.ctrlKey)&&!t.altKey}}}),i(k,[E,d,f],function(e,t,n){return function(i,o){function r(e){return o.settings.object_resizing===!1?!1:/TABLE|IMG|DIV/.test(e.nodeName)?"false"===e.getAttribute("data-mce-resize")?!1:!0:!1}function a(t){var n,i;n=t.screenX-S,i=t.screenY-T,R=n*_[2]+N,O=i*_[3]+A,R=5>R?5:R,O=5>O?5:O,(e.modifierPressed(t)||"IMG"==b.nodeName&&0!==_[2]*_[3])&&(R=Math.round(O/M),O=Math.round(R*M)),I.setStyles(w,{width:R,height:O}),0>_[2]&&R>=w.clientWidth&&I.setStyle(w,"left",E+(N-R)),0>_[3]&&O>=w.clientHeight&&I.setStyle(w,"top",k+(A-O)),P||(o.fire("ObjectResizeStart",{target:b,width:N,height:A}),P=!0)}function s(){function e(e,t){t&&(b.style[e]||!o.schema.isValid(b.nodeName.toLowerCase(),e)?I.setStyle(b,e,t):I.setAttrib(b,e,t))}P=!1,e("width",R),e("height",O),I.unbind(H,"mousemove",a),I.unbind(H,"mouseup",s),L!=H&&(I.unbind(L,"mousemove",a),I.unbind(L,"mouseup",s)),I.remove(w),z&&"TABLE"!=b.nodeName||l(b),o.fire("ObjectResized",{target:b,width:R,height:O}),o.nodeChanged()}function l(e,t,n){var i,l,c,d,h,p=o.getBody().offsetParent||o.getBody();i=I.getPos(e,p),E=i.x,k=i.y,h=e.getBoundingClientRect(),l=h.width||h.right-h.left,c=h.height||h.bottom-h.top,b!=e&&(m(),b=e,R=O=0),d=o.fire("ObjectSelected",{target:e}),r(e)&&!d.isDefaultPrevented()?D(x,function(e,i){function r(t){P=!0,S=t.screenX,T=t.screenY,N=b.clientWidth,A=b.clientHeight,M=A/N,_=e,w=b.cloneNode(!0),I.addClass(w,"mce-clonedresizable"),w.contentEditable=!1,w.unSelectabe=!0,I.setStyles(w,{left:E,top:k,margin:0}),w.removeAttribute("data-mce-selected"),o.getBody().appendChild(w),I.bind(H,"mousemove",a),I.bind(H,"mouseup",s),L!=H&&(I.bind(L,"mousemove",a),I.bind(L,"mouseup",s))}var u,d;return t?(i==t&&r(n),void 0):(u=I.get("mceResizeHandle"+i),u?I.show(u):(d=o.getBody(),u=I.add(d,"div",{id:"mceResizeHandle"+i,"data-mce-bogus":!0,"class":"mce-resizehandle",contentEditable:!1,unSelectabe:!0,style:"cursor:"+i+"-resize; margin:0; padding:0"}),I.bind(u,"mousedown",function(e){e.preventDefault(),r(e)})),I.setStyles(u,{left:l*e[0]+E-u.offsetWidth/2,top:c*e[1]+k-u.offsetHeight/2}),void 0)}):u(),b.setAttribute("data-mce-selected","1")}function u(){var e,t;b&&b.removeAttribute("data-mce-selected");for(e in x)t=I.get("mceResizeHandle"+e),t&&(I.unbind(t),I.remove(t))}function c(e){function t(e,t){do if(e===t)return!0;while(e=e.parentNode)}var n;return D(I.select("img[data-mce-selected],hr[data-mce-selected]"),function(e){e.removeAttribute("data-mce-selected")}),n="mousedown"==e.type?e.target:i.getNode(),n=I.getParent(n,z?"table":"table,img,hr"),n&&(g(),t(i.getStart(),n)&&t(i.getEnd(),n)&&(!z||n!=i.getStart()&&"IMG"!==i.getStart().nodeName))?(l(n),void 0):(u(),void 0)}function d(e,t,n){e&&e.attachEvent&&e.attachEvent("on"+t,n)}function h(e,t,n){e&&e.detachEvent&&e.detachEvent("on"+t,n)}function p(e){var t,n,i,r,a,s,u,c=e.srcElement;t=c.getBoundingClientRect(),s=C.clientX-t.left,u=C.clientY-t.top;for(n in x)if(i=x[n],r=c.offsetWidth*i[0],a=c.offsetHeight*i[1],8>Math.abs(r-s)&&8>Math.abs(a-u)){_=i;break}P=!0,o.getDoc().selection.empty(),l(c,n,C)}function f(e){var t=e.srcElement;if(t!=b){if(m(),0===t.id.indexOf("mceResizeHandle"))return e.returnValue=!1,void 0;("IMG"==t.nodeName||"TABLE"==t.nodeName)&&(u(),b=t,d(t,"resizestart",p))}}function m(){h(b,"resizestart",p)}function g(){try{o.getDoc().execCommand("enableObjectResizing",!1,!1)}catch(e){}}function v(e){var t;if(z){t=H.body.createControlRange();try{return t.addElement(e),t.select(),!0}catch(n){}}}function y(){b=w=null,z&&(m(),h(o.getBody(),"controlselect",f))}var b,w,x,_,C,S,T,E,k,N,A,M,P,R,O,I=o.dom,D=t.each,H=o.getDoc(),L=document,z=n.ie&&11>n.ie;x={n:[.5,0,0,-1],e:[1,.5,1,0],s:[.5,1,0,1],w:[0,.5,-1,0],nw:[0,0,-1,-1],ne:[1,0,1,-1],se:[1,1,1,1],sw:[0,1,-1,1]};var B=".mce-content-body";return o.contentStyles.push(B+" div.mce-resizehandle {"+"position: absolute;"+"border: 1px solid black;"+"background: #FFF;"+"width: 5px;"+"height: 5px;"+"z-index: 10000"+"}"+B+" .mce-resizehandle:hover {"+"background: #000"+"}"+B+" img[data-mce-selected], hr[data-mce-selected] {"+"outline: 1px solid black;"+"resize: none"+"}"+B+" .mce-clonedresizable {"+"position: absolute;"+(n.gecko?"":"outline: 1px dashed black;")+"opacity: .5;"+"filter: alpha(opacity=50);"+"z-index: 10000"+"}"),o.on("init",function(){z?(o.on("ObjectResized",function(e){"TABLE"!=e.target.nodeName&&(u(),v(e.target))}),d(o.getBody(),"controlselect",f),o.on("mousedown",function(e){C=e})):(g(),n.ie>=11&&o.on("mouseup mousedown",function(e){("IMG"==e.target.nodeName||"IMG"==o.selection.getNode().nodeName)&&(e.preventDefault(),o.selection.select(e.target))})),o.on("nodechange mousedown ResizeEditor",c),o.on("keydown keyup",function(e){b&&"TABLE"==b.nodeName&&c(e)})}),{controlSelect:v,destroy:y}}}),i(N,[c,T,k,f,d],function(e,n,i,o,r){function a(e,t,o,r){var a=this;a.dom=e,a.win=t,a.serializer=o,a.editor=r,a.controlSelection=new i(a,r),a.win.getSelection||(a.tridentSel=new n(a))}var s=r.each,l=r.grep,u=r.trim,c=o.ie,d=o.opera;return a.prototype={setCursorLocation:function(e,t){var n=this,i=n.dom.createRng();i.setStart(e,t),i.setEnd(e,t),n.setRng(i),n.collapse(!1)},getContent:function(e){var n,i,o,r=this,a=r.getRng(),s=r.dom.create("body"),l=r.getSel();return e=e||{},n=i="",e.get=!0,e.format=e.format||"html",e.selection=!0,r.editor.fire("BeforeGetContent",e),"text"==e.format?r.isCollapsed()?"":a.text||(l.toString?""+l:""):(a.cloneContents?(o=a.cloneContents(),o&&s.appendChild(o)):a.item!==t||a.htmlText!==t?(s.innerHTML="<br>"+(a.item?a.item(0).outerHTML:a.htmlText),s.removeChild(s.firstChild)):s.innerHTML=""+a,/^\s/.test(s.innerHTML)&&(n=" "),/\s+$/.test(s.innerHTML)&&(i=" "),e.getInner=!0,e.content=r.isCollapsed()?"":n+r.serializer.serialize(s,e)+i,r.editor.fire("GetContent",e),e.content)},setContent:function(e,t){var n,i,o,r=this,a=r.getRng(),s=r.win.document;if(t=t||{format:"html"},t.set=!0,t.selection=!0,e=t.content=e,t.no_events||r.editor.fire("BeforeSetContent",t),e=t.content,a.insertNode){e+='<span id="__caret">_</span>',a.startContainer==s&&a.endContainer==s?s.body.innerHTML=e:(a.deleteContents(),0===s.body.childNodes.length?s.body.innerHTML=e:a.createContextualFragment?a.insertNode(a.createContextualFragment(e)):(i=s.createDocumentFragment(),o=s.createElement("div"),i.appendChild(o),o.outerHTML=e,a.insertNode(i))),n=r.dom.get("__caret"),a=s.createRange(),a.setStartBefore(n),a.setEndBefore(n),r.setRng(a),r.dom.remove("__caret");try{r.setRng(a)}catch(l){}}else a.item&&(s.execCommand("Delete",!1,null),a=r.getRng()),/^\s+/.test(e)?(a.pasteHTML('<span id="__mce_tmp">_</span>'+e),r.dom.remove("__mce_tmp")):a.pasteHTML(e);t.no_events||r.editor.fire("SetContent",t)},getStart:function(){var e,t,n,i,o=this,r=o.getRng();if(r.duplicate||r.item){if(r.item)return r.item(0);for(n=r.duplicate(),n.collapse(1),e=n.parentElement(),e.ownerDocument!==o.dom.doc&&(e=o.dom.getRoot()),t=i=r.parentElement();i=i.parentNode;)if(i==e){e=t;break}return e}return e=r.startContainer,1==e.nodeType&&e.hasChildNodes()&&(e=e.childNodes[Math.min(e.childNodes.length-1,r.startOffset)]),e&&3==e.nodeType?e.parentNode:e},getEnd:function(){var e,t,n=this,i=n.getRng();return i.duplicate||i.item?i.item?i.item(0):(i=i.duplicate(),i.collapse(0),e=i.parentElement(),e.ownerDocument!==n.dom.doc&&(e=n.dom.getRoot()),e&&"BODY"==e.nodeName?e.lastChild||e:e):(e=i.endContainer,t=i.endOffset,1==e.nodeType&&e.hasChildNodes()&&(e=e.childNodes[t>0?t-1:t]),e&&3==e.nodeType?e.parentNode:e)},getBookmark:function(e,t){function n(e,t){var n=0;return s(f.select(e),function(e,i){e==t&&(n=i)}),n}function i(e){function t(t){var n,i,o,r=t?"start":"end";n=e[r+"Container"],i=e[r+"Offset"],1==n.nodeType&&"TR"==n.nodeName&&(o=n.childNodes,n=o[Math.min(t?i:i-1,o.length-1)],n&&(i=t?0:n.childNodes.length,e["set"+(t?"Start":"End")](n,i)))}return t(!0),t(),e}function o(){function e(e,n){var o,r,a=e[n?"startContainer":"endContainer"],s=e[n?"startOffset":"endOffset"],l=[],u=0;if(3==a.nodeType){if(t)for(o=a.previousSibling;o&&3==o.nodeType;o=o.previousSibling)s+=o.nodeValue.length;l.push(s)}else r=a.childNodes,s>=r.length&&r.length&&(u=1,s=Math.max(0,r.length-1)),l.push(p.dom.nodeIndex(r[s],t)+u);for(;a&&a!=i;a=a.parentNode)l.push(p.dom.nodeIndex(a,t));return l}var n=p.getRng(!0),i=f.getRoot(),o={};return o.start=e(n,!0),p.isCollapsed()||(o.end=e(n)),o}var r,a,l,u,c,d,h,p=this,f=p.dom,m="&#xFEFF;";if(2==e)return d=p.getNode(),c=d.nodeName,"IMG"==c?{name:c,index:n(c,d)}:p.tridentSel?p.tridentSel.getBookmark(e):o();if(e)return{rng:p.getRng()};if(r=p.getRng(),l=f.uniqueId(),u=p.isCollapsed(),h="overflow:hidden;line-height:0px",r.duplicate||r.item){if(r.item)return d=r.item(0),c=d.nodeName,{name:c,index:n(c,d)};a=r.duplicate();try{r.collapse(),r.pasteHTML('<span data-mce-type="bookmark" id="'+l+'_start" style="'+h+'">'+m+"</span>"),u||(a.collapse(!1),r.moveToElementText(a.parentElement()),0===r.compareEndPoints("StartToEnd",a)&&a.move("character",-1),a.pasteHTML('<span data-mce-type="bookmark" id="'+l+'_end" style="'+h+'">'+m+"</span>"))}catch(g){return null}}else{if(d=p.getNode(),c=d.nodeName,"IMG"==c)return{name:c,index:n(c,d)};a=i(r.cloneRange()),u||(a.collapse(!1),a.insertNode(f.create("span",{"data-mce-type":"bookmark",id:l+"_end",style:h},m))),r=i(r),r.collapse(!0),r.insertNode(f.create("span",{"data-mce-type":"bookmark",id:l+"_start",style:h},m))}return p.moveToBookmark({id:l,keep:1}),{id:l}},moveToBookmark:function(e){function t(t){var n,i,a,s,l=e[t?"start":"end"];if(l){for(a=l[0],i=r,n=l.length-1;n>=1;n--){if(s=i.childNodes,l[n]>s.length-1)return;i=s[l[n]]}3===i.nodeType&&(a=Math.min(l[0],i.nodeValue.length)),1===i.nodeType&&(a=Math.min(l[0],i.childNodes.length)),t?o.setStart(i,a):o.setEnd(i,a)}return!0}function n(t){var n,i,o,r,c=m.get(e.id+"_"+t),f=e.keep;if(c&&(n=c.parentNode,"start"==t?(f?(n=c.firstChild,i=1):i=m.nodeIndex(c),a=u=n,h=p=i):(f?(n=c.firstChild,i=1):i=m.nodeIndex(c),u=n,p=i),!f)){for(r=c.previousSibling,o=c.nextSibling,s(l(c.childNodes),function(e){3==e.nodeType&&(e.nodeValue=e.nodeValue.replace(/\uFEFF/g,""))});c=m.get(e.id+"_"+t);)m.remove(c,1);r&&o&&r.nodeType==o.nodeType&&3==r.nodeType&&!d&&(i=r.nodeValue.length,r.appendData(o.nodeValue),m.remove(o),"start"==t?(a=u=r,h=p=i):(u=r,p=i))}}function i(e){return!m.isBlock(e)||e.innerHTML||c||(e.innerHTML='<br data-mce-bogus="1" />'),e}var o,r,a,u,h,p,f=this,m=f.dom;if(e)if(e.start){if(o=m.createRng(),r=m.getRoot(),f.tridentSel)return f.tridentSel.moveToBookmark(e);t(!0)&&t()&&f.setRng(o)}else e.id?(n("start"),n("end"),a&&(o=m.createRng(),o.setStart(i(a),h),o.setEnd(i(u),p),f.setRng(o))):e.name?f.select(m.select(e.name)[e.index]):e.rng&&f.setRng(e.rng)},select:function(t,n){function i(t,n){var i=new e(t,t);do{if(3==t.nodeType&&0!==u(t.nodeValue).length)return n?s.setStart(t,0):s.setEnd(t,t.nodeValue.length),void 0;if("BR"==t.nodeName)return n?s.setStartBefore(t):s.setEndBefore(t),void 0}while(t=n?i.next():i.prev())}var o,r=this,a=r.dom,s=a.createRng();if(r.lastFocusBookmark=null,t){if(!n&&r.controlSelection.controlSelect(t))return;o=a.nodeIndex(t),s.setStart(t.parentNode,o),s.setEnd(t.parentNode,o+1),n&&(i(t,1),i(t)),r.setRng(s)}return t},isCollapsed:function(){var e=this,t=e.getRng(),n=e.getSel();return!t||t.item?!1:t.compareEndPoints?0===t.compareEndPoints("StartToEnd",t):!n||t.collapsed},collapse:function(e){var t,n=this,i=n.getRng();i.item&&(t=i.item(0),i=n.win.document.body.createTextRange(),i.moveToElementText(t)),i.collapse(!!e),n.setRng(i)},getSel:function(){var e=this.win;return e.getSelection?e.getSelection():e.document.selection},getRng:function(e){var t,n,i,o,r=this,a=r.win.document;if(!e&&r.lastFocusBookmark){var s=r.lastFocusBookmark;return s.startContainer?(n=a.createRange(),n.setStart(s.startContainer,s.startOffset),n.setEnd(s.endContainer,s.endOffset)):n=s,n}if(e&&r.tridentSel)return r.tridentSel.getRangeAt(0);try{(t=r.getSel())&&(n=t.rangeCount>0?t.getRangeAt(0):t.createRange?t.createRange():a.createRange())}catch(l){}if(c&&n&&n.setStart){try{o=a.selection.createRange()}catch(l){}o&&o.item&&(i=o.item(0),n=a.createRange(),n.setStartBefore(i),n.setEndAfter(i))}return n||(n=a.createRange?a.createRange():a.body.createTextRange()),n.setStart&&9===n.startContainer.nodeType&&n.collapsed&&(i=r.dom.getRoot(),n.setStart(i,0),n.setEnd(i,0)),r.selectedRange&&r.explicitRange&&(0===n.compareBoundaryPoints(n.START_TO_START,r.selectedRange)&&0===n.compareBoundaryPoints(n.END_TO_END,r.selectedRange)?n=r.explicitRange:(r.selectedRange=null,r.explicitRange=null)),n},setRng:function(e,t){var n,i=this;if(e.select)try{e.select()}catch(o){}else if(i.tridentSel){if(e.cloneRange)try{return i.tridentSel.addRange(e),void 0}catch(o){}}else if(n=i.getSel()){i.explicitRange=e;try{n.removeAllRanges(),n.addRange(e)}catch(o){}t===!1&&n.extend&&(n.collapse(e.endContainer,e.endOffset),n.extend(e.startContainer,e.startOffset)),i.selectedRange=n.rangeCount>0?n.getRangeAt(0):null}},setNode:function(e){var t=this;return t.setContent(t.dom.getOuterHTML(e)),e},getNode:function(){function e(e,t){for(var n=e;e&&3===e.nodeType&&0===e.length;)e=t?e.nextSibling:e.previousSibling;return e||n}var t,n=this,i=n.getRng(),o=i.startContainer,r=i.endContainer,a=i.startOffset,s=i.endOffset;return i?i.setStart?(t=i.commonAncestorContainer,!i.collapsed&&(o==r&&2>s-a&&o.hasChildNodes()&&(t=o.childNodes[a]),3===o.nodeType&&3===r.nodeType&&(o=o.length===a?e(o.nextSibling,!0):o.parentNode,r=0===s?e(r.previousSibling,!1):r.parentNode,o&&o===r))?o:t&&3==t.nodeType?t.parentNode:t):i.item?i.item(0):i.parentElement():n.dom.getRoot()},getSelectedBlocks:function(t,n){var i,o,r=this,a=r.dom,s=[];if(o=a.getRoot(),t=a.getParent(t||r.getStart(),a.isBlock),n=a.getParent(n||r.getEnd(),a.isBlock),t&&t!=o&&s.push(t),t&&n&&t!=n){i=t;for(var l=new e(t,o);(i=l.next())&&i!=n;)a.isBlock(i)&&s.push(i)}return n&&t!=n&&n!=o&&s.push(n),s},isForward:function(){var e,t,n=this.dom,i=this.getSel();return i&&i.anchorNode&&i.focusNode?(e=n.createRng(),e.setStart(i.anchorNode,i.anchorOffset),e.collapse(!0),t=n.createRng(),t.setStart(i.focusNode,i.focusOffset),t.collapse(!0),0>=e.compareBoundaryPoints(e.START_TO_START,t)):!0},normalize:function(){function t(t){function a(t,n){for(var i=new e(t,m.getParent(t.parentNode,m.isBlock)||g);t=i[n?"prev":"next"]();)if("BR"===t.nodeName)return!0}function s(e,t){return e.previousSibling&&e.previousSibling.nodeName==t}function l(t,n){var r,a;for(n=n||u,r=new e(n,m.getParent(n.parentNode,m.isBlock)||g);h=r[t?"prev":"next"]();){if(3===h.nodeType&&h.nodeValue.length>0)return u=h,c=t?h.nodeValue.length:0,i=!0,void 0;if(m.isBlock(h)||p[h.nodeName.toLowerCase()])return;a=h}o&&a&&(u=a,i=!0,c=0)}var u,c,d,h,p,f,m=r.dom,g=m.getRoot();if(u=n[(t?"start":"end")+"Container"],c=n[(t?"start":"end")+"Offset"],p=m.schema.getNonEmptyElements(),9===u.nodeType&&(u=m.getRoot(),c=0),u===g){if(t&&(h=u.childNodes[c>0?c-1:0],h&&(f=h.nodeName.toLowerCase(),p[h.nodeName]||"TABLE"==h.nodeName)))return;if(u.hasChildNodes()&&(c=Math.min(!t&&c>0?c-1:c,u.childNodes.length-1),u=u.childNodes[c],c=0,u.hasChildNodes()&&!/TABLE/.test(u.nodeName))){h=u,d=new e(u,g);do{if(3===h.nodeType&&h.nodeValue.length>0){c=t?0:h.nodeValue.length,u=h,i=!0;break}if(p[h.nodeName.toLowerCase()]){c=m.nodeIndex(h),u=h.parentNode,"IMG"!=h.nodeName||t||c++,i=!0;break}}while(h=t?d.next():d.prev())}}o&&(3===u.nodeType&&0===c&&l(!0),1===u.nodeType&&(h=u.childNodes[c],!h||"BR"!==h.nodeName||s(h,"A")||a(h)||a(h,!0)||l(!0,u.childNodes[c]))),t&&!o&&3===u.nodeType&&c===u.nodeValue.length&&l(!1),i&&n["set"+(t?"Start":"End")](u,c)}var n,i,o,r=this;c||(n=r.getRng(),o=n.collapsed,t(!0),o||t(),i&&(o&&n.collapse(!0),r.setRng(n,r.isForward())))},selectorChanged:function(e,t){var n,i=this;return i.selectorChangedData||(i.selectorChangedData={},n={},i.editor.on("NodeChange",function(e){var t=e.element,o=i.dom,r=o.getParents(t,null,o.getRoot()),a={};s(i.selectorChangedData,function(e,t){s(r,function(i){return o.is(i,t)?(n[t]||(s(e,function(e){e(!0,{node:i,selector:t,parents:r})}),n[t]=e),a[t]=e,!1):void 0})}),s(n,function(e,i){a[i]||(delete n[i],s(e,function(e){e(!1,{node:t,selector:i,parents:r})}))})})),i.selectorChangedData[e]||(i.selectorChangedData[e]=[]),i.selectorChangedData[e].push(t),i},scrollIntoView:function(e){var t,n,i=this,o=i.dom;n=o.getViewPort(i.editor.getWin()),t=o.getPos(e).y,(n.y>t||t+25>n.y+n.h)&&i.editor.getWin().scrollTo(0,n.y>t?t:t-n.h+25)},destroy:function(){this.win=null,this.controlSelection.destroy()}},a}),i(A,[d],function(e){function t(e){this.walk=function(t,i){function o(e){var t;return t=e[0],3===t.nodeType&&t===m&&g>=t.nodeValue.length&&e.splice(0,1),t=e[e.length-1],0===y&&e.length>0&&t===v&&3===t.nodeType&&e.splice(e.length-1,1),e}function r(e,t,n){for(var i=[];e&&e!=n;e=e[t])i.push(e);return i}function a(e,t){do{if(e.parentNode==t)return e;e=e.parentNode}while(e)}function s(e,t,n){var a=n?"nextSibling":"previousSibling";for(d=e,h=d.parentNode;d&&d!=t;d=h)h=d.parentNode,p=r(d==e?d:d[a],a),p.length&&(n||p.reverse(),i(o(p)))}var l,u,c,d,h,p,f,m=t.startContainer,g=t.startOffset,v=t.endContainer,y=t.endOffset;if(f=e.select("td.mce-item-selected,th.mce-item-selected"),f.length>0)return n(f,function(e){i([e])}),void 0;if(1==m.nodeType&&m.hasChildNodes()&&(m=m.childNodes[g]),1==v.nodeType&&v.hasChildNodes()&&(v=v.childNodes[Math.min(y-1,v.childNodes.length-1)]),m==v)return i(o([m]));for(l=e.findCommonAncestor(m,v),d=m;d;d=d.parentNode){if(d===v)return s(m,l,!0);if(d===l)break}for(d=v;d;d=d.parentNode){if(d===m)return s(v,l);if(d===l)break}u=a(m,l)||m,c=a(v,l)||v,s(m,u,!0),p=r(u==m?u:u.nextSibling,"nextSibling",c==v?c.nextSibling:c),p.length&&i(o(p)),s(v,c)},this.split=function(e){function t(e,t){return e.splitText(t)}var n=e.startContainer,i=e.startOffset,o=e.endContainer,r=e.endOffset;return n==o&&3==n.nodeType?i>0&&n.nodeValue.length>i&&(o=t(n,i),n=o.previousSibling,r>i?(r-=i,n=o=t(o,r).previousSibling,r=o.nodeValue.length,i=0):r=0):(3==n.nodeType&&i>0&&n.nodeValue.length>i&&(n=t(n,i),i=0),3==o.nodeType&&r>0&&o.nodeValue.length>r&&(o=t(o,r).previousSibling,r=o.nodeValue.length)),{startContainer:n,startOffset:i,endContainer:o,endOffset:r}}}var n=e.each;return t.compareRanges=function(e,t){if(e&&t){if(!e.item&&!e.duplicate)return e.startContainer==t.startContainer&&e.startOffset==t.startOffset;if(e.item&&t.item&&e.item(0)===t.item(0))return!0;if(e.isEqual&&t.isEqual&&t.isEqual(e))return!0}return!1},t}),i(M,[c,A,d],function(e,t,n){return function(i){function o(e){return e.nodeType&&(e=e.nodeName),!!i.schema.getTextBlockElements()[e.toLowerCase()]}function r(e,t){return U.getParents(e,t,U.getRoot())}function a(e){return 1===e.nodeType&&"_mce_caret"===e.id}function s(){c({alignleft:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"left"},defaultBlock:"div"},{selector:"img,table",collapsed:!1,styles:{"float":"left"}}],aligncenter:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"center"},defaultBlock:"div"},{selector:"img",collapsed:!1,styles:{display:"block",marginLeft:"auto",marginRight:"auto"}},{selector:"table",collapsed:!1,styles:{marginLeft:"auto",marginRight:"auto"}}],alignright:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"right"},defaultBlock:"div"},{selector:"img,table",collapsed:!1,styles:{"float":"right"}}],alignjustify:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"justify"},defaultBlock:"div"}],bold:[{inline:"strong",remove:"all"},{inline:"span",styles:{fontWeight:"bold"}},{inline:"b",remove:"all"}],italic:[{inline:"em",remove:"all"},{inline:"span",styles:{fontStyle:"italic"}},{inline:"i",remove:"all"}],underline:[{inline:"span",styles:{textDecoration:"underline"},exact:!0},{inline:"u",remove:"all"}],strikethrough:[{inline:"span",styles:{textDecoration:"line-through"},exact:!0},{inline:"strike",remove:"all"}],forecolor:{inline:"span",styles:{color:"%value"},wrap_links:!1},hilitecolor:{inline:"span",styles:{backgroundColor:"%value"},wrap_links:!1},fontname:{inline:"span",styles:{fontFamily:"%value"}},fontsize:{inline:"span",styles:{fontSize:"%value"}},fontsize_class:{inline:"span",attributes:{"class":"%value"}},blockquote:{block:"blockquote",wrapper:1,remove:"all"},subscript:{inline:"sub"},superscript:{inline:"sup"},code:{inline:"code"},link:{inline:"a",selector:"a",remove:"all",split:!0,deep:!0,onmatch:function(){return!0},onformat:function(e,t,n){et(n,function(t,n){U.setAttrib(e,n,t)})}},removeformat:[{selector:"b,strong,em,i,font,u,strike,sub,sup",remove:"all",split:!0,expand:!1,block_expand:!0,deep:!0},{selector:"span",attributes:["style","class"],remove:"empty",split:!0,expand:!1,deep:!0},{selector:"*",attributes:["style","class"],split:!1,expand:!1,deep:!0}]}),et("p h1 h2 h3 h4 h5 h6 div address pre div dt dd samp".split(/\s/),function(e){c(e,{block:e,remove:"all"})}),c(i.settings.formats)}function l(){i.addShortcut("ctrl+b","bold_desc","Bold"),i.addShortcut("ctrl+i","italic_desc","Italic"),i.addShortcut("ctrl+u","underline_desc","Underline");for(var e=1;6>=e;e++)i.addShortcut("ctrl+"+e,"",["FormatBlock",!1,"h"+e]);i.addShortcut("ctrl+7","",["FormatBlock",!1,"p"]),i.addShortcut("ctrl+8","",["FormatBlock",!1,"div"]),i.addShortcut("ctrl+9","",["FormatBlock",!1,"address"])}function u(e){return e?j[e]:j}function c(e,t){e&&("string"!=typeof e?et(e,function(e,t){c(t,e)}):(t=t.length?t:[t],et(t,function(e){e.deep===z&&(e.deep=!e.selector),e.split===z&&(e.split=!e.selector||e.inline),e.remove===z&&e.selector&&!e.inline&&(e.remove="none"),e.selector&&e.inline&&(e.mixed=!0,e.block_expand=!0),"string"==typeof e.classes&&(e.classes=e.classes.split(/\s+/))}),j[e]=t))}function d(e){var t;return i.dom.getParent(e,function(e){return t=i.dom.getStyle(e,"text-decoration"),t&&"none"!==t}),t}function h(e){var t;1===e.nodeType&&e.parentNode&&1===e.parentNode.nodeType&&(t=d(e.parentNode),i.dom.getStyle(e,"color")&&t?i.dom.setStyle(e,"text-decoration",t):i.dom.getStyle(e,"textdecoration")===t&&i.dom.setStyle(e,"text-decoration",null))}function p(t,n,r){function s(e,t){t=t||y,e&&(t.onformat&&t.onformat(e,t,n,r),et(t.styles,function(t,i){U.setStyle(e,i,T(t,n))}),et(t.attributes,function(t,i){U.setAttrib(e,i,T(t,n))}),et(t.classes,function(t){t=T(t,n),U.hasClass(e,t)||U.addClass(e,t)}))}function l(){function t(t,n){var i=new e(n);for(r=i.current();r;r=i.prev())if(r.childNodes.length>1||r==t||"BR"==r.tagName)return r}var n=i.selection.getRng(),o=n.startContainer,a=n.endContainer;if(o!=a&&0===n.endOffset){var s=t(o,a),l=3==s.nodeType?s.length:s.childNodes.length;n.setEnd(s,l)}return n}function c(e,t,n,i,o){var r,a,s=[],l=-1,u=-1,c=-1;return et(e.childNodes,function(e,t){return"UL"===e.nodeName||"OL"===e.nodeName?(l=t,r=e,!1):void 0}),et(e.childNodes,function(e,n){"SPAN"===e.nodeName&&"bookmark"==U.getAttrib(e,"data-mce-type")&&(e.id==t.id+"_start"?u=n:e.id==t.id+"_end"&&(c=n))}),0>=l||l>u&&c>l?(et(tt(e.childNodes),o),0):(a=U.clone(n,Z),et(tt(e.childNodes),function(e,t){(l>u&&l>t||u>l&&t>l)&&(s.push(e),e.parentNode.removeChild(e))}),l>u?e.insertBefore(a,r):u>l&&e.insertBefore(a,r.nextSibling),i.push(a),et(s,function(e){a.appendChild(e)}),a)}function d(e,i,r){var l,u,d=[],h=!0;l=y.inline||y.block,u=U.create(l),s(u),V.walk(e,function(e){function p(e){var m,w,x,C,S;return S=h,m=e.nodeName.toLowerCase(),w=e.parentNode.nodeName.toLowerCase(),1===e.nodeType&&J(e)&&(S=h,h="true"===J(e),C=!0),_(m,"br")?(f=0,y.block&&U.remove(e),void 0):y.wrapper&&g(e,t,n)?(f=0,void 0):h&&!C&&y.block&&!y.wrapper&&o(m)&&$(w,l)?(e=U.rename(e,l),s(e),d.push(e),f=0,void 0):y.selector&&(et(v,function(t){"collapsed"in t&&t.collapsed!==b||U.is(e,t.selector)&&!a(e)&&(s(e,t),x=!0)}),!y.inline||x)?(f=0,void 0):(!h||C||!$(l,m)||!$(w,l)||!r&&3===e.nodeType&&1===e.nodeValue.length&&65279===e.nodeValue.charCodeAt(0)||a(e)||y.inline&&q(e)?"li"==m&&i?f=c(e,i,u,d,p):(f=0,et(tt(e.childNodes),p),C&&(h=S),f=0):(f||(f=U.clone(u,Z),e.parentNode.insertBefore(f,e),d.push(f)),f.appendChild(e)),void 0)}var f;et(e,p)}),y.wrap_links===!1&&et(d,function(e){function t(e){var n,i,o;if("A"===e.nodeName){for(i=U.clone(u,Z),d.push(i),o=tt(e.childNodes),n=0;o.length>n;n++)i.appendChild(o[n]);e.appendChild(i)}et(tt(e.childNodes),t)}t(e)}),et(d,function(e){function i(e){var t=0;return et(e.childNodes,function(e){E(e)||R(e)||t++}),t}function o(e){var t,n;return et(e.childNodes,function(e){return 1!=e.nodeType||R(e)||a(e)?void 0:(t=e,Z)}),t&&x(t,y)&&(n=U.clone(t,Z),s(n),U.replace(n,e,K),U.remove(t,1)),n||e}var r;if(r=i(e),(d.length>1||!q(e))&&0===r)return U.remove(e,1),void 0;if(y.inline||y.wrapper){if(y.exact||1!==r||(e=o(e)),et(v,function(t){et(U.select(t.inline,e),function(e){var i;if(t.wrap_links===!1){i=e.parentNode;do if("A"===i.nodeName)return;while(i=i.parentNode)}A(t,n,e,t.exact?e:null)})}),g(e.parentNode,t,n))return U.remove(e,1),e=0,K;y.merge_with_parents&&U.getParent(e.parentNode,function(i){return g(i,t,n)?(U.remove(e,1),e=0,K):void 0}),e&&y.merge_siblings!==!1&&(e=O(P(e),e),e=O(e,P(e,K)))}})}var f,m,v=u(t),y=v[0],b=!r&&W.isCollapsed();if(y)if(r)r.nodeType?(m=U.createRng(),m.setStartBefore(r),m.setEndAfter(r),d(N(m,v),null,!0)):d(r,null,!0);else if(b&&y.inline&&!U.select("td.mce-item-selected,th.mce-item-selected").length)D("apply",t,n);else{var w=i.selection.getNode();Q||!v[0].defaultBlock||U.getParent(w,U.isBlock)||p(v[0].defaultBlock),i.selection.setRng(l()),f=W.getBookmark(),d(N(W.getRng(K),v),f),y.styles&&(y.styles.color||y.styles.textDecoration)&&(nt(w,h,"childNodes"),h(w)),W.moveToBookmark(f),H(W.getRng(K)),i.nodeChanged()}}function f(e,t,n){function o(e){var n,i,r,a,s;if(1===e.nodeType&&J(e)&&(a=b,b="true"===J(e),s=!0),n=tt(e.childNodes),b&&!s)for(i=0,r=m.length;r>i&&!A(m[i],t,e,e);i++);if(y.deep&&n.length){for(i=0,r=n.length;r>i;i++)o(n[i]);s&&(b=a)}}function a(n){var i;return et(r(n.parentNode).reverse(),function(n){var o;i||"_start"==n.id||"_end"==n.id||(o=g(n,e,t),o&&o.split!==!1&&(i=n))}),i}function s(e,n,i,o){var r,a,s,l,u,c;if(e){for(c=e.parentNode,r=n.parentNode;r&&r!=c;r=r.parentNode){for(a=U.clone(r,Z),u=0;m.length>u;u++)if(A(m[u],t,a,a)){a=0;break}a&&(s&&a.appendChild(s),l||(l=a),s=a)}!o||y.mixed&&q(e)||(n=U.split(e,n)),s&&(i.parentNode.insertBefore(s,i),l.appendChild(i))}return n}function l(e){return s(a(e),e,e,!0)}function c(e){var t=U.get(e?"_start":"_end"),n=t[e?"firstChild":"lastChild"];return R(n)&&(n=n[e?"firstChild":"lastChild"]),U.remove(t,!0),n}function h(e){var t,n;e=N(e,m,K),y.split&&(t=I(e,K),n=I(e),t!=n?(/^(TR|TD)$/.test(t.nodeName)&&t.firstChild&&(t="TD"==t.nodeName?t.firstChild||t:t.firstChild.firstChild||t),t=k(t,"span",{id:"_start","data-mce-type":"bookmark"}),n=k(n,"span",{id:"_end","data-mce-type":"bookmark"}),l(t),l(n),t=c(K),n=c()):t=n=l(t),e.startContainer=t.parentNode,e.startOffset=G(t),e.endContainer=n.parentNode,e.endOffset=G(n)+1),V.walk(e,function(e){et(e,function(e){o(e),1===e.nodeType&&"underline"===i.dom.getStyle(e,"text-decoration")&&e.parentNode&&"underline"===d(e.parentNode)&&A({deep:!1,exact:!0,inline:"span",styles:{textDecoration:"underline"}},null,e)})})}var p,f,m=u(e),y=m[0],b=!0;return n?(n.nodeType?(f=U.createRng(),f.setStartBefore(n),f.setEndAfter(n),h(f)):h(n),void 0):(W.isCollapsed()&&y.inline&&!U.select("td.mce-item-selected,th.mce-item-selected").length?D("remove",e,t):(p=W.getBookmark(),h(W.getRng(K)),W.moveToBookmark(p),y.inline&&v(e,t,W.getStart())&&H(W.getRng(!0)),i.nodeChanged()),void 0)}function m(e,t,n){var i=u(e);!v(e,t,n)||"toggle"in i[0]&&!i[0].toggle?p(e,t,n):f(e,t,n)}function g(e,t,n,i){function o(e,t,o){var r,a,s,l=t[o];if(t.onmatch)return t.onmatch(e,t,o);if(l)if(l.length===z){for(r in l)if(l.hasOwnProperty(r)){if(a="attributes"===o?U.getAttrib(e,r):C(e,r),i&&!a&&!t.exact)return;if((!i||t.exact)&&!_(a,S(T(l[r],n),r)))return}}else for(s=0;l.length>s;s++)if("attributes"===o?U.getAttrib(e,l[s]):C(e,l[s]))return t;return t}var r,a,s,l=u(t);if(l&&e)for(a=0;l.length>a;a++)if(r=l[a],x(e,r)&&o(e,r,"attributes")&&o(e,r,"styles")){if(s=r.classes)for(a=0;s.length>a;a++)if(!U.hasClass(e,s[a]))return;return r}}function v(e,t,n){function i(n){var i=U.getRoot();return n=U.getParent(n,function(n){return n.parentNode===i||!!g(n,e,t,!0)}),g(n,e,t)}var o;return n?i(n):(n=W.getNode(),i(n)?K:(o=W.getStart(),o!=n&&i(o)?K:Z))}function y(e,t){var n,i=[],o={};return n=W.getStart(),U.getParent(n,function(n){var r,a;for(r=0;e.length>r;r++)a=e[r],!o[a]&&g(n,a,t)&&(o[a]=!0,i.push(a))},U.getRoot()),i}function b(e){var t,n,i,o,a,s=u(e);if(s)for(t=W.getStart(),n=r(t),o=s.length-1;o>=0;o--){if(a=s[o].selector,!a||s[o].defaultBlock)return K;for(i=n.length-1;i>=0;i--)if(U.is(n[i],a))return K}return Z}function w(e,t,n){var o;return L||(L={},o={},i.on("NodeChange",function(e){var t=r(e.element),n={};et(L,function(e,i){et(t,function(r){return g(r,i,{},e.similar)?(o[i]||(et(e,function(e){e(!0,{node:r,format:i,parents:t})}),o[i]=e),n[i]=e,!1):void 0})}),et(o,function(i,r){n[r]||(delete o[r],et(i,function(n){n(!1,{node:e.element,format:r,parents:t})}))})})),et(e.split(","),function(e){L[e]||(L[e]=[],L[e].similar=n),L[e].push(t)}),this}function x(e,t){return _(e,t.inline)?K:_(e,t.block)?K:t.selector?1==e.nodeType&&U.is(e,t.selector):void 0}function _(e,t){return e=e||"",t=t||"",e=""+(e.nodeName||e),t=""+(t.nodeName||t),e.toLowerCase()==t.toLowerCase()}function C(e,t){return S(U.getStyle(e,t),t)}function S(e,t){return("color"==t||"backgroundColor"==t)&&(e=U.toHex(e)),"fontWeight"==t&&700==e&&(e="bold"),"fontFamily"==t&&(e=e.replace(/[\'\"]/g,"").replace(/,\s+/g,",")),""+e}function T(e,t){return"string"!=typeof e?e=e(t):t&&(e=e.replace(/%(\w+)/g,function(e,n){return t[n]||e})),e}function E(e){return e&&3===e.nodeType&&/^([\t \r\n]+|)$/.test(e.nodeValue)}function k(e,t,n){var i=U.create(t,n);return e.parentNode.insertBefore(i,e),i.appendChild(e),i}function N(t,n,a){function s(e){function t(e){return"BR"==e.nodeName&&e.getAttribute("data-mce-bogus")&&!e.nextSibling}var i,o,r,a,s;if(i=o=e?g:y,a=e?"previousSibling":"nextSibling",s=U.getRoot(),3==i.nodeType&&!E(i)&&(e?v>0:i.nodeValue.length>b))return i;for(;;){if(!n[0].block_expand&&q(o))return o;for(r=o[a];r;r=r[a])if(!R(r)&&!E(r)&&!t(r))return o;if(o.parentNode==s){i=o;break}o=o.parentNode}return i}function l(e,t){for(t===z&&(t=3===e.nodeType?e.length:e.childNodes.length);e&&e.hasChildNodes();)e=e.childNodes[t],e&&(t=3===e.nodeType?e.length:e.childNodes.length);return{node:e,offset:t}}function u(e){for(var t=e;t;){if(1===t.nodeType&&J(t))return"false"===J(t)?t:e;t=t.parentNode}return e}function c(t,n,o){function r(e,t){var n,i,r=e.nodeValue;return t===void 0&&(t=o?r.length:0),o?(n=r.lastIndexOf(" ",t),i=r.lastIndexOf(" ",t),n=n>i?n:i,-1===n||a||n++):(n=r.indexOf(" ",t),i=r.indexOf(" ",t),n=-1!==n&&(-1===i||i>n)?n:i),n}var s,l,u,c;if(3===t.nodeType){if(u=r(t,n),-1!==u)return{container:t,offset:u};c=t}for(s=new e(t,U.getParent(t,q)||i.getBody());l=s[o?"prev":"next"]();)if(3===l.nodeType){if(c=l,u=r(l),-1!==u)return{container:l,offset:u}}else if(q(l))break;return c?(n=o?0:c.length,{container:c,offset:n}):void 0}function d(e,i){var o,a,s,l;for(3==e.nodeType&&0===e.nodeValue.length&&e[i]&&(e=e[i]),o=r(e),a=0;o.length>a;a++)for(s=0;n.length>s;s++)if(l=n[s],!("collapsed"in l&&l.collapsed!==t.collapsed)&&U.is(o[a],l.selector))return o[a];
return e}function h(e,t){var i,a=U.getRoot();if(n[0].wrapper||(i=U.getParent(e,n[0].block)),i||(i=U.getParent(3==e.nodeType?e.parentNode:e,function(e){return e!=a&&o(e)})),i&&n[0].wrapper&&(i=r(i,"ul,ol").reverse()[0]||i),!i)for(i=e;i[t]&&!q(i[t])&&(i=i[t],!_(i,"br")););return i||e}var p,f,m,g=t.startContainer,v=t.startOffset,y=t.endContainer,b=t.endOffset;if(1==g.nodeType&&g.hasChildNodes()&&(p=g.childNodes.length-1,g=g.childNodes[v>p?p:v],3==g.nodeType&&(v=0)),1==y.nodeType&&y.hasChildNodes()&&(p=y.childNodes.length-1,y=y.childNodes[b>p?p:b-1],3==y.nodeType&&(b=y.nodeValue.length)),g=u(g),y=u(y),(R(g.parentNode)||R(g))&&(g=R(g)?g:g.parentNode,g=g.nextSibling||g,3==g.nodeType&&(v=0)),(R(y.parentNode)||R(y))&&(y=R(y)?y:y.parentNode,y=y.previousSibling||y,3==y.nodeType&&(b=y.length)),n[0].inline&&(t.collapsed&&(m=c(g,v,!0),m&&(g=m.container,v=m.offset),m=c(y,b),m&&(y=m.container,b=m.offset)),f=l(y,b),f.node)){for(;f.node&&0===f.offset&&f.node.previousSibling;)f=l(f.node.previousSibling);f.node&&f.offset>0&&3===f.node.nodeType&&" "===f.node.nodeValue.charAt(f.offset-1)&&f.offset>1&&(y=f.node,y.splitText(f.offset-1))}return(n[0].inline||n[0].block_expand)&&(n[0].inline&&3==g.nodeType&&0!==v||(g=s(!0)),n[0].inline&&3==y.nodeType&&b!==y.nodeValue.length||(y=s())),n[0].selector&&n[0].expand!==Z&&!n[0].inline&&(g=d(g,"previousSibling"),y=d(y,"nextSibling")),(n[0].block||n[0].selector)&&(g=h(g,"previousSibling"),y=h(y,"nextSibling"),n[0].block&&(q(g)||(g=s(!0)),q(y)||(y=s()))),1==g.nodeType&&(v=G(g),g=g.parentNode),1==y.nodeType&&(b=G(y)+1,y=y.parentNode),{startContainer:g,startOffset:v,endContainer:y,endOffset:b}}function A(e,t,n,i){var o,r,a;if(!x(n,e))return Z;if("all"!=e.remove)for(et(e.styles,function(e,o){e=S(T(e,t),o),"number"==typeof o&&(o=e,i=0),(!i||_(C(i,o),e))&&U.setStyle(n,o,""),a=1}),a&&""===U.getAttrib(n,"style")&&(n.removeAttribute("style"),n.removeAttribute("data-mce-style")),et(e.attributes,function(e,o){var r;if(e=T(e,t),"number"==typeof o&&(o=e,i=0),!i||_(U.getAttrib(i,o),e)){if("class"==o&&(e=U.getAttrib(n,o),e&&(r="",et(e.split(/\s+/),function(e){/mce\w+/.test(e)&&(r+=(r?" ":"")+e)}),r)))return U.setAttrib(n,o,r),void 0;"class"==o&&n.removeAttribute("className"),Y.test(o)&&n.removeAttribute("data-mce-"+o),n.removeAttribute(o)}}),et(e.classes,function(e){e=T(e,t),(!i||U.hasClass(i,e))&&U.removeClass(n,e)}),r=U.getAttribs(n),o=0;r.length>o;o++)if(0!==r[o].nodeName.indexOf("_"))return Z;return"none"!=e.remove?(M(n,e),K):void 0}function M(e,t){function n(e,t,n){return e=P(e,t,n),!e||"BR"==e.nodeName||q(e)}var i,o=e.parentNode;t.block&&(Q?o==U.getRoot()&&(t.list_block&&_(e,t.list_block)||et(tt(e.childNodes),function(e){$(Q,e.nodeName.toLowerCase())?i?i.appendChild(e):i=k(e,Q):i=0})):q(e)&&!q(o)&&(n(e,Z)||n(e.firstChild,K,1)||e.insertBefore(U.create("br"),e.firstChild),n(e,K)||n(e.lastChild,Z,1)||e.appendChild(U.create("br")))),t.selector&&t.inline&&!_(t.inline,e)||U.remove(e,1)}function P(e,t,n){if(e)for(t=t?"nextSibling":"previousSibling",e=n?e:e[t];e;e=e[t])if(1==e.nodeType||!E(e))return e}function R(e){return e&&1==e.nodeType&&"bookmark"==e.getAttribute("data-mce-type")}function O(e,t){function n(e,t){function n(e){var t={};return et(U.getAttribs(e),function(n){var i=n.nodeName.toLowerCase();0!==i.indexOf("_")&&"style"!==i&&(t[i]=U.getAttrib(e,i))}),t}function i(e,t){var n,i;for(i in e)if(e.hasOwnProperty(i)){if(n=t[i],n===z)return Z;if(e[i]!=n)return Z;delete t[i]}for(i in t)if(t.hasOwnProperty(i))return Z;return K}return e.nodeName!=t.nodeName?Z:i(n(e),n(t))?i(U.parseStyle(U.getAttrib(e,"style")),U.parseStyle(U.getAttrib(t,"style")))?K:Z:Z}function i(e,t){for(o=e;o;o=o[t]){if(3==o.nodeType&&0!==o.nodeValue.length)return e;if(1==o.nodeType&&!R(o))return o}return e}var o,r;if(e&&t&&(e=i(e,"previousSibling"),t=i(t,"nextSibling"),n(e,t))){for(o=e.nextSibling;o&&o!=t;)r=o,o=o.nextSibling,e.appendChild(r);return U.remove(t),et(tt(t.childNodes),function(t){e.appendChild(t)}),e}return t}function I(t,n){var o,r,a;return o=t[n?"startContainer":"endContainer"],r=t[n?"startOffset":"endOffset"],1==o.nodeType&&(a=o.childNodes.length-1,!n&&r&&r--,o=o.childNodes[r>a?a:r]),3===o.nodeType&&n&&r>=o.nodeValue.length&&(o=new e(o,i.getBody()).next()||o),3!==o.nodeType||n||0!==r||(o=new e(o,i.getBody()).prev()||o),o}function D(t,n,r){function a(e){var t=U.create("span",{id:y,"data-mce-bogus":!0,style:b?"color:red":""});return e&&t.appendChild(i.getDoc().createTextNode(X)),t}function s(e,t){for(;e;){if(3===e.nodeType&&e.nodeValue!==X||e.childNodes.length>1)return!1;t&&1===e.nodeType&&t.push(e),e=e.firstChild}return!0}function l(e){for(;e;){if(e.id===y)return e;e=e.parentNode}}function c(t){var n;if(t)for(n=new e(t,t),t=n.current();t;t=n.next())if(3===t.nodeType)return t}function d(e,t){var n,i;if(e)i=W.getRng(!0),s(e)?(t!==!1&&(i.setStartBefore(e),i.setEndBefore(e)),U.remove(e)):(n=c(e),n.nodeValue.charAt(0)===X&&(n=n.deleteData(0,1)),U.remove(e,1)),W.setRng(i);else if(e=l(W.getStart()),!e)for(;e=U.get(y);)d(e,!1)}function h(){var e,t,i,o,s,d,h;e=W.getRng(!0),o=e.startOffset,d=e.startContainer,h=d.nodeValue,t=l(W.getStart()),t&&(i=c(t)),h&&o>0&&h.length>o&&/\w/.test(h.charAt(o))&&/\w/.test(h.charAt(o-1))?(s=W.getBookmark(),e.collapse(!0),e=N(e,u(n)),e=V.split(e),p(n,r,e),W.moveToBookmark(s)):(t&&i.nodeValue===X?p(n,r,t):(t=a(!0),i=t.firstChild,e.insertNode(t),o=1,p(n,r,t)),W.setCursorLocation(i,o))}function m(){var e,t,i,s,l,c,d,h,p=W.getRng(!0),m=[];for(e=p.startContainer,t=p.startOffset,l=e,3==e.nodeType&&((t!=e.nodeValue.length||e.nodeValue===X)&&(s=!0),l=l.parentNode);l;){if(g(l,n,r)){c=l;break}l.nextSibling&&(s=!0),m.push(l),l=l.parentNode}if(c)if(s)i=W.getBookmark(),p.collapse(!0),p=N(p,u(n),!0),p=V.split(p),f(n,r,p),W.moveToBookmark(i);else{for(h=a(),l=h,d=m.length-1;d>=0;d--)l.appendChild(U.clone(m[d],!1)),l=l.firstChild;l.appendChild(U.doc.createTextNode(X)),l=l.firstChild;var v=U.getParent(c,o);v&&U.isEmpty(v)?c.parentNode.replaceChild(h,c):U.insertAfter(h,c),W.setCursorLocation(l,1),U.isEmpty(c)&&U.remove(c)}}function v(){var e;e=l(W.getStart()),e&&!U.isEmpty(e)&&nt(e,function(e){1!=e.nodeType||e.id===y||U.isEmpty(e)||U.setAttrib(e,"data-mce-bogus",null)},"childNodes")}var y="_mce_caret",b=i.settings.caret_debug;i._hasCaretEvents||(F=function(){var e,t=[];if(s(l(W.getStart()),t))for(e=t.length;e--;)U.setAttrib(t[e],"data-mce-bogus","1")},B=function(e){var t=e.keyCode;d(),(8==t||37==t||39==t)&&d(l(W.getStart())),v()},i.on("SetContent",function(e){e.selection&&v()}),i._hasCaretEvents=!0),"apply"==t?h():m()}function H(t){var n,i,o,r,a,s=t.startContainer,l=t.startOffset;if(3==s.nodeType&&l>=s.nodeValue.length&&(l=G(s),s=s.parentNode,n=!0),1==s.nodeType)for(r=s.childNodes,s=r[Math.min(l,r.length-1)],i=new e(s,U.getParent(s,U.isBlock)),(l>r.length-1||n)&&i.next(),o=i.current();o;o=i.next())if(3==o.nodeType&&!E(o))return a=U.create("a",null,X),o.parentNode.insertBefore(a,o),t.setStart(o,0),W.setRng(t),U.remove(a),void 0}var L,z,B,F,j={},U=i.dom,W=i.selection,V=new t(U),$=i.schema.isValidChild,q=U.isBlock,Q=i.settings.forced_root_block,G=U.nodeIndex,X="﻿",Y=/^(src|href|style)$/,Z=!1,K=!0,J=U.getContentEditable,et=n.each,tt=n.grep,nt=n.walk,it=n.extend;it(this,{get:u,register:c,apply:p,remove:f,toggle:m,match:v,matchAll:y,matchNode:g,canApply:b,formatChanged:w}),s(),l(),i.on("BeforeGetContent",function(){F&&F()}),i.on("mouseup keydown",function(e){B&&B(e)})}}),i(P,[f,d],function(e,t){var n,i=t.trim;return n=RegExp(["<span[^>]+data-mce-bogus[^>]+>[​﻿]+<\\/span>","<div[^>]+data-mce-bogus[^>]+><\\/div>",'\\s?data-mce-selected="[^"]+"'].join("|"),"gi"),function(t){function o(){return i(t.getContent({format:"raw",no_events:1}).replace(n,""))}function r(){a.typing=!1,a.add()}var a,s,l,u,c=0,d=[];return t.on("init",function(){a.add()}),t.on("BeforeExecCommand",function(e){var t=e.command;"Undo"!=t&&"Redo"!=t&&"mceRepaint"!=t&&a.beforeChange()}),t.on("ExecCommand",function(e){var t=e.command;"Undo"!=t&&"Redo"!=t&&"mceRepaint"!=t&&a.add()}),t.on("ObjectResizeStart",function(){a.beforeChange()}),t.on("SaveContent ObjectResized",r),t.dom.bind(t.dom.getRoot(),"dragend",r),t.dom.bind(t.getBody(),"focusout",function(){!t.removed&&a.typing&&r()}),t.on("KeyUp",function(n){var i=n.keyCode;(i>=33&&36>=i||i>=37&&40>=i||45==i||13==i||n.ctrlKey)&&(r(),t.nodeChanged()),(46==i||8==i||e.mac&&(91==i||93==i))&&t.nodeChanged(),l&&a.typing&&(t.isDirty()||(t.isNotDirty=!d[0]||o()==d[0].content,t.isNotDirty||t.fire("change",{level:d[0],lastLevel:null})),t.fire("TypingUndo"),l=!1,t.nodeChanged())}),t.on("KeyDown",function(e){var t=e.keyCode;return t>=33&&36>=t||t>=37&&40>=t||45==t?(a.typing&&r(),void 0):((16>t||t>20)&&224!=t&&91!=t&&!a.typing&&(a.beforeChange(),a.typing=!0,a.add(),l=!0),void 0)}),t.on("MouseDown",function(){a.typing&&r()}),t.addShortcut("ctrl+z","","Undo"),t.addShortcut("ctrl+y,ctrl+shift+z","","Redo"),t.on("AddUndo Undo Redo ClearUndos MouseUp",function(e){e.isDefaultPrevented()||t.nodeChanged()}),a={data:d,typing:!1,beforeChange:function(){u||(s=t.selection.getBookmark(2,!0))},add:function(e){var n,i,r=t.settings;if(e=e||{},e.content=o(),u||t.fire("BeforeAddUndo",{level:e}).isDefaultPrevented())return null;if(i=d[c],i&&i.content==e.content)return null;if(d[c]&&(d[c].beforeBookmark=s),r.custom_undo_redo_levels&&d.length>r.custom_undo_redo_levels){for(n=0;d.length-1>n;n++)d[n]=d[n+1];d.length--,c=d.length}e.bookmark=t.selection.getBookmark(2,!0),d.length-1>c&&(d.length=c+1),d.push(e),c=d.length-1;var a={level:e,lastLevel:i};return t.fire("AddUndo",a),c>0&&(t.fire("change",a),t.isNotDirty=!1),e},undo:function(){var e;return a.typing&&(a.add(),a.typing=!1),c>0&&(e=d[--c],t.setContent(e.content,{format:"raw"}),t.selection.moveToBookmark(e.beforeBookmark),t.fire("undo",{level:e})),e},redo:function(){var e;return d.length-1>c&&(e=d[++c],t.setContent(e.content,{format:"raw"}),t.selection.moveToBookmark(e.bookmark),t.fire("redo",{level:e})),e},clear:function(){d=[],c=0,a.typing=!1,t.fire("ClearUndos")},hasUndo:function(){return c>0||a.typing&&d[0]&&o()!=d[0].content},hasRedo:function(){return d.length-1>c&&!this.typing},transact:function(e){a.beforeChange(),u=!0,e(),u=!1,a.add()}}}}),i(R,[c,f],function(e,t){var n=t.ie&&11>t.ie;return function(t){function i(i){function c(e){return e&&o.isBlock(e)&&!/^(TD|TH|CAPTION|FORM)$/.test(e.nodeName)&&!/^(fixed|absolute)/i.test(e.style.position)&&"true"!==o.getContentEditable(e)}function d(e){var t;o.isBlock(e)&&(t=r.getRng(),e.appendChild(o.create("span",null," ")),r.select(e),e.lastChild.outerHTML="",r.setRng(t))}function h(e){for(var t,n=e,i=[];n=n.firstChild;){if(o.isBlock(n))return;1!=n.nodeType||u[n.nodeName.toLowerCase()]||i.push(n)}for(t=i.length;t--;)n=i[t],!n.hasChildNodes()||n.firstChild==n.lastChild&&""===n.firstChild.nodeValue?o.remove(n):"A"==n.nodeName&&" "===(n.innerText||n.textContent)&&o.remove(n)}function p(t){var n,i,a,s,l=t;if(a=o.createRng(),t.hasChildNodes()){for(n=new e(t,t);i=n.current();){if(3==i.nodeType){a.setStart(i,0),a.setEnd(i,0);break}if(u[i.nodeName.toLowerCase()]){a.setStartBefore(i),a.setEndBefore(i);break}l=i,i=n.next()}i||(a.setStart(l,0),a.setEnd(l,0))}else"BR"==t.nodeName?t.nextSibling&&o.isBlock(t.nextSibling)?((!N||9>N)&&(s=o.create("br"),t.parentNode.insertBefore(s,t)),a.setStartBefore(t),a.setEndBefore(t)):(a.setStartAfter(t),a.setEndAfter(t)):(a.setStart(t,0),a.setEnd(t,0));r.setRng(a),o.remove(s),r.scrollIntoView(t)}function f(e){var t,i,r,s=T;if(t=e||"TABLE"==O?o.create(e||D):k.cloneNode(!1),r=t,a.keep_styles!==!1)do if(/^(SPAN|STRONG|B|EM|I|FONT|STRIKE|U)$/.test(s.nodeName)){if("_mce_caret"==s.id)continue;i=s.cloneNode(!1),o.setAttrib(i,"id",""),t.hasChildNodes()?(i.appendChild(t.firstChild),t.appendChild(i)):(r=i,t.appendChild(i))}while(s=s.parentNode);return n||(r.innerHTML='<br data-mce-bogus="1">'),t}function m(t){var n,i,o;if(3==T.nodeType&&(t?E>0:T.nodeValue.length>E))return!1;if(T.parentNode==k&&H&&!t)return!0;if(t&&1==T.nodeType&&T==k.firstChild)return!0;if("TABLE"===T.nodeName||T.previousSibling&&"TABLE"==T.previousSibling.nodeName)return H&&!t||!H&&t;for(n=new e(T,k),3==T.nodeType&&(t&&0===E?n.prev():t||E!=T.nodeValue.length||n.next());i=n.current();){if(1===i.nodeType){if(!i.getAttribute("data-mce-bogus")&&(o=i.nodeName.toLowerCase(),u[o]&&"br"!==o))return!1}else if(3===i.nodeType&&!/^[ \t\r\n]*$/.test(i.nodeValue))return!1;t?n.prev():n.next()}return!0}function g(e,n){var i,r,a,s,u,d,h=D||"P";if(r=o.getParent(e,o.isBlock),d=t.getBody().nodeName.toLowerCase(),!r||!c(r)){if(r=r||S,!r.hasChildNodes())return i=o.create(h),r.appendChild(i),L.setStart(i,0),L.setEnd(i,0),i;for(s=e;s.parentNode!=r;)s=s.parentNode;for(;s&&!o.isBlock(s);)a=s,s=s.previousSibling;if(a&&l.isValidChild(d,h.toLowerCase())){for(i=o.create(h),a.parentNode.insertBefore(i,a),s=a;s&&!o.isBlock(s);)u=s.nextSibling,i.appendChild(s),s=u;L.setStart(e,n),L.setEnd(e,n)}}return e}function v(){function e(e){for(var t=R[e?"firstChild":"lastChild"];t&&1!=t.nodeType;)t=t[e?"nextSibling":"previousSibling"];return t===k}function t(){var e=R.parentNode;return"LI"==e.nodeName?e:R}var n=R.parentNode.nodeName;/^(OL|UL|LI)$/.test(n)&&(D="LI"),M=D?f(D):o.create("BR"),e(!0)&&e()?"LI"==n?o.insertAfter(M,t()):o.replace(M,R):e(!0)?"LI"==n?(o.insertAfter(M,t()),M.appendChild(o.doc.createTextNode(" ")),M.appendChild(R)):R.parentNode.insertBefore(M,R):e()?(o.insertAfter(M,t()),d(M)):(R=t(),C=L.cloneRange(),C.setStartAfter(k),C.setEndAfter(R),P=C.extractContents(),o.insertAfter(P,R),o.insertAfter(M,R)),o.remove(k),p(M),s.add()}function y(){for(var t,n=new e(T,k);t=n.next();)if(u[t.nodeName.toLowerCase()]||t.length>0)return!0}function b(){var e,t,i;T&&3==T.nodeType&&E>=T.nodeValue.length&&(n||y()||(e=o.create("br"),L.insertNode(e),L.setStartAfter(e),L.setEndAfter(e),t=!0)),e=o.create("br"),L.insertNode(e),n&&"PRE"==O&&(!N||8>N)&&e.parentNode.insertBefore(o.doc.createTextNode("\r"),e),i=o.create("span",{},"&nbsp;"),e.parentNode.insertBefore(i,e),r.scrollIntoView(i),o.remove(i),t?(L.setStartBefore(e),L.setEndBefore(e)):(L.setStartAfter(e),L.setEndAfter(e)),r.setRng(L),s.add()}function w(e){do 3===e.nodeType&&(e.nodeValue=e.nodeValue.replace(/^[\r\n]+/,"")),e=e.firstChild;while(e)}function x(e){var t,n,i=o.getRoot();for(t=e;t!==i&&"false"!==o.getContentEditable(t);)"true"===o.getContentEditable(t)&&(n=t),t=t.parentNode;return t!==i?n:i}function _(e){var t;n||(e.normalize(),t=e.lastChild,(!t||/^(left|right)$/gi.test(o.getStyle(t,"float",!0)))&&o.add(e,"br"))}var C,S,T,E,k,N,A,M,P,R,O,I,D,H,L=r.getRng(!0);if(!L.collapsed)return t.execCommand("Delete"),void 0;if(!i.isDefaultPrevented()&&(T=L.startContainer,E=L.startOffset,D=(a.force_p_newlines?"p":"")||a.forced_root_block,D=D?D.toUpperCase():"",N=o.doc.documentMode,A=i.shiftKey,1==T.nodeType&&T.hasChildNodes()&&(H=E>T.childNodes.length-1,T=T.childNodes[Math.min(E,T.childNodes.length-1)]||T,E=H&&3==T.nodeType?T.nodeValue.length:0),S=x(T))){if(s.beforeChange(),!o.isBlock(S)&&S!=o.getRoot())return(!D||A)&&b(),void 0;if((D&&!A||!D&&A)&&(T=g(T,E)),k=o.getParent(T,o.isBlock),R=k?o.getParent(k.parentNode,o.isBlock):null,O=k?k.nodeName.toUpperCase():"",I=R?R.nodeName.toUpperCase():"","LI"!=I||i.ctrlKey||(k=R,O=I),"LI"==O){if(!D&&A)return b(),void 0;if(o.isEmpty(k))return v(),void 0}if("PRE"==O&&a.br_in_pre!==!1){if(!A)return b(),void 0}else if(!D&&!A&&"LI"!=O||D&&A)return b(),void 0;D&&k===t.getBody()||(D=D||"P",m()?(M=/^(H[1-6]|PRE|FIGURE)$/.test(O)&&"HGROUP"!=I?f(D):f(),a.end_container_on_empty_block&&c(R)&&o.isEmpty(k)?M=o.split(R,k):o.insertAfter(M,k),p(M)):m(!0)?(M=k.parentNode.insertBefore(f(),k),d(M)):(C=L.cloneRange(),C.setEndAfter(k),P=C.extractContents(),w(P),M=P.firstChild,o.insertAfter(P,k),h(M),_(k),p(M)),o.setAttrib(M,"id",""),s.add())}}var o=t.dom,r=t.selection,a=t.settings,s=t.undoManager,l=t.schema,u=l.getNonEmptyElements();t.on("keydown",function(e){13==e.keyCode&&i(e)!==!1&&e.preventDefault()})}}),i(O,[],function(){return function(e){function t(){var t,s,l,u,c,d,h,p,f,m,g,v,y=o.getStart(),b=e.getBody(),w=-16777215;if(v=n.forced_root_block,y&&1===y.nodeType&&v){for(;y&&y!=b;){if(a[y.nodeName])return;y=y.parentNode}if(t=o.getRng(),t.setStart){s=t.startContainer,l=t.startOffset,u=t.endContainer,c=t.endOffset;try{f=e.getDoc().activeElement===b}catch(x){}}else t.item&&(y=t.item(0),t=e.getDoc().body.createTextRange(),t.moveToElementText(y)),f=t.parentElement().ownerDocument===e.getDoc(),m=t.duplicate(),m.collapse(!0),l=-1*m.move("character",w),m.collapsed||(m=t.duplicate(),m.collapse(!1),c=-1*m.move("character",w)-l);for(y=b.firstChild,g=b.nodeName.toLowerCase();y;)if((3===y.nodeType||1==y.nodeType&&!a[y.nodeName])&&r.isValidChild(g,v.toLowerCase())){if(3===y.nodeType&&0===y.nodeValue.length){h=y,y=y.nextSibling,i.remove(h);continue}d||(d=i.create(v),y.parentNode.insertBefore(d,y),p=!0),h=y,y=y.nextSibling,d.appendChild(h)}else d=null,y=y.nextSibling;if(p&&f){if(t.setStart)t.setStart(s,l),t.setEnd(u,c),o.setRng(t);else try{t=e.getDoc().body.createTextRange(),t.moveToElementText(b),t.collapse(!0),t.moveStart("character",l),c>0&&t.moveEnd("character",c),t.select()}catch(x){}e.nodeChanged()}}}var n=e.settings,i=e.dom,o=e.selection,r=e.schema,a=r.getBlockElements();n.forced_root_block&&e.on("NodeChange",t)}}),i(I,[C,f,d],function(e,n,i){var o=i.each,r=i.extend,a=i.map,s=i.inArray,l=i.explode,u=n.gecko,c=n.ie,d=!0,h=!1;return function(n){function i(e,t,n){var i;return e=e.toLowerCase(),(i=S.exec[e])?(i(e,t,n),d):h}function p(e){var t;return e=e.toLowerCase(),(t=S.state[e])?t(e):-1}function f(e){var t;return e=e.toLowerCase(),(t=S.value[e])?t(e):h}function m(e,t){t=t||"exec",o(e,function(e,n){o(n.toLowerCase().split(","),function(n){S[t][n]=e})})}function g(e,i,o){return i===t&&(i=h),o===t&&(o=null),n.getDoc().execCommand(e,i,o)}function v(e){return E.match(e)}function y(e,i){E.toggle(e,i?{value:i}:t),n.nodeChanged()}function b(e){x=C.getBookmark(e)}function w(){C.moveToBookmark(x)}var x,_=n.dom,C=n.selection,S={state:{},exec:{},value:{}},T=n.settings,E=n.formatter;r(this,{execCommand:i,queryCommandState:p,queryCommandValue:f,addCommands:m}),m({"mceResetDesignMode,mceBeginUndoLevel":function(){},"mceEndUndoLevel,mceAddUndoLevel":function(){n.undoManager.add()},"Cut,Copy,Paste":function(e){var t,i=n.getDoc();try{g(e)}catch(o){t=d}(t||!i.queryCommandSupported(e))&&n.windowManager.alert("Your browser doesn't support direct access to the clipboard. Please use the Ctrl+X/C/V keyboard shortcuts instead.")},unlink:function(e){C.isCollapsed()&&C.select(C.getNode()),g(e),C.collapse(h)},"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull":function(e){var t=e.substring(7);"full"==t&&(t="justify"),o("left,center,right,justify".split(","),function(e){t!=e&&E.remove("align"+e)}),y("align"+t),i("mceRepaint")},"InsertUnorderedList,InsertOrderedList":function(e){var t,n;g(e),t=_.getParent(C.getNode(),"ol,ul"),t&&(n=t.parentNode,/^(H[1-6]|P|ADDRESS|PRE)$/.test(n.nodeName)&&(b(),_.split(n,t),w()))},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(e){y(e)},"ForeColor,HiliteColor,FontName":function(e,t,n){y(e,n)},FontSize:function(e,t,n){var i,o;n>=1&&7>=n&&(o=l(T.font_size_style_values),i=l(T.font_size_classes),n=i?i[n-1]||n:o[n-1]||n),y(e,n)},RemoveFormat:function(e){E.remove(e)},mceBlockQuote:function(){y("blockquote")},FormatBlock:function(e,t,n){return y(n||"p")},mceCleanup:function(){var e=C.getBookmark();n.setContent(n.getContent({cleanup:d}),{cleanup:d}),C.moveToBookmark(e)},mceRemoveNode:function(e,t,i){var o=i||C.getNode();o!=n.getBody()&&(b(),n.dom.remove(o,d),w())},mceSelectNodeDepth:function(e,t,i){var o=0;_.getParent(C.getNode(),function(e){return 1==e.nodeType&&o++==i?(C.select(e),h):void 0},n.getBody())},mceSelectNode:function(e,t,n){C.select(n)},mceInsertContent:function(t,i,o){function r(e){function t(e){return i[e]&&3==i[e].nodeType}var n,i,o;return n=C.getRng(!0),i=n.startContainer,o=n.startOffset,3==i.nodeType&&(o>0?e=e.replace(/^&nbsp;/," "):t("previousSibling")||(e=e.replace(/^ /,"&nbsp;")),i.length>o?e=e.replace(/&nbsp;(<br>|)$/," "):t("nextSibling")||(e=e.replace(/(&nbsp;| )(<br>|)$/,"&nbsp;"))),e}var a,s,l,u,d,h,p,f,m,g,v,y,b,w;if(/^ | $/.test(o)&&(o=r(o)),a=n.parser,s=new e({},n.schema),b='<span id="mce_marker" data-mce-type="bookmark">&#xFEFF;</span>',h={content:o,format:"html",selection:!0},n.fire("BeforeSetContent",h),o=h.content,-1==o.indexOf("{$caret}")&&(o+="{$caret}"),o=o.replace(/\{\$caret\}/,b),C.isCollapsed()||n.getDoc().execCommand("Delete",!1,null),l=C.getNode(),h={context:l.nodeName.toLowerCase()},d=a.parse(o,h),v=d.lastChild,"mce_marker"==v.attr("id"))for(p=v,v=v.prev;v;v=v.walk(!0))if(3==v.type||!_.isBlock(v.name)){v.parent.insert(p,v,"br"===v.name);break}if(h.invalid){for(C.setContent(b),l=C.getNode(),u=n.getBody(),9==l.nodeType?l=v=u:v=l;v!==u;)l=v,v=v.parentNode;o=l==u?u.innerHTML:_.getOuterHTML(l),o=s.serialize(a.parse(o.replace(/<span (id="mce_marker"|id=mce_marker).+?<\/span>/i,function(){return s.serialize(d)}))),l==u?_.setHTML(u,o):_.setOuterHTML(l,o)}else o=s.serialize(d),v=l.firstChild,y=l.lastChild,!v||v===y&&"BR"===v.nodeName?_.setHTML(l,o):C.setContent(o);p=_.get("mce_marker"),f=_.getRect(p),m=_.getViewPort(n.getWin()),(f.y+f.h>m.y+m.h||f.y<m.y||f.x>m.x+m.w||f.x<m.x)&&(w=c?n.getDoc().documentElement:n.getBody(),w.scrollLeft=f.x,w.scrollTop=f.y-m.h+25),g=_.createRng(),v=p.previousSibling,v&&3==v.nodeType?(g.setStart(v,v.nodeValue.length),c||(y=p.nextSibling,y&&3==y.nodeType&&(v.appendData(y.data),y.parentNode.removeChild(y)))):(g.setStartBefore(p),g.setEndBefore(p)),_.remove(p),C.setRng(g),n.fire("SetContent",h),n.addVisual()},mceInsertRawHTML:function(e,t,i){C.setContent("tiny_mce_marker"),n.setContent(n.getContent().replace(/tiny_mce_marker/g,function(){return i}))},mceToggleFormat:function(e,t,n){y(n)},mceSetContent:function(e,t,i){n.setContent(i)},"Indent,Outdent":function(e){var t,n,i;t=T.indentation,n=/[a-z%]+$/i.exec(t),t=parseInt(t,10),p("InsertUnorderedList")||p("InsertOrderedList")?g(e):(T.forced_root_block||_.getParent(C.getNode(),_.isBlock)||E.apply("div"),o(C.getSelectedBlocks(),function(o){var r;"LI"!=o.nodeName&&(r="rtl"==_.getStyle(o,"direction",!0)?"paddingRight":"paddingLeft","outdent"==e?(i=Math.max(0,parseInt(o.style[r]||0,10)-t),_.setStyle(o,r,i?i+n:"")):(i=parseInt(o.style[r]||0,10)+t+n,_.setStyle(o,r,i)))}))},mceRepaint:function(){if(u)try{b(d),C.getSel()&&C.getSel().selectAllChildren(n.getBody()),C.collapse(d),w()}catch(e){}},InsertHorizontalRule:function(){n.execCommand("mceInsertContent",!1,"<hr />")},mceToggleVisualAid:function(){n.hasVisual=!n.hasVisual,n.addVisual()},mceReplaceContent:function(e,t,i){n.execCommand("mceInsertContent",!1,i.replace(/\{\$selection\}/g,C.getContent({format:"text"})))},mceInsertLink:function(e,t,n){var i;"string"==typeof n&&(n={href:n}),i=_.getParent(C.getNode(),"a"),n.href=n.href.replace(" ","%20"),i&&n.href||E.remove("link"),n.href&&E.apply("link",n,i)},selectAll:function(){var e=_.getRoot(),t=_.createRng();C.getRng().setStart?(t.setStart(e,0),t.setEnd(e,e.childNodes.length),C.setRng(t)):g("SelectAll")},mceNewDocument:function(){n.setContent("")}}),m({"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull":function(e){var t="align"+e.substring(7),n=C.isCollapsed()?[_.getParent(C.getNode(),_.isBlock)]:C.getSelectedBlocks(),i=a(n,function(e){return!!E.matchNode(e,t)});return-1!==s(i,d)},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(e){return v(e)},mceBlockQuote:function(){return v("blockquote")},Outdent:function(){var e;if(T.inline_styles){if((e=_.getParent(C.getStart(),_.isBlock))&&parseInt(e.style.paddingLeft,10)>0)return d;if((e=_.getParent(C.getEnd(),_.isBlock))&&parseInt(e.style.paddingLeft,10)>0)return d}return p("InsertUnorderedList")||p("InsertOrderedList")||!T.inline_styles&&!!_.getParent(C.getNode(),"BLOCKQUOTE")},"InsertUnorderedList,InsertOrderedList":function(e){var t=_.getParent(C.getNode(),"ul,ol");return t&&("insertunorderedlist"===e&&"UL"===t.tagName||"insertorderedlist"===e&&"OL"===t.tagName)}},"state"),m({"FontSize,FontName":function(e){var t,n=0;return(t=_.getParent(C.getNode(),"span"))&&(n="fontsize"==e?t.style.fontSize:t.style.fontFamily.replace(/, /g,",").replace(/[\'\"]/g,"").toLowerCase()),n}},"value"),m({Undo:function(){n.undoManager.undo()},Redo:function(){n.undoManager.redo()}})}}),i(D,[d],function(e){function t(e,o){var r,a,s=this;return e=i(e),o=s.settings=o||{},/^([\w\-]+):([^\/]{2})/i.test(e)||/^\s*#/.test(e)?(s.source=e,void 0):(0===e.indexOf("/")&&0!==e.indexOf("//")&&(e=(o.base_uri?o.base_uri.protocol||"http":"http")+"://mce_host"+e),/^[\w\-]*:?\/\//.test(e)||(a=o.base_uri?o.base_uri.path:new t(location.href).directory,e=(o.base_uri&&o.base_uri.protocol||"http")+"://mce_host"+s.toAbsPath(a,e)),e=e.replace(/@@/g,"(mce_at)"),e=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(e),n(["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],function(t,n){var i=e[n];i&&(i=i.replace(/\(mce_at\)/g,"@@")),s[t]=i}),r=o.base_uri,r&&(s.protocol||(s.protocol=r.protocol),s.userInfo||(s.userInfo=r.userInfo),s.port||"mce_host"!==s.host||(s.port=r.port),s.host&&"mce_host"!==s.host||(s.host=r.host),s.source=""),void 0)}var n=e.each,i=e.trim;return t.prototype={setPath:function(e){var t=this;e=/^(.*?)\/?(\w+)?$/.exec(e),t.path=e[0],t.directory=e[1],t.file=e[2],t.source="",t.getURI()},toRelative:function(e){var n,i=this;if("./"===e)return e;if(e=new t(e,{base_uri:i}),"mce_host"!=e.host&&i.host!=e.host&&e.host||i.port!=e.port||i.protocol!=e.protocol)return e.getURI();var o=i.getURI(),r=e.getURI();return o==r||"/"==o.charAt(o.length-1)&&o.substr(0,o.length-1)==r?o:(n=i.toRelPath(i.path,e.path),e.query&&(n+="?"+e.query),e.anchor&&(n+="#"+e.anchor),n)},toAbsolute:function(e,n){return e=new t(e,{base_uri:this}),e.getURI(this.host==e.host&&this.protocol==e.protocol?n:0)},toRelPath:function(e,t){var n,i,o,r=0,a="";if(e=e.substring(0,e.lastIndexOf("/")),e=e.split("/"),n=t.split("/"),e.length>=n.length)for(i=0,o=e.length;o>i;i++)if(i>=n.length||e[i]!=n[i]){r=i+1;break}if(e.length<n.length)for(i=0,o=n.length;o>i;i++)if(i>=e.length||e[i]!=n[i]){r=i+1;break}if(1===r)return t;for(i=0,o=e.length-(r-1);o>i;i++)a+="../";for(i=r-1,o=n.length;o>i;i++)a+=i!=r-1?"/"+n[i]:n[i];return a},toAbsPath:function(e,t){var i,o,r,a=0,s=[];for(o=/\/$/.test(t)?"/":"",e=e.split("/"),t=t.split("/"),n(e,function(e){e&&s.push(e)}),e=s,i=t.length-1,s=[];i>=0;i--)0!==t[i].length&&"."!==t[i]&&(".."!==t[i]?a>0?a--:s.push(t[i]):a++);return i=e.length-a,r=0>=i?s.reverse().join("/"):e.slice(0,i).join("/")+"/"+s.reverse().join("/"),0!==r.indexOf("/")&&(r="/"+r),o&&r.lastIndexOf("/")!==r.length-1&&(r+=o),r},getURI:function(e){var t,n=this;return(!n.source||e)&&(t="",e||(n.protocol&&(t+=n.protocol+"://"),n.userInfo&&(t+=n.userInfo+"@"),n.host&&(t+=n.host),n.port&&(t+=":"+n.port)),n.path&&(t+=n.path),n.query&&(t+="?"+n.query),n.anchor&&(t+="#"+n.anchor),n.source=t),n.source}},t}),i(H,[d],function(e){function t(){}var n,i,o=e.each,r=e.extend;return t.extend=n=function(e){function t(){var e,t,n,o;if(!i&&(o=this,o.init&&o.init.apply(o,arguments),t=o.Mixins))for(e=t.length;e--;)n=t[e],n.init&&n.init.apply(o,arguments)}function a(){return this}function s(e,t){return function(){var n,i=this,o=i._super;return i._super=h[e],n=t.apply(i,arguments),i._super=o,n}}var l,u,c,d=this,h=d.prototype;i=!0,l=new d,i=!1,e.Mixins&&(o(e.Mixins,function(t){t=t;for(var n in t)"init"!==n&&(e[n]=t[n])}),h.Mixins&&(e.Mixins=h.Mixins.concat(e.Mixins))),e.Methods&&o(e.Methods.split(","),function(t){e[t]=a}),e.Properties&&o(e.Properties.split(","),function(t){var n="_"+t;e[t]=function(e){var t,i=this;return e!==t?(i[n]=e,i):i[n]}}),e.Statics&&o(e.Statics,function(e,n){t[n]=e}),e.Defaults&&h.Defaults&&(e.Defaults=r({},h.Defaults,e.Defaults));for(u in e)c=e[u],l[u]="function"==typeof c&&h[u]?s(u,c):c;return t.prototype=l,t.constructor=t,t.extend=n,t},t}),i(L,[H,d],function(e,t){function n(e){for(var t,n=[],i=e.length;i--;)t=e[i],t.__checked||(n.push(t),t.__checked=1);for(i=n.length;i--;)delete n[i].__checked;return n}var i,o=/^([\w\\*]+)?(?:#([\w\\]+))?(?:\.([\w\\\.]+))?(?:\[\@?([\w\\]+)([\^\$\*!~]?=)([\w\\]+)\])?(?:\:(.+))?/i,r=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,a=/^\s*|\s*$/g,s=e.extend({init:function(e){function t(e){return e?(e=e.toLowerCase(),function(t){return"*"===e||t.type===e}):void 0}function n(e){return e?function(t){return t._name===e}:void 0}function i(e){return e?(e=e.split("."),function(t){for(var n=e.length;n--;)if(!t.hasClass(e[n]))return!1;return!0}):void 0}function s(e,t,n){return e?function(i){var o=i[e]?i[e]():"";return t?"="===t?o===n:"*="===t?o.indexOf(n)>=0:"~="===t?(" "+o+" ").indexOf(" "+n+" ")>=0:"!="===t?o!=n:"^="===t?0===o.indexOf(n):"$="===t?o.substr(o.length-n.length)===n:!1:!!n}:void 0}function l(e){var t;return e?(e=/(?:not\((.+)\))|(.+)/i.exec(e),e[1]?(t=c(e[1],[]),function(e){return!d(e,t)}):(e=e[2],function(t,n,i){return"first"===e?0===n:"last"===e?n===i-1:"even"===e?0===n%2:"odd"===e?1===n%2:t[e]?t[e]():!1})):void 0}function u(e,r,u){function c(e){e&&r.push(e)}var d;return d=o.exec(e.replace(a,"")),c(t(d[1])),c(n(d[2])),c(i(d[3])),c(s(d[4],d[5],d[6])),c(l(d[7])),r.psuedo=!!d[7],r.direct=u,r}function c(e,t){var n,i,o,a=[];do if(r.exec(""),i=r.exec(e),i&&(e=i[3],a.push(i[1]),i[2])){n=i[3];break}while(i);for(n&&c(n,t),e=[],o=0;a.length>o;o++)">"!=a[o]&&e.push(u(a[o],[],">"===a[o-1]));return t.push(e),t}var d=this.match;this._selectors=c(e,[])},match:function(e,n){var i,o,r,a,s,l,u,c,d,h,p,f,m;for(n=n||this._selectors,i=0,o=n.length;o>i;i++){for(s=n[i],a=s.length,m=e,f=0,r=a-1;r>=0;r--)for(c=s[r];m;){for(c.psuedo&&(p=m.parent().items(),d=t.inArray(m,p),h=p.length),l=0,u=c.length;u>l;l++)if(!c[l](m,d,h)){l=u+1;break}if(l===u){f++;break}if(r===a-1)break;m=m.parent()}if(f===a)return!0}return!1},find:function(e){function t(e,n,i){var o,r,s,l,u,c=n[i];for(o=0,r=e.length;r>o;o++){for(u=e[o],s=0,l=c.length;l>s;s++)if(!c[s](u,o,r)){s=l+1;break}if(s===l)i==n.length-1?a.push(u):u.items&&t(u.items(),n,i+1);else if(c.direct)return;u.items&&t(u.items(),n,i)}}var o,r,a=[],l=this._selectors;if(e.items){for(o=0,r=l.length;r>o;o++)t(e.items(),l[o],0);r>1&&(a=n(a))}return i||(i=s.Collection),new i(a)}});return s}),i(z,[d,L,H],function(e,t,n){var i,o,r=Array.prototype.push,a=Array.prototype.slice;return o={length:0,init:function(e){e&&this.add(e)},add:function(t){var n=this;return e.isArray(t)?r.apply(n,t):t instanceof i?n.add(t.toArray()):r.call(n,t),n},set:function(e){var t,n=this,i=n.length;for(n.length=0,n.add(e),t=n.length;i>t;t++)delete n[t];return n},filter:function(e){var n,o,r,a,s=this,l=[];for("string"==typeof e?(e=new t(e),a=function(t){return e.match(t)}):a=e,n=0,o=s.length;o>n;n++)r=s[n],a(r)&&l.push(r);return new i(l)},slice:function(){return new i(a.apply(this,arguments))},eq:function(e){return-1===e?this.slice(e):this.slice(e,+e+1)},each:function(t){return e.each(this,t),this},toArray:function(){return e.toArray(this)},indexOf:function(e){for(var t=this,n=t.length;n--&&t[n]!==e;);return n},reverse:function(){return new i(e.toArray(this).reverse())},hasClass:function(e){return this[0]?this[0].hasClass(e):!1},prop:function(e,t){var n,i,o=this;return t!==n?(o.each(function(n){n[e]&&n[e](t)}),o):(i=o[0],i&&i[e]?i[e]():void 0)},exec:function(t){var n=this,i=e.toArray(arguments).slice(1);return n.each(function(e){e[t]&&e[t].apply(e,i)}),n},remove:function(){for(var e=this.length;e--;)this[e].remove();return this}},e.each("fire on off show hide addClass removeClass append prepend before after reflow".split(" "),function(t){o[t]=function(){var n=e.toArray(arguments);return this.each(function(e){t in e&&e[t].apply(e,n)}),this}}),e.each("text name disabled active selected checked visible parent value data".split(" "),function(e){o[e]=function(t){return this.prop(e,t)
}}),i=n.extend(o),t.Collection=i,i}),i(B,[d,m],function(e,t){return{id:function(){return t.DOM.uniqueId()},createFragment:function(e){return t.DOM.createFragment(e)},getWindowSize:function(){return t.DOM.getViewPort()},getSize:function(e){return t.DOM.getSize(e)},getPos:function(e,n){return t.DOM.getPos(e,n)},getViewPort:function(e){return t.DOM.getViewPort(e)},get:function(e){return document.getElementById(e)},addClass:function(e,n){return t.DOM.addClass(e,n)},removeClass:function(e,n){return t.DOM.removeClass(e,n)},hasClass:function(e,n){return t.DOM.hasClass(e,n)},toggleClass:function(e,n,i){return t.DOM.toggleClass(e,n,i)},css:function(e,n,i){return t.DOM.setStyle(e,n,i)},on:function(e,n,i,o){return t.DOM.bind(e,n,i,o)},off:function(e,n,i){return t.DOM.unbind(e,n,i)},fire:function(e,n,i){return t.DOM.fire(e,n,i)},innerHtml:function(e,n){t.DOM.setHTML(e,n)}}}),i(F,[H,d,z,B],function(e,t,n,i){var o=t.makeMap("focusin focusout scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave wheel keydown keypress keyup contextmenu"," "),r={},a="onmousewheel"in document,s=!1,l=e.extend({Statics:{controlIdLookup:{}},classPrefix:"mce-",init:function(e){var n,o,r=this;if(r.settings=e=t.extend({},r.Defaults,e),r._id=i.id(),r._text=r._name="",r._width=r._height=0,r._aria={role:e.role},n=e.classes)for(n=n.split(" "),n.map={},o=n.length;o--;)n.map[n[o]]=!0;r._classes=n||[],r.visible(!0),t.each("title text width height name classes visible disabled active value".split(" "),function(t){var n,i=e[t];i!==n?r[t](i):r["_"+t]===n&&(r["_"+t]=!1)}),r.on("click",function(){return r.disabled()?!1:void 0}),e.classes&&t.each(e.classes.split(" "),function(e){r.addClass(e)}),r.settings=e,r._borderBox=r.parseBox(e.border),r._paddingBox=r.parseBox(e.padding),r._marginBox=r.parseBox(e.margin),e.hidden&&r.hide()},Properties:"parent,title,text,width,height,disabled,active,name,value",Methods:"renderHtml",getContainerElm:function(){return document.body},getParentCtrl:function(e){for(var t;e&&!(t=l.controlIdLookup[e.id]);)e=e.parentNode;return t},parseBox:function(e){var t,n=10;return e?"number"==typeof e?(e=e||0,{top:e,left:e,bottom:e,right:e}):(e=e.split(" "),t=e.length,1===t?e[1]=e[2]=e[3]=e[0]:2===t?(e[2]=e[0],e[3]=e[1]):3===t&&(e[3]=e[1]),{top:parseInt(e[0],n)||0,right:parseInt(e[1],n)||0,bottom:parseInt(e[2],n)||0,left:parseInt(e[3],n)||0}):void 0},borderBox:function(){return this._borderBox},paddingBox:function(){return this._paddingBox},marginBox:function(){return this._marginBox},measureBox:function(e,t){function n(t){var n=document.defaultView;return n?(t=t.replace(/[A-Z]/g,function(e){return"-"+e}),n.getComputedStyle(e,null).getPropertyValue(t)):e.currentStyle[t]}function i(e){var t=parseInt(n(e),10);return isNaN(t)?0:t}return{top:i(t+"TopWidth"),right:i(t+"RightWidth"),bottom:i(t+"BottomWidth"),left:i(t+"LeftWidth")}},initLayoutRect:function(){var e,t,n,i,o,r,a,s,l,u=this,c=u.settings,d=u.getEl();e=u._borderBox=u._borderBox||u.measureBox(d,"border"),u._paddingBox=u._paddingBox||u.measureBox(d,"padding"),u._marginBox=u._marginBox||u.measureBox(d,"margin"),s=c.minWidth,l=c.minHeight,o=s||d.offsetWidth,r=l||d.offsetHeight,n=c.width,i=c.height,a=c.autoResize,a=a!==void 0?a:!n&&!i,n=n||o,i=i||r;var h=e.left+e.right,p=e.top+e.bottom,f=c.maxWidth||65535,m=c.maxHeight||65535;return u._layoutRect=t={x:c.x||0,y:c.y||0,w:n,h:i,deltaW:h,deltaH:p,contentW:n-h,contentH:i-p,innerW:n-h,innerH:i-p,startMinWidth:s||0,startMinHeight:l||0,minW:Math.min(o,f),minH:Math.min(r,m),maxW:f,maxH:m,autoResize:a,scrollW:0},u._lastLayoutRect={},t},layoutRect:function(e){var t,n,i,o,r,a,s=this,u=s._layoutRect;return u||(u=s.initLayoutRect()),e?(i=u.deltaW,o=u.deltaH,e.x!==r&&(u.x=e.x),e.y!==r&&(u.y=e.y),e.minW!==r&&(u.minW=e.minW),e.minH!==r&&(u.minH=e.minH),n=e.w,n!==r&&(n=u.minW>n?u.minW:n,n=n>u.maxW?u.maxW:n,u.w=n,u.innerW=n-i),n=e.h,n!==r&&(n=u.minH>n?u.minH:n,n=n>u.maxH?u.maxH:n,u.h=n,u.innerH=n-o),n=e.innerW,n!==r&&(n=u.minW-i>n?u.minW-i:n,n=n>u.maxW-i?u.maxW-i:n,u.innerW=n,u.w=n+i),n=e.innerH,n!==r&&(n=u.minH-o>n?u.minH-o:n,n=n>u.maxH-o?u.maxH-o:n,u.innerH=n,u.h=n+o),e.contentW!==r&&(u.contentW=e.contentW),e.contentH!==r&&(u.contentH=e.contentH),t=s._lastLayoutRect,(t.x!==u.x||t.y!==u.y||t.w!==u.w||t.h!==u.h)&&(a=l.repaintControls,a&&a.map&&!a.map[s._id]&&(a.push(s),a.map[s._id]=!0),t.x=u.x,t.y=u.y,t.w=u.w,t.h=u.h),s):u},repaint:function(){var e,t,n,i,o,r=this,a=0,s=0;e=r.getEl().style,n=r._layoutRect,o=r._lastRepaintRect||{},i=r._borderBox,a=i.left+i.right,s=i.top+i.bottom,n.x!==o.x&&(e.left=n.x+"px",o.x=n.x),n.y!==o.y&&(e.top=n.y+"px",o.y=n.y),n.w!==o.w&&(e.width=n.w-a+"px",o.w=n.w),n.h!==o.h&&(e.height=n.h-s+"px",o.h=n.h),r._hasBody&&n.innerW!==o.innerW&&(t=r.getEl("body").style,t.width=n.innerW+"px",o.innerW=n.innerW),r._hasBody&&n.innerH!==o.innerH&&(t=t||r.getEl("body").style,t.height=n.innerH+"px",o.innerH=n.innerH),r._lastRepaintRect=o,r.fire("repaint",{},!1)},on:function(e,t){function n(e){var t,n;return function(i){return t||l.parents().each(function(i){var o=i.settings.callbacks;return o&&(t=o[e])?(n=i,!1):void 0}),t.call(n,i)}}var i,r,a,s,l=this;if(t)for("string"==typeof t&&(t=n(t)),a=e.toLowerCase().split(" "),s=a.length;s--;)e=a[s],i=l._bindings,i||(i=l._bindings={}),r=i[e],r||(r=i[e]=[]),r.push(t),o[e]&&(l._nativeEvents?l._nativeEvents[e]=!0:l._nativeEvents={name:!0},l._rendered&&l.bindPendingEvents());return l},off:function(e,t){var n,i,o,r,a,s=this,l=s._bindings;if(l)if(e)for(r=e.toLowerCase().split(" "),n=r.length;n--;){if(e=r[n],i=l[e],!e){for(o in l)l[o].length=0;return s}if(i)if(t)for(a=i.length;a--;)i[a]===t&&i.splice(a,1);else i.length=0}else s._bindings=[];return s},fire:function(e,t,n){function i(){return!1}function o(){return!0}var r,a,s,l,u=this;if(e=e.toLowerCase(),t=t||{},t.type||(t.type=e),t.control||(t.control=u),t.preventDefault||(t.preventDefault=function(){t.isDefaultPrevented=o},t.stopPropagation=function(){t.isPropagationStopped=o},t.stopImmediatePropagation=function(){t.isImmediatePropagationStopped=o},t.isDefaultPrevented=i,t.isPropagationStopped=i,t.isImmediatePropagationStopped=i),u._bindings&&(s=u._bindings[e]))for(r=0,a=s.length;a>r&&(t.isImmediatePropagationStopped()||s[r].call(u,t)!==!1);r++);if(n!==!1)for(l=u.parent();l&&!t.isPropagationStopped();)l.fire(e,t,!1),l=l.parent();return t},parents:function(e){var t=this,i=new n;for(t=t.parent();t;t=t.parent())i.add(t);return e&&(i=i.filter(e)),i},next:function(){var e=this.parent().items();return e[e.indexOf(this)+1]},prev:function(){var e=this.parent().items();return e[e.indexOf(this)-1]},findCommonAncestor:function(e,t){for(var n;e;){for(n=t;n&&e!=n;)n=n.parent();if(e==n)break;e=e.parent()}return e},hasClass:function(e,t){var n=this._classes[t||"control"];return e=this.classPrefix+e,n&&!!n.map[e]},addClass:function(e,t){var n,i,o=this;return e=this.classPrefix+e,n=o._classes[t||"control"],n||(n=[],n.map={},o._classes[t||"control"]=n),n.map[e]||(n.map[e]=e,n.push(e),o._rendered&&(i=o.getEl(t),i&&(i.className=n.join(" ")))),o},removeClass:function(e,t){var n,i,o,r=this;if(e=this.classPrefix+e,n=r._classes[t||"control"],n&&n.map[e])for(delete n.map[e],i=n.length;i--;)n[i]===e&&n.splice(i,1);return r._rendered&&(o=r.getEl(t),o&&(o.className=n.join(" "))),r},toggleClass:function(e,t,n){var i=this;return t?i.addClass(e,n):i.removeClass(e,n),i},classes:function(e){var t=this._classes[e||"control"];return t?t.join(" "):""},innerHtml:function(e){return i.innerHtml(this.getEl(),e),this},getEl:function(e,t){var n,o=e?this._id+"-"+e:this._id;return n=r[o]=(t===!0?null:r[o])||i.get(o)},visible:function(e){var t,n=this;return e!==void 0?(n._visible!==e&&(n._rendered&&(n.getEl().style.display=e?"":"none"),n._visible=e,t=n.parent(),t&&(t._lastRect=null),n.fire(e?"show":"hide")),n):n._visible},show:function(){return this.visible(!0)},hide:function(){return this.visible(!1)},focus:function(){try{this.getEl().focus()}catch(e){}return this},blur:function(){return this.getEl().blur(),this},aria:function(e,t){var n=this,i=n.getEl();return t===void 0?n._aria[e]:(n._aria[e]=t,n._rendered&&("label"==e&&i.setAttribute("aria-labeledby",n._id),i.setAttribute("role"==e?e:"aria-"+e,t)),n)},encode:function(e,t){return t!==!1&&l.translate&&(e=l.translate(e)),(e||"").replace(/[&<>"]/g,function(e){return"&#"+e.charCodeAt(0)+";"})},before:function(e){var t=this,n=t.parent();return n&&n.insert(e,n.items().indexOf(t),!0),t},after:function(e){var t=this,n=t.parent();return n&&n.insert(e,n.items().indexOf(t)),t},remove:function(){var e,t=this,n=t.getEl(),o=t.parent();if(t.items)for(var r=t.items().toArray(),a=r.length;a--;)r[a].remove();return o&&o.items&&(e=[],o.items().each(function(n){n!==t&&e.push(n)}),o.items().set(e),o._lastRect=null),t._eventsRoot&&t._eventsRoot==t&&i.off(n),delete l.controlIdLookup[t._id],n.parentNode&&n.parentNode.removeChild(n),t},renderBefore:function(e){var t=this;return e.parentNode.insertBefore(i.createFragment(t.renderHtml()),e),t.postRender(),t},renderTo:function(e){var t=this;return e=e||t.getContainerElm(),e.appendChild(i.createFragment(t.renderHtml())),t.postRender(),t},postRender:function(){var e,t,n,o,r,a=this,s=a.settings;for(o in s)0===o.indexOf("on")&&a.on(o.substr(2),s[o]);if(a._eventsRoot){for(n=a.parent();!r&&n;n=n.parent())r=n._eventsRoot;if(r)for(o in r._nativeEvents)a._nativeEvents[o]=!0}a.bindPendingEvents(),s.style&&(e=a.getEl(),e&&(e.setAttribute("style",s.style),e.style.cssText=s.style)),a._visible||i.css(a.getEl(),"display","none"),a.settings.border&&(t=a.borderBox(),i.css(a.getEl(),{"border-top-width":t.top,"border-right-width":t.right,"border-bottom-width":t.bottom,"border-left-width":t.left})),l.controlIdLookup[a._id]=a;for(var u in a._aria)a.aria(u,a._aria[u]);a.fire("postrender",{},!1)},scrollIntoView:function(e){function t(e,t){var n,i,o=e;for(n=i=0;o&&o!=t&&o.nodeType;)n+=o.offsetLeft||0,i+=o.offsetTop||0,o=o.offsetParent;return{x:n,y:i}}var n,i,o,r,a,s,l=this.getEl(),u=l.parentNode,c=t(l,u);return n=c.x,i=c.y,o=l.offsetWidth,r=l.offsetHeight,a=u.clientWidth,s=u.clientHeight,"end"==e?(n-=a-o,i-=s-r):"center"==e&&(n-=a/2-o/2,i-=s/2-r/2),u.scrollLeft=n,u.scrollTop=i,this},bindPendingEvents:function(){function e(e){var t=p.getParentCtrl(e.target);t&&t.fire(e.type,e)}function t(){var e=c._lastHoverCtrl;e&&(e.fire("mouseleave",{target:e.getEl()}),e.parents().each(function(e){e.fire("mouseleave",{target:e.getEl()})}),c._lastHoverCtrl=null)}function n(e){var t,n,i,o=p.getParentCtrl(e.target),r=c._lastHoverCtrl,a=0;if(o!==r){if(c._lastHoverCtrl=o,n=o.parents().toArray().reverse(),n.push(o),r){for(i=r.parents().toArray().reverse(),i.push(r),a=0;i.length>a&&n[a]===i[a];a++);for(t=i.length-1;t>=a;t--)r=i[t],r.fire("mouseleave",{target:r.getEl()})}for(t=a;n.length>t;t++)o=n[t],o.fire("mouseenter",{target:o.getEl()})}}function o(e){e.preventDefault(),"mousewheel"==e.type?(e.deltaY=-1/40*e.wheelDelta,e.wheelDeltaX&&(e.deltaX=-1/40*e.wheelDeltaX)):(e.deltaX=0,e.deltaY=e.detail),e=p.fire("wheel",e)}var r,l,u,c,d,h,p=this;if(p._rendered=!0,d=p._nativeEvents){for(u=p.parents().toArray(),u.unshift(p),r=0,l=u.length;!c&&l>r;r++)c=u[r]._eventsRoot;for(c||(c=u[u.length-1]||p),p._eventsRoot=c,l=r,r=0;l>r;r++)u[r]._eventsRoot=c;for(h in d){if(!d)return!1;"wheel"!==h||s?("mouseenter"===h||"mouseleave"===h?c._hasMouseEnter||(i.on(c.getEl(),"mouseleave",t),i.on(c.getEl(),"mouseover",n),c._hasMouseEnter=1):c[h]||(i.on(c.getEl(),h,e),c[h]=!0),d[h]=!1):a?i.on(p.getEl(),"mousewheel",o):i.on(p.getEl(),"DOMMouseScroll",o)}}},reflow:function(){return this.repaint(),this}});return l}),i(j,[],function(){var e,t={};return{add:function(e,n){t[e.toLowerCase()]=n},has:function(e){return!!t[e.toLowerCase()]},create:function(n,i){var o,r,a;if(!e){a=tinymce.ui;for(r in a)t[r.toLowerCase()]=a[r];e=!0}if("string"==typeof n?(i=i||{},i.type=n):(i=n,n=i.type),n=n.toLowerCase(),o=t[n],!o)throw Error("Could not find control by type: "+n);return o=new o(i),o.type=n,o}}}),i(U,[F,z,L,j,d,B],function(e,t,n,i,o,r){var a={};return e.extend({layout:"",innerClass:"container-inner",init:function(e){var n=this;n._super(e),e=n.settings,n._fixed=e.fixed,n._items=new t,n.addClass("container"),n.addClass("container-body","body"),e.containerCls&&n.addClass(e.containerCls),n._layout=i.create((e.layout||n.layout)+"layout"),n.settings.items&&n.add(n.settings.items),n._hasBody=!0},items:function(){return this._items},find:function(e){return e=a[e]=a[e]||new n(e),e.find(this)},add:function(e){var t=this;return t.items().add(t.create(e)).parent(t),t},focus:function(){var e=this;return e.keyNav?e.keyNav.focusFirst():e._super(),e},replace:function(e,t){for(var n,i=this.items(),o=i.length;o--;)if(i[o]===e){i[o]=t;break}o>=0&&(n=t.getEl(),n&&n.parentNode.removeChild(n),n=e.getEl(),n&&n.parentNode.removeChild(n)),t.parent(this)},create:function(t){var n,r=this,a=[];return o.isArray(t)||(t=[t]),o.each(t,function(t){t&&(t instanceof e||("string"==typeof t&&(t={type:t}),n=o.extend({},r.settings.defaults,t),t.type=n.type=n.type||t.type||r.settings.defaultType||(n.defaults?n.defaults.type:null),t=i.create(n)),a.push(t))}),a},renderNew:function(){var e=this;return e.items().each(function(t,n){var i,o;t.parent(e),t._rendered||(i=e.getEl("body"),o=r.createFragment(t.renderHtml()),i.hasChildNodes()&&i.childNodes.length-1>=n?i.insertBefore(o,i.childNodes[n]):i.appendChild(o),t.postRender())}),e._layout.applyClasses(e),e._lastRect=null,e},append:function(e){return this.add(e).renderNew()},prepend:function(e){var t=this;return t.items().set(t.create(e).concat(t.items().toArray())),t.renderNew()},insert:function(e,t,n){var i,o,r,a=this;return e=a.create(e),i=a.items(),!n&&i.length-1>t&&(t+=1),t>=0&&i.length>t&&(o=i.slice(0,t).toArray(),r=i.slice(t).toArray(),i.set(o.concat(e,r))),a.renderNew()},fromJSON:function(e){var t=this;for(var n in e)t.find("#"+n).value(e[n]);return t},toJSON:function(){var e=this,t={};return e.find("*").each(function(e){var n=e.name(),i=e.value();n&&i!==void 0&&(t[n]=i)}),t},preRender:function(){},renderHtml:function(){var e=this,t=e._layout;return e.preRender(),t.preRender(e),'<div id="'+e._id+'" class="'+e.classes()+'" role="'+this.settings.role+'">'+'<div id="'+e._id+'-body" class="'+e.classes("body")+'">'+(e.settings.html||"")+t.renderHtml(e)+"</div>"+"</div>"},postRender:function(){var e,t=this;return t.items().exec("postRender"),t._super(),t._layout.postRender(t),t._rendered=!0,t.settings.style&&r.css(t.getEl(),t.settings.style),t.settings.border&&(e=t.borderBox(),r.css(t.getEl(),{"border-top-width":e.top,"border-right-width":e.right,"border-bottom-width":e.bottom,"border-left-width":e.left})),t},initLayoutRect:function(){var e=this,t=e._super();return e._layout.recalc(e),t},recalc:function(){var e=this,t=e._layoutRect,n=e._lastRect;return n&&n.w==t.w&&n.h==t.h?void 0:(e._layout.recalc(e),t=e.layoutRect(),e._lastRect={x:t.x,y:t.y,w:t.w,h:t.h},!0)},reflow:function(){var t,n;if(this.visible()){for(e.repaintControls=[],e.repaintControls.map={},n=this.recalc(),t=e.repaintControls.length;t--;)e.repaintControls[t].repaint();"flow"!==this.settings.layout&&"stack"!==this.settings.layout&&this.repaint(),e.repaintControls=[]}return this}})}),i(W,[B],function(e){function t(){var e,t,n,i,o,r,a,s,l=document,u=Math.max;return e=l.documentElement,t=l.body,n=u(e.scrollWidth,t.scrollWidth),i=u(e.clientWidth,t.clientWidth),o=u(e.offsetWidth,t.offsetWidth),r=u(e.scrollHeight,t.scrollHeight),a=u(e.clientHeight,t.clientHeight),s=u(e.offsetHeight,t.offsetHeight),{width:o>n?i:n,height:s>r?a:r}}return function(n,i){function o(){return h.getElementById(i.handle||n)}var r,a,s,l,u,c,d,h=document;i=i||{},s=function(n){var s,p,f=t();n.preventDefault(),a=n.button,s=o(),c=n.screenX,d=n.screenY,p=window.getComputedStyle?window.getComputedStyle(s,null).getPropertyValue("cursor"):s.runtimeStyle.cursor,r=h.createElement("div"),e.css(r,{position:"absolute",top:0,left:0,width:f.width,height:f.height,zIndex:2147483647,opacity:1e-4,background:"red",cursor:p}),h.body.appendChild(r),e.on(h,"mousemove",u),e.on(h,"mouseup",l),i.start(n)},u=function(e){return e.button!==a?l(e):(e.deltaX=e.screenX-c,e.deltaY=e.screenY-d,e.preventDefault(),i.drag(e),void 0)},l=function(t){e.off(h,"mousemove",u),e.off(h,"mouseup",l),r.parentNode.removeChild(r),i.stop&&i.stop(t)},this.destroy=function(){e.off(o())},e.on(o(),"mousedown",s)}}),i(V,[B,W],function(e,t){return{init:function(){var e=this;e.on("repaint",e.renderScroll)},renderScroll:function(){function n(){function t(t,a,s,l,u,c){var d,h,p,f,m,g,v,y,b;if(h=o.getEl("scroll"+t)){if(y=a.toLowerCase(),b=s.toLowerCase(),o.getEl("absend")&&e.css(o.getEl("absend"),y,o.layoutRect()[l]-1),!u)return e.css(h,"display","none"),void 0;e.css(h,"display","block"),d=o.getEl("body"),p=o.getEl("scroll"+t+"t"),f=d["client"+s]-2*r,f-=n&&i?h["client"+c]:0,m=d["scroll"+s],g=f/m,v={},v[y]=d["offset"+a]+r,v[b]=f,e.css(h,v),v={},v[y]=d["scroll"+a]*g,v[b]=f*g,e.css(p,v)}}var n,i,a;a=o.getEl("body"),n=a.scrollWidth>a.clientWidth,i=a.scrollHeight>a.clientHeight,t("h","Left","Width","contentW",n,"Height"),t("v","Top","Height","contentH",i,"Width")}function i(){function n(n,i,a,s,l){var u,c=o._id+"-scroll"+n,d=o.classPrefix;o.getEl().appendChild(e.createFragment('<div id="'+c+'" class="'+d+"scrollbar "+d+"scrollbar-"+n+'">'+'<div id="'+c+'t" class="'+d+'scrollbar-thumb"></div>'+"</div>")),o.draghelper=new t(c+"t",{start:function(){u=o.getEl("body")["scroll"+i],e.addClass(e.get(c),d+"active")},drag:function(e){var t,c,d,h,p=o.layoutRect();c=p.contentW>p.innerW,d=p.contentH>p.innerH,h=o.getEl("body")["client"+a]-2*r,h-=c&&d?o.getEl("scroll"+n)["client"+l]:0,t=h/o.getEl("body")["scroll"+a],o.getEl("body")["scroll"+i]=u+e["delta"+s]/t},stop:function(){e.removeClass(e.get(c),d+"active")}})}o.addClass("scroll"),n("v","Top","Height","Y","Width"),n("h","Left","Width","X","Height")}var o=this,r=2;o.settings.autoScroll&&(o._hasScroll||(o._hasScroll=!0,i(),o.on("wheel",function(e){var t=o.getEl("body");t.scrollLeft+=10*(e.deltaX||0),t.scrollTop+=10*e.deltaY,n()}),e.on(o.getEl("body"),"scroll",n)),n())}}}),i($,[U,V],function(e,t){return e.extend({Defaults:{layout:"fit",containerCls:"panel"},Mixins:[t],renderHtml:function(){var e=this,t=e._layout,n=e.settings.html;return e.preRender(),t.preRender(e),n===void 0?n='<div id="'+e._id+'-body" class="'+e.classes("body")+'">'+t.renderHtml(e)+"</div>":("function"==typeof n&&(n=n.call(e)),e._hasBody=!1),'<div id="'+e._id+'" class="'+e.classes()+'" hideFocus="1" tabIndex="-1">'+(e._preBodyHtml||"")+n+"</div>"}})}),i(q,[B],function(e){function t(t,n,i){var o,r,a,s,l,u,c,d,h;return h=e.getViewPort(),r=e.getPos(n),a=r.x,s=r.y,t._fixed&&(a-=h.x,s-=h.y),o=t.getEl(),l=o.offsetWidth,u=o.offsetHeight,c=n.offsetWidth,d=n.offsetHeight,i=(i||"").split(""),"b"===i[0]&&(s+=d),"r"===i[1]&&(a+=c),"c"===i[0]&&(s+=Math.round(d/2)),"c"===i[1]&&(a+=Math.round(c/2)),"b"===i[3]&&(s-=u),"r"===i[4]&&(a-=l),"c"===i[3]&&(s-=Math.round(u/2)),"c"===i[4]&&(a-=Math.round(l/2)),{x:a,y:s,w:l,h:u}}return{testMoveRel:function(n,i){for(var o=e.getViewPort(),r=0;i.length>r;r++){var a=t(this,n,i[r]);if(this._fixed){if(a.x>0&&a.x+a.w<o.w&&a.y>0&&a.y+a.h<o.h)return i[r]}else if(a.x>o.x&&a.x+a.w<o.w+o.x&&a.y>o.y&&a.y+a.h<o.h+o.y)return i[r]}return i[0]},moveRel:function(e,n){"string"!=typeof n&&(n=this.testMoveRel(e,n));var i=t(this,e,n);return this.moveTo(i.x,i.y)},moveBy:function(e,t){var n=this,i=n.layoutRect();return n.moveTo(i.x+e,i.y+t),n},moveTo:function(t,n){function i(e,t,n){return 0>e?0:e+n>t?(e=t-n,0>e?0:e):e}var o=this;if(o.settings.constrainToViewport){var r=e.getViewPort(window),a=o.layoutRect();t=i(t,r.w+r.x,a.w),n=i(n,r.h+r.y,a.h)}return o._rendered?o.layoutRect({x:t,y:n}).repaint():(o.settings.x=t,o.settings.y=n),o.fire("move",{x:t,y:n}),o}}}),i(Q,[B],function(e){return{resizeToContent:function(){this._layoutRect.autoResize=!0,this._lastRect=null,this.reflow()},resizeTo:function(t,n){if(1>=t||1>=n){var i=e.getWindowSize();t=1>=t?t*i.w:t,n=1>=n?n*i.h:n}return this._layoutRect.autoResize=!1,this.layoutRect({minW:t,minH:n,w:t,h:n}).reflow()},resizeBy:function(e,t){var n=this,i=n.layoutRect();return n.resizeTo(i.w+e,i.h+t)}}}),i(G,[$,q,Q,B],function(e,t,n,i){function o(e){var t;for(t=l.length;t--;)l[t]===e&&l.splice(t,1)}var r,a,s,l=[],u=[],c=e.extend({Mixins:[t,n],init:function(e){function t(){var e,t,n=c.zIndex||65535;if(u.length)for(e=0;u.length>e;e++)u[e].modal&&(n++,t=u[e]),u[e].getEl().style.zIndex=n,u[e].zIndex=n,n++;var o=document.getElementById(d.classPrefix+"modal-block");t?i.css(o,"z-index",t.zIndex-1):o&&(o.parentNode.removeChild(o),s=!1),c.currentZIndex=n}function n(e,t){for(;e;){if(e==t)return!0;e=e.parent()}}function o(e){function t(t,n){for(var i,o=0;l.length>o;o++)if(l[o]!=e)for(i=l[o].parent();i&&(i=i.parent());)i==e&&l[o].fixed(t).moveBy(0,n).repaint()}var n=i.getViewPort().y;e.settings.autofix&&(e._fixed?e._autoFixY>n&&(e.fixed(!1).layoutRect({y:e._autoFixY}).repaint(),t(!1,e._autoFixY-n)):(e._autoFixY=e.layoutRect().y,n>e._autoFixY&&(e.fixed(!0).layoutRect({y:0}).repaint(),t(!0,n-e._autoFixY))))}var d=this;d._super(e),d._eventsRoot=d,d.addClass("floatpanel"),e.autohide&&(r||(r=function(e){var t,i=d.getParentCtrl(e.target);for(t=l.length;t--;){var o=l[t];if(o.settings.autohide){if(i&&(n(i,o)||o.parent()===i))continue;e=o.fire("autohide",{target:e.target}),e.isDefaultPrevented()||o.hide()}}},i.on(document,"click",r)),l.push(d)),e.autofix&&(a||(a=function(){var e;for(e=l.length;e--;)o(l[e])},i.on(window,"scroll",a)),d.on("move",function(){o(this)})),d.on("postrender show",function(e){if(e.control==d){var n,o=d.classPrefix;d.modal&&!s&&(n=i.createFragment('<div id="'+o+'modal-block" class="'+o+"reset "+o+'fade"></div>'),n=n.firstChild,d.getContainerElm().appendChild(n),setTimeout(function(){i.addClass(n,o+"in"),i.addClass(d.getEl(),o+"in")},0),s=!0),u.push(d),t()}}),d.on("close hide",function(e){if(e.control==d){for(var n=u.length;n--;)u[n]===d&&u.splice(n,1);t()}}),d.on("show",function(){d.parents().each(function(e){return e._fixed?(d.fixed(!0),!1):void 0})}),e.popover&&(d._preBodyHtml='<div class="'+d.classPrefix+'arrow"></div>',d.addClass("popover").addClass("bottom").addClass("start"))},fixed:function(e){var t=this;if(t._fixed!=e){if(t._rendered){var n=i.getViewPort();e?t.layoutRect().y-=n.y:t.layoutRect().y+=n.y}t.toggleClass("fixed",e),t._fixed=e}return t},show:function(){var e,t=this,n=t._super();for(e=l.length;e--&&l[e]!==t;);return-1===e&&l.push(t),n},hide:function(){return o(this),this._super()},hideAll:function(){c.hideAll()},close:function(){var e=this;return e.fire("close"),e.remove()},remove:function(){o(this),this._super()}});return c.hideAll=function(){for(var e=l.length;e--;){var t=l[e];t.settings.autohide&&(t.fire("cancel",{},!1),t.hide(),l.splice(e,1))}},c}),i(X,[B],function(e){return function(t){function n(){if(!m)if(m=[],h.find)h.find("*").each(function(e){e.canFocus&&m.push(e.getEl())});else for(var e=h.getEl().getElementsByTagName("*"),t=0;e.length>t;t++)e[t].id&&e[t]&&m.push(e[t])}function i(){return document.getElementById(d)}function o(e){return e=e||i(),e&&e.getAttribute("role")}function r(e){for(var t,n=e||i();n=n.parentNode;)if(t=o(n))return t}function a(e){var t=document.getElementById(d);return t?t.getAttribute("aria-"+e):void 0}function s(){var n=i();return!n||"TEXTAREA"!=n.nodeName&&"text"!=n.type?(t.onAction?t.onAction(d):e.fire(i(),"click",{keyboard:!0}),!0):void 0}function l(){var e;t.onCancel?((e=i())&&e.blur(),t.onCancel()):t.root.fire("cancel")}function u(e){function i(e){for(var t=h?h.getEl():document.body;e&&e!=t;){if("none"==e.style.display)return!1;e=e.parentNode}return!0}var o,r,a=-1,l=[];for(n(),r=l.length,r=0;m.length>r;r++)i(m[r])&&l.push(m[r]);for(r=l.length;r--;)if(l[r].id===d){a=r;break}a+=e,0>a?a=l.length-1:a>=l.length&&(a=0),o=l[a],o.focus(),d=o.id,t.actOnFocus&&s()}function c(){var e,i;for(i=o(t.root.getEl()),n(),e=m.length;e--;)if("toolbar"==i&&m[e].id===d)return m[e].focus(),void 0;m[0].focus()}var d,h=t.root,p=t.enableUpDown!==!1,f=t.enableLeftRight!==!1,m=t.items;return h.on("keydown",function(e){var n,i=37,c=39,d=38,h=40,m=27,g=14,v=13,y=32,b=9;switch(e.keyCode){case i:f&&(t.leftAction?t.leftAction():u(-1),n=!0);break;case c:f&&("menuitem"==o()&&"menu"==r()?a("haspopup")&&s():u(1),n=!0);break;case d:p&&(u(-1),n=!0);break;case h:p&&("menuitem"==o()&&"menubar"==r()?s():"button"==o()&&a("haspopup")?s():u(1),n=!0);break;case b:n=!0,e.shiftKey?u(-1):u(1);break;case m:n=!0,l();break;case g:case v:case y:n=s()}n&&(e.stopPropagation(),e.preventDefault())}),h.on("focusin",function(e){n(),d=e.target.id}),{moveFocus:u,focusFirst:c,cancel:l}}}),i(Y,[G,$,B,X,W],function(e,t,n,i,o){var r=e.extend({modal:!0,Defaults:{border:1,layout:"flex",containerCls:"panel",role:"dialog",callbacks:{submit:function(){this.fire("submit",{data:this.toJSON()})},close:function(){this.close()}}},init:function(e){var n=this;n._super(e),n.addClass("window"),n._fixed=!0,e.buttons&&(n.statusbar=new t({layout:"flex",border:"1 0 0 0",spacing:3,padding:10,align:"center",pack:"end",defaults:{type:"button"},items:e.buttons}),n.statusbar.addClass("foot"),n.statusbar.parent(n)),n.on("click",function(e){-1!=e.target.className.indexOf(n.classPrefix+"close")&&n.close()}),n.aria("label",e.title),n._fullscreen=!1},recalc:function(){var e,t,i,o=this,r=o.statusbar;o._fullscreen&&(o.layoutRect(n.getWindowSize()),o.layoutRect().contentH=o.layoutRect().innerH),o._super(),e=o.layoutRect(),o.settings.title&&!o._fullscreen&&(t=e.headerW,t>e.w&&(o.layoutRect({w:t}),i=!0)),r&&(r.layoutRect({w:o.layoutRect().innerW}).recalc(),t=r.layoutRect().minW+e.deltaW,t>e.w&&(o.layoutRect({w:t}),i=!0)),i&&o.recalc()},initLayoutRect:function(){var e,t=this,i=t._super(),o=0;t.settings.title&&!t._fullscreen&&(e=t.getEl("head"),i.headerW=e.offsetWidth,i.headerH=e.offsetHeight,o+=i.headerH),t.statusbar&&(o+=t.statusbar.layoutRect().h),i.deltaH+=o,i.minH+=o,i.h+=o;var r=n.getWindowSize();return i.x=Math.max(0,r.w/2-i.w/2),i.y=Math.max(0,r.h/2-i.h/2),i},renderHtml:function(){var e=this,t=e._layout,n=e._id,i=e.classPrefix,o=e.settings,r="",a="",s=o.html;return e.preRender(),t.preRender(e),o.title&&(r='<div id="'+n+'-head" class="'+i+'window-head">'+'<div class="'+i+'title">'+e.encode(o.title)+"</div>"+'<button type="button" class="'+i+'close" aria-hidden="true">&times;</button>'+'<div id="'+n+'-dragh" class="'+i+'dragh"></div>'+"</div>"),o.url&&(s='<iframe src="'+o.url+'" tabindex="-1"></iframe>'),s===void 0&&(s=t.renderHtml(e)),e.statusbar&&(a=e.statusbar.renderHtml()),'<div id="'+n+'" class="'+e.classes()+'" hideFocus="1" tabIndex="-1">'+r+'<div id="'+n+'-body" class="'+e.classes("body")+'">'+s+"</div>"+a+"</div>"},fullscreen:function(e){var t,i,o=this,r=document.documentElement,a=o.classPrefix;if(e!=o._fullscreen)if(n.on(window,"resize",function(){var e;if(o._fullscreen)if(t)o._timer||(o._timer=setTimeout(function(){var e=n.getWindowSize();o.moveTo(0,0).resizeTo(e.w,e.h),o._timer=0},50));else{e=(new Date).getTime();var i=n.getWindowSize();o.moveTo(0,0).resizeTo(i.w,i.h),(new Date).getTime()-e>50&&(t=!0)}}),i=o.layoutRect(),o._fullscreen=e,e){o._initial={x:i.x,y:i.y,w:i.w,h:i.h},o._borderBox=o.parseBox("0"),o.getEl("head").style.display="none",i.deltaH-=i.headerH+2,n.addClass(r,a+"fullscreen"),n.addClass(document.body,a+"fullscreen"),o.addClass("fullscreen");var s=n.getWindowSize();o.moveTo(0,0).resizeTo(s.w,s.h)}else o._borderBox=o.parseBox(o.settings.border),o.getEl("head").style.display="",i.deltaH+=i.headerH,n.removeClass(r,a+"fullscreen"),n.removeClass(document.body,a+"fullscreen"),o.removeClass("fullscreen"),o.moveTo(o._initial.x,o._initial.y).resizeTo(o._initial.w,o._initial.h);return o.reflow()},postRender:function(){var e,t,n,r=this,a=[];setTimeout(function(){r.addClass("in")},0),r.keyboardNavigation=new i({root:r,enableLeftRight:!1,enableUpDown:!1,items:a,onCancel:function(){r.close()}}),r.find("*").each(function(n){n.canFocus&&(t=t||n.settings.autofocus,e=e||n,"filepicker"==n.type?(a.push(n.getEl("inp")),n.getEl("open")&&a.push(n.getEl("open").firstChild)):a.push(n.getEl()))}),r.statusbar&&r.statusbar.find("*").each(function(n){n.canFocus&&(t=t||n.settings.autofocus,e=e||n,a.push(n.getEl()))}),r._super(),r.statusbar&&r.statusbar.postRender(),!t&&e&&e.focus(),this.dragHelper=new o(r._id+"-dragh",{start:function(){n={x:r.layoutRect().x,y:r.layoutRect().y}},drag:function(e){r.moveTo(n.x+e.deltaX,n.y+e.deltaY)}}),r.on("submit",function(e){e.isDefaultPrevented()||r.close()})},submit:function(){var e=this.getParentCtrl(document.activeElement);return e&&e.blur(),this.fire("submit",{data:this.toJSON()})},remove:function(){var e=this;e._super(),e.dragHelper.destroy(),e.statusbar&&this.statusbar.remove()}});return r}),i(Z,[Y],function(e){var t=e.extend({init:function(e){e={border:1,padding:20,layout:"flex",pack:"center",align:"center",containerCls:"panel",autoScroll:!0,buttons:{type:"button",text:"Ok",action:"ok"},items:{type:"label",multiline:!0,maxWidth:500,maxHeight:200}},this._super(e)},Statics:{OK:1,OK_CANCEL:2,YES_NO:3,YES_NO_CANCEL:4,msgBox:function(n){var i,o=n.callback||function(){};switch(n.buttons){case t.OK_CANCEL:i=[{type:"button",text:"Ok",subtype:"primary",onClick:function(e){e.control.parents()[1].close(),o(!0)}},{type:"button",text:"Cancel",onClick:function(e){e.control.parents()[1].close(),o(!1)}}];break;case t.YES_NO:i=[{type:"button",text:"Ok",subtype:"primary",onClick:function(e){e.control.parents()[1].close(),o(!0)}}];break;case t.YES_NO_CANCEL:i=[{type:"button",text:"Ok",subtype:"primary",onClick:function(e){e.control.parents()[1].close()}}];break;default:i=[{type:"button",text:"Ok",subtype:"primary",onClick:function(e){e.control.parents()[1].close()}}]}return new e({padding:20,x:n.x,y:n.y,minWidth:300,minHeight:100,layout:"flex",pack:"center",align:"center",buttons:i,title:n.title,items:{type:"label",multiline:!0,maxWidth:500,maxHeight:200,text:n.text},onClose:n.onClose}).renderTo(document.body).reflow()},alert:function(e,n){return"string"==typeof e&&(e={text:e}),e.callback=n,t.msgBox(e)},confirm:function(e,n){return"string"==typeof e&&(e={text:e}),e.callback=n,e.buttons=t.OK_CANCEL,t.msgBox(e)}}});return t}),i(K,[Y,Z],function(e,t){return function(n){var i=this,o=[];i.windows=o,i.open=function(t,i){var r;return t.url=t.url||t.file,t.url&&(t.width=parseInt(t.width||320,10),t.height=parseInt(t.height||240,10)),t.body&&(t.items={defaults:t.defaults,type:t.bodyType||"form",items:t.body}),t.url||t.buttons||(t.buttons=[{text:"Ok",subtype:"primary",onclick:function(){r.find("form")[0].submit(),r.close()}},{text:"Cancel",onclick:function(){r.close()}}]),r=new e(t),o.push(r),r.on("close",function(){for(var e=o.length;e--;)o[e]===r&&o.splice(e,1);n.focus()}),t.data&&r.on("postRender",function(){this.find("*").each(function(e){var n=e.name();n in t.data&&e.value(t.data[n])})}),r.params=i||{},n.nodeChanged(),r.renderTo(document.body).reflow()},i.alert=function(e,n,i){t.alert(e,function(){n.call(i||this)})},i.confirm=function(e,n,i){t.confirm(e,function(e){n.call(i||this,e)})},i.close=function(){o.length&&o[o.length-1].close()},i.getParams=function(){return o.length?o[o.length-1].params:null},i.setParams=function(e){o.length&&(o[o.length-1].params=e)}}}),i(J,[E,A,y,p,f,d],function(e,t,n,i,o,r){return function(a){function s(e,t){try{a.getDoc().execCommand(e,!1,t)}catch(n){}}function l(){var e=a.getDoc().documentMode;return e?e:6}function u(e){return e.isDefaultPrevented()}function c(){function t(e){function t(){if(3==l.nodeType){if(e&&u==l.length)return!0;if(!e&&0===u)return!0}}var n,i,o,s,l,u,c;n=F.getRng();var d=[n.startContainer,n.startOffset,n.endContainer,n.endOffset];if(n.collapsed||(e=!0),l=n[(e?"start":"end")+"Container"],u=n[(e?"start":"end")+"Offset"],3==l.nodeType&&(i=B.getParent(n.startContainer,B.isBlock),e&&(i=B.getNext(i,B.isBlock)),!i||!t()&&n.collapsed||(o=B.create("em",{id:"__mceDel"}),H(r.grep(i.childNodes),function(e){o.appendChild(e)}),i.appendChild(o))),n=B.createRng(),n.setStart(d[0],d[1]),n.setEnd(d[2],d[3]),F.setRng(n),a.getDoc().execCommand(e?"ForwardDelete":"Delete",!1,null),o){for(s=F.getBookmark();c=B.get("__mceDel");)B.remove(c,!0);
F.moveToBookmark(s)}}a.on("keydown",function(n){var i;i=n.keyCode==z,u(n)||!i&&n.keyCode!=L||e.modifierPressed(n)||(n.preventDefault(),t(i))}),a.addCommand("Delete",function(){t()})}function d(){function e(e){var t=B.create("body"),n=e.cloneContents();return t.appendChild(n),F.serializer.serialize(t,{format:"html"})}function t(t){var n=e(t),i=B.createRng();i.selectNode(a.getBody());var o=e(i);return n===o}a.on("keydown",function(e){var n,i=e.keyCode;if(!u(e)&&(i==z||i==L)){if(n=a.selection.isCollapsed(),n&&!B.isEmpty(a.getBody()))return;if($&&!n)return;if(!n&&!t(a.selection.getRng()))return;e.preventDefault(),a.setContent(""),a.selection.setCursorLocation(a.getBody(),0),a.nodeChanged()}})}function h(){a.on("keydown",function(t){!u(t)&&65==t.keyCode&&e.metaKeyPressed(t)&&(t.preventDefault(),a.execCommand("SelectAll"))})}function p(){a.settings.content_editable||(B.bind(a.getDoc(),"focusin",function(){F.setRng(F.getRng())}),B.bind(a.getDoc(),"mousedown",function(e){e.target==a.getDoc().documentElement&&(a.getWin().focus(),F.setRng(F.getRng()))}))}function f(){a.on("keydown",function(e){if(!u(e)&&e.keyCode===L&&F.isCollapsed()&&0===F.getRng(!0).startOffset){var t=F.getNode(),n=t.previousSibling;n&&n.nodeName&&"hr"===n.nodeName.toLowerCase()&&(B.remove(n),e.preventDefault())}})}function m(){window.Range.prototype.getClientRects||a.on("mousedown",function(e){if(!u(e)&&"HTML"===e.target.nodeName){var t=a.getBody();t.blur(),setTimeout(function(){t.focus()},0)}})}function g(){a.on("click",function(e){e=e.target,/^(IMG|HR)$/.test(e.nodeName)&&F.getSel().setBaseAndExtent(e,0,e,1),"A"==e.nodeName&&B.hasClass(e,"mce-item-anchor")&&F.select(e),a.nodeChanged()})}function v(){function e(){var e=B.getAttribs(F.getStart().cloneNode(!1));return function(){var t=F.getStart();t!==a.getBody()&&(B.setAttrib(t,"style",null),H(e,function(e){t.setAttributeNode(e.cloneNode(!0))}))}}function t(){return!F.isCollapsed()&&B.getParent(F.getStart(),B.isBlock)!=B.getParent(F.getEnd(),B.isBlock)}a.on("keypress",function(n){var i;return u(n)||8!=n.keyCode&&46!=n.keyCode||!t()?void 0:(i=e(),a.getDoc().execCommand("delete",!1,null),i(),n.preventDefault(),!1)}),B.bind(a.getDoc(),"cut",function(n){var i;!u(n)&&t()&&(i=e(),setTimeout(function(){i()},0))})}function y(){var e,n;a.on("selectionchange",function(){n&&(clearTimeout(n),n=0),n=window.setTimeout(function(){var n=F.getRng();e&&t.compareRanges(n,e)||(a.nodeChanged(),e=n)},50)})}function b(){document.body.setAttribute("role","application")}function w(){a.on("keydown",function(e){if(!u(e)&&e.keyCode===L&&F.isCollapsed()&&0===F.getRng(!0).startOffset){var t=F.getNode().previousSibling;if(t&&t.nodeName&&"table"===t.nodeName.toLowerCase())return e.preventDefault(),!1}})}function x(){l()>7||(s("RespectVisibilityInDesign",!0),a.contentStyles.push(".mceHideBrInPre pre br {display: none}"),B.addClass(a.getBody(),"mceHideBrInPre"),U.addNodeFilter("pre",function(e){for(var t,i,o,r,a=e.length;a--;)for(t=e[a].getAll("br"),i=t.length;i--;)o=t[i],r=o.prev,r&&3===r.type&&"\n"!=r.value.charAt(r.value-1)?r.value+="\n":o.parent.insert(new n("#text",3),o,!0).value="\n"}),W.addNodeFilter("pre",function(e){for(var t,n,i,o,r=e.length;r--;)for(t=e[r].getAll("br"),n=t.length;n--;)i=t[n],o=i.prev,o&&3==o.type&&(o.value=o.value.replace(/\r?\n$/,""))}))}function _(){B.bind(a.getBody(),"mouseup",function(){var e,t=F.getNode();"IMG"==t.nodeName&&((e=B.getStyle(t,"width"))&&(B.setAttrib(t,"width",e.replace(/[^0-9%]+/g,"")),B.setStyle(t,"width","")),(e=B.getStyle(t,"height"))&&(B.setAttrib(t,"height",e.replace(/[^0-9%]+/g,"")),B.setStyle(t,"height","")))})}function C(){a.on("keydown",function(t){var n,i,o,r,s,l,c,d;if(n=t.keyCode==z,!u(t)&&(n||t.keyCode==L)&&!e.modifierPressed(t)&&(i=F.getRng(),o=i.startContainer,r=i.startOffset,c=i.collapsed,3==o.nodeType&&o.nodeValue.length>0&&(0===r&&!c||c&&r===(n?0:1)))){if(l=o.previousSibling,l&&"IMG"==l.nodeName)return;d=a.schema.getNonEmptyElements(),t.preventDefault(),s=B.create("br",{id:"__tmp"}),o.parentNode.insertBefore(s,o),a.getDoc().execCommand(n?"ForwardDelete":"Delete",!1,null),o=F.getRng().startContainer,l=o.previousSibling,l&&1==l.nodeType&&!B.isBlock(l)&&B.isEmpty(l)&&!d[l.nodeName.toLowerCase()]&&B.remove(l),B.remove("__tmp")}})}function S(){a.on("keydown",function(t){var n,i,o,r,s;if(!u(t)&&t.keyCode==e.BACKSPACE&&(n=F.getRng(),i=n.startContainer,o=n.startOffset,r=B.getRoot(),s=i,n.collapsed&&0===o)){for(;s&&s.parentNode&&s.parentNode.firstChild==s&&s.parentNode!=r;)s=s.parentNode;"BLOCKQUOTE"===s.tagName&&(a.formatter.toggle("blockquote",null,s),n=B.createRng(),n.setStart(i,0),n.setEnd(i,0),F.setRng(n))}})}function T(){function e(){a._refreshContentEditable(),s("StyleWithCSS",!1),s("enableInlineTableEditing",!1),j.object_resizing||s("enableObjectResizing",!1)}j.readonly||a.on("BeforeExecCommand MouseDown",e)}function E(){function e(){H(B.select("a"),function(e){var t=e.parentNode,n=B.getRoot();if(t.lastChild===e){for(;t&&!B.isBlock(t);){if(t.parentNode.lastChild!==t||t===n)return;t=t.parentNode}B.add(t,"br",{"data-mce-bogus":1})}})}a.on("SetContent ExecCommand",function(t){("setcontent"==t.type||"mceInsertLink"===t.command)&&e()})}function k(){j.forced_root_block&&a.on("init",function(){s("DefaultParagraphSeparator",j.forced_root_block)})}function N(){a.on("Undo Redo SetContent",function(e){e.initial||a.execCommand("mceRepaint")})}function A(){a.on("keydown",function(e){var t;u(e)||e.keyCode!=L||(t=a.getDoc().selection.createRange(),t&&t.item&&(e.preventDefault(),a.undoManager.beforeChange(),B.remove(t.item(0)),a.undoManager.add()))})}function M(){var e;l()>=10&&(e="",H("p div h1 h2 h3 h4 h5 h6".split(" "),function(t,n){e+=(n>0?",":"")+t+":empty"}),a.contentStyles.push(e+"{padding-right: 1px !important}"))}function P(){9>l()&&(U.addNodeFilter("noscript",function(e){for(var t,n,i=e.length;i--;)t=e[i],n=t.firstChild,n&&t.attr("data-mce-innertext",n.value)}),W.addNodeFilter("noscript",function(e){for(var t,o,r,a=e.length;a--;)t=e[a],o=e[a].firstChild,o?o.value=i.decode(o.value):(r=t.attributes.map["data-mce-innertext"],r&&(t.attr("data-mce-innertext",null),o=new n("#text",3),o.value=r,o.raw=!0,t.append(o)))}))}function R(){function e(e,t){var n=s.createTextRange();try{n.moveToPoint(e,t)}catch(i){n=null}return n}function t(t){var i;t.button?(i=e(t.x,t.y),i&&(i.compareEndPoints("StartToStart",o)>0?i.setEndPoint("StartToStart",o):i.setEndPoint("EndToEnd",o),i.select())):n()}function n(){var e=a.selection.createRange();o&&!e.item&&0===e.compareEndPoints("StartToEnd",e)&&o.select(),B.unbind(a,"mouseup",n),B.unbind(a,"mousemove",t),o=i=0}var i,o,r,a=B.doc,s=a.body;a.documentElement.unselectable=!0,B.bind(a,"mousedown contextmenu",function(s){if("HTML"===s.target.nodeName){if(i&&n(),r=a.documentElement,r.scrollHeight>r.clientHeight)return;i=1,o=e(s.x,s.y),o&&(B.bind(a,"mouseup",n),B.bind(a,"mousemove",t),B.win.focus(),o.select())}})}function O(){a.on("keyup focusin",function(t){65==t.keyCode&&e.metaKeyPressed(t)||F.normalize()})}function I(){a.contentStyles.push("img:-moz-broken {-moz-force-broken-image-icon:1;min-width:24px;min-height:24px}")}function D(){a.inline||a.on("keydown",function(){document.activeElement==document.body&&a.getWin().focus()})}var H=r.each,L=e.BACKSPACE,z=e.DELETE,B=a.dom,F=a.selection,j=a.settings,U=a.parser,W=a.serializer,V=o.gecko,$=o.ie,q=o.webkit;w(),S(),d(),O(),q&&(C(),c(),p(),g(),k(),o.iOS?(y(),D()):h()),$&&11>o.ie&&(f(),b(),x(),_(),A(),M(),P(),R()),V&&(f(),m(),v(),T(),E(),N(),I())}}),i(et,[d],function(e){function t(){return!1}function n(){return!0}var i="__bindings",o=e.makeMap("focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange mouseout mouseenter mouseleave keydown keypress keyup contextmenu dragend dragover draggesture dragdrop drop drag"," ");return{fire:function(e,o,r){var a,s,l,u,c,d=this;if(e=e.toLowerCase(),o=o||{},o.type=e,o.target||(o.target=d),o.preventDefault||(o.preventDefault=function(){o.isDefaultPrevented=n},o.stopPropagation=function(){o.isPropagationStopped=n},o.stopImmediatePropagation=function(){o.isImmediatePropagationStopped=n},o.isDefaultPrevented=t,o.isPropagationStopped=t,o.isImmediatePropagationStopped=t),d[i]&&(a=d[i][e]))for(s=0,l=a.length;l>s&&(a[s]=u=a[s],!o.isImmediatePropagationStopped());s++)if(u.call(d,o)===!1)return o.preventDefault(),o;if(r!==!1&&d.parent)for(c=d.parent();c&&!o.isPropagationStopped();)c.fire(e,o,!1),c=c.parent();return o},on:function(e,t){var n,r,a,s,l=this;if(t===!1&&(t=function(){return!1}),t)for(a=e.toLowerCase().split(" "),s=a.length;s--;)e=a[s],n=l[i],n||(n=l[i]={}),r=n[e],r||(r=n[e]=[],l.bindNative&&o[e]&&l.bindNative(e)),r.push(t);return l},off:function(e,t){var n,r,a,s,l,u=this,c=u[i];if(c)if(e)for(s=e.toLowerCase().split(" "),n=s.length;n--;){if(e=s[n],r=c[e],!e){for(a in c)c[e].length=0;return u}if(r){if(t)for(l=r.length;l--;)r[l]===t&&r.splice(l,1);else r.length=0;!r.length&&u.unbindNative&&o[e]&&(u.unbindNative(e),delete c[e])}}else{if(u.unbindNative)for(e in c)u.unbindNative(e);u[i]=[]}return u}}}),i(tt,[d,f],function(e,t){var n=e.each,i=e.explode,o={f9:120,f10:121,f11:122};return function(r){var a=this,s={};r.on("keyup keypress keydown",function(e){(e.altKey||e.ctrlKey||e.metaKey)&&n(s,function(n){var i=t.mac?e.ctrlKey||e.metaKey:e.ctrlKey;return n.ctrl==i&&n.alt==e.altKey&&n.shift==e.shiftKey?e.keyCode==n.keyCode||e.charCode&&e.charCode==n.charCode?(e.preventDefault(),"keydown"==e.type&&n.func.call(n.scope),!0):void 0:void 0})}),a.add=function(t,a,l,u){var c;return c=l,"string"==typeof l?l=function(){r.execCommand(c,!1,null)}:e.isArray(c)&&(l=function(){r.execCommand(c[0],c[1],c[2])}),n(i(t.toLowerCase()),function(e){var t={func:l,scope:u||r,desc:r.translate(a),alt:!1,ctrl:!1,shift:!1};n(i(e,"+"),function(e){switch(e){case"alt":case"ctrl":case"shift":t[e]=!0;break;default:t.charCode=e.charCodeAt(0),t.keyCode=o[e]||e.toUpperCase().charCodeAt(0)}}),s[(t.ctrl?"ctrl":"")+","+(t.alt?"alt":"")+","+(t.shift?"shift":"")+","+t.keyCode]=t}),!0}}}),i(nt,[m,v,y,S,C,N,M,P,R,O,I,D,g,u,K,b,x,J,f,d,et,tt],function(e,n,i,o,r,a,s,l,u,c,d,h,p,f,m,g,v,y,b,w,x,_){function C(e,t){return"selectionchange"==t||"drop"==t?e.getDoc():!e.inline&&/^mouse|click|contextmenu/.test(t)?e.getDoc():e.getBody()}function S(e,t,i){var o,r,a=this;o=a.documentBaseUrl=i.documentBaseURL,r=i.baseURI,a.settings=t=N({id:e,theme:"modern",delta_width:0,delta_height:0,popup_css:"",plugins:"",document_base_url:o,add_form_submit_trigger:!0,submit_patch:!0,add_unload_trigger:!0,convert_urls:!0,relative_urls:!0,remove_script_host:!0,object_resizing:!0,doctype:"<!DOCTYPE html>",visual:!0,font_size_style_values:"xx-small,x-small,small,medium,large,x-large,xx-large",font_size_legacy_values:"xx-small,small,medium,large,x-large,xx-large,300%",forced_root_block:"p",hidden_input:!0,padd_empty_editor:!0,render_ui:!0,indentation:"30px",inline_styles:!0,convert_fonts_to_spans:!0,indent:"simple",indent_before:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,ul,li,area,table,thead,tfoot,tbody,tr,section,article,hgroup,aside,figure,option,optgroup,datalist",indent_after:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,ul,li,area,table,thead,tfoot,tbody,tr,section,article,hgroup,aside,figure,option,optgroup,datalist",validate:!0,entity_encoding:"named",url_converter:a.convertURL,url_converter_scope:a,ie7_compat:!0},t),n.settings=t,n.baseURL=i.baseURL,a.id=t.id=e,a.isNotDirty=!0,a.plugins={},a.documentBaseURI=new h(t.document_base_url||o,{base_uri:r}),a.baseURI=r,a.contentCSS=[],a.contentStyles=[],a.shortcuts=new _(a),a.execCommands={},a.queryStateCommands={},a.queryValueCommands={},a.loadedCSS={},a.suffix=i.suffix,a.editorManager=i,a.inline=t.inline,a.execCallback("setup",a)}var T=e.DOM,E=n.ThemeManager,k=n.PluginManager,N=w.extend,A=w.each,M=w.explode,P=w.inArray,R=w.trim,O=w.resolve,I=f.Event,D=b.gecko,H=b.ie,L=b.opera;return S.prototype={render:function(){function e(){var e=p.ScriptLoader;n.language&&"en"!=n.language&&(n.language_url=t.editorManager.baseURL+"/langs/"+n.language+".js"),n.language_url&&e.add(n.language_url),n.theme&&"function"!=typeof n.theme&&"-"!=n.theme.charAt(0)&&!E.urls[n.theme]&&E.load(n.theme,"themes/"+n.theme+"/theme"+o+".js"),w.isArray(n.plugins)&&(n.plugins=n.plugins.join(" ")),A(n.external_plugins,function(e,t){k.load(t,e),n.plugins+=" "+t}),A(n.plugins.split(/[ ,]/),function(e){if(e=R(e),e&&!k.urls[e])if("-"==e.charAt(0)){e=e.substr(1,e.length);var t=k.dependencies(e);A(t,function(e){var t={prefix:"plugins/",resource:e,suffix:"/plugin"+o+".js"};e=k.createUrl(t,e),k.load(e.resource,e)})}else k.load(e,{prefix:"plugins/",resource:e,suffix:"/plugin"+o+".js"})}),e.loadQueue(function(){t.removed||t.init()})}var t=this,n=t.settings,i=t.id,o=t.suffix;if(!I.domLoaded)return T.bind(window,"ready",function(){t.render()}),void 0;if(t.editorManager.settings=n,t.getElement()&&b.contentEditable){n.inline?t.inline=!0:(t.orgVisibility=t.getElement().style.visibility,t.getElement().style.visibility="hidden");var r=t.getElement().form||T.getParent(i,"form");r&&(t.formElement=r,n.hidden_input&&!/TEXTAREA|INPUT/i.test(t.getElement().nodeName)&&T.insertAfter(T.create("input",{type:"hidden",name:i}),i),t.formEventDelegate=function(e){t.fire(e.type,e)},T.bind(r,"submit reset",t.formEventDelegate),t.on("reset",function(){t.setContent(t.startContent,{format:"raw"})}),!n.submit_patch||r.submit.nodeType||r.submit.length||r._mceOldSubmit||(r._mceOldSubmit=r.submit,r.submit=function(){return t.editorManager.triggerSave(),t.isNotDirty=!0,r._mceOldSubmit(r)})),t.windowManager=new m(t),"xml"==n.encoding&&t.on("GetContent",function(e){e.save&&(e.content=T.encode(e.content))}),n.add_form_submit_trigger&&t.on("submit",function(){t.initialized&&t.save()}),n.add_unload_trigger&&(t._beforeUnload=function(){!t.initialized||t.destroyed||t.isHidden()||t.save({format:"raw",no_events:!0,set_dirty:!1})},t.editorManager.on("BeforeUnload",t._beforeUnload)),e()}},init:function(){function e(t){var n,i,o=k.get(t);n=k.urls[t]||d.documentBaseUrl.replace(/\/$/,""),t=R(t),o&&-1===P(f,t)&&(A(k.dependencies(t),function(t){e(t)}),i=new o(d,n),d.plugins[t]=i,i.init&&(i.init(d,n),f.push(t)))}var t,n,i,o,r,a,s,l,u,c,d=this,h=d.settings,p=d.getElement(),f=[];if(d.editorManager.add(d),h.aria_label=h.aria_label||T.getAttrib(p,"aria-label",d.getLang("aria.rich_text_area")),h.theme&&("function"!=typeof h.theme?(h.theme=h.theme.replace(/-/,""),r=E.get(h.theme),d.theme=new r(d,E.urls[h.theme]),d.theme.init&&d.theme.init(d,E.urls[h.theme]||d.documentBaseUrl.replace(/\/$/,""))):d.theme=h.theme),A(h.plugins.replace(/\-/g,"").split(/[ ,]/),e),d.fire("BeforeRenderUI"),h.render_ui&&d.theme&&(d.orgDisplay=p.style.display,"function"!=typeof h.theme?(t=h.width||p.style.width||p.offsetWidth,n=h.height||p.style.height||p.offsetHeight,i=h.min_height||100,u=/^[0-9\.]+(|px)$/i,u.test(""+t)&&(t=Math.max(parseInt(t,10)+(r.deltaWidth||0),100)),u.test(""+n)&&(n=Math.max(parseInt(n,10)+(r.deltaHeight||0),i)),r=d.theme.renderUI({targetNode:p,width:t,height:n,deltaWidth:h.delta_width,deltaHeight:h.delta_height}),h.content_editable||(T.setStyles(r.sizeContainer||r.editorContainer,{wi2dth:t,h2eight:n}),n=(r.iframeHeight||n)+("number"==typeof n?r.deltaHeight||0:""),i>n&&(n=i))):(r=h.theme(d,p),r.editorContainer.nodeType&&(r.editorContainer=r.editorContainer.id=r.editorContainer.id||d.id+"_parent"),r.iframeContainer.nodeType&&(r.iframeContainer=r.iframeContainer.id=r.iframeContainer.id||d.id+"_iframecontainer"),n=r.iframeHeight||p.offsetHeight),d.editorContainer=r.editorContainer),h.content_css&&A(M(h.content_css),function(e){d.contentCSS.push(d.documentBaseURI.toAbsolute(e))}),h.content_style&&d.contentStyles.push(h.content_style),h.content_editable)return p=o=r=null,d.initContentBody();for(document.domain&&location.hostname!=document.domain&&(d.editorManager.relaxedDomain=document.domain),d.iframeHTML=h.doctype+"<html><head>",h.document_base_url!=d.documentBaseUrl&&(d.iframeHTML+='<base href="'+d.documentBaseURI.getURI()+'" />'),!b.caretAfter&&h.ie7_compat&&(d.iframeHTML+='<meta http-equiv="X-UA-Compatible" content="IE=7" />'),d.iframeHTML+='<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />',c=0;d.contentCSS.length>c;c++){var m=d.contentCSS[c];d.iframeHTML+='<link type="text/css" rel="stylesheet" href="'+m+'" />',d.loadedCSS[m]=!0}s=h.body_id||"tinymce",-1!=s.indexOf("=")&&(s=d.getParam("body_id","","hash"),s=s[d.id]||s),l=h.body_class||"",-1!=l.indexOf("=")&&(l=d.getParam("body_class","","hash"),l=l[d.id]||""),d.iframeHTML+='</head><body id="'+s+'" class="mce-content-body '+l+'" '+"onload=\"window.parent.tinymce.get('"+d.id+"').fire('load');\"><br></body></html>",d.editorManager.relaxedDomain&&(H||L&&11>parseFloat(window.opera.version()))&&(a='javascript:(function(){document.open();document.domain="'+document.domain+'";'+'var ed = window.parent.tinymce.get("'+d.id+'");document.write(ed.iframeHTML);'+"document.close();ed.initContentBody();})()"),o=T.add(r.iframeContainer,"iframe",{id:d.id+"_ifr",src:a||'javascript:""',frameBorder:"0",allowTransparency:"true",title:d.editorManager.translate("Rich Text Area. Press ALT-F9 for menu. Press ALT-F10 for toolbar. Press ALT-0 for help"),style:{width:"100%",height:n,display:"block"}}),d.contentAreaContainer=r.iframeContainer,r.editorContainer&&(T.get(r.editorContainer).style.display=d.orgDisplay),T.get(d.id).style.display="none",T.setAttrib(d.id,"aria-hidden",!0),d.editorManager.relaxedDomain&&a||d.initContentBody(),p=o=r=null},initContentBody:function(){var t,n,r=this,h=r.settings,p=T.get(r.id),f=r.getDoc();h.inline||(r.getElement().style.visibility=r.orgVisibility),H&&r.editorManager.relaxedDomain||h.content_editable||(f.open(),f.write(r.iframeHTML),f.close(),r.editorManager.relaxedDomain&&(f.domain=r.editorManager.relaxedDomain)),h.content_editable&&(r.on("remove",function(){var e=this.getBody();T.removeClass(e,"mce-content-body"),T.removeClass(e,"mce-edit-focus"),T.setAttrib(e,"tabIndex",null),T.setAttrib(e,"contentEditable",null)}),T.addClass(p,"mce-content-body"),p.tabIndex=-1,r.contentDocument=f=h.content_document||document,r.contentWindow=h.content_window||window,r.bodyElement=p,h.content_document=h.content_window=null,h.root_name=p.nodeName.toLowerCase()),t=r.getBody(),t.disabled=!0,h.readonly||(t.contentEditable=r.getParam("content_editable_state",!0)),t.disabled=!1,r.schema=new g(h),r.dom=new e(f,{keep_values:!0,url_converter:r.convertURL,url_converter_scope:r,hex_colors:h.force_hex_style_colors,class_filter:h.class_filter,update_styles:!0,root_element:h.content_editable?r.id:null,schema:r.schema,onSetAttrib:function(e){r.fire("SetAttrib",e)}}),r.parser=new v(h,r.schema),r.parser.addAttributeFilter("src,href,style",function(e,t){for(var n,i,o,a=e.length,s=r.dom;a--;)n=e[a],i=n.attr(t),o="data-mce-"+t,n.attributes.map[o]||("style"===t?n.attr(o,s.serializeStyle(s.parseStyle(i),n.name)):n.attr(o,r.convertURL(i,t,n.name)))}),r.parser.addNodeFilter("script",function(e){for(var t,n=e.length;n--;)t=e[n],t.attr("type","mce-"+(t.attr("type")||"text/javascript"))}),r.parser.addNodeFilter("#cdata",function(e){for(var t,n=e.length;n--;)t=e[n],t.type=8,t.name="#comment",t.value="[CDATA["+t.value+"]]"}),r.parser.addNodeFilter("p,h1,h2,h3,h4,h5,h6,div",function(e){for(var t,n=e.length,o=r.schema.getNonEmptyElements();n--;)t=e[n],t.isEmpty(o)&&(t.empty().append(new i("br",1)).shortEnded=!0)}),r.serializer=new o(h,r),r.selection=new a(r.dom,r.getWin(),r.serializer,r),r.formatter=new s(r),r.undoManager=new l(r),r.forceBlocks=new c(r),r.enterKey=new u(r),r.editorCommands=new d(r),r.fire("PreInit"),h.browser_spellcheck||h.gecko_spellcheck||(f.body.spellcheck=!1,T.setAttrib(t,"spellcheck","false")),r.fire("PostRender"),r.quirks=y(r),h.directionality&&(t.dir=h.directionality),h.nowrap&&(t.style.whiteSpace="nowrap"),h.protect&&r.on("BeforeSetContent",function(e){A(h.protect,function(t){e.content=e.content.replace(t,function(e){return"<!--mce:protected "+escape(e)+"-->"})})}),r.on("SetContent",function(){r.addVisual(r.getBody())}),h.padd_empty_editor&&r.on("PostProcess",function(e){e.content=e.content.replace(/^(<p[^>]*>(&nbsp;|&#160;|\s|\u00a0|)<\/p>[\r\n]*|<br \/>[\r\n]*)$/,"")}),r.load({initial:!0,format:"html"}),r.startContent=r.getContent({format:"raw"}),r.initialized=!0,A(r._pendingNativeEvents,function(e){r.dom.bind(C(r,e),e,function(e){r.fire(e.type,e)})}),r.fire("init"),r.focus(!0),r.nodeChanged({initial:!0}),r.execCallback("init_instance_callback",r),r.contentStyles.length>0&&(n="",A(r.contentStyles,function(e){n+=e+"\r\n"}),r.dom.addStyle(n)),A(r.contentCSS,function(e){r.loadedCSS[e]||(r.dom.loadCSS(e),r.loadedCSS[e]=!0)}),h.auto_focus&&setTimeout(function(){var e=r.editorManager.get(h.auto_focus);e.selection.select(e.getBody(),1),e.selection.collapse(1),e.getBody().focus(),e.getWin().focus()},100),p=f=t=null},focus:function(e){var t,n,i,o,r=this,a=r.selection,s=r.settings.content_editable,l=r.getDoc();e||(n=a.getRng(),n.item&&(i=n.item(0)),r._refreshContentEditable(),s||(b.opera||r.getBody().focus(),r.getWin().focus()),(D||s)&&(o=r.getBody(),o.setActive?o.setActive():o.focus(),s&&a.normalize()),i&&i.ownerDocument==l&&(n=l.body.createControlRange(),n.addElement(i),n.select())),r.editorManager.activeEditor!=r&&((t=r.editorManager.activeEditor)&&t.fire("deactivate",{relatedTarget:r}),r.fire("activate",{relatedTarget:t})),r.editorManager.activeEditor=r},execCallback:function(e){var t,n=this,i=n.settings[e];return i?(n.callbackLookup&&(t=n.callbackLookup[e])&&(i=t.func,t=t.scope),"string"==typeof i&&(t=i.replace(/\.\w+$/,""),t=t?O(t):0,i=O(i),n.callbackLookup=n.callbackLookup||{},n.callbackLookup[e]={func:i,scope:t}),i.apply(t||n,Array.prototype.slice.call(arguments,1))):void 0},translate:function(e){var t=this.settings.language||"en",n=this.editorManager.i18n;return e?n[t+"."+e]||e.replace(/\{\#([^\}]+)\}/g,function(e,i){return n[t+"."+i]||"{#"+i+"}"}):""},getLang:function(e,n){return this.editorManager.i18n[(this.settings.language||"en")+"."+e]||(n!==t?n:"{#"+e+"}")},getParam:function(e,t,n){var i,o=e in this.settings?this.settings[e]:t;return"hash"===n?(i={},"string"==typeof o?A(o.indexOf("=")>0?o.split(/[;,](?![^=;,]*(?:[;,]|$))/):o.split(","),function(e){e=e.split("="),i[R(e[0])]=e.length>1?R(e[1]):R(e)}):i=o,i):o},nodeChanged:function(){var e,t,n,i=this,o=i.selection;i.initialized&&!i.settings.disable_nodechange&&(n=i.getBody(),e=o.getStart()||n,e=H&&e.ownerDocument!=i.getDoc()?i.getBody():e,"IMG"==e.nodeName&&o.isCollapsed()&&(e=e.parentNode),t=[],i.dom.getParent(e,function(e){return e===n?!0:(t.push(e),void 0)}),i.fire("NodeChange",{element:e,parents:t}))},addButton:function(e,t){var n=this;t.cmd&&(t.onclick=function(){n.execCommand(t.cmd)}),t.text||t.icon||(t.icon=e),n.buttons=n.buttons||{},t.tooltip=t.tooltip||t.title,n.buttons[e]=t},addMenuItem:function(e,t){var n=this;t.cmd&&(t.onclick=function(){n.execCommand(t.cmd)}),n.menuItems=n.menuItems||{},n.menuItems[e]=t},addCommand:function(e,t,n){this.execCommands[e]={func:t,scope:n||this}},addQueryStateHandler:function(e,t,n){this.queryStateCommands[e]={func:t,scope:n||this}},addQueryValueHandler:function(e,t,n){this.queryValueCommands[e]={func:t,scope:n||this}},addShortcut:function(e,t,n,i){this.shortcuts.add(e,t,n,i)},execCommand:function(e,t,n,i){var o,r=this,a=0;return/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(e)||i&&i.skip_focus||r.focus(),i=N({},i),i=r.fire("BeforeExecCommand",{command:e,ui:t,value:n}),i.isDefaultPrevented()?!1:(o=r.execCommands[e])&&o.func.call(o.scope,t,n)!==!0?(r.fire("ExecCommand",{command:e,ui:t,value:n}),!0):(A(r.plugins,function(i){return i.execCommand&&i.execCommand(e,t,n)?(r.fire("ExecCommand",{command:e,ui:t,value:n}),a=!0,!1):void 0}),a?a:r.theme&&r.theme.execCommand&&r.theme.execCommand(e,t,n)?(r.fire("ExecCommand",{command:e,ui:t,value:n}),!0):r.editorCommands.execCommand(e,t,n)?(r.fire("ExecCommand",{command:e,ui:t,value:n}),!0):(r.getDoc().execCommand(e,t,n),r.fire("ExecCommand",{command:e,ui:t,value:n}),void 0))},queryCommandState:function(e){var t,n,i=this;if(!i._isHidden()){if((t=i.queryStateCommands[e])&&(n=t.func.call(t.scope),n!==!0))return n;if(n=i.editorCommands.queryCommandState(e),-1!==n)return n;try{return i.getDoc().queryCommandState(e)}catch(o){}}},queryCommandValue:function(e){var n,i,o=this;if(!o._isHidden()){if((n=o.queryValueCommands[e])&&(i=n.func.call(n.scope),i!==!0))return i;if(i=o.editorCommands.queryCommandValue(e),i!==t)return i;try{return o.getDoc().queryCommandValue(e)}catch(r){}}},show:function(){var e=this;T.show(e.getContainer()),T.hide(e.id),e.load(),e.fire("show")},hide:function(){var e=this,t=e.getDoc();H&&t&&t.execCommand("SelectAll"),e.save(),T.hide(e.getContainer()),T.setStyle(e.id,"display",e.orgDisplay),e.fire("hide")},isHidden:function(){return!T.isHidden(this.id)},setProgressState:function(e,t){this.fire("ProgressState",{state:e,time:t})},load:function(e){var n,i=this,o=i.getElement();return o?(e=e||{},e.load=!0,n=i.setContent(o.value!==t?o.value:o.innerHTML,e),e.element=o,e.no_events||i.fire("LoadContent",e),e.element=o=null,n):void 0},save:function(e){var t,n,i=this,o=i.getElement();return o&&i.initialized?(e=e||{},e.save=!0,e.element=o,t=e.content=i.getContent(e),e.no_events||i.fire("SaveContent",e),t=e.content,/TEXTAREA|INPUT/i.test(o.nodeName)?o.value=t:(o.innerHTML=t,(n=T.getParent(i.id,"form"))&&A(n.elements,function(e){return e.name==i.id?(e.value=t,!1):void 0})),e.element=o=null,e.set_dirty!==!1&&(i.isNotDirty=!0),t):void 0},setContent:function(e,t){var n,i=this,o=i.getBody();return t=t||{},t.format=t.format||"html",t.set=!0,t.content=e,t.no_events||i.fire("BeforeSetContent",t),e=t.content,0===e.length||/^\s+$/.test(e)?(n=i.settings.forced_root_block,n&&i.schema.isValidChild(o.nodeName.toLowerCase(),n.toLowerCase())?e=H&&11>H?"<"+n+"></"+n+">":"<"+n+'><br data-mce-bogus="1"></'+n+">":H||(e='<br data-mce-bogus="1">'),o.innerHTML=e,i.fire("SetContent",t)):("raw"!==t.format&&(e=new r({},i.schema).serialize(i.parser.parse(e,{isRootContent:!0}))),t.content=R(e),i.dom.setHTML(o,t.content),t.no_events||i.fire("SetContent",t)),t.initial||(i.selection.select(o,!0),i.selection.collapse(!0)),t.content},getContent:function(e){var t,n=this,i=n.getBody();return e=e||{},e.format=e.format||"html",e.get=!0,e.getInner=!0,e.no_events||n.fire("BeforeGetContent",e),t="raw"==e.format?i.innerHTML:"text"==e.format?i.innerText||i.textContent:n.serializer.serialize(i,e),e.content="text"!=e.format?R(t):t,e.no_events||n.fire("GetContent",e),e.content},insertContent:function(e){this.execCommand("mceInsertContent",!1,e)},isDirty:function(){return!this.isNotDirty},getContainer:function(){var e=this;return e.container||(e.container=T.get(e.editorContainer||e.id+"_parent")),e.container},getContentAreaContainer:function(){return this.contentAreaContainer},getElement:function(){return T.get(this.settings.content_element||this.id)},getWin:function(){var e,t=this;return t.contentWindow||(e=T.get(t.id+"_ifr"),e&&(t.contentWindow=e.contentWindow)),t.contentWindow},getDoc:function(){var e,t=this;return t.contentDocument||(e=t.getWin(),e&&(t.contentDocument=e.document)),t.contentDocument},getBody:function(){return this.bodyElement||this.getDoc().body},convertURL:function(e,t,n){var i=this,o=i.settings;return o.urlconverter_callback?i.execCallback("urlconverter_callback",e,n,!0,t):!o.convert_urls||n&&"LINK"==n.nodeName||0===e.indexOf("file:")||0===e.length?e:o.relative_urls?i.documentBaseURI.toRelative(e):e=i.documentBaseURI.toAbsolute(e,o.remove_script_host)},addVisual:function(e){var n,i=this,o=i.settings,r=i.dom;e=e||i.getBody(),i.hasVisual===t&&(i.hasVisual=o.visual),A(r.select("table,a",e),function(e){var t;switch(e.nodeName){case"TABLE":return n=o.visual_table_class||"mce-item-table",t=r.getAttrib(e,"border"),t&&"0"!=t||(i.hasVisual?r.addClass(e,n):r.removeClass(e,n)),void 0;case"A":return r.getAttrib(e,"href",!1)||(t=r.getAttrib(e,"name")||e.id,n="mce-item-anchor",t&&(i.hasVisual?r.addClass(e,n):r.removeClass(e,n))),void 0}}),i.fire("VisualAid",{element:e,hasVisual:i.hasVisual})},remove:function(){var e=this,t=e.getContainer(),n=e.getDoc();e.removed||(e.removed=1,H&&n&&n.execCommand("SelectAll"),e.save(),T.setStyle(e.id,"display",e.orgDisplay),e.settings.content_editable||(I.unbind(e.getWin()),I.unbind(e.getDoc())),I.unbind(e.getBody()),I.unbind(t),e.fire("remove"),e.editorManager.remove(e),T.remove(t))},bindNative:function(e){var t=this;t.initialized?t.dom.bind(C(t,e),e,function(n){t.fire(e,n)}):t._pendingNativeEvents?t._pendingNativeEvents.push(e):t._pendingNativeEvents=[e]},unbindNative:function(e){var t=this;t.initialized&&t.dom.unbind(e)},destroy:function(e){var t,n=this;n.destroyed||(D&&(I.unbind(n.getDoc()),I.unbind(n.getWin()),I.unbind(n.getBody())),e||(n.editorManager.off("beforeunload",n._beforeUnload),n.theme&&n.theme.destroy&&n.theme.destroy(),n.selection.destroy(),n.dom.destroy()),t=n.formElement,t&&(t.submit=t._mceOldSubmit,t._mceOldSubmit=null,T.unbind(t,"submit reset",n.formEventDelegate)),n.contentAreaContainer=n.formElement=n.container=null,n.settings.content_element=n.bodyElement=n.contentDocument=n.contentWindow=null,n.selection&&(n.selection=n.selection.win=n.selection.dom=n.selection.dom.doc=null),n.destroyed=1)},_refreshContentEditable:function(){var e,t,n=this;n._isHidden()&&(e=n.getBody(),t=e.parentNode,t.removeChild(e),t.appendChild(e),e.focus())},_isHidden:function(){var e;return D?(e=this.selection.getSel(),!e||!e.rangeCount||0===e.rangeCount):0}},N(S.prototype,x),S}),i(it,[],function(){var e={};return{add:function(t,n){for(var i in n)e[i]=n[i]},translate:function(t){if(t===void 0)return t;if("string"!=typeof t&&t.raw)return t.raw;if(t.push){var n=t.slice(1);t=(e[t[0]]||t[0]).replace(/\{([^\}]+)\}/g,function(e,t){return n[t]})}return e[t]||t},data:e}}),i(ot,[m,f],function(e,t){function n(i){function o(){try{return document.activeElement}catch(e){return document.body}}function r(e){return e&&e.startContainer?{startContainer:e.startContainer,startOffset:e.startOffset,endContainer:e.endContainer,endOffset:e.endOffset}:e}function a(e,t){var n;return t.startContainer?(n=e.getDoc().createRange(),n.setStart(t.startContainer,t.startOffset),n.setEnd(t.endContainer,t.endOffset)):n=t,n}function s(s){function l(t){return!!e.DOM.getParent(t,n.isEditorUIElement)}var u,c,d=s.editor;d.on("init",function(){"onbeforedeactivate"in document&&11>t.ie?d.dom.bind(d.getBody(),"beforedeactivate",function(){var e=d.getDoc().selection;try{u=e&&e.createRange?e.createRange():d.selection.getRng()}catch(t){}}):(d.inline||t.ie>10)&&(d.on("nodechange keyup",function(){var e,t=document.activeElement;for(t&&t.id==d.id+"_ifr"&&(t=d.getBody());t;){if(t==d.getBody()){e=!0;break}t=t.parentNode}e&&(u=d.selection.getRng())}),t.webkit&&(c=function(){var e=d.selection.getRng();e.collapsed||(u=e)},e.DOM.bind(document,"selectionchange",c),d.on("remove",function(){e.DOM.unbind(document,"selectionchange",c)})))}),d.on("focusin",function(){var e=i.focusedEditor;d.selection.lastFocusBookmark&&(d.selection.setRng(a(d,d.selection.lastFocusBookmark)),d.selection.lastFocusBookmark=null),e!=d&&(e&&e.fire("blur",{focusedEditor:d}),i.activeEditor=d,d.fire("focus",{blurredEditor:e}),d.focus(!1),i.focusedEditor=d)}),d.on("focusout",function(){d.selection.lastFocusBookmark=r(u),window.setTimeout(function(){var e=i.focusedEditor;e!=d&&(d.selection.lastFocusBookmark=null),l(o())||e!=d||(d.fire("blur",{focusedEditor:null}),i.focusedEditor=null,d.selection.lastFocusBookmark=null)},0)})}i.on("AddEditor",s)}return n.isEditorUIElement=function(e){return-1!==e.className.indexOf("mce-")},n}),i(rt,[nt,m,D,f,d,et,it,ot],function(e,n,i,o,r,a,s,l){var u,c=n.DOM,d=r.explode,h=r.each,p=r.extend,f=0,m={majorVersion:"4",minorVersion:"0.5",releaseDate:"2013-08-27",editors:[],i18n:s,activeEditor:null,setup:function(){var e,t,n,o=this,r="";if(t=document.location.href.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,""),/[\/\\]$/.test(t)||(t+="/"),n=window.tinymce||window.tinyMCEPreInit)e=n.base||n.baseURL,r=n.suffix;
else for(var a=document.getElementsByTagName("script"),s=0;a.length>s;s++){var u=a[s].src;if(/tinymce(\.jquery|)(\.min|\.dev|)\.js/.test(u)){-1!=u.indexOf(".min")&&(r=".min"),e=u.substring(0,u.lastIndexOf("/"));break}}o.baseURL=new i(t).toAbsolute(e),o.documentBaseURL=t,o.baseURI=new i(o.baseURL),o.suffix=r,o.focusManager=new l(o)},init:function(t){function n(e){var t=e.id;return t||(t=e.name,t=t&&!c.get(t)?e.name:c.uniqueId(),e.setAttribute("id",t)),t}function i(e,t,n){var i=e[t];return i?i.apply(n||this,Array.prototype.slice.call(arguments,2)):void 0}function o(e,t){return t.constructor===RegExp?t.test(e.className):c.hasClass(e,t)}var r,a=this,s=[];a.settings=t,c.bind(window,"ready",function(){var l,u;if(i(t,"onpageload"),t.types)return h(t.types,function(i){h(c.select(i.selector),function(o){var r=new e(n(o),p({},t,i),a);s.push(r),r.render(1)})}),void 0;if(t.selector)return h(c.select(t.selector),function(i){var o=new e(n(i),t,a);s.push(o),o.render(1)}),void 0;switch(t.mode){case"exact":l=t.elements||"",l.length>0&&h(d(l),function(n){c.get(n)?(r=new e(n,t,a),s.push(r),r.render(!0)):h(document.forms,function(i){h(i.elements,function(i){i.name===n&&(n="mce_editor_"+f++,c.setAttrib(i,"id",n),r=new e(n,t,a),s.push(r),r.render(1))})})});break;case"textareas":case"specific_textareas":h(c.select("textarea"),function(i){t.editor_deselector&&o(i,t.editor_deselector)||(!t.editor_selector||o(i,t.editor_selector))&&(r=new e(n(i),t,a),s.push(r),r.render(!0))})}t.oninit&&(l=u=0,h(s,function(e){u++,e.initialized?l++:e.on("init",function(){l++,l==u&&i(t,"oninit")}),l==u&&i(t,"oninit")}))})},get:function(e){return e===t?this.editors:this.editors[e]},add:function(e){var t=this,n=t.editors;return n[e.id]=e,n.push(e),t.activeEditor=e,t.fire("AddEditor",{editor:e}),u||(u=function(){t.fire("BeforeUnload")},c.bind(window,"beforeunload",u)),e},createEditor:function(t,n){return this.add(new e(t,n,this))},remove:function(e){var t,n,i=this,o=i.editors;if(e){if("string"==typeof e)return e=e.selector||e,h(c.select(e),function(e){i.remove(o[e.id])}),void 0;if(n=e,!o[n.id])return null;for(delete o[n.id],t=0;o.length>t;t++)if(o[t]==n){o.splice(t,1);break}if(i.activeEditor==n&&(i.activeEditor=o[0]),n&&!n.removed)return n.remove(),n.destroy(),i.fire("RemoveEditor",{editor:n}),o.length||c.unbind(window,"beforeunload",u),n}else for(t=o.length-1;t>=0;t--)i.remove(o[t])},execCommand:function(t,n,i){var o=this,r=o.get(i);switch(t){case"mceAddEditor":return o.get(i)||new e(i,o.settings,o).render(),!0;case"mceRemoveEditor":return r&&r.remove(),!0;case"mceToggleEditor":return r?(r.isHidden()?r.show():r.hide(),!0):(o.execCommand("mceAddEditor",0,i),!0)}return o.activeEditor?o.activeEditor.execCommand(t,n,i):!1},triggerSave:function(){h(this.editors,function(e){e.save()})},addI18n:function(e,t){s.add(e,t)},translate:function(e){return s.translate(e)}};return p(m,a),m.setup(),window.tinymce=window.tinyMCE=m,m}),i(at,[rt,d],function(e,t){var n=t.each,i=t.explode;e.on("AddEditor",function(e){var t=e.editor;t.on("preInit",function(){function e(e,t){n(t,function(t,n){t&&s.setStyle(e,n,t)}),s.rename(e,"span")}function o(e){s=t.dom,l.convert_fonts_to_spans&&n(s.select("font,u,strike",e.node),function(e){r[e.nodeName.toLowerCase()](s,e)})}var r,a,s,l=t.settings;l.inline_styles&&(a=i(l.font_size_legacy_values),r={font:function(t,n){e(n,{backgroundColor:n.style.backgroundColor,color:n.color,fontFamily:n.face,fontSize:a[parseInt(n.size,10)-1]})},u:function(t,n){e(n,{textDecoration:"underline"})},strike:function(t,n){e(n,{textDecoration:"line-through"})}},t.on("PreProcess SetContent",o))})})}),i(st,[],function(){return{send:function(e){function t(){!e.async||4==n.readyState||i++>1e4?(e.success&&1e4>i&&200==n.status?e.success.call(e.success_scope,""+n.responseText,n,e):e.error&&e.error.call(e.error_scope,i>1e4?"TIMED_OUT":"GENERAL",n,e),n=null):setTimeout(t,10)}var n,i=0;if(e.scope=e.scope||this,e.success_scope=e.success_scope||e.scope,e.error_scope=e.error_scope||e.scope,e.async=e.async===!1?!1:!0,e.data=e.data||"",n=new XMLHttpRequest){if(n.overrideMimeType&&n.overrideMimeType(e.content_type),n.open(e.type||(e.data?"POST":"GET"),e.url,e.async),e.content_type&&n.setRequestHeader("Content-Type",e.content_type),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.send(e.data),!e.async)return t();setTimeout(t,10)}}}}),i(lt,[],function(){function e(t,n){var i,o,r,a;if(n=n||'"',null===t)return"null";if(r=typeof t,"string"==r)return o="\bb	t\nn\ff\rr\"\"''\\\\",n+t.replace(/([\u0080-\uFFFF\x00-\x1f\"\'\\])/g,function(e,t){return'"'===n&&"'"===e?e:(i=o.indexOf(t),i+1?"\\"+o.charAt(i+1):(e=t.charCodeAt().toString(16),"\\u"+"0000".substring(e.length)+e))})+n;if("object"==r){if(t.hasOwnProperty&&"[object Array]"===Object.prototype.toString.call(t)){for(i=0,o="[";t.length>i;i++)o+=(i>0?",":"")+e(t[i],n);return o+"]"}o="{";for(a in t)t.hasOwnProperty(a)&&(o+="function"!=typeof t[a]?(o.length>1?","+n:n)+a+n+":"+e(t[a],n):"");return o+"}"}return""+t}return{serialize:e,parse:function(e){try{return window[String.fromCharCode(101)+"val"]("("+e+")")}catch(t){}}}}),i(ut,[lt,st,d],function(e,t,n){function i(e){this.settings=o({},e),this.count=0}var o=n.extend;return i.sendRPC=function(e){return(new i).send(e)},i.prototype={send:function(n){var i=n.error,r=n.success;n=o(this.settings,n),n.success=function(t,o){t=e.parse(t),t===void 0&&(t={error:"JSON Parse error."}),t.error?i.call(n.error_scope||n.scope,t.error,o):r.call(n.success_scope||n.scope,t.result)},n.error=function(e,t){i&&i.call(n.error_scope||n.scope,e,t)},n.data=e.serialize({id:n.id||"c"+this.count++,method:n.method,params:n.params}),n.content_type="application/json",t.send(n)}},i}),i(ct,[m],function(e){return{callbacks:{},count:0,send:function(n){var i=this,o=e.DOM,r=n.count!==t?n.count:i.count,a="tinymce_jsonp_"+r;i.callbacks[r]=function(e){o.remove(a),delete i.callbacks[r],n.callback(e)},o.add(o.doc.body,"script",{id:a,src:n.url,type:"text/javascript"}),i.count++}}}),i(dt,[],function(){function e(){s=[];for(var e in a)s.push(e);o.length=s.length}function n(){function n(e){var n,i;return i=e!==t?c+e:o.indexOf(",",c),-1===i||i>o.length?null:(n=o.substring(c,i),c=i+1,n)}var i,o,s,c=0;if(a={},u){r.load(l),o=r.getAttribute(l)||"";do i=n(parseInt(n(),32)||0),null!==i&&(s=n(parseInt(n(),32)||0),a[i]=s);while(null!==i);e()}}function i(){var t,n="";if(u){for(var i in a)t=a[i],n+=(n?",":"")+i.length.toString(32)+","+i+","+t.length.toString(32)+","+t;r.setAttribute(l,n),r.save(l),e()}}var o,r,a,s,l,u;return window.localStorage?localStorage:(l="tinymce",r=document.documentElement,u=!!r.addBehavior,u&&r.addBehavior("#default#userData"),o={key:function(e){return s[e]},getItem:function(e){return e in a?a[e]:null},setItem:function(e,t){a[e]=""+t,i()},removeItem:function(e){delete a[e],i()},clear:function(){a={},i()}},n(),o)}),i(ht,[m,u,g,v,d,f],function(e,t,n,i,o,r){var a=window.tinymce;return a.DOM=e.DOM,a.ScriptLoader=n.ScriptLoader,a.PluginManager=i.PluginManager,a.ThemeManager=i.ThemeManager,a.dom=a.dom||{},a.dom.Event=t.Event,o.each(o,function(e,t){a[t]=e}),o.each("isOpera isWebKit isIE isGecko isMac".split(" "),function(e){a[e]=r[e.substr(2).toLowerCase()]}),{}}),i(pt,[H,d],function(e,t){return e.extend({Defaults:{firstControlClass:"first",lastControlClass:"last"},init:function(e){this.settings=t.extend({},this.Defaults,e)},preRender:function(e){e.addClass(this.settings.containerClass,"body")},applyClasses:function(e){var t,n,i,o=this,r=o.settings;t=e.items().filter(":visible"),n=r.firstControlClass,i=r.lastControlClass,t.each(function(e){e.removeClass(n).removeClass(i),r.controlClass&&e.addClass(r.controlClass)}),t.eq(0).addClass(n),t.eq(-1).addClass(i)},renderHtml:function(e){var t,n=this,i=n.settings,o="";return t=e.items(),t.eq(0).addClass(i.firstControlClass),t.eq(-1).addClass(i.lastControlClass),t.each(function(e){i.controlClass&&e.addClass(i.controlClass),o+=e.renderHtml()}),o},recalc:function(){},postRender:function(){}})}),i(ft,[pt],function(e){return e.extend({Defaults:{containerClass:"abs-layout",controlClass:"abs-layout-item"},recalc:function(e){e.items().filter(":visible").each(function(e){var t=e.settings;e.layoutRect({x:t.x,y:t.y,w:t.w,h:t.h}),e.recalc&&e.recalc()})},renderHtml:function(e){return'<div id="'+e._id+'-absend" class="'+e.classPrefix+'abs-end"></div>'+this._super(e)}})}),i(mt,[F,q],function(e,t){return e.extend({Mixins:[t],Defaults:{classes:"widget tooltip tooltip-n"},text:function(e){var t=this;return e!==void 0?(t._value=e,t._rendered&&(t.getEl().lastChild.innerHTML=t.encode(e)),t):t._value},renderHtml:function(){var e=this,t=e.classPrefix;return'<div id="'+e._id+'" class="'+e.classes()+'" role="presentation">'+'<div class="'+t+'tooltip-arrow"></div>'+'<div class="'+t+'tooltip-inner">'+e.encode(e._text)+"</div>"+"</div>"},repaint:function(){var e,t,n=this;e=n.getEl().style,t=n._layoutRect,e.left=t.x+"px",e.top=t.y+"px",e.zIndex=131070}})}),i(gt,[F,mt],function(e,t){var n,i=e.extend({init:function(e){var t=this;t._super(e),t.canFocus=!0,e.tooltip&&i.tooltips!==!1&&t.on("mouseenter mouseleave",function(n){var i=t.tooltip().moveTo(-65535);if(n.control==t&&"mouseenter"==n.type){var o=i.text(e.tooltip).show().testMoveRel(t.getEl(),["bc-tc","bc-tl","bc-tr"]);i.toggleClass("tooltip-n","bc-tc"==o),i.toggleClass("tooltip-nw","bc-tl"==o),i.toggleClass("tooltip-ne","bc-tr"==o),i.moveRel(t.getEl(),o)}else i.hide()}),t.aria("label",e.tooltip)},tooltip:function(){var e=this;return n||(n=new t({type:"tooltip"}),n.renderTo(e.getContainerElm())),n},active:function(e){var t,n=this;return e!==t&&(n.aria("pressed",e),n.toggleClass("active",e)),n._super(e)},disabled:function(e){var t,n=this;return e!==t&&(n.aria("disabled",e),n.toggleClass("disabled",e)),n._super(e)},postRender:function(){var e=this,t=e.settings;e._rendered=!0,e._super(),e.parent()||!t.width&&!t.height||(e.initLayoutRect(),e.repaint()),t.autofocus&&setTimeout(function(){e.focus()},0)},remove:function(){this._super(),n&&(n.remove(),n=null)}});return i}),i(vt,[gt],function(e){return e.extend({Defaults:{classes:"widget btn",role:"button"},init:function(e){var t,n=this;n.on("click mousedown",function(e){e.preventDefault()}),n._super(e),t=e.size,e.subtype&&n.addClass(e.subtype),t&&n.addClass("btn-"+t)},repaint:function(){var e=this.getEl().firstChild.style;e.width=e.height="100%",this._super()},renderHtml:function(){var e=this,t=e._id,n=e.classPrefix,i=e.settings.icon,o="";return e.settings.image&&(i="none",o=" style=\"background-image: url('"+e.settings.image+"')\""),i=e.settings.icon?n+"ico "+n+"i-"+i:"",'<div id="'+t+'" class="'+e.classes()+'" tabindex="-1">'+'<button role="presentation" type="button" tabindex="-1">'+(i?'<i class="'+i+'"'+o+"></i>":"")+(e._text?(i?" ":"")+e.encode(e._text):"")+"</button>"+"</div>"}})}),i(yt,[U],function(e){return e.extend({Defaults:{defaultType:"button",role:"toolbar"},renderHtml:function(){var e=this,t=e._layout;return e.addClass("btn-group"),e.preRender(),t.preRender(e),'<div id="'+e._id+'" class="'+e.classes()+'">'+'<div id="'+e._id+'-body">'+(e.settings.html||"")+t.renderHtml(e)+"</div>"+"</div>"}})}),i(bt,[gt],function(e){return e.extend({Defaults:{classes:"checkbox",role:"checkbox",checked:!1},init:function(e){var t=this;t._super(e),t.on("click mousedown",function(e){e.preventDefault()}),t.on("click",function(e){e.preventDefault(),t.disabled()||t.checked(!t.checked())}),t.checked(t.settings.checked)},checked:function(e){var t=this;return e!==void 0?(e?t.addClass("checked"):t.removeClass("checked"),t._checked=e,t.aria("checked",e),t):t._checked},value:function(e){return this.checked(e)},renderHtml:function(){var e=this,t=e._id,n=e.classPrefix;return'<div id="'+t+'" class="'+e.classes()+'" unselectable="on" aria-labeledby="'+t+'-al" tabindex="-1">'+'<i class="'+n+"ico "+n+'i-checkbox"></i>'+'<span id="'+t+'-al" class="'+n+'label">'+e.encode(e._text)+"</span>"+"</div>"}})}),i(wt,[vt,G],function(e,t){return e.extend({showPanel:function(){var e=this,n=e.settings;n.panel.popover=!0,n.panel.autohide=!0,e.active(!0),e.panel?e.panel.show():(e.panel=new t(n.panel).on("hide",function(){e.active(!1)}).parent(e).renderTo(e.getContainerElm()),e.panel.fire("show"),e.panel.reflow()),e.panel.moveRel(e.getEl(),n.popoverAlign||"bc-tc")},hidePanel:function(){var e=this;e.panel&&e.panel.hide()},postRender:function(){var e=this;return e.on("click",function(t){t.control===e&&(e.panel&&e.panel.visible()?e.hidePanel():e.showPanel())}),e._super()}})}),i(xt,[wt,m],function(e,t){var n=t.DOM;return e.extend({init:function(e){this._super(e),this.addClass("colorbutton")},color:function(e){return e?(this._color=e,this.getEl("preview").style.backgroundColor=e,this):this._color},renderHtml:function(){var e=this,t=e._id,n=e.classPrefix,i=e.settings.icon?n+"ico "+n+"i-"+e.settings.icon:"",o=e.settings.image?" style=\"background-image: url('"+e.settings.image+"')\"":"";return'<div id="'+t+'" class="'+e.classes()+'">'+'<button role="presentation" hidefocus type="button" tabindex="-1">'+(i?'<i class="'+i+'"'+o+"></i>":"")+'<span id="'+t+'-preview" class="'+n+'preview"></span>'+(e._text?(i?" ":"")+e._text:"")+"</button>"+'<button type="button" class="'+n+'open" hidefocus tabindex="-1">'+' <i class="'+n+'caret"></i>'+"</button>"+"</div>"},postRender:function(){var e=this,t=e.settings.onclick;return e.on("click",function(i){i.control!=e||n.getParent(i.target,"."+e.classPrefix+"open")||(i.stopImmediatePropagation(),t.call(e,i))}),delete e.settings.onclick,e._super()}})}),i(_t,[gt,B],function(e,t){return e.extend({init:function(e){var n=this;n._super(e),n.addClass("combobox"),n.on("click",function(e){for(var t=e.target;t;)t.id&&-1!=t.id.indexOf("-open")&&n.fire("action"),t=t.parentNode}),n.on("keydown",function(e){"INPUT"==e.target.nodeName&&13==e.keyCode&&n.parents().reverse().each(function(t){return e.preventDefault(),n.fire("change"),t.submit?(t.submit(),!1):void 0})}),e.placeholder&&(n.addClass("placeholder"),n.on("focusin",function(){n._hasOnChange||(t.on(n.getEl("inp"),"change",function(){n.fire("change")}),n._hasOnChange=!0),n.hasClass("placeholder")&&(n.getEl("inp").value="",n.removeClass("placeholder"))}),n.on("focusout",function(){0===n.value().length&&(n.getEl("inp").value=e.placeholder,n.addClass("placeholder"))}))},value:function(e){var t=this;return e!==void 0?(t._value=e,t.removeClass("placeholder"),t._rendered&&(t.getEl("inp").value=e),t):t._rendered?(e=t.getEl("inp").value,e!=t.settings.placeholder?e:""):t._value},disabled:function(e){var t=this;t._super(e),t._rendered&&(t.getEl("inp").disabled=e)},focus:function(){this.getEl("inp").focus()},repaint:function(){var e,n,i=this,o=i.getEl(),r=i.getEl("open"),a=i.layoutRect();e=r?a.w-r.offsetWidth-10:a.w-10;var s=document;return s.all&&(!s.documentMode||8>=s.documentMode)&&(n=i.layoutRect().h-2+"px"),t.css(o.firstChild,{width:e,lineHeight:n}),i._super(),i},postRender:function(){var e=this;return t.on(this.getEl("inp"),"change",function(){e.fire("change")}),e._super()},renderHtml:function(){var e,t,n=this,i=n._id,o=n.settings,r=n.classPrefix,a=o.value||o.placeholder||"",s="";return e=o.icon?r+"ico "+r+"i-"+o.icon:"",t=n._text,(e||t)&&(s='<div id="'+i+'-open" class="'+r+"btn "+r+'open" tabIndex="-1">'+'<button id="'+i+'-action" type="button" hidefocus tabindex="-1">'+(e?'<i class="'+e+'"></i>':'<i class="'+r+'caret"></i>')+(t?(e?" ":"")+t:"")+"</button>"+"</div>",n.addClass("has-open")),'<div id="'+i+'" class="'+n.classes()+'">'+'<input id="'+i+'-inp" class="'+r+"textbox "+r+'placeholder" value="'+a+'" hidefocus="true">'+s+"</div>"}})}),i(Ct,[F,X],function(e,t){return e.extend({Defaults:{delimiter:"»"},init:function(e){var t=this;t._super(e),t.addClass("path"),t.canFocus=!0,t.on("click",function(e){var n,i=e.target;(n=i.getAttribute("data-index"))&&t.fire("select",{value:t.data()[n],index:n})})},focus:function(){var e=this;return e.keyNav=new t({root:e,enableLeftRight:!0}),e.keyNav.focusFirst(),e},data:function(e){var t=this;return e!==void 0?(t._data=e,t.update(),t):t._data},update:function(){this.innerHtml(this._getPathHtml())},postRender:function(){var e=this;e._super(),e.data(e.settings.data)},renderHtml:function(){var e=this;return'<div id="'+e._id+'" class="'+e.classPrefix+'path">'+e._getPathHtml()+"</div>"},_getPathHtml:function(){var e,t,n=this,i=n._data||[],o="",r=n.classPrefix;for(e=0,t=i.length;t>e;e++)o+=(e>0?'<div class="'+r+'divider" aria-hidden="true"> '+n.settings.delimiter+" </div>":"")+'<div role="button" class="'+r+"path-item"+(e==t-1?" "+r+"last":"")+'" data-index="'+e+'" tabindex="-1" id="'+n._id+"-"+e+'">'+i[e].name+"</div>";return o||(o='<div class="'+r+'path-item">&nbsp;</div>'),o}})}),i(St,[Ct,rt],function(e,t){return e.extend({postRender:function(){function e(e){return 1===e.nodeType&&("BR"==e.nodeName||!!e.getAttribute("data-mce-bogus"))}var n=this,i=t.activeEditor;return n.on("select",function(t){var n,o=[],r=i.getBody();for(i.focus(),n=i.selection.getStart();n&&n!=r;)e(n)||o.push(n),n=n.parentNode;i.selection.select(o[o.length-1-t.index]),i.nodeChanged()}),i.on("nodeChange",function(t){for(var o=[],r=t.parents,a=r.length;a--;)if(1==r[a].nodeType&&!e(r[a])){var s=i.fire("ResolveName",{name:r[a].nodeName.toLowerCase(),target:r[a]});o.push({name:s.name})}n.data(o)}),n._super()}})}),i(Tt,[U],function(e){return e.extend({Defaults:{layout:"flex",align:"center",defaults:{flex:1}},renderHtml:function(){var e=this,t=e._layout,n=e.classPrefix;return e.addClass("formitem"),t.preRender(e),'<div id="'+e._id+'" class="'+e.classes()+'" hideFocus="1" tabIndex="-1">'+(e.settings.title?'<div id="'+e._id+'-title" class="'+n+'title">'+e.settings.title+"</div>":"")+'<div id="'+e._id+'-body" class="'+e.classes("body")+'">'+(e.settings.html||"")+t.renderHtml(e)+"</div>"+"</div>"}})}),i(Et,[U,Tt],function(e,t){return e.extend({Defaults:{containerCls:"form",layout:"flex",direction:"column",align:"stretch",flex:1,padding:20,labelGap:30,spacing:10},preRender:function(){var e=this,n=e.items();n.each(function(n){var i,o=n.settings.label;o&&(i=new t({layout:"flex",autoResize:"overflow",defaults:{flex:1},items:[{type:"label",text:o,flex:0,forId:n._id}]}),i.type="formitem",n.settings.flex===void 0&&(n.settings.flex=1),e.replace(n,i),i.add(n))})},recalcLabels:function(){var e,t,n=this,i=0,o=[];if(n.settings.labelGapCalc!==!1)for(n.items().filter("formitem").each(function(e){var t=e.items()[0],n=t.getEl().clientWidth;i=n>i?n:i,o.push(t)}),t=n.settings.labelGap||0,e=o.length;e--;)o[e].settings.minWidth=i+t},visible:function(e){var t=this._super(e);return e===!0&&this._rendered&&this.recalcLabels(),t},submit:function(){var e=this.getParentCtrl(document.activeElement);return e&&e.blur(),this.fire("submit",{data:this.toJSON()})},postRender:function(){var e=this;e._super(),e.recalcLabels(),e.fromJSON(e.settings.data)}})}),i(kt,[Et],function(e){return e.extend({Defaults:{containerCls:"fieldset",layout:"flex",direction:"column",align:"stretch",flex:1,padding:"25 15 5 15",labelGap:30,spacing:10,border:1},renderHtml:function(){var e=this,t=e._layout,n=e.classPrefix;return e.preRender(),t.preRender(e),'<fieldset id="'+e._id+'" class="'+e.classes()+'" hideFocus="1" tabIndex="-1">'+(e.settings.title?'<legend id="'+e._id+'-title" class="'+n+'fieldset-title">'+e.settings.title+"</legend>":"")+'<div id="'+e._id+'-body" class="'+e.classes("body")+'">'+(e.settings.html||"")+t.renderHtml(e)+"</div>"+"</fieldset>"}})}),i(Nt,[_t],function(e){return e.extend({init:function(e){var t,n=this,i=tinymce.activeEditor;e.spellcheck=!1,t=i.settings.file_browser_callback,t&&(e.icon="browse",e.onaction=function(){t(n.getEl("inp").id,n.getEl("inp").value,e.filetype,window)}),n._super(e)}})}),i(At,[ft],function(e){return e.extend({recalc:function(e){var t=e.layoutRect(),n=e.paddingBox();e.items().filter(":visible").each(function(e){e.layoutRect({x:n.left,y:n.top,w:t.innerW-n.right-n.left,h:t.innerH-n.top-n.bottom}),e.recalc&&e.recalc()})}})}),i(Mt,[ft],function(e){return e.extend({recalc:function(e){var t,n,i,o,r,a,s,l,u,c,d,h,p,f,m,g,v,y,b,w,x,_,C,S,T,E,k,N,A,M,P,R,O,I,D,H,L,z,B,F,j=[],U=Math.max,W=Math.min;for(i=e.items().filter(":visible"),o=e.layoutRect(),r=e._paddingBox,a=e.settings,h=a.direction,s=a.align,l=a.pack,u=a.spacing||0,("row-reversed"==h||"column-reverse"==h)&&(i=i.set(i.toArray().reverse()),h=h.split("-")[0]),"column"==h?(T="y",C="h",S="minH",E="maxH",N="innerH",k="top",A="bottom",M="deltaH",P="contentH",L="left",I="w",R="x",O="innerW",D="minW",H="maxW",z="right",B="deltaW",F="contentW"):(T="x",C="w",S="minW",E="maxW",N="innerW",k="left",A="right",M="deltaW",P="contentW",L="top",I="h",R="y",O="innerH",D="minH",H="maxH",z="bottom",B="deltaH",F="contentH"),d=o[N]-r[k]-r[k],_=c=0,t=0,n=i.length;n>t;t++)p=i[t],f=p.layoutRect(),m=p.settings,g=m.flex,d-=n-1>t?u:0,g>0&&(c+=g,f[E]&&j.push(p),f.flex=g),d-=f[S],v=r[L]+f[D]+r[z],v>_&&(_=v);if(w={},w[S]=0>d?o[S]-d+o[M]:o[N]-d+o[M],w[D]=_+o[B],w[P]=o[N]-d,w[F]=_,w.minW=W(w.minW,o.maxW),w.minH=W(w.minH,o.maxH),w.minW=U(w.minW,o.startMinWidth),w.minH=U(w.minH,o.startMinHeight),!o.autoResize||w.minW==o.minW&&w.minH==o.minH){for(b=d/c,t=0,n=j.length;n>t;t++)p=j[t],f=p.layoutRect(),y=f[E],v=f[S]+Math.ceil(f.flex*b),v>y?(d-=f[E]-f[S],c-=f.flex,f.flex=0,f.maxFlexSize=y):f.maxFlexSize=0;for(b=d/c,x=r[k],w={},0===c&&("end"==l?x=d+r[k]:"center"==l?(x=Math.round(o[N]/2-(o[N]-d)/2)+r[k],0>x&&(x=r[k])):"justify"==l&&(x=r[k],u=Math.floor(d/(i.length-1)))),w[R]=r[L],t=0,n=i.length;n>t;t++)p=i[t],f=p.layoutRect(),v=f.maxFlexSize||f[S],"center"===s?w[R]=Math.round(o[O]/2-f[I]/2):"stretch"===s?(w[I]=U(f[D]||0,o[O]-r[L]-r[z]),w[R]=r[L]):"end"===s&&(w[R]=o[O]-f[I]-r.top),f.flex>0&&(v+=Math.ceil(f.flex*b)),w[C]=v,w[T]=x,p.layoutRect(w),p.recalc&&p.recalc(),x+=v+u}else if(w.w=w.minW,w.h=w.minH,e.layoutRect(w),this.recalc(e),null===e._lastRect){var V=e.parent();V&&(V._lastRect=null,V.recalc())}}})}),i(Pt,[pt],function(e){return e.extend({Defaults:{containerClass:"flow-layout",controlClass:"flow-layout-item",endClass:"break"},recalc:function(e){e.items().filter(":visible").each(function(e){e.recalc&&e.recalc()})}})}),i(Rt,[F,gt,G,d,rt,f],function(e,t,n,i,o,r){function a(e){function t(t){function n(e){return e.replace(/%(\w+)/g,"")}var i,o,r,a,l=e.dom,u="";return a=e.settings.preview_styles,a===!1?"":(a||(a="font-family font-size font-weight text-decoration text-transform color background-color border border-radius"),(t=e.formatter.get(t))?(t=t[0],i=t.block||t.inline||"span",o=l.create(i),s(t.styles,function(e,t){e=n(e),e&&l.setStyle(o,t,e)}),s(t.attributes,function(e,t){e=n(e),e&&l.setAttrib(o,t,e)}),s(t.classes,function(e){e=n(e),l.hasClass(o,e)||l.addClass(o,e)}),e.fire("PreviewFormats"),l.setStyles(o,{position:"absolute",left:-65535}),e.getBody().appendChild(o),r=l.getStyle(e.getBody(),"fontSize",!0),r=/px$/.test(r)?parseInt(r,10):0,s(a.split(" "),function(t){var n=l.getStyle(o,t,!0);if(!("background-color"==t&&/transparent|rgba\s*\([^)]+,\s*0\)/.test(n)&&(n=l.getStyle(e.getBody(),t,!0),"#ffffff"==l.toHex(n).toLowerCase())||"color"==t&&"#000000"==l.toHex(n).toLowerCase())){if("font-size"==t&&/em|%$/.test(n)){if(0===r)return;n=parseFloat(n,10)/(/%$/.test(n)?100:1),n=n*r+"px"}"border"==t&&n&&(u+="padding:0 2px;"),u+=t+":"+n+";"}}),e.fire("AfterPreviewFormats"),l.remove(o),u):void 0)}function i(t,n){return function(){var i=this;e.on("nodeChange",function(o){var r=e.formatter,a=null;s(o.parents,function(e){return s(t,function(t){return n?r.matchNode(e,n,{value:t.value})&&(a=t.value):r.matchNode(e,t.value)&&(a=t.value),a?!1:void 0}),a?!1:void 0}),i.value(a)})}}function o(e){e=e.split(";");for(var t=e.length;t--;)e[t]=e[t].split("=");return e}function r(){function n(e){var t=[];return e?(s(e,function(e){var r={text:e.title,icon:e.icon};if(e.items)r.menu=n(e.items);else{var a=e.format||"custom"+i++;e.format||(e.name=a,o.push(e)),r.format=a}t.push(r)}),t):void 0}var i=0,o=[],r=[{title:"Headers",items:[{title:"Header 1",format:"h1"},{title:"Header 2",format:"h2"},{title:"Header 3",format:"h3"},{title:"Header 4",format:"h4"},{title:"Header 5",format:"h5"},{title:"Header 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},{title:"Underline",icon:"underline",format:"underline"},{title:"Strikethrough",icon:"strikethrough",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"},{title:"Code",icon:"code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Alignment",items:[{title:"Left",icon:"alignleft",format:"alignleft"},{title:"Center",icon:"aligncenter",format:"aligncenter"},{title:"Right",icon:"alignright",format:"alignright"},{title:"Justify",icon:"alignjustify",format:"alignjustify"}]}];e.on("init",function(){s(o,function(t){e.formatter.register(t.name,t)})});var a=n(e.settings.style_formats||r);return a={type:"menu",items:a,onPostRender:function(t){e.fire("renderFormatsMenu",{control:t.control})},itemDefaults:{preview:!0,textStyle:function(){return this.settings.format?t(this.settings.format):void 0},onPostRender:function(){var t=this,n=this.settings.format;n&&t.parent().on("show",function(){t.disabled(!e.formatter.canApply(n)),t.active(e.formatter.match(n))})},onclick:function(){this.settings.format&&h(this.settings.format)}}}}function a(){return e.undoManager?e.undoManager.hasUndo():!1}function l(){return e.undoManager?e.undoManager.hasRedo():!1}function u(){var t=this;t.disabled(!a()),e.on("Undo Redo AddUndo TypingUndo",function(){t.disabled(!a())})}function c(){var t=this;t.disabled(!l()),e.on("Undo Redo AddUndo TypingUndo",function(){t.disabled(!l())})}function d(){var t=this;e.on("VisualAid",function(e){t.active(e.hasVisual)}),t.active(e.hasVisual)}function h(t){t.control&&(t=t.control.value()),t&&e.execCommand("mceToggleFormat",!1,t)}var p;p=r(),s({bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",subscript:"Subscript",superscript:"Superscript"},function(t,n){e.addButton(n,{tooltip:t,onPostRender:function(){var t=this;e.formatter?e.formatter.formatChanged(n,function(e){t.active(e)}):e.on("init",function(){e.formatter.formatChanged(n,function(e){t.active(e)})})},onclick:function(){h(n)}})}),s({outdent:["Decrease indent","Outdent"],indent:["Increase indent","Indent"],cut:["Cut","Cut"],copy:["Copy","Copy"],paste:["Paste","Paste"],help:["Help","mceHelp"],selectall:["Select all","SelectAll"],hr:["Insert horizontal rule","InsertHorizontalRule"],removeformat:["Clear formatting","RemoveFormat"],visualaid:["Visual aids","mceToggleVisualAid"],newdocument:["New document","mceNewDocument"]},function(t,n){e.addButton(n,{tooltip:t[0],cmd:t[1]})}),s({blockquote:["Toggle blockquote","mceBlockQuote"],numlist:["Numbered list","InsertOrderedList"],bullist:["Bullet list","InsertUnorderedList"],subscript:["Subscript","Subscript"],superscript:["Superscript","Superscript"],alignleft:["Align left","JustifyLeft"],aligncenter:["Align center","JustifyCenter"],alignright:["Align right","JustifyRight"],alignjustify:["Justify","JustifyFull"]},function(t,n){e.addButton(n,{tooltip:t[0],cmd:t[1],onPostRender:function(){var t=this;e.formatter?e.formatter.formatChanged(n,function(e){t.active(e)}):e.on("init",function(){e.formatter.formatChanged(n,function(e){t.active(e)})})}})}),e.addButton("undo",{tooltip:"Undo",onPostRender:u,cmd:"undo"}),e.addButton("redo",{tooltip:"Redo",onPostRender:c,cmd:"redo"}),e.addMenuItem("newdocument",{text:"New document",shortcut:"Ctrl+N",icon:"newdocument",cmd:"mceNewDocument"}),e.addMenuItem("undo",{text:"Undo",icon:"undo",shortcut:"Ctrl+Z",onPostRender:u,cmd:"undo"}),e.addMenuItem("redo",{text:"Redo",icon:"redo",shortcut:"Ctrl+Y",onPostRender:c,cmd:"redo"}),e.addMenuItem("visualaid",{text:"Visual aids",selectable:!0,onPostRender:d,cmd:"mceToggleVisualAid"}),s({cut:["Cut","Cut","Ctrl+X"],copy:["Copy","Copy","Ctrl+C"],paste:["Paste","Paste","Ctrl+V"],selectall:["Select all","SelectAll","Ctrl+A"],bold:["Bold","Bold","Ctrl+B"],italic:["Italic","Italic","Ctrl+I"],underline:["Underline","Underline"],strikethrough:["Strikethrough","Strikethrough"],subscript:["Subscript","Subscript"],superscript:["Superscript","Superscript"],removeformat:["Clear formatting","RemoveFormat"]},function(t,n){e.addMenuItem(n,{text:t[0],icon:n,shortcut:t[2],cmd:t[1]})}),e.on("mousedown",function(){n.hideAll()}),e.addButton("styleselect",{type:"menubutton",text:"Formats",menu:p}),e.addButton("formatselect",function(){var n=[],r=o(e.settings.block_formats||"Paragraph=p;Address=address;Pre=pre;Header 1=h1;Header 2=h2;Header 3=h3;Header 4=h4;Header 5=h5;Header 6=h6");return s(r,function(e){n.push({text:e[0],value:e[1],textStyle:function(){return t(e[1])}})}),{type:"listbox",text:{raw:r[0][0]},values:n,fixedWidth:!0,onselect:h,onPostRender:i(n)}}),e.addButton("fontselect",function(){var t="Andale Mono=andale mono,times;Arial=arial,helvetica,sans-serif;Arial Black=arial black,avant garde;Book Antiqua=book antiqua,palatino;Comic Sans MS=comic sans ms,sans-serif;Courier New=courier new,courier;Georgia=georgia,palatino;Helvetica=helvetica;Impact=impact,chicago;Symbol=symbol;Tahoma=tahoma,arial,helvetica,sans-serif;Terminal=terminal,monaco;Times New Roman=times new roman,times;Trebuchet MS=trebuchet ms,geneva;Verdana=verdana,geneva;Webdings=webdings;Wingdings=wingdings,zapf dingbats",n=[],r=o(e.settings.font_formats||t);return s(r,function(e){n.push({text:{raw:e[0]},value:e[1],textStyle:-1==e[1].indexOf("dings")?"font-family:"+e[1]:""})}),{type:"listbox",text:"Font Family",tooltip:"Font Family",values:n,fixedWidth:!0,onPostRender:i(n,"fontname"),onselect:function(t){t.control.settings.value&&e.execCommand("FontName",!1,t.control.settings.value)}}}),e.addButton("fontsizeselect",function(){var t=[],n="8pt 10pt 12pt 14pt 18pt 24pt 36pt",o=e.settings.fontsize_formats||n;return s(o.split(" "),function(e){t.push({text:e,value:e})}),{type:"listbox",text:"Font Sizes",tooltip:"Font Sizes",values:t,fixedWidth:!0,onPostRender:i(t,"fontsize"),onclick:function(t){t.control.settings.value&&e.execCommand("FontSize",!1,t.control.settings.value)}}}),e.addMenuItem("formats",{text:"Formats",menu:p})}var s=i.each;o.on("AddEditor",function(e){a(e.editor)}),e.translate=function(e){return o.translate(e)},t.tooltips=!r.iOS}),i(Ot,[ft],function(e){return e.extend({recalc:function(e){var t,n,i,o,r,a,s,l,u,c,d,h,p,f,m,g,v,y,b,w,x,_,C,S,T,E,k,N,A=e.settings,M=[],P=[];for(A=e.settings,i=e.items().filter(":visible"),o=e.layoutRect(),n=A.columns||Math.ceil(Math.sqrt(i.length)),t=Math.ceil(i.length/n),v=A.spacingH||A.spacing||0,y=A.spacingV||A.spacing||0,b=A.alignH||A.align,w=A.alignV||A.align,m=e._paddingBox,b&&"string"==typeof b&&(b=[b]),w&&"string"==typeof w&&(w=[w]),c=0;n>c;c++)M.push(0);for(d=0;t>d;d++)P.push(0);for(d=0;t>d;d++)for(c=0;n>c&&(u=i[d*n+c]);c++)l=u.layoutRect(),C=l.minW,S=l.minH,M[c]=C>M[c]?C:M[c],P[d]=S>P[d]?S:P[d];for(k=o.innerW-m.left-m.right,x=0,c=0;n>c;c++)x+=M[c]+(c>0?v:0),k-=(c>0?v:0)+M[c];for(N=o.innerH-m.top-m.bottom,_=0,d=0;t>d;d++)_+=P[d]+(d>0?y:0),N-=(d>0?y:0)+P[d];if(x+=m.left+m.right,_+=m.top+m.bottom,s={},s.minW=x+(o.w-o.innerW),s.minH=_+(o.h-o.innerH),s.contentW=s.minW-o.deltaW,s.contentH=s.minH-o.deltaH,s.minW=Math.min(s.minW,o.maxW),s.minH=Math.min(s.minH,o.maxH),s.minW=Math.max(s.minW,o.startMinWidth),s.minH=Math.max(s.minH,o.startMinHeight),!o.autoResize||s.minW==o.minW&&s.minH==o.minH){o.autoResize&&(s=e.layoutRect(s),s.contentW=s.minW-o.deltaW,s.contentH=s.minH-o.deltaH);var R;R="start"==A.packV?0:N>0?Math.floor(N/t):0;var O=0,I=A.flexWidths;if(I)for(c=0;I.length>c;c++)O+=I[c];else O=n;var D=k/O;for(c=0;n>c;c++)M[c]+=I?Math.ceil(I[c]*D):D;for(p=m.top,d=0;t>d;d++){for(h=m.left,a=P[d]+R,c=0;n>c&&(u=i[d*n+c]);c++)f=u.settings,l=u.layoutRect(),r=M[c],T=E=0,l.x=h,l.y=p,g=f.alignH||(b?b[c]||b[0]:null),"center"==g?l.x=h+r/2-l.w/2:"right"==g?l.x=h+r-l.w:"stretch"==g&&(l.w=r),g=f.alignV||(w?w[c]||w[0]:null),"center"==g?l.y=p+a/2-l.h/2:"bottom"==g?l.y=p+a-l.h:"stretch"==g&&(l.h=a),u.layoutRect(l),h+=r+v,u.recalc&&u.recalc();
p+=a+y}}else if(s.w=s.minW,s.h=s.minH,e.layoutRect(s),this.recalc(e),null===e._lastRect){var H=e.parent();H&&(H._lastRect=null,H.recalc())}}})}),i(It,[gt],function(e){return e.extend({renderHtml:function(){var e=this;return e.addClass("iframe"),e.canFocus=!1,'<iframe id="'+e._id+'" class="'+e.classes()+'" tabindex="-1" src="'+(e.settings.url||"javascript:''")+'" frameborder="0"></iframe>'},src:function(e){this.getEl().src=e},html:function(e,t){var n=this,i=this.getEl().contentWindow.document.body;return i?(i.innerHTML=e,t&&t()):setTimeout(function(){n.html(e)},0),this}})}),i(Dt,[gt],function(e){return e.extend({init:function(e){var t=this;t._super(e),t.addClass("widget"),t.addClass("label"),t.canFocus=!1,e.multiline&&t.addClass("autoscroll"),e.strong&&t.addClass("strong")},initLayoutRect:function(){var e=this,t=e._super();return e.settings.multiline&&(e.getEl().offsetWidth>t.maxW&&(t.minW=t.maxW,e.addClass("multiline")),e.getEl().style.width=t.minW+"px",t.startMinH=t.h=t.minH=Math.min(t.maxH,e.getEl().offsetHeight)),t},disabled:function(e){var t,n=this;return e!==t&&(n.toggleClass("label-disabled",e),n._rendered&&(n.getEl()[0].className=n.classes())),n._super(e)},repaint:function(){var e=this;return e.settings.multiline||(e.getEl().style.lineHeight=e.layoutRect().h+"px"),e._super()},text:function(e){var t=this;return t._rendered&&e&&this.innerHtml(t.encode(e)),t._super(e)},renderHtml:function(){var e=this,t=e.settings.forId;return'<label id="'+e._id+'" class="'+e.classes()+'"'+(t?' for="'+t:"")+'">'+e.encode(e._text)+"</label>"}})}),i(Ht,[U,X],function(e,t){return e.extend({Defaults:{role:"toolbar",layout:"flow"},init:function(e){var t=this;t._super(e),t.addClass("toolbar")},postRender:function(){var e=this;return e.items().addClass("toolbar-item"),e.keyNav=new t({root:e,enableLeftRight:!0}),e._super()}})}),i(Lt,[Ht],function(e){return e.extend({Defaults:{role:"menubar",containerCls:"menubar",defaults:{type:"menubutton"}}})}),i(zt,[vt,j,Lt],function(e,t,n){function i(e,t){for(;e;){if(t===e)return!0;e=e.parentNode}return!1}var o=e.extend({init:function(e){var t=this;t._renderOpen=!0,t._super(e),t.addClass("menubtn"),e.fixedWidth&&t.addClass("fixed-width"),t.aria("haspopup",!0),t.hasPopup=!0},showMenu:function(){var e,n=this,i=n.settings;return n.menu&&n.menu.visible()?n.hideMenu():(n.menu||(e=i.menu||[],e.length?e={type:"menu",items:e}:e.type=e.type||"menu",n.menu=t.create(e).parent(n).renderTo(n.getContainerElm()),n.fire("createmenu"),n.menu.reflow(),n.menu.on("cancel",function(e){e.control===n.menu&&n.focus()}),n.menu.on("show hide",function(e){e.control==n.menu&&n.activeMenu("show"==e.type)}).fire("show"),n.aria("expanded",!0)),n.menu.show(),n.menu.layoutRect({w:n.layoutRect().w}),n.menu.moveRel(n.getEl(),["bl-tl","tl-bl"]),void 0)},hideMenu:function(){var e=this;e.menu&&(e.menu.items().each(function(e){e.hideMenu&&e.hideMenu()}),e.menu.hide(),e.aria("expanded",!1))},activeMenu:function(e){this.toggleClass("active",e)},renderHtml:function(){var e=this,t=e._id,i=e.classPrefix,o=e.settings.icon?i+"ico "+i+"i-"+e.settings.icon:"";return e.aria("role",e.parent()instanceof n?"menuitem":"button"),'<div id="'+t+'" class="'+e.classes()+'" tabindex="-1">'+'<button id="'+t+'-open" role="presentation" type="button" tabindex="-1">'+(o?'<i class="'+o+'"></i>':"")+"<span>"+(e._text?(o?" ":"")+e.encode(e._text):"")+"</span>"+' <i class="'+i+'caret"></i>'+"</button>"+"</div>"},postRender:function(){var e=this;return e.on("click",function(t){t.control===e&&i(t.target,e.getEl())&&(e.showMenu(),t.keyboard&&e.menu.items()[0].focus())}),e.on("mouseenter",function(t){var n,i=t.control,r=e.parent();i&&r&&i instanceof o&&i.parent()==r&&(r.items().filter("MenuButton").each(function(e){e.hideMenu&&e!=i&&(e.menu&&e.menu.visible()&&(n=!0),e.hideMenu())}),n&&(i.focus(),i.showMenu()))}),e._super()},text:function(e){var t,n,i=this;if(i._rendered)for(n=i.getEl("open").getElementsByTagName("span"),t=0;n.length>t;t++)n[t].innerHTML=i.encode(e);return this._super(e)},remove:function(){this._super(),this.menu&&this.menu.remove()}});return o}),i(Bt,[zt],function(e){return e.extend({init:function(e){var t,n,i,o,r,a=this;if(a._values=t=e.values,t){for(n=0;t.length>n;n++)i=t[n].selected||e.value===t[n].value,i&&(o=o||t[n].text,a._value=t[n].value);e.menu=t}e.text=e.text||o||t[0].text,a._super(e),a.addClass("listbox"),a.on("select",function(t){var n=t.control;r&&(t.lastControl=r),e.multiple?n.active(!n.active()):a.value(t.control.settings.value),r=n})},value:function(e){function t(e,o){e.items().each(function(e){n=e.value()===o,n&&(i=i||e.text()),e.active(n),e.menu&&t(e.menu,o)})}var n,i,o,r,a=this;if(e!==void 0){if(a.menu)t(a.menu,e);else for(o=a.settings.menu,r=0;o.length>r;r++)n=o[r].value==e,n&&(i=i||o[r].text),o[r].active=n;a.text(i||this.settings.text)}return a._super(e)}})}),i(Ft,[gt,j],function(e,t){return e.extend({Defaults:{border:0,role:"menuitem"},init:function(e){var t=this;t.hasPopup=!0,t._super(e),e=t.settings,t.addClass("menu-item"),e.menu&&t.addClass("menu-item-expand"),e.preview&&t.addClass("menu-item-preview"),("-"===t._text||"|"===t._text)&&(t.addClass("menu-item-sep"),t.aria("role","separator"),t.canFocus=!1,t._text="-"),e.selectable&&(t.aria("role","menuitemcheckbox"),t.aria("checked",!0),t.addClass("menu-item-checkbox"),e.icon="selected"),t.on("mousedown",function(e){e.preventDefault()}),t.on("mouseenter click",function(n){n.control===t&&(e.menu||"click"!==n.type?(t.showMenu(),n.keyboard&&setTimeout(function(){t.menu.items()[0].focus()},0)):(t.parent().hideAll(),t.fire("cancel"),t.fire("select")))}),e.menu&&t.aria("haspopup",!0)},hasMenus:function(){return!!this.settings.menu},showMenu:function(){var e,n=this,i=n.settings,o=n.parent();if(o.items().each(function(e){e!==n&&e.hideMenu()}),i.menu){e=n.menu,e?e.show():(e=i.menu,e.length?e={type:"menu",items:e}:e.type=e.type||"menu",o.settings.itemDefaults&&(e.itemDefaults=o.settings.itemDefaults),e=n.menu=t.create(e).parent(n).renderTo(n.getContainerElm()),e.reflow(),e.fire("show"),e.on("cancel",function(){n.focus()}),e.on("hide",function(t){t.control===e&&n.removeClass("selected")})),e._parentMenu=o,e.addClass("menu-sub");var r=e.testMoveRel(n.getEl(),["tr-tl","br-bl","tl-tr","bl-br"]);e.moveRel(n.getEl(),r),r="menu-sub-"+r,e.removeClass(e._lastRel),e.addClass(r),e._lastRel=r,n.addClass("selected"),n.aria("expanded",!0)}},hideMenu:function(){var e=this;return e.menu&&(e.menu.items().each(function(e){e.hideMenu&&e.hideMenu()}),e.menu.hide(),e.aria("expanded",!1)),e},renderHtml:function(){var e=this,t=e._id,n=e.settings,i=e.classPrefix,o=e.encode(e._text),r=e.settings.icon;return r&&e.parent().addClass("menu-has-icons"),r=i+"ico "+i+"i-"+(e.settings.icon||"none"),'<div id="'+t+'" class="'+e.classes()+'" tabindex="-1">'+("-"!==o?'<i class="'+r+'"></i>&nbsp;':"")+("-"!==o?'<span id="'+t+'-text" class="'+i+'text">'+o+"</span>":"")+(n.shortcut?'<div id="'+t+'-shortcut" class="'+i+'menu-shortcut">'+n.shortcut+"</div>":"")+(n.menu?'<div class="'+i+'caret"></div>':"")+"</div>"},postRender:function(){var e=this,t=e.settings,n=t.textStyle;if("function"==typeof n&&(n=n.call(this)),n){var i=e.getEl("text");i&&i.setAttribute("style",n)}return e._super()},remove:function(){this._super(),this.menu&&this.menu.remove()}})}),i(jt,[G,X,Ft,d],function(e,t,n,i){var o=e.extend({Defaults:{defaultType:"menuitem",border:1,layout:"stack",role:"menu"},init:function(e){var o=this;if(e.autohide=!0,e.constrainToViewport=!0,e.itemDefaults)for(var r=e.items,a=r.length;a--;)r[a]=i.extend({},e.itemDefaults,r[a]);o._super(e),o.addClass("menu"),o.keyNav=new t({root:o,enableUpDown:!0,enableLeftRight:!0,leftAction:function(){o.parent()instanceof n&&o.keyNav.cancel()},onCancel:function(){o.fire("cancel",{},!1),o.hide()}})},repaint:function(){return this.toggleClass("menu-align",!0),this._super(),this.getEl().style.height="",this.getEl("body").style.height="",this},cancel:function(){var e=this;e.hideAll(),e.fire("cancel"),e.fire("select")},hideAll:function(){var e=this;return this.find("menuitem").exec("hideMenu"),e._super()},preRender:function(){var e=this;return e.items().each(function(t){var n=t.settings;return n.icon||n.selectable?(e._hasIcons=!0,!1):void 0}),e._super()}});return o}),i(Ut,[bt],function(e){return e.extend({Defaults:{classes:"radio",role:"radio"}})}),i(Wt,[gt,W],function(e,t){return e.extend({renderHtml:function(){var e=this,t=e.classPrefix;return e.addClass("resizehandle"),"both"==e.settings.direction&&e.addClass("resizehandle-both"),e.canFocus=!1,'<div id="'+e._id+'" class="'+e.classes()+'">'+'<i class="'+t+"ico "+t+'i-resize"></i>'+"</div>"},postRender:function(){var e=this;e._super(),e.resizeDragHelper=new t(this._id,{start:function(){e.fire("ResizeStart")},drag:function(t){"both"!=e.settings.direction&&(t.deltaX=0),e.fire("Resize",t)},end:function(){e.fire("ResizeEnd")}})}})}),i(Vt,[gt],function(e){return e.extend({renderHtml:function(){var e=this;return e.addClass("spacer"),e.canFocus=!1,'<div id="'+e._id+'" class="'+e.classes()+'"></div>'}})}),i($t,[zt,m],function(e,t){var n=t.DOM;return e.extend({Defaults:{classes:"widget btn splitbtn",role:"splitbutton"},repaint:function(){var e,t,i,o=this,r=o.getEl(),a=o.layoutRect();return o._super(),e=r.firstChild,t=r.lastChild,n.css(e,{width:a.w-t.offsetWidth,height:a.h-2}),n.css(t,{height:a.h-2}),i=e.firstChild.style,i.width=i.height="100%",i=t.firstChild.style,i.width=i.height="100%",o},activeMenu:function(e){var t=this;n.toggleClass(t.getEl().lastChild,t.classPrefix+"active",e)},renderHtml:function(){var e=this,t=e._id,n=e.classPrefix,i=e.settings.icon?n+"ico "+n+"i-"+e.settings.icon:"";return'<div id="'+t+'" class="'+e.classes()+'">'+'<button type="button" hidefocus tabindex="-1">'+(i?'<i class="'+i+'"></i>':"")+(e._text?(i?" ":"")+e._text:"")+"</button>"+'<button type="button" class="'+n+'open" hidefocus tabindex="-1">'+(e._menuBtnText?(i?" ":"")+e._menuBtnText:"")+' <i class="'+n+'caret"></i>'+"</button>"+"</div>"},postRender:function(){var e=this,t=e.settings.onclick;return e.on("click",function(e){e.control!=this||n.getParent(e.target,"."+this.classPrefix+"open")||(e.stopImmediatePropagation(),t.call(this,e))}),delete e.settings.onclick,e._super()}})}),i(qt,[Pt],function(e){return e.extend({Defaults:{containerClass:"stack-layout",controlClass:"stack-layout-item",endClass:"break"}})}),i(Qt,[$,B],function(e,t){"use stict";return e.extend({lastIdx:0,Defaults:{layout:"absolute",defaults:{type:"panel"}},activateTab:function(e){this.activeTabId&&t.removeClass(this.getEl(this.activeTabId),this.classPrefix+"active"),this.activeTabId="t"+e,t.addClass(this.getEl("t"+e),this.classPrefix+"active"),e!=this.lastIdx&&(this.items()[this.lastIdx].hide(),this.lastIdx=e),this.items()[e].show().fire("showtab"),this.reflow()},renderHtml:function(){var e=this,t=e._layout,n="",i=e.classPrefix;return e.preRender(),t.preRender(e),e.items().each(function(t,o){n+='<div id="'+e._id+"-t"+o+'" class="'+i+'tab" unselectable="on">'+e.encode(t.settings.title)+"</div>"}),'<div id="'+e._id+'" class="'+e.classes()+'" hideFocus="1" tabIndex="-1">'+'<div id="'+e._id+'-head" class="'+i+'tabs">'+n+"</div>"+'<div id="'+e._id+'-body" class="'+e.classes("body")+'">'+t.renderHtml(e)+"</div>"+"</div>"},postRender:function(){var e=this;e._super(),e.settings.activeTab=e.settings.activeTab||0,e.activateTab(e.settings.activeTab),this.on("click",function(t){var n=t.target.parentNode;if(t.target.parentNode.id==e._id+"-head")for(var i=n.childNodes.length;i--;)n.childNodes[i]==t.target&&e.activateTab(i)})},initLayoutRect:function(){var e,t,n,i=this;t=n=0,i.items().each(function(e,o){t=Math.max(t,e.layoutRect().minW),n=Math.max(n,e.layoutRect().minH),i.settings.activeTab!=o&&e.hide()}),i.items().each(function(e){e.settings.x=0,e.settings.y=0,e.settings.w=t,e.settings.h=n,e.layoutRect({x:0,y:0,w:t,h:n})});var o=i.getEl("head").offsetHeight;return i.settings.minWidth=t,i.settings.minHeight=n+o,e=i._super(),e.deltaH+=i.getEl("head").offsetHeight,e.innerH=e.h-e.deltaH,e}})}),i(Gt,[gt,B],function(e,t){return e.extend({init:function(e){var t=this;t._super(e),t._value=e.value||"",t.addClass("textbox"),e.multiline?t.addClass("multiline"):t.on("keydown",function(e){13==e.keyCode&&t.parents().reverse().each(function(t){return e.preventDefault(),t.submit?(t.submit(),!1):void 0})})},value:function(e){var t=this;return e!==void 0?(t._value=e,t._rendered&&(t.getEl().value=e),t):t._rendered?t.getEl().value:t._value},repaint:function(){var e,t,n,i,o=this,r=0,a=0;e=o.getEl().style,t=o._layoutRect,i=o._lastRepaintRect||{};var s=document;return!o.settings.multiline&&s.all&&(!s.documentMode||8>=s.documentMode)&&(e.lineHeight=t.h-a+"px"),n=o._borderBox,r=n.left+n.right+8,a=n.top+n.bottom+(o.settings.multiline?8:0),t.x!==i.x&&(e.left=t.x+"px",i.x=t.x),t.y!==i.y&&(e.top=t.y+"px",i.y=t.y),t.w!==i.w&&(e.width=t.w-r+"px",i.w=t.w),t.h!==i.h&&(e.height=t.h-a+"px",i.h=t.h),o._lastRepaintRect=i,o.fire("repaint",{},!1),o},renderHtml:function(){var e=this,t=e._id,n=e.settings,i=e.encode(e._value,!1),o="";return"spellcheck"in n&&(o+=' spellcheck="'+n.spellcheck+'"'),n.maxLength&&(o+=' maxlength="'+n.maxLength+'"'),n.size&&(o+=' size="'+n.size+'"'),n.subtype&&(o+=' type="'+n.subtype+'"'),n.multiline?'<textarea id="'+t+'" class="'+e.classes()+'" '+(n.rows?' rows="'+n.rows+'"':"")+' hidefocus="true"'+o+">"+i+"</textarea>":'<input id="'+t+'" class="'+e.classes()+'" value="'+i+'" hidefocus="true"'+o+">"},postRender:function(){var e=this;return t.on(e.getEl(),"change",function(t){e.fire("change",t)}),e._super()}})}),i(Xt,[B],function(e){return function(t){var n,i=this;i.show=function(o){return i.hide(),n=!0,window.setTimeout(function(){n&&t.appendChild(e.createFragment('<div class="mce-throbber"></div>'))},o||0),i},i.hide=function(){var e=t.lastChild;return e&&-1!=e.className.indexOf("throbber")&&e.parentNode.removeChild(e),n=!1,i}}}),r([s,l,u,c,d,h,p,f,m,g,v,y,b,w,x,_,C,S,T,E,k,N,A,M,P,R,O,I,D,H,L,z,B,F,j,U,W,V,$,q,Q,G,X,Y,Z,K,J,et,tt,nt,it,ot,rt,at,st,lt,ut,ct,dt,ht,pt,ft,mt,gt,vt,yt,bt,wt,xt,_t,Ct,St,Tt,Et,kt,Nt,At,Mt,Pt,Rt,Ot,It,Dt,Ht,Lt,zt,Bt,Ft,jt,Ut,Wt,Vt,$t,qt,Qt,Gt,Xt])}(this),!function(e){function t(){function t(e){"remove"===e&&this.each(function(e,t){var n=o(t);n&&n.remove()}),this.find("span.mceEditor,div.mceEditor").each(function(e,t){var n=tinymce.get(t.id.replace(/_parent$/,""));n&&n.remove()})}function i(e){var n,i=this;if(null!=e)t.call(i),i.each(function(t,n){var i;(i=tinymce.get(n.id))&&i.setContent(e)});else if(i.length>0&&(n=tinymce.get(i[0].id)))return n.getContent()}function o(e){var t=null;return e&&e.id&&r.tinymce&&(t=tinymce.get(e.id)),t}function a(e){return!!(e&&e.length&&r.tinymce&&e.is(":tinymce"))}var s={};e.each(["text","html","val"],function(t,r){var l=s[r]=e.fn[r],u="text"===r;e.fn[r]=function(t){var r=this;if(!a(r))return l.apply(r,arguments);if(t!==n)return i.call(r.filter(":tinymce"),t),l.apply(r.not(":tinymce"),arguments),r;var s="",c=arguments;return(u?r:r.eq(0)).each(function(t,n){var i=o(n);s+=i?u?i.getContent().replace(/<(?:"[^"]*"|'[^']*'|[^'">])*>/g,""):i.getContent({save:!0}):l.apply(e(n),c)}),s}}),e.each(["append","prepend"],function(t,i){var r=s[i]=e.fn[i],l="prepend"===i;e.fn[i]=function(e){var t=this;return a(t)?e!==n?(t.filter(":tinymce").each(function(t,n){var i=o(n);i&&i.setContent(l?e+i.getContent():i.getContent()+e)}),r.apply(t.not(":tinymce"),arguments),t):void 0:r.apply(t,arguments)}}),e.each(["remove","replaceWith","replaceAll","empty"],function(n,i){var o=s[i]=e.fn[i];e.fn[i]=function(){return t.call(this,i),o.apply(this,arguments)}}),s.attr=e.fn.attr,e.fn.attr=function(t,r){var l=this,u=arguments;if(!t||"value"!==t||!a(l))return r!==n?s.attr.apply(l,u):s.attr.apply(l,u);if(r!==n)return i.call(l.filter(":tinymce"),r),s.attr.apply(l.not(":tinymce"),u),l;var c=l[0],d=o(c);return d?d.getContent({save:!0}):s.attr.apply(e(c),u)}}var n,i,o=[],r=window;e.fn.tinymce=function(n){function a(){var i=[],o=0;t&&(t(),t=null),c.each(function(e,t){var r,a=t.id,s=n.oninit;a||(t.id=a=tinymce.DOM.uniqueId()),tinymce.get(a)||(r=new tinymce.Editor(a,n,tinymce.EditorManager),i.push(r),r.on("init",function(){var e,t=s;c.css("visibility",""),s&&++o==i.length&&("string"==typeof t&&(e=-1===t.indexOf(".")?null:tinymce.resolve(t.replace(/\.\w+$/,"")),t=tinymce.resolve(t)),t.apply(e||tinymce,i))}))}),e.each(i,function(e,t){t.render()})}var s,l,u,c=this,d="";if(!c.length)return c;if(!n)return tinymce.get(c[0].id);if(c.css("visibility","hidden"),r.tinymce||i||!(s=n.script_url))1===i?o.push(a):a();else{i=1,l=s.substring(0,s.lastIndexOf("/")),-1!=s.indexOf(".min")&&(d=".min"),r.tinymce=r.tinyMCEPreInit||{base:l,suffix:d},-1!=s.indexOf("gzip")&&(u=n.language||"en",s=s+(/\?/.test(s)?"&":"?")+"js=true&core=true&suffix="+escape(d)+"&themes="+escape(n.theme||"")+"&plugins="+escape(n.plugins||"")+"&languages="+(u||""),r.tinyMCE_GZ||(r.tinyMCE_GZ={start:function(){function t(e){tinymce.ScriptLoader.markDone(tinymce.baseURI.toAbsolute(e))}t("langs/"+u+".js"),t("themes/"+n.theme+"/theme"+d+".js"),t("themes/"+n.theme+"/langs/"+u+".js"),e.each(n.plugins.split(","),function(e,n){n&&(t("plugins/"+n+"/plugin"+d+".js"),t("plugins/"+n+"/langs/"+u+".js"))})},end:function(){}}));var h=document.createElement("script");h.type="text/javascript",h.onload=h.onreadystatechange=function(t){t=t||event,("load"==t.type||/complete|loaded/.test(h.readyState))&&(tinymce.dom.Event.domLoaded=1,i=2,n.script_loaded&&n.script_loaded(),a(),e.each(o,function(e,t){t()}))},h.src=s,document.body.appendChild(h)}return c},e.extend(e.expr[":"],{tinymce:function(e){return!!(e.id&&"tinymce"in window&&tinymce.get(e.id))}})}(jQuery),tinymce.PluginManager.add("anchor",function(e){function t(){var t=e.selection.getNode();e.windowManager.open({title:"Anchor",body:{type:"textbox",name:"name",size:40,label:"Name",value:t.name||t.id},onsubmit:function(t){e.execCommand("mceInsertContent",!1,e.dom.createHTML("a",{id:t.data.name}))}})}e.addButton("anchor",{icon:"anchor",tooltip:"Anchor",onclick:t,stateSelector:"a:not([href])"}),e.addMenuItem("anchor",{icon:"anchor",text:"Anchor",context:"insert",onclick:t})}),tinymce.PluginManager.add("charmap",function(e){function t(){function t(e){for(;e;){if("TD"==e.nodeName)return e;e=e.parentNode}}var i,o,r,a;i='<table role="presentation" cellspacing="0" class="mce-charmap"><tbody>';var s=25;for(r=0;10>r;r++){for(i+="<tr>",o=0;s>o;o++){var l=n[r*s+o],u="g"+(r*s+o);i+='<td title="'+l[1]+'"><div id="'+u+'" tabIndex="-1">'+(l?String.fromCharCode(parseInt(l[0],10)):"&nbsp;")+"</div></td>"}i+="</tr>"}i+="</tbody></table>";var c={type:"container",html:i,onclick:function(t){var n=t.target;"DIV"==n.nodeName&&e.execCommand("mceInsertContent",!1,n.firstChild.nodeValue)},onmouseover:function(e){var n=t(e.target);n&&a.find("#preview").text(n.firstChild.firstChild.data)}};a=e.windowManager.open({title:"Special character",spacing:10,padding:10,items:[c,{type:"label",name:"preview",text:" ",style:"font-size: 40px; text-align: center",border:1,minWidth:100,minHeight:80}],buttons:[{text:"Close",onclick:function(){a.close()}}]})}var n=[["160","no-break space"],["38","ampersand"],["34","quotation mark"],["162","cent sign"],["8364","euro sign"],["163","pound sign"],["165","yen sign"],["169","copyright sign"],["174","registered sign"],["8482","trade mark sign"],["8240","per mille sign"],["181","micro sign"],["183","middle dot"],["8226","bullet"],["8230","three dot leader"],["8242","minutes / feet"],["8243","seconds / inches"],["167","section sign"],["182","paragraph sign"],["223","sharp s / ess-zed"],["8249","single left-pointing angle quotation mark"],["8250","single right-pointing angle quotation mark"],["171","left pointing guillemet"],["187","right pointing guillemet"],["8216","left single quotation mark"],["8217","right single quotation mark"],["8220","left double quotation mark"],["8221","right double quotation mark"],["8218","single low-9 quotation mark"],["8222","double low-9 quotation mark"],["60","less-than sign"],["62","greater-than sign"],["8804","less-than or equal to"],["8805","greater-than or equal to"],["8211","en dash"],["8212","em dash"],["175","macron"],["8254","overline"],["164","currency sign"],["166","broken bar"],["168","diaeresis"],["161","inverted exclamation mark"],["191","turned question mark"],["710","circumflex accent"],["732","small tilde"],["176","degree sign"],["8722","minus sign"],["177","plus-minus sign"],["247","division sign"],["8260","fraction slash"],["215","multiplication sign"],["185","superscript one"],["178","superscript two"],["179","superscript three"],["188","fraction one quarter"],["189","fraction one half"],["190","fraction three quarters"],["402","function / florin"],["8747","integral"],["8721","n-ary sumation"],["8734","infinity"],["8730","square root"],["8764","similar to"],["8773","approximately equal to"],["8776","almost equal to"],["8800","not equal to"],["8801","identical to"],["8712","element of"],["8713","not an element of"],["8715","contains as member"],["8719","n-ary product"],["8743","logical and"],["8744","logical or"],["172","not sign"],["8745","intersection"],["8746","union"],["8706","partial differential"],["8704","for all"],["8707","there exists"],["8709","diameter"],["8711","backward difference"],["8727","asterisk operator"],["8733","proportional to"],["8736","angle"],["180","acute accent"],["184","cedilla"],["170","feminine ordinal indicator"],["186","masculine ordinal indicator"],["8224","dagger"],["8225","double dagger"],["192","A - grave"],["193","A - acute"],["194","A - circumflex"],["195","A - tilde"],["196","A - diaeresis"],["197","A - ring above"],["198","ligature AE"],["199","C - cedilla"],["200","E - grave"],["201","E - acute"],["202","E - circumflex"],["203","E - diaeresis"],["204","I - grave"],["205","I - acute"],["206","I - circumflex"],["207","I - diaeresis"],["208","ETH"],["209","N - tilde"],["210","O - grave"],["211","O - acute"],["212","O - circumflex"],["213","O - tilde"],["214","O - diaeresis"],["216","O - slash"],["338","ligature OE"],["352","S - caron"],["217","U - grave"],["218","U - acute"],["219","U - circumflex"],["220","U - diaeresis"],["221","Y - acute"],["376","Y - diaeresis"],["222","THORN"],["224","a - grave"],["225","a - acute"],["226","a - circumflex"],["227","a - tilde"],["228","a - diaeresis"],["229","a - ring above"],["230","ligature ae"],["231","c - cedilla"],["232","e - grave"],["233","e - acute"],["234","e - circumflex"],["235","e - diaeresis"],["236","i - grave"],["237","i - acute"],["238","i - circumflex"],["239","i - diaeresis"],["240","eth"],["241","n - tilde"],["242","o - grave"],["243","o - acute"],["244","o - circumflex"],["245","o - tilde"],["246","o - diaeresis"],["248","o slash"],["339","ligature oe"],["353","s - caron"],["249","u - grave"],["250","u - acute"],["251","u - circumflex"],["252","u - diaeresis"],["253","y - acute"],["254","thorn"],["255","y - diaeresis"],["913","Alpha"],["914","Beta"],["915","Gamma"],["916","Delta"],["917","Epsilon"],["918","Zeta"],["919","Eta"],["920","Theta"],["921","Iota"],["922","Kappa"],["923","Lambda"],["924","Mu"],["925","Nu"],["926","Xi"],["927","Omicron"],["928","Pi"],["929","Rho"],["931","Sigma"],["932","Tau"],["933","Upsilon"],["934","Phi"],["935","Chi"],["936","Psi"],["937","Omega"],["945","alpha"],["946","beta"],["947","gamma"],["948","delta"],["949","epsilon"],["950","zeta"],["951","eta"],["952","theta"],["953","iota"],["954","kappa"],["955","lambda"],["956","mu"],["957","nu"],["958","xi"],["959","omicron"],["960","pi"],["961","rho"],["962","final sigma"],["963","sigma"],["964","tau"],["965","upsilon"],["966","phi"],["967","chi"],["968","psi"],["969","omega"],["8501","alef symbol"],["982","pi symbol"],["8476","real part symbol"],["978","upsilon - hook symbol"],["8472","Weierstrass p"],["8465","imaginary part"],["8592","leftwards arrow"],["8593","upwards arrow"],["8594","rightwards arrow"],["8595","downwards arrow"],["8596","left right arrow"],["8629","carriage return"],["8656","leftwards double arrow"],["8657","upwards double arrow"],["8658","rightwards double arrow"],["8659","downwards double arrow"],["8660","left right double arrow"],["8756","therefore"],["8834","subset of"],["8835","superset of"],["8836","not a subset of"],["8838","subset of or equal to"],["8839","superset of or equal to"],["8853","circled plus"],["8855","circled times"],["8869","perpendicular"],["8901","dot operator"],["8968","left ceiling"],["8969","right ceiling"],["8970","left floor"],["8971","right floor"],["9001","left-pointing angle bracket"],["9002","right-pointing angle bracket"],["9674","lozenge"],["9824","black spade suit"],["9827","black club suit"],["9829","black heart suit"],["9830","black diamond suit"],["8194","en space"],["8195","em space"],["8201","thin space"],["8204","zero width non-joiner"],["8205","zero width joiner"],["8206","left-to-right mark"],["8207","right-to-left mark"],["173","soft hyphen"]];e.addButton("charmap",{icon:"charmap",tooltip:"Special character",onclick:t}),e.addMenuItem("charmap",{icon:"charmap",text:"Special character",onclick:t,context:"insert"})}),tinymce.PluginManager.add("code",function(e){function t(){e.windowManager.open({title:"Source code",body:{type:"textbox",name:"code",multiline:!0,minWidth:e.getParam("code_dialog_width",600),minHeight:e.getParam("code_dialog_height",500),value:e.getContent({source_view:!0}),spellcheck:!1},onSubmit:function(t){e.undoManager.transact(function(){e.setContent(t.data.code)}),e.nodeChanged()}})}e.addCommand("mceCodeEditor",t),e.addButton("code",{icon:"code",tooltip:"Source code",onclick:t}),e.addMenuItem("code",{icon:"code",text:"Source code",context:"tools",onclick:t})}),tinymce.PluginManager.add("contextmenu",function(e){var t;e.on("contextmenu",function(n){var i;if(n.preventDefault(),i=e.settings.contextmenu||"link image inserttable | cell row column deletetable",t)t.show();else{var o=[];tinymce.each(i.split(/[ ,]/),function(t){var n=e.menuItems[t];"|"==t&&(n={text:t}),n&&(n.shortcut="",o.push(n))});for(var r=0;o.length>r;r++)"|"==o[r].text&&(0===r||r==o.length-1)&&o.splice(r,1);t=new tinymce.ui.Menu({items:o,context:"contextmenu"}),t.renderTo(document.body)}var a={x:n.pageX,y:n.pageY};e.inline||(a=tinymce.DOM.getPos(e.getContentAreaContainer()),a.x+=n.clientX,a.y+=n.clientY),t.moveTo(a.x,a.y),e.on("remove",function(){t.remove(),t=null})})}),tinymce.PluginManager.add("fullscreen",function(e){function t(){var e,t,n=window,i=document,o=i.body;return o.offsetWidth&&(e=o.offsetWidth,t=o.offsetHeight),n.innerWidth&&n.innerHeight&&(e=n.innerWidth,t=n.innerHeight),{w:e,h:t}}function n(){function n(){s.setStyle(u,"height",t().h-(l.clientHeight-u.clientHeight))}var l,u,c,d=document.body,h=document.documentElement;a=!a,l=e.getContainer().firstChild,u=e.getContentAreaContainer().firstChild,c=u.style,a?(i=c.width,o=c.height,c.width=c.height="100%",s.addClass(d,"mce-fullscreen"),s.addClass(h,"mce-fullscreen"),s.addClass(l,"mce-fullscreen"),s.bind(window,"resize",n),n(),r=n):(c.width=i,c.height=o,s.removeClass(d,"mce-fullscreen"),s.removeClass(h,"mce-fullscreen"),s.removeClass(l,"mce-fullscreen"),s.unbind(window,"resize",r)),e.fire("FullscreenStateChanged",{state:a})}var i,o,r,a=!1,s=tinymce.DOM;return e.settings.inline?void 0:(e.on("init",function(){e.addShortcut("Ctrl+Alt+F","",n)}),e.on("remove",function(){r&&s.unbind(window,"resize",r)}),e.addCommand("mceFullScreen",n),e.addMenuItem("fullscreen",{text:"Fullscreen",shortcut:"Ctrl+Alt+F",selectable:!0,onClick:n,onPostRender:function(){var t=this;e.on("FullscreenStateChanged",function(e){t.active(e.state)})},context:"view"}),e.addButton("fullscreen",{tooltip:"Fullscreen",shortcut:"Ctrl+Alt+F",onClick:n,onPostRender:function(){var t=this;e.on("FullscreenStateChanged",function(e){t.active(e.state)})}}),{isFullscreen:function(){return a}})}),tinymce.PluginManager.add("image",function(e){function t(e,t){function n(e,n){i.parentNode.removeChild(i),t({width:e,height:n})}var i=document.createElement("img");i.onload=function(){n(i.clientWidth,i.clientHeight)},i.onerror=function(){n()},i.src=e;var o=i.style;o.visibility="hidden",o.position="fixed",o.bottom=o.left=0,o.width=o.height="auto",document.body.appendChild(i)}function n(t){return function(){var n=e.settings.image_list;"string"==typeof n?tinymce.util.XHR.send({url:n,success:function(e){t(tinymce.util.JSON.parse(e))}}):t(n)}}function i(n){function i(){var e=[{text:"None",value:""}];return tinymce.each(n,function(t){e.push({text:t.text||t.title,value:t.value||t.url,menu:t.menu})}),e}function o(e){var t,n,i,o;t=u.find("#width")[0],n=u.find("#height")[0],i=t.value(),o=n.value(),u.find("#constrain")[0].checked()&&d&&h&&i&&o&&(e.control==t?(o=Math.round(i/d*o),n.value(o)):(i=Math.round(o/h*i),t.value(i))),d=i,h=o}function r(){function t(t){function i(){t.onload=t.onerror=null,e.selection.select(t),e.nodeChanged()}t.onload=function(){n.width||n.height||f.setAttribs(t,{width:t.clientWidth,height:t.clientHeight}),i()},t.onerror=i}var n=u.toJSON();""===n.width&&(n.width=null),""===n.height&&(n.height=null),""===n.style&&(n.style=null),n={src:n.src,alt:n.alt,width:n.width,height:n.height,style:n.style},e.undoManager.transact(function(){return n.src?(m?f.setAttribs(m,n):(n.id="__mcenew",e.selection.setContent(f.createHTML("img",n)),m=f.get("__mcenew"),f.setAttrib(m,"id",null)),t(m),void 0):(m&&(f.remove(m),e.nodeChanged()),void 0)})}function a(e){return e&&(e=e.replace(/px$/,"")),e}function s(){t(this.value(),function(e){e.width&&e.height&&(d=e.width,h=e.height,u.find("#width").value(d),u.find("#height").value(h))})}function l(){function e(e){return e.length>0&&/^[0-9]+$/.test(e)&&(e+="px"),e}var t=u.toJSON(),n=f.parseStyle(t.style);f.setAttrib(m,"style",""),delete n.margin,n["margin-top"]=n["margin-bottom"]=e(t.vspace),n["margin-left"]=n["margin-right"]=e(t.hspace),n["border-width"]=e(t.border),u.find("#style").value(f.serializeStyle(f.parseStyle(f.serializeStyle(n))))}var u,c,d,h,p,f=e.dom,m=e.selection.getNode();d=f.getAttrib(m,"width"),h=f.getAttrib(m,"height"),"IMG"!=m.nodeName||m.getAttribute("data-mce-object")?m=null:c={src:f.getAttrib(m,"src"),alt:f.getAttrib(m,"alt"),width:d,height:h},n&&(p={name:"target",type:"listbox",label:"Image list",values:i(),onselect:function(e){var t=u.find("#alt");(!t.value()||e.lastControl&&t.value()==e.lastControl.text())&&t.value(e.control.text()),u.find("#src").value(e.control.value())}});var g=[{name:"src",type:"filepicker",filetype:"image",label:"Source",autofocus:!0,onchange:s},p,{name:"alt",type:"textbox",label:"Image description"},{type:"container",label:"Dimensions",layout:"flex",direction:"row",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:3,size:3,onchange:o},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:3,size:3,onchange:o},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]}];e.settings.image_advtab?(m&&(c.hspace=a(m.style.marginLeft||m.style.marginRight),c.vspace=a(m.style.marginTop||m.style.marginBottom),c.border=a(m.style.borderWidth),c.style=e.dom.serializeStyle(e.dom.parseStyle(e.dom.getAttrib(m,"style")))),u=e.windowManager.open({title:"Insert/edit image",data:c,bodyType:"tabpanel",body:[{title:"General",type:"form",items:g},{title:"Advanced",type:"form",pack:"start",items:[{label:"Style",name:"style",type:"textbox"},{type:"form",layout:"grid",packV:"start",columns:2,padding:0,alignH:["left","right"],defaults:{type:"textbox",maxWidth:50,onchange:l},items:[{label:"Vertical space",name:"vspace"},{label:"Horizontal space",name:"hspace"},{label:"Border",name:"border"}]}]}],onSubmit:r})):u=e.windowManager.open({title:"Edit image",data:c,body:g,onSubmit:r})}e.addButton("image",{icon:"image",tooltip:"Insert/edit image",onclick:n(i),stateSelector:"img:not([data-mce-object])"}),e.addMenuItem("image",{icon:"image",text:"Insert image",onclick:n(i),context:"insert",prependToContext:!0})}),tinymce.PluginManager.add("insertdatetime",function(e){function t(t,n){function i(e,t){if(e=""+e,t>e.length)for(var n=0;t-e.length>n;n++)e="0"+e;
return e}return n=n||new Date,t=t.replace("%D","%m/%d/%Y"),t=t.replace("%r","%I:%M:%S %p"),t=t.replace("%Y",""+n.getFullYear()),t=t.replace("%y",""+n.getYear()),t=t.replace("%m",i(n.getMonth()+1,2)),t=t.replace("%d",i(n.getDate(),2)),t=t.replace("%H",""+i(n.getHours(),2)),t=t.replace("%M",""+i(n.getMinutes(),2)),t=t.replace("%S",""+i(n.getSeconds(),2)),t=t.replace("%I",""+((n.getHours()+11)%12+1)),t=t.replace("%p",""+(12>n.getHours()?"AM":"PM")),t=t.replace("%B",""+e.translate(s[n.getMonth()])),t=t.replace("%b",""+e.translate(a[n.getMonth()])),t=t.replace("%A",""+e.translate(r[n.getDay()])),t=t.replace("%a",""+e.translate(o[n.getDay()])),t=t.replace("%%","%")}function n(n){var i=t(n);if(e.settings.insertdatetime_element){var o;o=/%[HMSIp]/.test(n)?t("%Y-%m-%dT%H:%M"):t("%Y-%m-%d"),i='<time datetime="'+o+'">'+i+"</time>";var r=e.dom.getParent(e.selection.getStart(),"time");if(r)return e.dom.setOuterHTML(r,i),void 0}e.insertContent(i)}var i,o="Sun Mon Tue Wed Thu Fri Sat Sun".split(" "),r="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),a="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),s="January February March April May June July August September October November December".split(" "),l=[];e.addCommand("mceInsertDate",function(){n(e.getParam("insertdatetime_dateformat",e.translate("%Y-%m-%d")))}),e.addCommand("mceInsertTime",function(){n(e.getParam("insertdatetime_timeformat",e.translate("%H:%M:%S")))}),e.addButton("inserttime",{type:"splitbutton",title:"Insert time",onclick:function(){n(i||"%H:%M:%S")},menu:l}),tinymce.each(e.settings.insertdatetime_formats||["%H:%M:%S","%Y-%m-%d","%I:%M:%S %p","%D"],function(e){l.push({text:t(e),onclick:function(){i=e,n(e)}})}),e.addMenuItem("insertdatetime",{icon:"date",text:"Insert date/time",menu:l,context:"insert"})}),tinymce.PluginManager.add("link",function(e){function t(t){return function(){var n=e.settings.link_list;"string"==typeof n?tinymce.util.XHR.send({url:n,success:function(e){t(tinymce.util.JSON.parse(e))}}):t(n)}}function n(t){function n(e){var t=d.find("#text");(!t.value()||e.lastControl&&t.value()==e.lastControl.text())&&t.value(e.control.text()),d.find("#href").value(e.control.value())}function i(){var e=[{text:"None",value:""}];return tinymce.each(t,function(t){e.push({text:t.text||t.title,value:t.value||t.url,menu:t.menu})}),e}function o(t){var n=[{text:"None",value:""}];return tinymce.each(e.settings.rel_list,function(e){n.push({text:e.text||e.title,value:e.value,selected:t===e.value})}),n}function r(t){var n=[{text:"None",value:""}];return e.settings.target_list||n.push({text:"New window",value:"_blank"}),tinymce.each(e.settings.target_list,function(e){n.push({text:e.text||e.title,value:e.value,selected:t===e.value})}),n}function a(t){var i=[];return tinymce.each(e.dom.select("a:not([href])"),function(e){var n=e.name||e.id;n&&i.push({text:n,value:"#"+n,selected:-1!=t.indexOf("#"+n)})}),i.length?(i.unshift({text:"None",value:""}),{name:"anchor",type:"listbox",label:"Anchors",values:i,onselect:n}):void 0}function s(){c||0!==m.text.length||this.parent().parent().find("#text")[0].value(this.value())}var l,u,c,d,h,p,f,m={},g=e.selection,v=e.dom;l=g.getNode(),u=v.getParent(l,"a[href]"),m.text=c=u?u.innerText||u.textContent:g.getContent({format:"text"}),m.href=u?v.getAttrib(u,"href"):"",m.target=u?v.getAttrib(u,"target"):"",m.rel=u?v.getAttrib(u,"rel"):"","IMG"==l.nodeName&&(m.text=c=" "),t&&(h={type:"listbox",label:"Link list",values:i(),onselect:n}),e.settings.target_list!==!1&&(f={name:"target",type:"listbox",label:"Target",values:r(m.target)}),e.settings.rel_list&&(p={name:"rel",type:"listbox",label:"Rel",values:o(m.rel)}),d=e.windowManager.open({title:"Insert link",data:m,body:[{name:"href",type:"filepicker",filetype:"file",size:40,autofocus:!0,label:"Url",onchange:s,onkeyup:s},{name:"text",type:"textbox",size:40,label:"Text to display",onchange:function(){m.text=this.value()}},a(m.href),h,p,f],onSubmit:function(t){function n(t,n){window.setTimeout(function(){e.windowManager.confirm(t,n)},0)}function i(){o.text!=c?u?(e.focus(),u.innerHTML=o.text,v.setAttribs(u,{href:r,target:o.target?o.target:null,rel:o.rel?o.rel:null}),g.select(u)):e.insertContent(v.createHTML("a",{href:r,target:o.target?o.target:null,rel:o.rel?o.rel:null},o.text)):e.execCommand("mceInsertLink",!1,{href:r,target:o.target,rel:o.rel?o.rel:null})}var o=t.data,r=o.href;return r?r.indexOf("@")>0&&-1==r.indexOf("//")&&-1==r.indexOf("mailto:")?(n("The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",function(e){e&&(r="mailto:"+r),i()}),void 0):/^\s*www\./i.test(r)?(n("The URL you entered seems to be an external link. Do you want to add the required http:// prefix?",function(e){e&&(r="http://"+r),i()}),void 0):(i(),void 0):(e.execCommand("unlink"),void 0)}})}e.addButton("link",{icon:"link",tooltip:"Insert/edit link",shortcut:"Ctrl+K",onclick:t(n),stateSelector:"a[href]"}),e.addButton("unlink",{icon:"unlink",tooltip:"Remove link",cmd:"unlink",stateSelector:"a[href]"}),e.addShortcut("Ctrl+K","",t(n)),this.showDialog=n,e.addMenuItem("link",{icon:"link",text:"Insert link",shortcut:"Ctrl+K",onclick:t(n),stateSelector:"a[href]",context:"insert",prependToContext:!0})}),tinymce.PluginManager.add("lists",function(e){var t=this;e.on("init",function(){function n(e){function t(t){var i,o,r;o=e[t?"startContainer":"endContainer"],r=e[t?"startOffset":"endOffset"],1==o.nodeType&&(i=b.create("span",{"data-mce-type":"bookmark"}),o.hasChildNodes()?(r=Math.min(r,o.childNodes.length-1),o.insertBefore(i,o.childNodes[r])):o.appendChild(i),o=i,r=0),n[t?"startContainer":"endContainer"]=o,n[t?"startOffset":"endOffset"]=r}var n={};return t(!0),e.collapsed||t(),n}function i(t){function n(n){function i(e){for(var t=e.parentNode.firstChild,n=0;t;){if(t==e)return n;(1!=t.nodeType||"bookmark"!=t.getAttribute("data-mce-type"))&&n++,t=t.nextSibling}return-1}var o,r,a;if(o=a=t[n?"startContainer":"endContainer"],r=t[n?"startOffset":"endOffset"],o){if(1==o.nodeType){if(o.parentNode==e.getBody()){var s,l=e.settings.forced_root_block;l?(s=b.create(l),(!tinymce.Env.ie||tinymce.Env.ie>10)&&s.appendChild(b.create("br",{"data-mce-bogus":"true"})),o.parentNode.insertBefore(s,o),o=s,r=0):(s=b.create("br"),o.parentNode.insertBefore(s,o),o=o.parentNode,r=i(s))}else n?(r=i(o),o=o.parentNode):(r=i(o),o=o.parentNode);b.remove(a)}t[n?"startContainer":"endContainer"]=o,t[n?"startOffset":"endOffset"]=r}}n(!0),n();var i=b.createRng();i.setStart(t.startContainer,t.startOffset),t.endContainer&&i.setEnd(t.endContainer,t.endOffset),w.setRng(i)}function o(e){return e&&/^(OL|UL)$/.test(e.nodeName)}function r(e){return e.parentNode.firstChild==e}function a(e){return e.parentNode.lastChild==e}function s(t){return t&&!!e.schema.getTextBlockElements()[t.nodeName]}function l(t,n){var i,o;if(e.settings.forced_root_block&&(n=n||e.settings.forced_root_block),o=n?b.create(n):b.createFragment(),t)for(;i=t.firstChild;)o.appendChild(i);return e.settings.forced_root_block||o.appendChild(b.create("br")),o.hasChildNodes()||tinymce.Env.ie&&!(tinymce.Env.ie>10)||(o.innerHTML='<br data-mce-bogus="1">'),o}function u(){return tinymce.grep(w.getSelectedBlocks(),function(e){return"LI"==e.nodeName})}function c(){return tinymce.grep(w.getSelectedBlocks(),s)}function d(e,t,n){var i,o,r=b.select('span[data-mce-type="bookmark"]',e);n=n||l(t),i=b.createRng(),i.setStartAfter(t),i.setEndAfter(e),o=i.extractContents(),b.isEmpty(o)||b.insertAfter(o,e),b.isEmpty(n)||b.insertAfter(n,e),b.isEmpty(t.parentNode)&&(tinymce.each(r,function(e){t.parentNode.parentNode.insertBefore(e,t.parentNode)}),b.remove(t.parentNode)),b.remove(t)}function h(e){var t,n;if(t=e.nextSibling,t&&o(t)&&t.nodeName==e.nodeName){for(;n=t.firstChild;)e.appendChild(n);b.remove(t)}if(t=e.previousSibling,t&&o(t)&&t.nodeName==e.nodeName){for(;n=t.firstChild;)e.insertBefore(n,e.firstChild);b.remove(t)}}function p(e){tinymce.each(tinymce.grep(b.select("ol,ul",e)),function(e){var t,n=e.parentNode;"LI"==n.nodeName&&n.firstChild==e&&(t=n.previousSibling,t&&"LI"==t.nodeName&&(t.appendChild(e),b.isEmpty(n)&&b.remove(n))),o(n)&&(t=n.previousSibling,t&&"LI"==t.nodeName&&t.appendChild(e))})}function f(){var e,t=n(w.getRng(!0));return tinymce.each(u(),function(t){var n,i;return n=t.previousSibling,n&&"UL"==n.nodeName?(n.appendChild(t),void 0):n&&"LI"==n.nodeName&&o(n.lastChild)?(n.lastChild.appendChild(t),void 0):(n=t.nextSibling,n&&"UL"==n.nodeName?(n.insertBefore(t,n.firstChild),void 0):(n&&"LI"==n.nodeName&&o(t.lastChild)||(n=t.previousSibling,n&&"LI"==n.nodeName&&(i=b.create(t.parentNode.nodeName),n.appendChild(i),i.appendChild(t)),e=!0),void 0))}),i(t),e}function m(){function e(e){b.isEmpty(e)&&b.remove(e)}var t,s=n(w.getRng(!0));return tinymce.each(u(),function(n){var i,s=n.parentNode,u=s.parentNode;if(r(n)&&a(n))if("LI"==u.nodeName)b.insertAfter(n,u),e(u);else{if(!o(u))return;b.remove(s,!0)}else if(r(n))if("LI"==u.nodeName)b.insertAfter(n,u),i=b.create("LI"),i.appendChild(s),b.insertAfter(i,n),e(u);else{if(!o(u))return;u.insertBefore(n,s)}else if(a(n))if("LI"==u.nodeName)b.insertAfter(n,u);else{if(!o(u))return;b.insertAfter(n,s)}else{if("LI"==u.nodeName)s=u,i=l(n,"LI");else{if(!o(u))return;i=l(n,"LI")}d(s,n,i),p(s.parentNode)}t=!0}),i(s),t}function g(t){function r(){function t(t){var n,i,o=e.getBody();for(n=a[t?"startContainer":"endContainer"],i=a[t?"startOffset":"endOffset"],1==n.nodeType&&(n=n.childNodes[Math.min(i,n.childNodes.length-1)]||n);n.parentNode!=o;){if(s(n))return n;if(/^(TD|TH)$/.test(n.parentNode.nodeName))return n;n=n.parentNode}return n}function n(e,t){var n,i=[];if(!s(e)){for(;e&&(n=e[t?"previousSibling":"nextSibling"],!b.isBlock(n)&&n);)e=n;for(;e;)i.push(e),e=e[t?"nextSibling":"previousSibling"]}return i}var i,o,r=t(!0),l=t();o=n(r,!0),r!=l&&(o=o.concat(n(l).reverse())),tinymce.each(o,function(e){if(!b.isBlock(e)||"BR"==e.nodeName){if(!i||"BR"==e.nodeName){if("BR"==e.nodeName&&(!e.nextSibling||b.isBlock(e.nextSibling)&&"BR"!=e.nextSibling.nodeName))return b.remove(e),!1;i=b.create("p"),u.push(i),e.parentNode.insertBefore(i,e)}return"BR"!=e.nodeName?i.appendChild(e):b.remove(e),e==l?!1:void 0}})}var a=w.getRng(!0),l=n(a),u=c();r(),tinymce.each(u,function(e){var n,i;i=e.previousSibling,i&&o(i)&&i.nodeName==t?(n=i,e=b.rename(e,"LI"),i.appendChild(e)):(n=b.create(t),e.parentNode.insertBefore(n,e),n.appendChild(e),e=b.rename(e,"LI")),h(n)}),i(l)}function v(){var e=n(w.getRng(!0));tinymce.each(u(),function(e){var t,n;for(t=e;t;t=t.parentNode)o(t)&&(n=t);d(n,e)}),i(e)}function y(e){var t=b.getParent(w.getStart(),"OL,UL");if(t)if(t.nodeName==e)v(e);else{var o=n(w.getRng(!0));h(b.rename(t,e)),i(o)}else g(e)}var b=e.dom,w=e.selection;t.backspaceDelete=function(e){function t(e,t){var n=e.startContainer,i=e.startOffset;if(3==n.nodeType&&(t?n.data.length>i:i>0))return n;for(var o=new tinymce.dom.TreeWalker(e.startContainer);n=o[t?"next":"prev"]();)if(3==n.nodeType&&n.data.length>0)return n}function r(e,t){var n,i,r=e.parentNode;for(o(t.lastChild)&&(i=t.lastChild),n=t.lastChild,n&&"BR"==n.nodeName&&e.hasChildNodes()&&b.remove(n);n=e.firstChild;)t.appendChild(n);i&&t.appendChild(i),b.remove(e),b.isEmpty(r)&&b.remove(r)}if(w.isCollapsed()){var a=b.getParent(w.getStart(),"LI");if(a){var s=w.getRng(!0),l=b.getParent(t(s,e),"LI");if(l&&l!=a){var u=n(s);return e?r(l,a):r(a,l),i(u),!0}if(!l&&!e&&v(a.parentNode.nodeName))return!0}}},e.addCommand("Indent",function(){return f()?void 0:!0}),e.addCommand("Outdent",function(){return m()?void 0:!0}),e.addCommand("InsertUnorderedList",function(){y("UL")}),e.addCommand("InsertOrderedList",function(){y("OL")})}),e.on("keydown",function(e){e.keyCode==tinymce.util.VK.BACKSPACE?t.backspaceDelete()&&e.preventDefault():e.keyCode==tinymce.util.VK.DELETE&&t.backspaceDelete(!0)&&e.preventDefault()})}),tinymce.PluginManager.add("media",function(e,t){function n(e){return-1!=e.indexOf(".mp3")?"audio/mpeg":-1!=e.indexOf(".wav")?"audio/wav":-1!=e.indexOf(".mp4")?"video/mp4":-1!=e.indexOf(".webm")?"video/webm":-1!=e.indexOf(".ogg")?"video/ogg":-1!=e.indexOf(".swf")?"application/x-shockwave-flash":""}function i(){function t(e){var t,o,r,a;t=n.find("#width")[0],o=n.find("#height")[0],r=t.value(),a=o.value(),n.find("#constrain")[0].checked()&&i&&l&&r&&a&&(e.control==t?(a=Math.round(r/i*a),o.value(a)):(r=Math.round(a/l*r),t.value(r))),i=r,l=a}var n,i,l,u;u=s(e.selection.getNode()),i=u.width,l=u.height,n=e.windowManager.open({title:"Insert/edit video",data:u,bodyType:"tabpanel",body:[{title:"General",type:"form",onShowTab:function(){this.fromJSON(a(this.next().find("#embed").value()))},items:[{name:"source1",type:"filepicker",filetype:"media",size:40,autofocus:!0,label:"Source"},{name:"source2",type:"filepicker",filetype:"media",size:40,label:"Alternative source"},{name:"poster",type:"filepicker",filetype:"image",size:40,label:"Poster"},{type:"container",label:"Dimensions",layout:"flex",direction:"row",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:3,size:3,onchange:t},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:3,size:3,onchange:t},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]}]},{title:"Embed",type:"panel",layout:"flex",direction:"column",align:"stretch",padding:10,spacing:10,onShowTab:function(){this.find("#embed").value(r(this.parent().toJSON()))},items:[{type:"label",text:"Paste your embed code below:"},{type:"textbox",flex:1,name:"embed",value:o(),multiline:!0,label:"Source"}]}],onSubmit:function(){e.insertContent(r(this.toJSON()))}})}function o(){var t=e.selection.getNode();return t.getAttribute("data-mce-object")?e.selection.getContent():void 0}function r(i){var o="";return i.source1||(tinymce.extend(i,a(i.embed)),i.source1)?(i.source1=e.convertURL(i.source1,"source"),i.source2=e.convertURL(i.source2,"source"),i.source1mime=n(i.source1),i.source2mime=n(i.source2),i.poster=e.convertURL(i.poster,"poster"),i.flashPlayerUrl=e.convertURL(t+"/moxieplayer.swf","movie"),i.embed?o=l(i.embed,i,!0):(tinymce.each(u,function(e){var t,n,o;if(t=e.regex.exec(i.source1)){for(o=e.url,n=0;t[n];n++)o=o.replace("$"+n,function(){return t[n]});i.source1=o,i.type=e.type,i.width=e.w,i.height=e.h}}),i.width=i.width||300,i.height=i.height||150,tinymce.each(i,function(t,n){i[n]=e.dom.encode(t)}),"iframe"==i.type?o+='<iframe src="'+i.source1+'" width="'+i.width+'" height="'+i.height+'"></iframe>':"application/x-shockwave-flash"==i.source1mime?(o+='<object data="'+i.source1+'" width="'+i.width+'" height="'+i.height+'" type="application/x-shockwave-flash">',i.poster&&(o+='<img src="'+i.poster+'" width="'+i.width+'" height="'+i.height+'" />'),o+="</object>"):-1!=i.source1mime.indexOf("audio")?e.settings.audio_template_callback?o=e.settings.audio_template_callback(i):o+='<audio controls="controls" src="'+i.source1+'">'+(i.source2?'\n<source src="'+i.source2+'"'+(i.source2mime?' type="'+i.source2mime+'"':"")+" />\n":"")+"</audio>":o=e.settings.video_template_callback?e.settings.video_template_callback(i):'<video width="'+i.width+'" height="'+i.height+'"'+(i.poster?' poster="'+i.poster+'"':"")+' controls="controls">\n'+'<source src="'+i.source1+'"'+(i.source1mime?' type="'+i.source1mime+'"':"")+" />\n"+(i.source2?'<source src="'+i.source2+'"'+(i.source2mime?' type="'+i.source2mime+'"':"")+" />\n":"")+"</video>"),o):""}function a(e){var t={};return new tinymce.html.SaxParser({validate:!1,special:"script,noscript",start:function(e,n){t.source1||"param"!=e||(t.source1=n.map.movie),("iframe"==e||"object"==e||"embed"==e||"video"==e||"audio"==e)&&(t=tinymce.extend(n.map,t)),"source"==e&&(t.source1?t.source2||(t.source2=n.map.src):t.source1=n.map.src),"img"!=e||t.poster||(t.poster=n.map.src)}}).parse(e),t.source1=t.source1||t.src||t.data,t.source2=t.source2||"",t.poster=t.poster||"",t}function s(t){return t.getAttribute("data-mce-object")?a(e.serializer.serialize(t,{selection:!0})):{}}function l(e,t,n){function i(e,t){var n,i,o,r;for(n in t)if(o=""+t[n],e.map[n])for(i=e.length;i--;)r=e[i],r.name==n&&(o?(e.map[n]=o,r.value=o):(delete e.map[n],e.splice(i,1)));else o&&(e.push({name:n,value:o}),e.map[n]=o)}var o,r=new tinymce.html.Writer,a=0;return new tinymce.html.SaxParser({validate:!1,special:"script,noscript",comment:function(e){r.comment(e)},cdata:function(e){r.cdata(e)},text:function(e,t){r.text(e,t)},start:function(e,s,l){switch(e){case"video":case"object":case"img":case"iframe":i(s,{width:t.width,height:t.height})}if(n)switch(e){case"video":i(s,{poster:t.poster,src:""}),t.source2&&i(s,{src:""});break;case"iframe":i(s,{src:t.source1});break;case"source":if(a++,2>=a&&(i(s,{src:t["source"+a],type:t["source"+a+"mime"]}),!t["source"+a]))return;break;case"img":if(!t.poster)return;o=!0}r.start(e,s,l)},end:function(e){if("video"==e&&n)for(var s=1;2>=s;s++)if(t["source"+s]){var l=[];l.map={},s>a&&(i(l,{src:t["source"+s],type:t["source"+s+"mime"]}),r.start("source",l,!0))}if(t.poster&&"object"==e&&n&&!o){var u=[];u.map={},i(u,{src:t.poster,width:t.width,height:t.height}),r.start("img",u,!0)}r.end(e)}},new tinymce.html.Schema({})).parse(e),r.getContent()}var u=[{regex:/youtu\.be\/([a-z1-9.-_]+)/,type:"iframe",w:425,h:350,url:"http://www.youtube.com/embed/$1"},{regex:/youtube\.com(.+)v=([^&]+)/,type:"iframe",w:425,h:350,url:"http://www.youtube.com/embed/$2"},{regex:/vimeo\.com\/([0-9]+)/,type:"iframe",w:425,h:350,url:"http://player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc"},{regex:/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/,type:"iframe",w:425,h:350,url:'http://maps.google.com/maps/ms?msid=$2&output=embed"'}];e.on("ResolveName",function(e){var t;1==e.target.nodeType&&(t=e.target.getAttribute("data-mce-object"))&&(e.name=t)}),e.on("preInit",function(){var t=e.schema.getSpecialElements();tinymce.each("video audio iframe object".split(" "),function(e){t[e]=RegExp("</"+e+"[^>]*>","gi")}),e.schema.addValidElements("object[id|style|width|height|classid|codebase|*],embed[id|style|width|height|type|src|*],video[*],audio[*]");var n=e.schema.getBoolAttrs();tinymce.each("webkitallowfullscreen mozallowfullscreen allowfullscreen".split(" "),function(e){n[e]={}}),e.parser.addNodeFilter("iframe,video,audio,object,embed",function(t,n){for(var i,o,r,a,s,l,u,c=t.length;c--;){for(o=t[c],r=new tinymce.html.Node("img",1),r.shortEnded=!0,l=o.attributes,i=l.length;i--;)a=l[i].name,s=l[i].value,"width"!==a&&"height"!==a&&"style"!==a&&(("data"==a||"src"==a)&&(s=e.convertURL(s,a)),r.attr("data-mce-p-"+a,s));u=o.firstChild&&o.firstChild.value,u&&(r.attr("data-mce-html",escape(u)),r.firstChild=null),r.attr({width:o.attr("width")||"300",height:o.attr("height")||("audio"==n?"30":"150"),style:o.attr("style"),src:tinymce.Env.transparentSrc,"data-mce-object":n,"class":"mce-object mce-object-"+n}),o.replace(r)}}),e.serializer.addAttributeFilter("data-mce-object",function(e,t){for(var n,i,o,r,a,s,l=e.length;l--;){for(n=e[l],i=new tinymce.html.Node(n.attr(t),1),"audio"!=n.attr(t)&&i.attr({width:n.attr("width"),height:n.attr("height")}),i.attr({style:n.attr("style")}),r=n.attributes,o=r.length;o--;){var u=r[o].name;0===u.indexOf("data-mce-p-")&&i.attr(u.substr(11),r[o].value)}a=n.attr("data-mce-html"),a&&(s=new tinymce.html.Node("#text",3),s.raw=!0,s.value=unescape(a),i.append(s)),n.replace(i)}})}),e.on("ObjectSelected",function(e){"audio"==e.target.getAttribute("data-mce-object")&&e.preventDefault()}),e.on("objectResized",function(e){var t,n=e.target;n.getAttribute("data-mce-object")&&(t=n.getAttribute("data-mce-html"),t&&(t=unescape(t),n.setAttribute("data-mce-html",escape(l(t,{width:e.width,height:e.height})))))}),e.addButton("media",{tooltip:"Insert/edit video",onclick:i,stateSelector:"img[data-mce-object=video]"}),e.addMenuItem("media",{icon:"media",text:"Insert video",onclick:i,context:"insert",prependToContext:!0})}),!function(e,t){"use strict";function n(e,t){for(var n,i=[],r=0;e.length>r;++r){if(n=a[e[r]]||o(e[r]),!n)throw"module definition dependecy not found: "+e[r];i.push(n)}t.apply(null,i)}function i(e,i,o){if("string"!=typeof e)throw"invalid module definition, module id must be defined and be a string";if(i===t)throw"invalid module definition, dependencies must be specified";if(o===t)throw"invalid module definition, definition function must be specified";n(i,function(){a[e]=o.apply(null,arguments)})}function o(t){for(var n=e,i=t.split(/[.\/]/),o=0;i.length>o;++o){if(!n[i[o]])return;n=n[i[o]]}return n}function r(n){for(var i=0;n.length>i;i++){for(var o=e,r=n[i],s=r.split(/[.\/]/),l=0;s.length-1>l;++l)o[s[l]]===t&&(o[s[l]]={}),o=o[s[l]];o[s[s.length-1]]=a[r]}}var a={},s="tinymce/pasteplugin/Clipboard",l="tinymce/Env",u="tinymce/util/Tools",c="tinymce/util/VK",d="tinymce/pasteplugin/WordFilter",h="tinymce/html/DomParser",p="tinymce/html/Schema",f="tinymce/html/Serializer",m="tinymce/html/Node",g="tinymce/pasteplugin/Quirks",v="tinymce/pasteplugin/Plugin",y="tinymce/PluginManager";i(s,[l,u,c],function(e,t,n){function i(){return!e.gecko&&("ClipboardEvent"in window||e.webkit&&"FocusEvent"in window)}return function(o){function r(){return(new Date).getTime()}function a(e){return n.metaKeyPressed(e)&&86==e.keyCode||e.shiftKey&&45==e.keyCode}function s(e){return e.innerText||e.textContent}function l(){return 100>r()-f||"text"==m.pasteFormat}function u(e,n){return t.each(n,function(t){e=t.constructor==RegExp?e.replace(t,""):e.replace(t[0],t[1])}),e}function c(t){var n=o.fire("PastePreProcess",{content:t});t=n.content,o.settings.paste_data_images||(t=t.replace(/<img src=\"data:image[^>]+>/g,"")),(o.settings.paste_remove_styles||o.settings.paste_remove_styles_if_webkit!==!1&&e.webkit)&&(t=t.replace(/ style=\"[^\"]+\"/g,"")),n.isDefaultPrevented()||o.insertContent(t)}function d(e){e=o.dom.encode(e).replace(/\r\n/g,"\n");var t=o.dom.getParent(o.selection.getStart(),o.dom.isBlock);e=t&&/^(PRE|DIV)$/.test(t.nodeName)||!o.settings.forced_root_block?u(e,[[/\n/g,"<br>"]]):u(e,[[/\n\n/g,"</p><p>"],[/^(.*<\/p>)(<p>)$/,"<p>$1"],[/\n/g,"<br />"]]);var n=o.fire("PastePreProcess",{content:e});n.isDefaultPrevented()||o.insertContent(n.content)}function h(){var e=o.dom.getViewPort().y,t=o.dom.add(o.getBody(),"div",{contentEditable:!1,"data-mce-bogus":"1",style:"position: absolute; top: "+e+"px; left: 0; width: 1px; height: 1px; overflow: hidden"},'<div contentEditable="true" data-mce-bogus="1">X</div>');return o.dom.bind(t,"beforedeactivate focusin focusout",function(e){e.stopPropagation()}),t}function p(e){o.dom.unbind(e),o.dom.remove(e)}var f,m=this;if(o.on("keydown",function(e){n.metaKeyPressed(e)&&e.shiftKey&&86==e.keyCode&&(f=r())}),i())o.on("paste",function(e){function t(e,t){for(var i=0;n.types.length>i;i++)if(n.types[i]==e)return t(n.getData(e)),!0}var n=e.clipboardData;n&&(e.preventDefault(),l()?t("text/plain",d)||t("text/html",c):t("text/html",c)||t("text/plain",d))});else{if(e.ie){var g=0;o.on("keydown",function(e){if(a(e)&&!e.isDefaultPrevented()){e.stopImmediatePropagation();var t=h();g=r(),o.dom.bind(t,"paste",function(){setTimeout(function(){o.selection.setRng(n),p(t),l()?d(s(t.firstChild)):c(t.firstChild.innerHTML)},0)});var n=o.selection.getRng();t.firstChild.focus(),t.firstChild.innerText=""}}),o.on("init",function(){var e=o.dom;o.dom.bind(o.getBody(),"paste",function(t){if(r()-g>100){var n,i=h();t.preventDefault(),e.bind(i,"paste",function(e){e.stopPropagation(),n=!0});var a=o.selection.getRng(),u=e.doc.body.createTextRange();if(u.moveToElementText(i.firstChild),u.execCommand("Paste"),p(i),!n)return o.windowManager.alert("Please use Ctrl+V/Cmd+V keyboard shortcuts to paste contents."),void 0;o.selection.setRng(a),l()?d(s(i.firstChild)):c(i.firstChild.innerHTML)}})})}else o.on("init",function(){o.dom.bind(o.getBody(),"paste",function(e){e.preventDefault(),o.windowManager.alert("Please use Ctrl+V/Cmd+V keyboard shortcuts to paste contents.")})}),o.on("keydown",function(e){if(a(e)&&!e.isDefaultPrevented()){e.stopImmediatePropagation();var t=h(),n=o.selection.getRng();o.selection.select(t,!0),o.dom.bind(t,"paste",function(e){e.stopPropagation(),setTimeout(function(){p(t),o.lastRng=n,o.selection.setRng(n);var e=t.firstChild;e.lastChild&&"BR"==e.lastChild.nodeName&&e.removeChild(e.lastChild),l()?d(s(e)):c(e.innerHTML)},0)})}});o.settings.paste_data_images||o.on("drop",function(e){var t=e.dataTransfer;t&&t.files&&t.files.length>0&&e.preventDefault()})}o.paste_block_drop&&o.on("dragend dragover draggesture dragdrop drop drag",function(e){e.preventDefault(),e.stopPropagation()}),this.paste=c,this.pasteText=d}}),i(d,[u,h,p,f,m],function(e,t,n,i,o){return function(r){var a=e.each;r.on("PastePreProcess",function(s){function l(e){a(e,function(e){p=e.constructor==RegExp?p.replace(e,""):p.replace(e[0],e[1])})}function u(e){function t(e,t,a,s){var l=e._listLevel||r;l!=r&&(r>l?n&&(n=n.parent.parent):(i=n,n=null)),n&&n.name==a?n.append(e):(i=i||n,n=new o(a,1),s>1&&n.attr("start",""+s),e.wrap(n)),e.name="li",t.value="";var u=t.next;u&&3==u.type&&(u.value=u.value.replace(/^\u00a0+/,"")),l>r&&i&&i.lastChild.append(n),r=l}for(var n,i,r=1,a=e.getAll("p"),s=0;a.length>s;s++)if(e=a[s],"p"==e.name&&e.firstChild){for(var l="",u=e.firstChild;u&&!(l=u.value);)u=u.firstChild;if(/^\s*[\u2022\u00b7\u00a7\u00d8o\u25CF]\s*$/.test(l)){t(e,u,"ul");continue}if(/^\s*\w+\./.test(l)){var c=/([0-9])\./.exec(l),d=1;c&&(d=parseInt(c[1],10)),t(e,u,"ol",d);continue}n=null}}function c(t,n){if("p"===t.name){var i=/mso-list:\w+ \w+([0-9]+)/.exec(n);i&&(t._listLevel=parseInt(i[1],10))}if(r.getParam("paste_retain_style_properties","none")){var o="";if(e.each(r.dom.parseStyle(n),function(e,t){switch(t){case"horiz-align":return t="text-align",void 0;case"vert-align":return t="vertical-align",void 0;case"font-color":case"mso-foreground":return t="color",void 0;case"mso-background":case"mso-highlight":t="background"}("all"==d||h&&h[t])&&(o+=t+":"+e+";")}),o)return o}return null}var d,h,p=s.content;if(d=r.settings.paste_retain_style_properties,d&&(h=e.makeMap(d)),r.settings.paste_enable_default_filters!==!1&&/class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i.test(s.content)){s.wordContent=!0,l([/<!--[\s\S]+?-->/gi,/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,[/<(\/?)s>/gi,"<$1strike>"],[/&nbsp;/gi," "],[/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(e,t){return t.length>0?t.replace(/./," ").slice(Math.floor(t.length/2)).split("").join(" "):""}]]);var f=new n({valid_elements:"@[style],-strong/b,-em/i,-span,-p,-ol,-ul,-li,-h1,-h2,-h3,-h4,-h5,-h6,-table,-tr,-td[colspan|rowspan],-th,-thead,-tfoot,-tbody,-a[!href],sub,sup,strike"}),m=new t({},f);m.addAttributeFilter("style",function(e){for(var t,n=e.length;n--;)t=e[n],t.attr("style",c(t,t.attr("style"))),"span"!=t.name||t.attributes.length||t.unwrap()});var g=m.parse(p);u(g),s.content=new i({},f).serialize(g)}})}}),i(g,[l,u],function(e,t){return function(n){function i(e){n.on("PastePreProcess",function(t){t.content=e(t.content)})}function o(e,n){return t.each(n,function(t){e=t.constructor==RegExp?e.replace(t,""):e.replace(t[0],t[1])}),e}function r(e){return e=o(e,[/^[\s\S]*<!--StartFragment-->|<!--EndFragment-->[\s\S]*$/g,[/<span class="Apple-converted-space">\u00a0<\/span>/g," "],/<br>$/])}function a(e){if(!s){var i=[];t.each(n.schema.getBlockElements(),function(e,t){i.push(t)}),s=RegExp("(?:<br>&nbsp;[\\s\\r\\n]+|<br>)*(<\\/?("+i.join("|")+")[^>]*>)(?:<br>&nbsp;[\\s\\r\\n]+|<br>)*","g")}return e=o(e,[[s,"$1"]]),e=o(e,[[/<br><br>/g,"<BR><BR>"],[/<br>/g," "],[/<BR><BR>/g,"<br>"]])}var s;e.webkit&&i(r),e.ie&&i(a)}}),i(v,[y,s,d,g],function(e,t,n,i){var o;e.add("paste",function(e){function r(){"text"==a.pasteFormat?(this.active(!1),a.pasteFormat="html"):(a.pasteFormat="text",this.active(!0),o||(e.windowManager.alert("Paste is now in plain text mode. Contents will now be pasted as plain text until you toggle this option off."),o=!0))}var a,s=this;s.clipboard=a=new t(e),s.quirks=new i(e),s.wordFilter=new n(e),e.settings.paste_as_text&&(s.clipboard.pasteFormat="text"),e.addCommand("mceInsertClipboardContent",function(e,t){t.content&&s.clipboard.paste(t.content),t.text&&s.clipboard.pasteText(t.text)}),e.addButton("pastetext",{icon:"pastetext",tooltip:"Paste as text",onclick:r,active:"text"==s.clipboard.pasteFormat}),e.addMenuItem("pastetext",{text:"Paste as text",selectable:!0,active:a.pasteFormat,onclick:r})})}),r([s,d,g,v])}(this),tinymce.PluginManager.add("preview",function(e){var t=e.settings;e.addCommand("mcePreview",function(){e.windowManager.open({title:"Preview",width:parseInt(e.getParam("plugin_preview_width","650"),10),height:parseInt(e.getParam("plugin_preview_height","500"),10),html:'<iframe src="javascript:\'\'" frameborder="0"></iframe>',buttons:{text:"Close",onclick:function(){this.parent().parent().close()}},onPostRender:function(){var n,i=this.getEl("body").firstChild.contentWindow.document,o="";tinymce.each(e.contentCSS,function(t){o+='<link type="text/css" rel="stylesheet" href="'+e.documentBaseURI.toAbsolute(t)+'">'});var r=t.body_id||"tinymce";-1!=r.indexOf("=")&&(r=e.getParam("body_id","","hash"),r=r[e.id]||r);var a=t.body_class||"";-1!=a.indexOf("=")&&(a=e.getParam("body_class","","hash"),a=a[e.id]||""),n="<!DOCTYPE html><html><head>"+o+"</head>"+'<body id="'+r+'" class="mce-content-body '+a+'">'+e.getContent()+"</body>"+"</html>",i.open(),i.write(n),i.close()}})}),e.addButton("preview",{title:"Preview",cmd:"mcePreview"}),e.addMenuItem("preview",{text:"Preview",cmd:"mcePreview",context:"view"})}),tinymce.PluginManager.add("print",function(e){e.addCommand("mcePrint",function(){e.getWin().print()}),e.addButton("print",{title:"Print",cmd:"mcePrint"}),e.addShortcut("Ctrl+P","","mcePrint"),e.addMenuItem("print",{text:"Print",cmd:"mcePrint",icon:"print",shortcut:"Ctrl+P",context:"file"})}),!function(){function e(e,t,n,i,o){function r(e,t){if(t=t||0,!e[0])throw"findAndReplaceDOMText cannot handle zero-length matches";var n=e.index;if(t>0){var i=e[t];if(!i)throw"Invalid capture group";n+=e[0].indexOf(i),e[0]=i}return[n,n+e[0].length,[e[0]]]}function a(e){var t;if(3===e.nodeType)return e.data;if(p[e.nodeName])return"";if(t="",(h[e.nodeName]||f[e.nodeName])&&(t+="\n"),e=e.firstChild)do t+=a(e);while(e=e.nextSibling);return t}function s(e,t,n){var i,o,r,a,s=[],l=0,u=e,c=t.shift(),d=0;e:for(;;){if((h[u.nodeName]||f[u.nodeName])&&l++,3===u.nodeType&&(!o&&u.length+l>=c[1]?(o=u,a=c[1]-l):i&&s.push(u),!i&&u.length+l>c[0]&&(i=u,r=c[0]-l),l+=u.length),i&&o){if(u=n({startNode:i,startNodeIndex:r,endNode:o,endNodeIndex:a,innerNodes:s,match:c[2],matchIndex:d}),l-=o.length-a,i=null,o=null,s=[],c=t.shift(),d++,!c)break}else{if(!p[u.nodeName]&&u.firstChild){u=u.firstChild;continue}if(u.nextSibling){u=u.nextSibling;continue}}for(;;){if(u.nextSibling){u=u.nextSibling;break}if(u.parentNode===e)break e;u=u.parentNode}}}function l(e){var t;if("function"!=typeof e){var n=e.nodeType?e:d.createElement(e);t=function(e,t){var i=n.cloneNode(!1);return i.setAttribute("data-mce-index",t),e&&i.appendChild(d.createTextNode(e)),i}}else t=e;return function(e){var n,i,o,r=e.startNode,a=e.endNode,s=e.matchIndex;if(r===a){var l=r;o=l.parentNode,e.startNodeIndex>0&&(n=d.createTextNode(l.data.substring(0,e.startNodeIndex)),o.insertBefore(n,l));var u=t(e.match[0],s);return o.insertBefore(u,l),e.endNodeIndex<l.length&&(i=d.createTextNode(l.data.substring(e.endNodeIndex)),o.insertBefore(i,l)),l.parentNode.removeChild(l),u}n=d.createTextNode(r.data.substring(0,e.startNodeIndex)),i=d.createTextNode(a.data.substring(e.endNodeIndex));for(var c=t(r.data.substring(e.startNodeIndex),s),h=[],p=0,f=e.innerNodes.length;f>p;++p){var m=e.innerNodes[p],g=t(m.data,s);m.parentNode.replaceChild(g,m),h.push(g)}var v=t(a.data.substring(0,e.endNodeIndex),s);return o=r.parentNode,o.insertBefore(n,r),o.insertBefore(c,r),o.removeChild(r),o=a.parentNode,o.insertBefore(v,a),o.insertBefore(i,a),o.removeChild(a),v}}var u,c,d,h,p,f,m=[],g=0;if(d=t.ownerDocument,h=o.getBlockElements(),p=o.getWhiteSpaceElements(),f=o.getShortEndedElements(),c=a(t)){if(e.global)for(;u=e.exec(c);)m.push(r(u,i));
else u=c.match(e),m.push(r(u,i));return m.length&&(g=m.length,s(t,m,l(n))),g}}function t(t){function n(){var e=tinymce.ui.Factory.create({type:"window",layout:"flex",pack:"center",align:"center",onClose:function(){t.focus(),a=!1,s.unmarkAllMatches()},buttons:[{text:"Find",onclick:function(){e.find("form")[0].submit()}},{text:"Replace",disabled:!0,onclick:function(){s.replace(e.find("#replace").value())||e.statusbar.items().slice(1).disabled(!0)}},{text:"Replace all",disabled:!0,onclick:function(){s.replaceAll(e.find("#replace").value()),e.statusbar.items().slice(1).disabled(!0)}},{type:"spacer",flex:1},{text:"Prev",disabled:!0,onclick:function(){s.prev()}},{text:"Next",disabled:!0,onclick:function(){s.next()}}],title:"Find and replace",items:{type:"form",padding:20,labelGap:30,spacing:10,onsubmit:function(t){var n,i,o,r,a;return t.preventDefault(),o=e.find("#case").checked(),a=e.find("#words").checked(),r=e.find("#find").value(),r.length?(r=r.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),r=a?"\\b"+r+"\\b":r,i=RegExp(r,o?"g":"gi"),n=s.markAllMatches(i),n?s.first():tinymce.ui.MessageBox.alert("Could not find the specified string."),e.statusbar.items().slice(1).disabled(0===n),void 0):(s.unmarkAllMatches(),e.statusbar.items().slice(1).disabled(!0),void 0)},items:[{type:"textbox",name:"find",size:40,label:"Find",value:t.selection.getNode().src},{type:"textbox",name:"replace",size:40,label:"Replace with"},{type:"checkbox",name:"case",text:"Match case",label:" "},{type:"checkbox",name:"words",text:"Whole words",label:" "}]}}).renderTo().reflow();a=!0}function i(e){var t=e.parentNode;t.insertBefore(e.firstChild,e),e.parentNode.removeChild(e)}function o(e,n){function i(){var i,a;for(i=n?t.getBody()[e?"firstChild":"lastChild"]:s[e?"endContainer":"startContainer"],a=new tinymce.dom.TreeWalker(i,t.getBody());i=a.current();){if(1==i.nodeType&&"SPAN"==i.nodeName&&null!==i.getAttribute("data-mce-index"))for(l=i.getAttribute("data-mce-index"),o=i.firstChild;i=a.current();){if(1==i.nodeType&&"SPAN"==i.nodeName&&null!==i.getAttribute("data-mce-index")){if(i.getAttribute("data-mce-index")!==l)return;r=i.firstChild}a[e?"next":"prev"]()}a[e?"next":"prev"]()}}var o,r,a=t.selection,s=a.getRng(!0),l=-1;return e=e!==!1,i(),o&&r&&(t.focus(),e?(s.setStart(o,0),s.setEnd(r,r.length)):(s.setStart(r,0),s.setEnd(o,o.length)),a.scrollIntoView(o.parentNode),a.setRng(s)),l}function r(e){e.parentNode.removeChild(e)}var a,s=this,l=-1;s.init=function(e){e.addMenuItem("searchreplace",{text:"Find and replace",shortcut:"Ctrl+F",onclick:n,separator:"before",context:"edit"}),e.addButton("searchreplace",{tooltip:"Find and replace",shortcut:"Ctrl+F",onclick:n}),e.addCommand("SearchReplace",n),e.shortcuts.add("Ctrl+F","",n)},s.markAllMatches=function(n){var i,o;return o=t.dom.create("span",{"class":"mce-match-marker","data-mce-bogus":1}),i=t.getBody(),s.unmarkAllMatches(i),e(n,i,o,!1,t.schema)},s.first=function(){return l=o(!0,!0),-1!==l},s.next=function(){return l=o(!0),-1!==l},s.prev=function(){return l=o(!1),-1!==l},s.replace=function(e,n,a){var s,u,c,d,h,p;if(-1===l&&(l=o(n)),p=o(n),c=t.getBody(),u=tinymce.toArray(c.getElementsByTagName("span")),u.length)for(s=0;u.length>s;s++){var f=u[s].getAttribute("data-mce-index");if(null!==f&&f.length&&(d=h=u[s].getAttribute("data-mce-index"),a||d===l))for(e.length?(u[s].firstChild.nodeValue=e,i(u[s])):r(u[s]);u[++s];)if(d=u[s].getAttribute("data-mce-index"),null!==f&&f.length){if(d!==h){s--;break}r(u[s])}}return-1==p&&(p=o(n,!0)),l=p,a&&t.selection.setCursorLocation(t.getBody(),0),t.undoManager.add(),-1!==l},s.replaceAll=function(e){s.replace(e,!0,!0)},s.unmarkAllMatches=function(){var e,n,o;for(o=t.getBody(),n=o.getElementsByTagName("span"),e=n.length;e--;)o=n[e],o.getAttribute("data-mce-index")&&i(o)},t.on("beforeaddundo keydown",function(e){return a?(e.preventDefault(),!1):void 0})}tinymce.PluginManager.add("searchreplace",t)}(),!function(e,t){"use strict";function n(e,t){for(var n,i=[],r=0;e.length>r;++r){if(n=a[e[r]]||o(e[r]),!n)throw"module definition dependecy not found: "+e[r];i.push(n)}t.apply(null,i)}function i(e,i,o){if("string"!=typeof e)throw"invalid module definition, module id must be defined and be a string";if(i===t)throw"invalid module definition, dependencies must be specified";if(o===t)throw"invalid module definition, definition function must be specified";n(i,function(){a[e]=o.apply(null,arguments)})}function o(t){for(var n=e,i=t.split(/[.\/]/),o=0;i.length>o;++o){if(!n[i[o]])return;n=n[i[o]]}return n}function r(n){for(var i=0;n.length>i;i++){for(var o=e,r=n[i],s=r.split(/[.\/]/),l=0;s.length-1>l;++l)o[s[l]]===t&&(o[s[l]]={}),o=o[s[l]];o[s[s.length-1]]=a[r]}}var a={},s="tinymce/tableplugin/TableGrid",l="tinymce/util/Tools",u="tinymce/Env",c="tinymce/tableplugin/Quirks",d="tinymce/util/VK",h="tinymce/tableplugin/CellSelection",p="tinymce/dom/TreeWalker",f="tinymce/tableplugin/Plugin",m="tinymce/PluginManager";i(s,[l,u],function(e,t){function n(e,t){return parseInt(e.getAttribute(t)||1,10)}var i=e.each;return function(o,r){function a(){var e=0;A=[],i(["thead","tbody","tfoot"],function(t){var o=I.select("> "+t+" tr",r);i(o,function(o,r){r+=e,i(I.select("> td, > th",o),function(e,i){var o,a,s,l;if(A[r])for(;A[r][i];)i++;for(s=n(e,"rowspan"),l=n(e,"colspan"),a=r;r+s>a;a++)for(A[a]||(A[a]=[]),o=i;i+l>o;o++)A[a][o]={part:t,real:a==r&&o==i,elm:e,rowspan:s,colspan:l}})}),e+=o.length})}function s(e,t){return e=e.cloneNode(t),e.removeAttribute("id"),e}function l(e,t){var n;return n=A[t],n?n[e]:void 0}function u(e,t,n){e&&(n=parseInt(n,10),1===n?e.removeAttribute(t,1):e.setAttribute(t,n,1))}function c(e){return e&&(I.hasClass(e.elm,"mce-item-selected")||e==R)}function d(){var e=[];return i(r.rows,function(t){i(t.cells,function(n){return I.hasClass(n,"mce-item-selected")||n==R.elm?(e.push(t),!1):void 0})}),e}function h(){var e=I.createRng();e.setStartAfter(r),e.setEndAfter(r),O.setRng(e),I.remove(r)}function p(n){var r,a={};return o.settings.table_clone_elements!==!1&&(a=e.makeMap((o.settings.table_clone_elements||"strong em b i span font h1 h2 h3 h4 h5 h6 p div").toUpperCase(),/[ ,]/)),e.walk(n,function(e){var o;return 3==e.nodeType?(i(I.getParents(e.parentNode,null,n).reverse(),function(e){a[e.nodeName]&&(e=s(e,!1),r?o&&o.appendChild(e):r=o=e,o=e)}),o&&(o.innerHTML=t.ie?"&nbsp;":'<br data-mce-bogus="1" />'),!1):void 0},"childNodes"),n=s(n,!1),u(n,"rowSpan",1),u(n,"colSpan",1),r?n.appendChild(r):t.ie||(n.innerHTML='<br data-mce-bogus="1" />'),n}function f(){var e,t=I.createRng();return i(I.select("tr",r),function(e){0===e.cells.length&&I.remove(e)}),0===I.select("tr",r).length?(t.setStartBefore(r),t.setEndBefore(r),O.setRng(t),I.remove(r),void 0):(i(I.select("thead,tbody,tfoot",r),function(e){0===e.rows.length&&I.remove(e)}),a(),e=A[Math.min(A.length-1,M.y)],e&&(O.select(e[Math.min(e.length-1,M.x)].elm,!0),O.collapse(!0)),void 0)}function m(e,t,n,i){var o,r,a,s,l;for(o=A[t][e].elm.parentNode,a=1;n>=a;a++)if(o=I.getNext(o,"tr")){for(r=e;r>=0;r--)if(l=A[t+a][r].elm,l.parentNode==o){for(s=1;i>=s;s++)I.insertAfter(p(l),l);break}if(-1==r)for(s=1;i>=s;s++)o.insertBefore(p(o.cells[0]),o.cells[0])}}function g(){i(A,function(e,t){i(e,function(e,i){var o,r,a;if(c(e)&&(e=e.elm,o=n(e,"colspan"),r=n(e,"rowspan"),o>1||r>1)){for(u(e,"rowSpan",1),u(e,"colSpan",1),a=0;o-1>a;a++)I.insertAfter(p(e),e);m(i,t,r-1,o)}})})}function v(t,n,o){var r,s,d,h,p,m,v,y,b,w,x;if(t?(r=T(t),s=r.x,d=r.y,h=s+(n-1),p=d+(o-1)):(M=P=null,i(A,function(e,t){i(e,function(e,n){c(e)&&(M||(M={x:n,y:t}),P={x:n,y:t})})}),s=M.x,d=M.y,h=P.x,p=P.y),y=l(s,d),b=l(h,p),y&&b&&y.part==b.part){for(g(),a(),y=l(s,d).elm,u(y,"colSpan",h-s+1),u(y,"rowSpan",p-d+1),v=d;p>=v;v++)for(m=s;h>=m;m++)A[v]&&A[v][m]&&(t=A[v][m].elm,t!=y&&(w=e.grep(t.childNodes),i(w,function(e){y.appendChild(e)}),w.length&&(w=e.grep(y.childNodes),x=0,i(w,function(e){"BR"==e.nodeName&&I.getAttrib(e,"data-mce-bogus")&&x++<w.length-1&&y.removeChild(e)})),I.remove(t)));f()}}function y(e){var t,o,r,a,l,d,h,f,m;for(i(A,function(n,o){return i(n,function(n){return c(n)&&(n=n.elm,l=n.parentNode,d=s(l,!1),t=o,e)?!1:void 0}),e?!t:void 0}),a=0;A[0].length>a;a++)if(A[t][a]&&(o=A[t][a].elm,o!=r)){if(e){if(t>0&&A[t-1][a]&&(f=A[t-1][a].elm,m=n(f,"rowSpan"),m>1)){u(f,"rowSpan",m+1);continue}}else if(m=n(o,"rowspan"),m>1){u(o,"rowSpan",m+1);continue}h=p(o),u(h,"colSpan",o.colSpan),d.appendChild(h),r=o}d.hasChildNodes()&&(e?l.parentNode.insertBefore(d,l):I.insertAfter(d,l))}function b(e){var t,o;i(A,function(n){return i(n,function(n,i){return c(n)&&(t=i,e)?!1:void 0}),e?!t:void 0}),i(A,function(i,r){var a,s,l;i[t]&&(a=i[t].elm,a!=o&&(l=n(a,"colspan"),s=n(a,"rowspan"),1==l?e?(a.parentNode.insertBefore(p(a),a),m(t,r,s-1,l)):(I.insertAfter(p(a),a),m(t,r,s-1,l)):u(a,"colSpan",a.colSpan+1),o=a))})}function w(){var t=[];i(A,function(o){i(o,function(o,r){c(o)&&-1===e.inArray(t,r)&&(i(A,function(e){var t,i=e[r].elm;t=n(i,"colSpan"),t>1?u(i,"colSpan",t-1):I.remove(i)}),t.push(r))})}),f()}function x(){function e(e){var t,o,r;t=I.getNext(e,"tr"),i(e.cells,function(e){var t=n(e,"rowSpan");t>1&&(u(e,"rowSpan",t-1),o=T(e),m(o.x,o.y,1,1))}),o=T(e.cells[0]),i(A[o.y],function(e){var t;e=e.elm,e!=r&&(t=n(e,"rowSpan"),1>=t?I.remove(e):u(e,"rowSpan",t-1),r=e)})}var t;t=d(),i(t.reverse(),function(t){e(t)}),f()}function _(){var e=d();return I.remove(e),f(),e}function C(){var e=d();return i(e,function(t,n){e[n]=s(t,!0)}),e}function S(e,t){var n=d(),o=n[t?0:n.length-1],r=o.cells.length;e&&(i(A,function(e){var t;return r=0,i(e,function(e){e.real&&(r+=e.colspan),e.elm.parentNode==o&&(t=1)}),t?!1:void 0}),t||e.reverse(),i(e,function(e){var n,i,a=e.cells.length;for(n=0;a>n;n++)i=e.cells[n],u(i,"colSpan",1),u(i,"rowSpan",1);for(n=a;r>n;n++)e.appendChild(p(e.cells[a-1]));for(n=r;a>n;n++)I.remove(e.cells[n]);t?o.parentNode.insertBefore(e,o):I.insertAfter(e,o)}),I.removeClass(I.select("td.mce-item-selected,th.mce-item-selected"),"mce-item-selected"))}function T(e){var t;return i(A,function(n,o){return i(n,function(n,i){return n.elm==e?(t={x:i,y:o},!1):void 0}),!t}),t}function E(e){M=T(e)}function k(){var e,t;return e=t=0,i(A,function(n,o){i(n,function(n,i){var r,a;c(n)&&(n=A[o][i],i>e&&(e=i),o>t&&(t=o),n.real&&(r=n.colspan-1,a=n.rowspan-1,r&&i+r>e&&(e=i+r),a&&o+a>t&&(t=o+a)))})}),{x:e,y:t}}function N(e){var t,n,i,o,r,a,s,l,u,c;if(P=T(e),M&&P){for(t=Math.min(M.x,P.x),n=Math.min(M.y,P.y),i=Math.max(M.x,P.x),o=Math.max(M.y,P.y),r=i,a=o,c=n;a>=c;c++)e=A[c][t],e.real||t>t-(e.colspan-1)&&(t-=e.colspan-1);for(u=t;r>=u;u++)e=A[n][u],e.real||n>n-(e.rowspan-1)&&(n-=e.rowspan-1);for(c=n;o>=c;c++)for(u=t;i>=u;u++)e=A[c][u],e.real&&(s=e.colspan-1,l=e.rowspan-1,s&&u+s>r&&(r=u+s),l&&c+l>a&&(a=c+l));for(I.removeClass(I.select("td.mce-item-selected,th.mce-item-selected"),"mce-item-selected"),c=n;a>=c;c++)for(u=t;r>=u;u++)A[c][u]&&I.addClass(A[c][u].elm,"mce-item-selected")}}var A,M,P,R,O=o.selection,I=O.dom;r=r||I.getParent(O.getStart(),"table"),a(),R=I.getParent(O.getStart(),"th,td"),R&&(M=T(R),P=k(),R=l(M.x,M.y)),e.extend(this,{deleteTable:h,split:g,merge:v,insertRow:y,insertCol:b,deleteCols:w,deleteRows:x,cutRows:_,copyRows:C,pasteRows:S,getPos:T,setStartCell:E,setEndCell:N})}}),i(c,[d,u,l],function(e,t,n){function i(e,t){return parseInt(e.getAttribute(t)||1,10)}var o=n.each;return function(n){function r(){function t(t){function r(e,i){var o=e?"previousSibling":"nextSibling",r=n.dom.getParent(i,"tr"),s=r[o];if(s)return g(n,i,s,e),t.preventDefault(),!0;var c=n.dom.getParent(r,"table"),d=r.parentNode,h=d.nodeName.toLowerCase();if("tbody"===h||h===(e?"tfoot":"thead")){var p=a(e,c,d,"tbody");if(null!==p)return l(e,p,i)}return u(e,r,o,c)}function a(e,t,i,o){var r=n.dom.select(">"+o,t),a=r.indexOf(i);if(e&&0===a||!e&&a===r.length-1)return s(e,t);if(-1===a){var l="thead"===i.tagName.toLowerCase()?0:r.length-1;return r[l]}return r[a+(e?-1:1)]}function s(e,t){var i=e?"thead":"tfoot",o=n.dom.select(">"+i,t);return 0!==o.length?o[0]:null}function l(e,i,o){var r=c(i,e);return r&&g(n,o,r,e),t.preventDefault(),!0}function u(e,i,o,a){var s=a[o];if(s)return d(s),!0;var l=n.dom.getParent(a,"td,th");if(l)return r(e,l,t);var u=c(i,!e);return d(u),t.preventDefault(),!1}function c(e,t){var i=e&&e[t?"lastChild":"firstChild"];return i&&"BR"===i.nodeName?n.dom.getParent(i,"td,th"):i}function d(e){n.selection.setCursorLocation(e,0)}function h(){return b==e.UP||b==e.DOWN}function p(e){var t=e.selection.getNode(),n=e.dom.getParent(t,"tr");return null!==n}function f(e){for(var t=0,n=e;n.previousSibling;)n=n.previousSibling,t+=i(n,"colspan");return t}function m(e,t){var n=0,r=0;return o(e.children,function(e,o){return n+=i(e,"colspan"),r=o,n>t?!1:void 0}),r}function g(e,t,i,o){var r=f(n.dom.getParent(t,"td,th")),a=m(i,r),s=i.childNodes[a],l=c(s,o);d(l||s)}function v(e){var t=n.selection.getNode(),i=n.dom.getParent(t,"td,th"),o=n.dom.getParent(e,"td,th");return i&&i!==o&&y(i,o)}function y(e,t){return n.dom.getParent(e,"TABLE")===n.dom.getParent(t,"TABLE")}var b=t.keyCode;if(h()&&p(n)){var w=n.selection.getNode();setTimeout(function(){v(w)&&r(!t.shiftKey&&b===e.UP,w,t)},0)}}n.on("KeyDown",function(e){t(e)})}function a(){function e(e,t){var n,i=t.ownerDocument,o=i.createRange();return o.setStartBefore(t),o.setEnd(e.endContainer,e.endOffset),n=i.createElement("body"),n.appendChild(o.cloneContents()),0===n.innerHTML.replace(/<(br|img|object|embed|input|textarea)[^>]*>/gi,"-").replace(/<[^>]+>/g,"").length}n.on("KeyDown",function(t){var i,o,r=n.dom;(37==t.keyCode||38==t.keyCode)&&(i=n.selection.getRng(),o=r.getParent(i.startContainer,"table"),o&&n.getBody().firstChild==o&&e(i,o)&&(i=r.createRng(),i.setStartBefore(o),i.setEndBefore(o),n.selection.setRng(i),t.preventDefault()))})}function s(){n.on("KeyDown SetContent VisualAid",function(){var e;for(e=n.getBody().lastChild;e;e=e.previousSibling)if(3==e.nodeType){if(e.nodeValue.length>0)break}else if(1==e.nodeType&&!e.getAttribute("data-mce-bogus"))break;e&&"TABLE"==e.nodeName&&(n.settings.forced_root_block?n.dom.add(n.getBody(),n.settings.forced_root_block,null,t.ie?"&nbsp;":'<br data-mce-bogus="1" />'):n.dom.add(n.getBody(),"br",{"data-mce-bogus":"1"}))}),n.on("PreProcess",function(e){var t=e.node.lastChild;t&&("BR"==t.nodeName||1==t.childNodes.length&&("BR"==t.firstChild.nodeName||" "==t.firstChild.nodeValue))&&t.previousSibling&&"TABLE"==t.previousSibling.nodeName&&n.dom.remove(t)})}function l(){function e(e,t,n,i){var o,r,a,s=3,l=e.dom.getParent(t.startContainer,"TABLE");return l&&(o=l.parentNode),r=t.startContainer.nodeType==s&&0===t.startOffset&&0===t.endOffset&&i&&("TR"==n.nodeName||n==o),a=("TD"==n.nodeName||"TH"==n.nodeName)&&!i,r||a}function t(){var t=n.selection.getRng(),i=n.selection.getNode(),o=n.dom.getParent(t.startContainer,"TD,TH");if(e(n,t,i,o)){o||(o=i);for(var r=o.lastChild;r.lastChild;)r=r.lastChild;t.setEnd(r,r.nodeValue.length),n.selection.setRng(t)}}n.on("KeyDown",function(){t()}),n.on("MouseDown",function(e){2!=e.button&&t()})}t.webkit&&(r(),l()),t.gecko&&(a(),s())}}),i(h,[s,p,l],function(e,t,n){return function(i){function o(){i.getBody().style.webkitUserSelect="",u&&(i.dom.removeClass(i.dom.select("td.mce-item-selected,th.mce-item-selected"),"mce-item-selected"),u=!1)}var r,a,s,l=i.dom,u=!0;return i.on("MouseDown",function(e){2!=e.button&&(o(),a=l.getParent(e.target,"td,th"),s=l.getParent(a,"table"))}),l.bind(i.getDoc(),"mouseover",function(t){var n,o,c=t.target;if(a&&(r||c!=a)&&("TD"==c.nodeName||"TH"==c.nodeName)){o=l.getParent(c,"table"),o==s&&(r||(r=new e(i,o),r.setStartCell(a),i.getBody().style.webkitUserSelect="none"),r.setEndCell(c),u=!0),n=i.selection.getSel();try{n.removeAllRanges?n.removeAllRanges():n.empty()}catch(d){}t.preventDefault()}}),i.on("MouseUp",function(){function e(e,i){var r=new t(e,e);do{if(3==e.nodeType&&0!==n.trim(e.nodeValue).length)return i?o.setStart(e,0):o.setEnd(e,e.nodeValue.length),void 0;if("BR"==e.nodeName)return i?o.setStartBefore(e):o.setEndBefore(e),void 0}while(e=i?r.next():r.prev())}var o,u,c,d,h,p,f=i.selection;if(a){if(r&&(i.getBody().style.webkitUserSelect=""),u=l.select("td.mce-item-selected,th.mce-item-selected"),u.length>0){o=l.createRng(),d=u[0],p=u[u.length-1],o.setStartBefore(d),o.setEndAfter(d),e(d,1),c=new t(d,l.getParent(u[0],"table"));do if("TD"==d.nodeName||"TH"==d.nodeName){if(!l.hasClass(d,"mce-item-selected"))break;h=d}while(d=c.next());e(h),f.setRng(o)}i.nodeChanged(),a=r=s=null}}),i.on("KeyUp",function(){o()}),{clear:o}}}),i(f,[s,c,h,l,p,u,m],function(e,t,n,i,o,r,a){function s(i){function o(e){return e?e.replace(/px$/,""):""}function a(e){return/^[0-9]+$/.test(e)&&(e+="px"),e}function s(e){l("left center right".split(" "),function(t){i.formatter.remove("align"+t,{},e)})}function u(){var e,t,n,u=i.dom;e=i.dom.getParent(i.selection.getStart(),"table"),n=!1,t={width:o(u.getStyle(e,"width")||u.getAttrib(e,"width")),height:o(u.getStyle(e,"height")||u.getAttrib(e,"height")),cellspacing:u.getAttrib(e,"cellspacing"),cellpadding:u.getAttrib(e,"cellpadding"),border:u.getAttrib(e,"border"),caption:!!u.select("caption",e)[0]},l("left center right".split(" "),function(n){i.formatter.matchNode(e,"align"+n)&&(t.align=n)}),i.windowManager.open({title:"Table properties",items:{type:"form",layout:"grid",columns:2,data:t,defaults:{type:"textbox",maxWidth:50},items:[n?{label:"Cols",name:"cols",disabled:!0}:null,n?{label:"Rows",name:"rows",disabled:!0}:null,{label:"Width",name:"width"},{label:"Height",name:"height"},{label:"Cell spacing",name:"cellspacing"},{label:"Cell padding",name:"cellpadding"},{label:"Border",name:"border"},{label:"Caption",name:"caption",type:"checkbox"},{label:"Alignment",minWidth:90,name:"align",type:"listbox",text:"None",maxWidth:null,values:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]}]},onsubmit:function(){var t,n=this.toJSON();i.undoManager.transact(function(){i.dom.setAttribs(e,{cellspacing:n.cellspacing,cellpadding:n.cellpadding,border:n.border}),i.dom.setStyles(e,{width:a(n.width),height:a(n.height)}),t=u.select("caption",e)[0],t&&!n.caption&&u.remove(t),!t&&n.caption&&(t=u.create("caption"),r.ie||(t.innerHTML='<br data-mce-bogus="1"/>'),e.insertBefore(t,e.firstChild)),s(e),n.align&&i.formatter.apply("align"+n.align,{},e),i.focus(),i.addVisual()})}})}function c(e,t){i.windowManager.open({title:"Merge cells",body:[{label:"Cols",name:"cols",type:"textbox",size:10},{label:"Rows",name:"rows",type:"textbox",size:10}],onsubmit:function(){var n=this.toJSON();i.undoManager.transact(function(){e.merge(t,n.cols,n.rows)})}})}function d(){var e,t,n=i.dom,r=[];r=i.dom.select("td.mce-item-selected,th.mce-item-selected"),e=i.dom.getParent(i.selection.getStart(),"td,th"),!r.length&&e&&r.push(e),e=e||r[0],t={width:o(n.getStyle(e,"width")||n.getAttrib(e,"width")),height:o(n.getStyle(e,"height")||n.getAttrib(e,"height")),scope:n.getAttrib(e,"scope")},t.type=e.nodeName.toLowerCase(),l("left center right".split(" "),function(n){i.formatter.matchNode(e,"align"+n)&&(t.align=n)}),i.windowManager.open({title:"Cell properties",items:{type:"form",data:t,layout:"grid",columns:2,defaults:{type:"textbox",maxWidth:50},items:[{label:"Width",name:"width"},{label:"Height",name:"height"},{label:"Cell type",name:"type",type:"listbox",text:"None",minWidth:90,maxWidth:null,menu:[{text:"Cell",value:"td"},{text:"Header cell",value:"th"}]},{label:"Scope",name:"scope",type:"listbox",text:"None",minWidth:90,maxWidth:null,menu:[{text:"None",value:""},{text:"Row",value:"row"},{text:"Column",value:"col"},{text:"Row group",value:"rowgroup"},{text:"Column group",value:"colgroup"}]},{label:"Alignment",name:"align",type:"listbox",text:"None",minWidth:90,maxWidth:null,values:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]}]},onsubmit:function(){var e=this.toJSON();i.undoManager.transact(function(){l(r,function(t){i.dom.setAttrib(t,"scope",e.scope),i.dom.setStyles(t,{width:a(e.width),height:a(e.height)}),e.type&&t.nodeName.toLowerCase()!=e.type&&(t=n.rename(t,e.type)),s(t),e.align&&i.formatter.apply("align"+e.align,{},t)}),i.focus()})}})}function h(){var e,t,n,r,u=i.dom,c=[];e=i.dom.getParent(i.selection.getStart(),"table"),t=i.dom.getParent(i.selection.getStart(),"td,th"),l(e.rows,function(e){l(e.cells,function(n){return u.hasClass(n,"mce-item-selected")||n==t?(c.push(e),!1):void 0})}),n=c[0],r={height:o(u.getStyle(n,"height")||u.getAttrib(n,"height")),scope:u.getAttrib(n,"scope")},r.type=n.parentNode.nodeName.toLowerCase(),l("left center right".split(" "),function(e){i.formatter.matchNode(n,"align"+e)&&(r.align=e)}),i.windowManager.open({title:"Row properties",items:{type:"form",data:r,columns:2,defaults:{type:"textbox"},items:[{type:"listbox",name:"type",label:"Row type",text:"None",maxWidth:null,menu:[{text:"Header",value:"thead"},{text:"Body",value:"tbody"},{text:"Footer",value:"tfoot"}]},{type:"listbox",name:"align",label:"Alignment",text:"None",maxWidth:null,menu:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]},{label:"Height",name:"height"}]},onsubmit:function(){var e,t,n,o=this.toJSON();i.undoManager.transact(function(){var r=o.type;l(c,function(l){i.dom.setAttrib(l,"scope",o.scope),i.dom.setStyles(l,{height:a(o.height)}),r!=l.parentNode.nodeName.toLowerCase()&&(e=u.getParent(l,"table"),t=l.parentNode,n=u.select(r,e)[0],n||(n=u.create(r),e.firstChild?e.insertBefore(n,e.firstChild):e.appendChild(n)),n.appendChild(l),t.hasChildNodes()||u.remove(t)),s(l),o.align&&i.formatter.apply("align"+o.align,{},l)}),i.focus()})}})}function p(e){return function(){i.execCommand(e)}}function f(e,t){var n,o,a;for(a="<table><tbody>",n=0;t>n;n++){for(a+="<tr>",o=0;e>o;o++)a+="<td>"+(r.ie?" ":"<br>")+"</td>";a+="</tr>"}a+="</tbody></table>",i.insertContent(a)}function m(e,t){function n(){e.disabled(!i.dom.getParent(i.selection.getStart(),t)),i.selection.selectorChanged(t,function(t){e.disabled(!t)})}i.initialized?n():i.on("init",n)}function g(){m(this,"table")}function v(){m(this,"td,th")}function y(){var e="";e='<table role="presentation" class="mce-grid mce-grid-border">';for(var t=0;10>t;t++){e+="<tr>";for(var n=0;10>n;n++)e+='<td><a href="#" data-mce-index="'+n+","+t+'"></a></td>';e+="</tr>"}return e+="</table>",e+='<div class="mce-text-center">0 x 0</div>'}var b,w,x=this;i.addMenuItem("inserttable",{text:"Insert table",icon:"table",context:"table",onhide:function(){i.dom.removeClass(this.menu.items()[0].getEl().getElementsByTagName("a"),"mce-active")},menu:[{type:"container",html:y(),onmousemove:function(e){var t=e.target;if("A"==t.nodeName){var n=i.dom.getParent(t,"table"),o=t.getAttribute("data-mce-index");if(o!=this.lastPos){o=o.split(","),o[0]=parseInt(o[0],10),o[1]=parseInt(o[1],10);for(var r=0;10>r;r++)for(var a=0;10>a;a++)i.dom.toggleClass(n.rows[r].childNodes[a].firstChild,"mce-active",o[0]>=a&&o[1]>=r);n.nextSibling.innerHTML=o[0]+1+" x "+(o[1]+1),this.lastPos=o}}},onclick:function(e){"A"==e.target.nodeName&&this.lastPos&&(e.preventDefault(),f(this.lastPos[0]+1,this.lastPos[1]+1),this.parent().cancel())}}]}),i.addMenuItem("tableprops",{text:"Table properties",context:"table",onPostRender:g,onclick:u}),i.addMenuItem("deletetable",{text:"Delete table",context:"table",onPostRender:g,cmd:"mceTableDelete"}),i.addMenuItem("cell",{separator:"before",text:"Cell",context:"table",menu:[{text:"Cell properties",onclick:p("mceTableCellProps"),onPostRender:v},{text:"Merge cells",onclick:p("mceTableMergeCells"),onPostRender:v},{text:"Split cell",onclick:p("mceTableSplitCells"),onPostRender:v}]}),i.addMenuItem("row",{text:"Row",context:"table",menu:[{text:"Insert row before",onclick:p("mceTableInsertRowBefore"),onPostRender:v},{text:"Insert row after",onclick:p("mceTableInsertRowAfter"),onPostRender:v},{text:"Delete row",onclick:p("mceTableDeleteRow"),onPostRender:v},{text:"Row properties",onclick:p("mceTableRowProps"),onPostRender:v},{text:"-"},{text:"Cut row",onclick:p("mceTableCutRow"),onPostRender:v},{text:"Copy row",onclick:p("mceTableCopyRow"),onPostRender:v},{text:"Paste row before",onclick:p("mceTablePasteRowBefore"),onPostRender:v},{text:"Paste row after",onclick:p("mceTablePasteRowAfter"),onPostRender:v}]}),i.addMenuItem("column",{text:"Column",context:"table",menu:[{text:"Insert column before",onclick:p("mceTableInsertColBefore"),onPostRender:v},{text:"Insert column after",onclick:p("mceTableInsertColAfter"),onPostRender:v},{text:"Delete column",onclick:p("mceTableDeleteCol"),onPostRender:v}]});var _=[];l("inserttable tableprops deletetable | cell row column".split(" "),function(e){"|"==e?_.push({text:"-"}):_.push(i.menuItems[e])}),i.addButton("table",{type:"menubutton",title:"Table",menu:_}),r.isIE||i.on("click",function(e){e=e.target,"TABLE"===e.nodeName&&(i.selection.select(e),i.nodeChanged())}),x.quirks=new t(i),i.on("Init",function(){b=i.windowManager,x.cellSelection=new n(i)}),l({mceTableSplitCells:function(e){e.split()},mceTableMergeCells:function(e){var t,n,o;o=i.dom.getParent(i.selection.getStart(),"th,td"),o&&(t=o.rowSpan,n=o.colSpan),i.dom.select("td.mce-item-selected,th.mce-item-selected").length?e.merge():c(e,o)},mceTableInsertRowBefore:function(e){e.insertRow(!0)},mceTableInsertRowAfter:function(e){e.insertRow()},mceTableInsertColBefore:function(e){e.insertCol(!0)},mceTableInsertColAfter:function(e){e.insertCol()},mceTableDeleteCol:function(e){e.deleteCols()},mceTableDeleteRow:function(e){e.deleteRows()},mceTableCutRow:function(e){w=e.cutRows()},mceTableCopyRow:function(e){w=e.copyRows()},mceTablePasteRowBefore:function(e){e.pasteRows(w,!0)},mceTablePasteRowAfter:function(e){e.pasteRows(w)},mceTableDelete:function(e){e.deleteTable()}},function(t,n){i.addCommand(n,function(){var n=new e(i);n&&(t(n),i.execCommand("mceRepaint"),x.cellSelection.clear())})}),l({mceInsertTable:function(){u()},mceTableRowProps:h,mceTableCellProps:d},function(e,t){i.addCommand(t,function(t,n){e(n)})})}var l=i.each;a.add("table",s)}),r([s,c,h,f])}(this),tinymce.PluginManager.add("wordcount",function(e){function t(){e.theme.panel.find("#wordcount").text(["Words: {0}",o.getCount()])}var n,i,o=this;n=e.getParam("wordcount_countregex",/[\w\u2019\x27\-]+/g),i=e.getParam("wordcount_cleanregex",/[0-9.(),;:!?%#$?\x27\x22_+=\\\/\-]*/g),e.on("init",function(){var n=e.theme.panel&&e.theme.panel.find("#statusbar")[0];n&&window.setTimeout(function(){n.insert({type:"label",name:"wordcount",text:["Words: {0}",o.getCount()],classes:"wordcount"},0),e.on("setcontent beforeaddundo",t),e.on("keyup",function(e){32==e.keyCode&&t()})},0)}),o.getCount=function(){var t=e.getContent({format:"raw"}),o=0;if(t){t=t.replace(/\.\.\./g," "),t=t.replace(/<.[^<>]*?>/g," ").replace(/&nbsp;|&#160;/gi," "),t=t.replace(/(\w+)(&.+?;)+(\w+)/,"$1$3").replace(/&.+?;/g," "),t=t.replace(i,"");var r=t.match(n);r&&(o=r.length)}return o}}),tinymce.ThemeManager.add("modern",function(e){function t(){function t(t){var i,o=[];return t?(d(t.split(/[ ,]/),function(t){function n(){var n=e.selection;"bullist"==r&&n.selectorChanged("ul > li",function(e,n){for(var i,o=n.parents.length;o--&&(i=n.parents[o].nodeName,"OL"!=i&&"UL"!=i););t.active("UL"==i)}),"numlist"==r&&n.selectorChanged("ol > li",function(e,n){for(var i,o=n.parents.length;o--&&(i=n.parents[o].nodeName,"OL"!=i&&"UL"!=i););t.active("OL"==i)}),t.settings.stateSelector&&n.selectorChanged(t.settings.stateSelector,function(e){t.active(e)},!0),t.settings.disabledStateSelector&&n.selectorChanged(t.settings.disabledStateSelector,function(e){t.disabled(e)})}var r;"|"==t?i=null:c.has(t)?(t={type:t},u.toolbar_items_size&&(t.size=u.toolbar_items_size),o.push(t),i=null):(i||(i={type:"buttongroup",items:[]},o.push(i)),e.buttons[t]&&(r=t,t=e.buttons[r],"function"==typeof t&&(t=t()),t.type=t.type||"button",u.toolbar_items_size&&(t.size=u.toolbar_items_size),t=c.create(t),i.items.push(t),e.initialized?n():e.on("init",n)))}),n.push({type:"toolbar",layout:"flow",items:o}),!0):void 0}for(var n=[],i=1;10>i&&t(u["toolbar"+i]);i++);return n.length||t(u.toolbar||f),n}function n(){function t(t){var n;return"|"==t?{text:"|"}:n=e.menuItems[t]}function n(n){var i,o,r,a,s;if(s=tinymce.makeMap((u.removed_menuitems||"").split(/[ ,]/)),u.menu?(o=u.menu[n],a=!0):o=p[n],o){i={text:o.title},r=[],d((o.items||"").split(/[ ,]/),function(e){var n=t(e);n&&!s[e]&&r.push(t(e))}),a||d(e.menuItems,function(e){e.context==n&&("before"==e.separator&&r.push({text:"|"}),e.prependToContext?r.unshift(e):r.push(e),"after"==e.separator&&r.push({text:"|"}))});for(var l=0;r.length>l;l++)"|"==r[l].text&&(0===l||l==r.length-1)&&r.splice(l,1);if(i.menu=r,!i.menu.length)return null}return i}var i,o=[],r=[];if(u.menu)for(i in u.menu)r.push(i);else for(i in p)r.push(i);for(var a=u.menubar?u.menubar.split(/[ ,]/):r,s=0;a.length>s;s++){var l=a[s];l=n(l),l&&o.push(l)}return o}function i(t){function n(e){var n=t.find(e)[0];n&&n.focus()}e.shortcuts.add("Alt+F9","",function(){n("menubar")}),e.shortcuts.add("Alt+F10","",function(){n("toolbar")}),e.shortcuts.add("Alt+F11","",function(){n("elementpath")}),t.on("cancel",function(){e.focus()})}function o(t,n){function i(e){return{width:e.clientWidth,height:e.clientHeight}}var o,r,a,s;o=e.getContainer(),r=e.getContentAreaContainer().firstChild,a=i(o),s=i(r),null!==t&&(t=Math.max(u.min_width||100,t),t=Math.min(u.max_width||65535,t),h.css(o,"width",t+(a.width-s.width)),h.css(r,"width",t)),n=Math.max(u.min_height||100,n),n=Math.min(u.max_height||65535,n),h.css(r,"height",n),e.fire("ResizeEditor")}function r(t,n){var i=e.getContentAreaContainer();l.resizeTo(i.clientWidth+t,i.clientHeight+n)}function a(){function o(){d&&d.moveRel&&d.visible()&&!d._fixed&&d.moveRel(e.getBody(),["tl-bl","bl-tl"])}function r(){d&&(d.show(),o(),h.addClass(e.getBody(),"mce-edit-focus"))}function a(){d&&(d.hide(),h.removeClass(e.getBody(),"mce-edit-focus"))}function s(){return d?(d.visible()||r(),void 0):(d=l.panel=c.create({type:p?"panel":"floatpanel",classes:"tinymce tinymce-inline",layout:"flex",direction:"column",autohide:!1,autofix:!0,fixed:!!p,border:1,items:[u.menubar===!1?null:{type:"menubar",border:"0 0 1 0",items:n()},u.toolbar===!1?null:{type:"panel",name:"toolbar",layout:"stack",items:t()}]}),d.renderTo(p||document.body).reflow(),i(d),r(),e.on("nodeChange",o),e.on("activate",r),e.on("deactivate",a),void 0)}var d,p;return u.fixed_toolbar_container&&(p=h.select(u.fixed_toolbar_container)[0]),u.content_editable=!0,e.on("focus",s),e.on("blur",a),e.on("remove",function(){d&&(d.remove(),d=null)}),{}}function s(r){var a,s,d;return a=l.panel=c.create({type:"panel",classes:"tinymce",style:"visibility: hidden",layout:"stack",border:1,items:[u.menubar===!1?null:{type:"menubar",border:"0 0 1 0",items:n()},u.toolbar===!1?null:{type:"panel",layout:"stack",items:t()},{type:"panel",name:"iframe",layout:"stack",classes:"edit-area",html:"",border:"1 0 0 0"}]}),u.resize!==!1&&(s={type:"resizehandle",direction:u.resize,onResizeStart:function(){var t=e.getContentAreaContainer().firstChild;d={width:t.clientWidth,height:t.clientHeight}},onResize:function(e){"both"==u.resize?o(d.width+e.deltaX,d.height+e.deltaY):o(null,d.height+e.deltaY)}}),u.statusbar!==!1&&a.add({type:"panel",name:"statusbar",classes:"statusbar",layout:"flow",border:"1 0 0 0",items:[{type:"elementpath"},s]}),a.renderBefore(r.targetNode).reflow(),u.width&&tinymce.DOM.setStyle(a.getEl(),"width",u.width),e.on("remove",function(){a.remove(),a=null}),i(a),{iframeContainer:a.find("#iframe")[0].getEl(),editorContainer:a.getEl()}}var l=this,u=e.settings,c=tinymce.ui.Factory,d=tinymce.each,h=tinymce.DOM,p={file:{title:"File",items:"newdocument"},edit:{title:"Edit",items:"undo redo | cut copy paste pastetext | selectall"},insert:{title:"Insert",items:"|"},view:{title:"View",items:"visualaid |"},format:{title:"Format",items:"bold italic underline strikethrough superscript subscript | formats | removeformat"},table:{title:"Table"},tools:{title:"Tools"}},f="undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image";
l.renderUI=function(t){var n=u.skin!==!1?u.skin||"lightgray":!1;return n&&(7>=tinymce.Env.documentMode?tinymce.DOM.loadCSS(tinymce.baseURL+"/skins/"+n+"/skin.ie7.min.css"):tinymce.DOM.loadCSS(tinymce.baseURL+"/skins/"+n+"/skin.min.css"),e.contentCSS.push(tinymce.baseURL+"/skins/"+n+"/content"+(e.inline?".inline":"")+".min.css")),e.on("ProgressState",function(e){l.throbber=l.throbber||new tinymce.ui.Throbber(l.panel.getEl("body")),e.state?l.throbber.show(e.time):l.throbber.hide()}),u.inline?a(t):s(t)},l.resizeTo=o,l.resizeBy=r});var _ref,__bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var i in t)__hasProp.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};Annotator.Plugin.RichText=function(e){function t(){return _ref=t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.options={tinymce:{selector:"li.annotator-item textarea",plugins:"media image insertdatetime link code",menubar:!1,toolbar_items_size:"small",extended_valid_elements:"iframe[src|frameborder|style|scrolling|class|width|height|name|align|id]",toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image media rubric | code "}},t.prototype.pluginInit=function(){console.log("RichText-pluginInit");var e=this.annotator,t=this.annotator.editor;Annotator.supported()&&(e.editor.addField({type:"input",load:this.updateEditor}),e.viewer.addField({load:this.updateViewer}),e.subscribe("annotationEditorShown",function(){$(e.editor.element).find(".mce-tinymce")[0].style.display="block",$(e.editor.element).find(".mce-container").css("z-index",3e9),e.editor.checkOrientation()}),e.subscribe("annotationEditorHidden",function(){$(e.editor.element).find(".mce-tinymce")[0].style.display="none"}),this.options.tinymce.setup=function(e){e.on("change",function(){$(t.element).find("textarea")[0].value=tinymce.activeEditor.getContent()}),e.on("Init",function(){$(".mce-container").css("z-index","3090000000000000000")}),e.addButton("rubric",{icon:"rubric",title:"Insert a rubric",onclick:function(){e.windowManager.open({title:"Insert a public rubric of the webside https://gteavirtual.org/rubric   ",body:[{type:"textbox",name:"url",label:"Url"}],onsubmit:function(n){var i,o=n.data.url,r="irb";r=r.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a=RegExp("[\\?&]"+r+"=([^&#]*)"),s=a.exec(o);if(i=null==s?"":decodeURIComponent(s[1].replace(/\+/g," ")),""==i)e.windowManager.alert("Error: The given webpage didn't have a irb variable in the url");else{var l="<iframe src='https://gteavirtual.org/rubric/?mod=portal&scr=viewrb&evt=frame&irb="+i+"' style='width:800px;height:600px;overflow-y: scroll;background:transparent' frameborder='0' ></iframe>";e.setContent(e.getContent()+l),$(t.element).find("textarea")[0].value=e.getContent()}}}),e.label="My Button"}})},tinymce.init(this.options.tinymce))},t.prototype.updateEditor=function(e,t){var n=t.text!==void 0?t.text:"";tinymce.activeEditor.setContent(n),$(e).remove()},t.prototype.updateViewer=function(e,t){var n=$(e.parentNode).find("div:first-of-type")[0];n.innerHTML=t.text,$(n).addClass("richText-annotation"),$(e).remove()},t}(Annotator.Plugin),function(e){function t(t){t.autoHideControls&&(t.controlsShouldFade=!0,t.controlsFadeBeginTime=e.now()+t.controlsFadeDelay,window.setTimeout(function(){scheduleControlsFade(t)},t.controlsFadeDelay))}function n(e){var t;for(e.controlsShouldFade=!1,t=e.controls.length-1;t>=0;t--)e.controls[t].setOpacity(1)}function i(){n(this.viewer)}function o(){t(this.viewer)}e.Viewer.prototype.annotation=function(){var t=jQuery(".annotator-wrapper").parent()[0],n=jQuery.data(t,"annotator"),i=this,o=!1;this.addHandler("open",function(){o=!0,i.annotationInstance!==void 0&&i.annotationInstance.refreshDisplay()}),n.subscribe("annotationsLoaded",function(){function t(){o?i.annotationInstance.refreshDisplay():setTimeout(t,200)}console.log("annotationsLoaded"),i.annotationInstance?i.annotationInstance.refreshDisplay():(i.annotationInstance=new e._annotation({viewer:i,annotator:n}),n.osda=i.annotationInstance,t())})},e._annotation=function(e){if(e=e||{},!e.viewer)throw Error("A viewer must be specified.");this.viewer=e.viewer,this.annotator=e.annotator,this.options=e,this.isAnnotating=!1,this.isDrawing=!1,this.init()},e._annotation.prototype={init:function(){var t=this.viewer;this._createNewButton();var n=this.__bind(this._onCanvasMouseDown,this),i=this.__bind(this._onCanvasMouseMove,this),o=this.__bind(this._onDocumentMouseUp,this);e.addEvent(t.canvas,"mousedown",n,!0),e.addEvent(t.canvas,"mousemove",i,!0),e.addEvent(document,"mouseup",o,!0)},newAnnotation:function(){console.log("new annotation");var e=this.annotator;e.editor.OpenSeaDragon=this.viewer.id,e.adder.show(),this._setOverShape(e.adder),e.onAdderClick()},editAnnotation:function(e,t){if(this._isOpenSeaDragon(e)){var t=t||this.annotator.editor;this._setOverShape(t.element),t.checkOrientation(),t.OpenSeaDragon=this.viewer.id}},refreshDisplay:function(){var e=this.annotator.plugins.Store.annotations;this._sortByDate(e),this.viewer.drawer.clearOverlays();for(var t in e){var n=e[t];this._isOpenSeaDragon(n)&&this.drawRect(n)}},modeAnnotation:function(e){this._reset();var t=this.viewer;this.isAnnotating?(e.eventSource.imgGroup.src=this.resolveUrl(t.prefixUrl,"newan_grouphover.png"),e.eventSource.imgRest.src=this.resolveUrl(t.prefixUrl,"newan_rest.png"),e.eventSource.imgHover.src=this.resolveUrl(t.prefixUrl,"newan_hover.png")):(e.eventSource.imgGroup.src=this.resolveUrl(t.prefixUrl,"newan_hover.png"),e.eventSource.imgRest.src=this.resolveUrl(t.prefixUrl,"newan_hover.png"),e.eventSource.imgHover.src=this.resolveUrl(t.prefixUrl,"newan_grouphover.png")),this.isAnnotating=this.isAnnotating?!1:!0},drawRect:function(t){if(t.rangePosition!==void 0){var n=document.createElement("span"),i=t.rangePosition;n.className="annotator-hl",n.style.border="1px solid rgba(0,0,0,0.5)";var o=this.__bind(this._onAnnotationMouseMove,this),r=this.__bind(this._onAnnotationClick,this);e.addEvent(n,"mousemove",o,!0),e.addEvent(n,"click",r,!0),jQuery.data(n,"annotation",t),t.highlights=jQuery(n);var a=new OpenSeadragon.Rect(i.left,i.top,i.width,i.height);return this.viewer.drawer.addOverlay({element:n,location:a,placement:OpenSeadragon.OverlayPlacement.TOP_LEFT})}return!1},setRectPosition:function(){var t=parseInt(this.rect.style.left),n=parseInt(this.rect.style.top),i=parseInt(this.rect.style.left)+parseInt(this.rect.style.width),o=parseInt(this.rect.style.top)+parseInt(this.rect.style.height),r=new e.Point(t,n),a=new e.Point(i,o);this.rectPosition={left:this._physicalToLogicalXY(r).x,top:this._physicalToLogicalXY(r).y,width:this._physicalToLogicalXY(a).x-this._physicalToLogicalXY(r).x,height:this._physicalToLogicalXY(a).y-this._physicalToLogicalXY(r).y}},_onCanvasMouseDown:function(t){if(this.isAnnotating){var n=this.viewer;t.preventDefault(),this._reset(),this.isDrawing=!0;var i=e.getMousePosition(t),o=e.getElementPosition(n.canvas),r=i.minus(o);n.innerTracker.setTracking(!1),this.rect=document.createElement("div"),this.rect.style.background="rgba(0,0,0,0.25)",this.rect.style.border="1px solid rgba(0,0,0,0.5)",this.rect.style.position="absolute",this.rect.className="DrawingRect",this.rect.style.top=r.y+"px",this.rect.style.left=r.x+"px",this.rect.style.width="1px",this.rect.style.height="1px",this.startPosition=r,this.setRectPosition(),n.canvas.appendChild(this.rect)}},_onCanvasMouseMove:function(t){if(this.isAnnotating&&this.isDrawing){var n=this.viewer,i=e.getMousePosition(t),o=e.getElementPosition(n.canvas),r=i.minus(o),a=this.startPosition,s=r.x-a.x,l=r.y-a.y;this.rect.style.width=0>s?-1*s+"px":s+"px",this.rect.style.left=0>s?a.x+s+"px":a.x+"px",this.rect.style.height=0>l?-1*l+"px":l+"px",this.rect.style.top=0>l?a.y+l+"px":a.y+"px",this.setRectPosition(),this.annotator.editor.element[0].style.display="none",this._setOverShape(this.annotator.adder)}},_onDocumentMouseUp:function(){if(this.isAnnotating&&this.isDrawing){var e=this.viewer;e.innerTracker.setTracking(!0),this.isDrawing=!1,this.setRectPosition(),this.newAnnotation(),this.annotator.editor.element[0].style.display="block",this._setOverShape(this.annotator.editor.element),this.annotator.editor.checkOrientation()}},_onAnnotationMouseMove:function(t){var n=this.annotator,i=jQuery(t.target).parents(".annotator-hl").andSelf();if(n!==void 0&&i.hasClass("annotator-hl")&&!this.isDrawing){n.viewer.hide();var o=jQuery(t.target.parentNode).find(".annotator-hl").map(function(){var n=jQuery(this),i=n.offset(),o=i.left,r=i.top,a=n.height(),s=n.width(),l=e.getMousePosition(t).x,u=e.getMousePosition(t).y,c=o+s,d=r+a;return this.style.background=d>=u&&u>=r&&c>=l&&l>=o?"rgba(12, 150, 0, 0.3)":"rgba(255, 255, 10, 0.3)",d>=u&&u>=r&&c>=l&&l>=o?jQuery(this).data("annotation"):null}),r={top:e.getMousePosition(t).y,left:e.getMousePosition(t).x};o.length>0&&n.showViewer(jQuery.makeArray(o),r)}},_onAnnotationClick:function(e){var t=jQuery.data(e.target,"annotation"),n=t.bounds!==void 0?t.bounds:{},i=this.viewer.drawer.viewport.getBounds();n.x!==void 0&&(i.x=n.x),n.y!==void 0&&(i.y=n.y),n.width!==void 0&&(i.width=n.width),n.height!==void 0&&(i.height=n.height),this.viewer.drawer.viewport.fitBounds(i)},_onAnnotationMouseOut:function(e){var t=this.annotator,n=jQuery(e.target).parents(".annotator-hl").andSelf();t!==void 0&&n.hasClass("annotator-hl")&&!this.isDrawing&&jQuery(e.target.parentNode).find(".annotator-hl").map(function(){return this.style.background="rgba(255, 255, 10, 0.3)"})},_sortByDate:function(e,t){var t=t||"asc";e.sort(function(e,n){return e=new Date(e.updated!==void 0?createDateFromISO8601(e.updated):""),n=new Date(n.updated!==void 0?createDateFromISO8601(n.updated):""),"asc"==t?e>n?-1:n>e?1:0:n>e?-1:e>n?1:0})},_createNewButton:function(){var t=this.viewer,n=e.delegate(this,i),r=e.delegate(this,o),a=e.delegate(this,this.modeAnnotation),t=this.viewer,s=this;t.modeAnnotation=new e.Button({element:t.modeAnnotation?e.getElement(t.modeAnnotation):null,clickTimeThreshold:t.clickTimeThreshold,clickDistThreshold:t.clickDistThreshold,tooltip:"New Annotation",srcRest:s.resolveUrl(t.prefixUrl,"newan_rest.png"),srcGroup:s.resolveUrl(t.prefixUrl,"newan_grouphover.png"),srcHover:s.resolveUrl(t.prefixUrl,"newan_hover.png"),srcDown:s.resolveUrl(t.prefixUrl,"newan_pressed.png"),onRelease:a,onFocus:n,onBlur:r}),t.wrapperAnnotation=new e.ButtonGroup({buttons:[t.modeAnnotation],clickTimeThreshold:t.clickTimeThreshold,clickDistThreshold:t.clickDistThreshold}),t.annotatorControl=t.wrapperAnnotation.element,t.toolbar?t.toolbar.addControl(t.annotatorControl,{anchor:e.ControlAnchor.BOTTOM_RIGHT}):t.addControl(t.annotatorControl,{anchor:e.ControlAnchor.TOP_LEFT})},_reset:function(){this._removeElemsByClass("DrawingRect",this.viewer.canvas),this.annotator.editor.element[0].style.display="none"},__bind:function(e,t){return function(){return e.apply(t,arguments)}},_removeElemsByClass:function(e,t){var e=e||"",t=t||{};divs=t.getElementsByClassName(e);for(var n=0;divs.length>n;n++)divs[n].remove()},_isOpenSeaDragon:function(e){var t=this.annotator,n=e.rangePosition,i=t.osda!==void 0,o=e.target!==void 0&&e.target.container==this.viewer.id,r=e.media!==void 0&&"image"==e.media,a=n!==void 0,s=!1,l=this.viewer.source,u=l.tilesUrl!==void 0?l.tilesUrl:"";return functionUrl=l.getTileUrl!==void 0?l.getTileUrl:"",compareUrl=""!=u?u:(""+functionUrl).replace(/\s+/g," "),o&&(s=e.target.src==compareUrl),i&&o&&r&&a&&s},_setOverShape:function(t){var n=this.rectPosition||{},i=this._logicalToPhysicalXY(new e.Point(n.left,n.top)),o=this._logicalToPhysicalXY(new e.Point(n.left+n.width,n.top+n.height)),r=jQuery(".annotator-wrapper")[0],a=e.getElementPosition(r),s=e.getElementPosition(this.viewer.canvas),l={};i=i.plus(s),o=o.plus(s),t[0].style.display="block",l.left=i.x-a.x+(o.x-i.x)/2,l.top=i.y-a.y+(o.y-i.y)/2,t.css(l)},resolveUrl:function(e,t){return e?e+t:t},_physicalToLogicalXY:function(t){var t=t!==void 0?t:{},n=this.viewer.viewport.getBounds(!0).x,i=this.viewer.viewport.getBounds(!0).y,o=this.viewer.viewport.getBounds(!0).width,r=this.viewer.viewport.getBounds(!0).height,a=this.viewer.viewport.getContainerSize().x,s=this.viewer.viewport.getContainerSize().y,l=t.x!==void 0?t.x:0,u=t.y!==void 0?t.y:0;return l=n+l/a*o,u=i+u/s*r,new e.Point(l,u)},_logicalToPhysicalXY:function(t){var t=t!==void 0?t:{},n=this.viewer.viewport.getBounds(!0).x,i=this.viewer.viewport.getBounds(!0).y,o=this.viewer.viewport.getBounds(!0).width,r=this.viewer.viewport.getBounds(!0).height,a=this.viewer.viewport.getContainerSize().x,s=this.viewer.viewport.getContainerSize().y,l=t.x!==void 0?t.x:0,u=t.y!==void 0?t.y:0;return l=(l-n)*a/o,u=(u-i)*s/r,new e.Point(l,u)}}}(OpenSeadragon),Annotator.Plugin.OpenSeaDragon=function(e){function t(){return this.pluginSubmit=__bind(this.pluginSubmit,this),_ref=t.__super__.constructor.apply(this,arguments),this.__indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},_ref}return __extends(t,e),t.prototype.field=null,t.prototype.input=null,t.prototype.pluginInit=function(){if(console.log("OpenSeaDragon-pluginInit"),Annotator.supported()){this.field=this.annotator.editor.addField({id:"osd-input-rangePosition-annotations",type:"input",submit:this.pluginSubmit,EditOpenSeaDragonAn:this.EditOpenSeaDragonAn});var e='<li><span id="osd-input-rangePosition-annotations"></span></li>',t=Annotator.$(e);return Annotator.$(this.field).replaceWith(t),this.field=t[0],this.initListeners(),this.input=$(this.field).find(":input")}},t.prototype.pluginSubmit=function(e,t){if(console.log("Plug-pluginSubmit"),this.EditOpenSeaDragonAn()){var n=this.annotator,i=n.osda,o=i.rectPosition,r=t.media===void 0;t.media===void 0&&(t.media="image"),t.target=t.target||{},t.target.container=i.viewer.id||"";var a=i.viewer.source,s=a.tilesUrl!==void 0?a.tilesUrl:"",l=a.getTileUrl!==void 0?a.getTileUrl:"";t.target.src=""!=s?s:(""+l).replace(/\s+/g," "),t.target.ext=a.fileFormat||"",t.bounds=i.viewer.drawer.viewport.getBounds()||{},r&&(t.rangePosition=o||{}),t.updated=(new Date).toISOString(),t.created===void 0&&(t.created=t.updated)}else t.media===void 0&&(t.media="text"),t.updated=(new Date).toISOString(),t.created===void 0&&(t.created=t.updated);return t.media},t.prototype.EditOpenSeaDragonAn=function(){var e=$(".annotator-wrapper").parent()[0],t=window.annotator=$.data(e,"annotator"),n=t.osda!==void 0,i=t.editor.OpenSeaDragon;return n&&i!==void 0&&-1!==i},t.prototype.isOpenSeaDragon=function(e){var t=$(".annotator-wrapper").parent()[0],n=window.annotator=$.data(t,"annotator"),i=e.rangePosition,o=n.osda!==void 0,r=e.target!==void 0&&e.target.container==n.osda.viewer.id,a=e.media!==void 0&&"image"==e.media,s=i!==void 0,l=!1,u=n.osda.viewer.source,c=u.tilesUrl!==void 0?u.tilesUrl:"";return functionUrl=u.getTileUrl!==void 0?u.getTileUrl:"",compareUrl=""!=c?c:(""+functionUrl).replace(/\s+/g," "),r&&(l=e.target.src==compareUrl),o&&r&&a&&s&&l},t.prototype._deleteAnnotation=function(e){var t=this.annotator.plugins.Store.annotations;t.indexOf(e)>-1&&t.splice(t.indexOf(e),1),this.annotator.osda.refreshDisplay()},t.prototype.initListeners=function(){function e(){console.log("annotationEditorHidden"),s()&&(a.osda._reset(),a.osda.refreshDisplay()),a.editor.OpenSeaDragon=-1,a.unsubscribe("annotationEditorHidden",e)}function t(t,n){console.log("annotationEditorShown"),a.osda.editAnnotation(n,t),a.subscribe("annotationEditorHidden",e)}function n(e){console.log("annotationDeleted"),l(e)&&u._deleteAnnotation(e)}function i(){jQuery(a.osda.viewer.canvas.parentNode).find(".annotator-hl").map(function(){return this.style.background="rgba(255, 255, 10, 0.3)"}),a.viewer.unsubscribe("hide",i)}function o(e){var t=jQuery(".annotator-wrapper").offset(),n={x:parseFloat(e.element[0].style.left),y:parseFloat(e.element[0].style.top)},o=e.element.hasClass(e.classes.invert.y)?5:-5,r={top:n.y-t.top+o,left:n.x-t.left};e.element.css(r),e.element.find(".annotator-controls").removeClass(e.classes.showControls),a.viewer.subscribe("hide",i)}var r=$(".annotator-wrapper").parent()[0],a=$.data(r,"annotator"),s=this.EditOpenSeaDragonAn,l=this.isOpenSeaDragon,u=this;a.subscribe("annotationEditorShown",t).subscribe("annotationDeleted",n).subscribe("annotationViewerShown",o)},t}(Annotator.Plugin),OpenSeadragonAnnotation="OpenSeadragonAnnotation"in window?OpenSeadragonAnnotation:{},OpenSeadragonAnnotation=function(e,t){var n=jQuery,t=t||{};t.optionsOpenSeadragon=t.optionsOpenSeadragon||{},t.optionsOSDA=t.optionsOSDA||{},t.optionsAnnotator=t.optionsAnnotator||{},t.optionsAnnotator.store===void 0&&(t.optionsAnnotator.store={});var i=t.optionsAnnotator.store;if(i.annotationData===void 0&&(i.annotationData={}),i.annotationData.uri===void 0){var o=location.protocol+"//"+location.host+location.pathname;i.annotationData.store={uri:o}}return i.loadFromSearch===void 0&&(i.loadFromSearch={}),i.loadFromSearch.uri===void 0&&(i.loadFromSearch.uri=o),i.loadFromSearch.limit===void 0&&(i.loadFromSearch.limit=1e4),this.currentUser=null,this.annotator=n(e).annotator(t.optionsAnnotator.annotator).data("annotator"),t.optionsAnnotator.auth!==void 0&&this.annotator.addPlugin("Auth",t.optionsAnnotator.auth),t.optionsAnnotator.permissions!==void 0&&this.annotator.addPlugin("Permissions",t.optionsAnnotator.permissions),t.optionsAnnotator.store!==void 0&&this.annotator.addPlugin("Store",t.optionsAnnotator.store),this.annotator.addPlugin("Tags"),"function"==typeof Annotator.Plugin.Geolocation&&this.annotator.addPlugin("Geolocation",t.optionsAnnotator.geolocation),"function"==typeof Annotator.Plugin.Share&&this.annotator.addPlugin("Share",t.optionsAnnotator.share),"function"==typeof Annotator.Plugin.RichText&&this.annotator.addPlugin("RichText",t.optionsAnnotator.richText),"function"==typeof Annotator.Plugin.Reply&&this.annotator.addPlugin("Reply"),"function"==typeof Annotator.Plugin.OpenSeaDragon&&this.annotator.addPlugin("OpenSeaDragon"),"function"==typeof Annotator.Plugin.Flagging&&this.annotator.addPlugin("Flagging"),this.viewer=t.optionsOpenSeadragon.instance||OpenSeadragon(t.optionsOpenSeadragon),this.viewer.annotation(t.optionsOSDA),this.annotator.editor.OpenSeaDragon=-1,this.options=t,this},window.Mirador=window.Mirador||function(e){Mirador.viewer=new Mirador.Viewer(e),Mirador.manifests=new Mirador.ManifestsLoader(e),Mirador.DEFAULT_SETTINGS.imageView.osda=e.osda},function(e){e.DEFAULT_SETTINGS={workspaceAutoSave:!0,showNoImageChoiceOption:!0,initialLayout:"stackAll3Columns",availableViews:{imageView:{label:"Image View"},scrollView:{label:"Scroll View"},thumbnailsView:{label:"Thumbnails View"},metadataView:{label:"Metadata View"}},maxWidgetsLimit:10,mainMenu:{height:25,width:"100%"},statusBar:{show:!0,height:25,width:"100%"},scale:{height:60,maxWidth:230},widget:{height:400,width:400},widgetToolbar:{height:25},widgetStatusBar:{height:26},imageView:{height:400,width:350,annotationsList:{display:!0,width:200}},scrollView:{height:400,imageLabelHeight:25,toolbarHeight:25,width:600},thumbnailsView:{height:400,thumbsMaxHeight:150,thumbsMinHeight:50,thumbsDefaultZoom:.5,width:600},metadataView:{height:400,width:600},saveController:{saveInterval:8e3},lockController:{lockProfile:"lazyZoom",notifyMaxMin:!1}},e.isValidView=function(){return e.DEFAULT_SETTINGS.availableViews.view===void 0},e.inArrayToBoolean=function(e){return-1===e?!1:!0},e.castToArray=function(e){return"string"==typeof e?[e]:e},e.getUniques=function(e){for(var t={},n=[],i=0;e.length>i;i++)t[e[i]]=!0;for(var o in t)n.push(o);return n},e.getTitlePrefix=function(e){var t=[];return e&&e.label&&t.push(e.label),t.join(" / ")},e.trimString=function(e){return e.replace(/^\s+|\s+$/g,"")},e.trimStringBy=function(e,t){return e.length>t&&(e=e.substr(0,t)+"..."),e},e.stringifyObject=function(t,n){var i,o=!0,r=15,a="<br/>";if(t instanceof RegExp)return"/"+t.source+"/";if(n===void 0&&(n=0),t instanceof Array)return i="[ ",jQuery.each(t,function(t,o){i+=(0===t?"":", ")+e.stringifyObject(o,n+r)}),i+" ]";if("object"==typeof t){i='<div style="margin-left:'+n+'px">';for(var s in t)t.hasOwnProperty(s)&&(i+=(o?"":a)+s+": "+e.stringifyObject(t[s],n+r),o=!1);return i+"</div>"}return""+t},e.getJsonFromUrl=function(e,t){var n;return jQuery.ajax({url:e,dataType:"json",async:t||!1,success:function(e){n=e},error:function(e,t,n){console.error(e,t,n)}}),n},e.getViewLabel=function(t){var n=e.DEFAULT_SETTINGS.availableViews[t];return n&&n.label?n.label:t},e.extractLabelFromAttribute=function(e){var t=e;return t=t.replace(/^@/,""),t=t.replace(/([A-Z])/g," $1"),t=t.replace(/\s{2,}/g," "),t=t.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},e.toString=function(e,t){var n="",i=t||" ";return"string"===jQuery.type(e)&&(n=e),jQuery.isArray(e)&&(n=e.join(i)),n},e.getManifestIdByUri=function(t){var n;return n=jQuery.map(e.manifests,function(e,n){return t===e.uri?n:void 0}),n[0]||n},e.getMetadataByManifestId=function(t){return e.manifests[t].metadata},e.getImagesListByManifestId=function(t){return e.manifests[t].sequences[0].imagesList},e.getCollectionTitle=function(e){return e.details.label||""},e.getImageTitlesAndIds=function(e){var t=[];return jQuery.each(e,function(e,n){t.push({title:n.title,id:n.id})}),t},e.genUUID=function(){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=0|16*Math.random(),n="x"==e?t:8|3&t;return n.toString(16)});return"uuid-"+e},e.throttle=function(e,t,n){var i,o,r,a=null,s=0;n!==void 0&&(n={});var l=function(){s=n.leading===!1?0:new Date,a=null,r=e.apply(i,o)};return function(){var u=new Date;s||n.leading!==!1||(s=u);var c=t-(u-s);return i=this,o=arguments,0>=c?(clearTimeout(a),a=null,s=u,r=e.apply(i,o)):a||n.trailing===!1||(a=setTimeout(l,c)),r}},e.debounce=function(e,t,n){var i,o,r,a,s;return function(){r=this,o=arguments,a=new Date;var l=function(){var u=new Date-a;t>u?i=setTimeout(l,t-u):(i=null,n||(s=e.apply(r,o)))},u=n&&!i;return i||(i=setTimeout(l,t)),u&&(s=e.apply(r,o)),s}},e.parseRegion=function(e){e=new URI(e);var t=e.hash();return regionArray=t.split("=")[1].split(",")},e.getOsdFrame=function(e,t){var n=t.width,i=t.height,o=t.canvasWidth,r=t.canvasHeight,a=n/o,s=i/r,l=e[0]*a/n,u=e[1]*s/n,c=e[2]*a/n,d=e[3]*s/n,h=new OpenSeadragon.Rect(l,u,c,d);return h}}(Mirador),jQuery.fn.scrollStop=function(e){$(this).scroll(function(){var t=this,n=$(t);n.data("scrollTimeout")&&clearTimeout(n.data("scrollTimeout")),n.data("scrollTimeout",setTimeout(e,250,t))})},function(e){var t=Array.prototype.slice;e.extend(e.event.special,{resizestop:{add:function(t){var n=t.handler;e(this).resize(function(i){clearTimeout(n._timer),i.type="resizestop";var o=e.proxy(n,this,i);n._timer=setTimeout(o,t.data||200)})}},resizestart:{add:function(t){var n=t.handler;e(this).on("resize",function(i){clearTimeout(n._timer),n._started||(i.type="resizestart",n.apply(this,arguments),n._started=!0),n._timer=setTimeout(e.proxy(function(){n._started=!1},this),t.data||300)})}}}),e.extend(e.fn,{resizestop:function(){e(this).on.apply(this,["resizestop"].concat(t.call(arguments)))},resizestart:function(){e(this).on.apply(this,["resizestart"].concat(t.call(arguments)))}})}(jQuery),function(e){e.ManifestsLoader=function(e){return this.getManifestsData(e)},e.ManifestsLoader.prototype={getManifestsData:function(t){var n=this,i={},o=[],r=[];return jQuery.each(t.data,function(e,t){n.hasWidgets(t)?o.unshift(e):o.push(e)}),jQuery.each(o,function(o,a){var s,l="manifest-"+e.genUUID(),u=t.data[a],c=jQuery.Deferred();jQuery.isEmptyObject(u)||(s=new e.Manifest(u.manifestUri,c),r.push(c),c.done(function(t){t&&(i[l]={uri:e.trimString(u.manifestUri),metadata:s.metadata,sequences:s.sequences,location:u.location||"-"},n.hasWidgets(u)&&e.viewer.renderWidgetsForCollection(u),e.viewer.addStatusBarMessage("left","Loaded "+u.manifestUri,600))}))}),jQuery.when.apply(null,r).done(function(){var t="Loaded "+e.viewer.numManifestsLoaded+" of "+r.length+" manifests to viewer";e.viewer.updateLoadWindowContent(),e.viewer.addStatusBarMessage("left",t,1e3,!0)}).done(function(){e.viewer.workspaceAutoSave&&e.viewer.saveController.save()}),i},hasWidgets:function(e){return e.widgets!==void 0&&e.widgets&&!jQuery.isEmptyObject(e.widgets)&&e.widgets.length>0}}}(Mirador),function(e){e.Viewer=function(t){jQuery.extend(!0,this,{id:t.id,hash:t.id,data:null,element:null,canvas:null,initialLayout:e.DEFAULT_SETTINGS.initialLayout||"cascade",currentLayout:null,layout:null,mainMenu:null,numManifestsLoaded:0,showStatusBar:e.DEFAULT_SETTINGS.statusBar.show,statusBar:null,widgets:[],collectionsListingCls:"mirador-listing-collections",mainMenuLoadWindowCls:".mirador-main-menu .load-window",workspaceAutoSave:e.DEFAULT_SETTINGS.workspaceAutoSave,windowSize:{},resizeRatio:{},lastWidgetPosition:{x:"left",y:"top",offset:0}},e.DEFAULT_SETTINGS,t),this.element=this.element||jQuery("#"+this.id),this.data&&this.create(),this.lockController=new e.LockController,this.workspaceAutoSave&&(this.saveController=new e.SaveController)},e.Viewer.prototype={create:function(){this.mainMenu=new e.MainMenu({appendTo:this.element}),this.canvas=jQuery("<div/>").addClass("mirador-viewer").appendTo(this.element),this.showStatusBar&&(this.statusBar=new e.StatusBar({appendTo:this.element})),this.layout=new e.Layout,this.alignViewerElements(),this.attachEvents()},alignViewerElements:function(){this.canvas.height(this.element.height()-this.mainMenu.element.outerHeight(!0)),this.showStatusBar&&this.canvas.height(this.canvas.height()-this.statusBar.element.outerHeight(!0))},renderWidgetsForCollection:function(t){var n=this;jQuery.each(t.widgets,function(i,o){!jQuery.isEmptyObject(o)&&e.isValidView(o.type)&&(o.manifestId=e.getManifestIdByUri(t.manifestUri),n.addWidget(o))}),this.initialLayout!==void 0&&(e.viewer.layout.applyLayout(this.initialLayout),this.currentLayout=this.initialLayout)},addWidget:function(t){jQuery.extend(!0,t,{appendTo:this.canvas,id:"mirador-widget-"+e.genUUID(),position:{my:this.getWidgetPosition()}}),this.widgets.push(new e.Widget(t))},removeWidget:function(t){jQuery.each(e.viewer.widgets,function(n,i){i&&i.id===t&&("imageView"===i.type&&e.viewer.lockController.removeLockedView(i.id),e.viewer.widgets.splice(n,1))})},findWidget:function(t,n,i){var o=[];return jQuery.each(e.viewer.widgets,function(e,r){r.type==t&&r.manifestId==n&&(i&&this.imageId!=i||o.push(r))}),o},loadView:function(t,n,i,o){e.viewer.addWidget({height:e.DEFAULT_SETTINGS[t].height,manifestId:n,openAt:o,imageId:i,type:t,width:e.DEFAULT_SETTINGS[t].width})},getWidgetPosition:function(){var e=25,t=this.lastWidgetPosition.x+"+"+this.lastWidgetPosition.offset,n=this.lastWidgetPosition.y+"+"+this.lastWidgetPosition.offset;return this.lastWidgetPosition.offset+=e,t+" "+n},updateLoadWindowContent:function(){var t={cssCls:this.collectionsListingCls,collections:[]},n=this.arrangeCollectionsFromManifests(),i=[];jQuery.each(n,function(e){i.push(e)}),jQuery.each(i.sort(),function(e,i){t.collections.push({location:i,list:n[i]})}),e.loadWindowContent=e.Templates.mainMenu.loadWindowContent(t),jQuery(this.mainMenuLoadWindowCls).tooltipster("update",e.loadWindowContent)},arrangeCollectionsFromManifests:function(){var t={};return jQuery.isEmptyObject(e.manifests)||jQuery.each(e.manifests,function(n,i){var o=i.location;t[o]===void 0&&(t[o]=[]),t[o].push({manifestId:n,collectionTitle:e.trimStringBy(e.getCollectionTitle(i.metadata),60),imageData:e.getImageTitlesAndIds(i.sequences[0].imagesList)})}),jQuery.each(t,function(e){t[e]=t[e].sort(function(e,t){return e.collectionTitle.localeCompare(t.collectionTitle)})}),t},addStatusBarMessage:function(e,t,n,i){var o=this.statusBar.element.find(".mirador-status-bar-msg-"+e);n=isNaN(n)?0:n,i&&"boolean"!=typeof i&&(i=!0),o.text(t),i&&setTimeout(function(){o.fadeOut()},n)},attachEvents:function(){var e=this;jQuery(window).on("resizestart",function(t){t.target==window&&e.saveCurrentWindowSize()}),jQuery(window).on("resizestop",function(t){t.target==window&&e.resizeViewer()})},resizeWidgets:function(){var t=this;null!==this.currentLayout?e.viewer.layout.applyLayout(this.currentLayout):jQuery.each(this.widgets,function(e,n){var i,o,r=n.getPosition(),a=r[0],s=r[1];i=t.resizeRatio.width*a,o=t.resizeRatio.height*s,1>t.resizeRatio.width&&(n.setPosition(i,s),n.setWidth(t.resizeRatio.width*n.getWidth())),1>t.resizeRatio.height&&(n.setPosition(a,o),n.setHeight(t.resizeRatio.height*n.getHeight()))})},resizeViewer:function(){this.resizeRatio.width=(jQuery(window).width()/this.windowSize.width).toFixed(2),this.resizeRatio.height=(jQuery(window).height()/this.windowSize.height).toFixed(2),this.alignViewerElements(),this.resizeWidgets(),this.saveCurrentWindowSize()},saveCurrentWindowSize:function(){this.windowSize.width=jQuery(window).width(),this.windowSize.height=jQuery(window).height()},saveCurrentLayout:function(e){this.currentLayout=e}}}(Mirador),function(e){e.Templates={mainMenu:{menuItems:Handlebars.compile(['<ul class="{{mainMenuCls}}">',"<li>",'<a href="javascript:;" class="bookmark-workspace" title="Bookmark Workspace">','<span class="icon-bookmark-workspace"></span>Bookmark Workspace',"</a>","</li>","<li>",'<a href="javascript:;" class="load-window" title="Load Window">','<span class="icon-load-window"></span>Load Window',"</a>","</li>","<li>",'<a href="javascript:;" class="window-options" title="Window Options">','<span class="icon-window-options"></span>Window Options',"</a>","</li>","<li>",'<a href="javascript:;" class="clear-local-storage" title="Clear saved workspace and reload">','<span class="icon-clear-local-storage"></span>',"</a>","</li>","</ul>"].join("")),windowOptionsMenu:Handlebars.compile(['<ul class="{{windowOptionsMenuCls}}">','<li><a class="cascade-all" href="javascript:;">Cascade All</a></li>','<li><a class="tile-all-vertically" href="javascript:;">Tile All Vertically</li>','<li><a class="tile-all-horizontally" href="javascript:;">Tile All Horizontally</a></li>','<li><a class="stack-all-vertically-2-cols" href="javascript:;">Stack Vertically (2 columns)</a></li>','<li><a class="stack-all-vertically-3-cols" href="javascript:;">Stack Vertically (3 columns)</a></li>','<li class="ui-state-disabled"><a href="javascript:;">Open Recent</a></li>','<li><a class="close-all" href="javascript:;">Close All</a></li>',"</ul>"].join("")),loadWindowContent:Handlebars.compile(['<fieldset class="{{cssCls}}">',"<legend>Available/Loaded manuscripts</legend>","<select>","{{#collections}}",'<optgroup label="{{location}}">',"{{#list}}",'<option data-manifest-id="{{manifestId}}">{{collectionTitle}}</option>',"{{/list}}","</optgroup>","{{/collections}}","</select><br/>",'<a href="javascript:;" class="mirador-btn mirador-icon-thumbnails-view"></a>','<a href="javascript:;" class="mirador-btn mirador-icon-scroll-view"></a>','<a href="javascript:;" class="mirador-btn mirador-icon-metadata-view"></a>',"{{#collections}}","{{#list}}",'<ul class="ul-{{manifestId}}">',"{{#imageData}}",'<li><a href="javascript:;" data-image-id="{{id}}" data-manifest-id="{{../manifestId}}">{{trimTitlePrefix title}}</a></li>',"{{/imageData}}","</ul>","{{/list}}","{{/collections}}","</fieldset>"].join("")),clearLocalStorage:Handlebars.compile(['<div class="{{cssCls}}">',"<p>Do you want to delete your saved workspace, and reload the viewer?</p>","<p>","<a class=\"btn-cancel\" href=\"javascript: jQuery('{{selectorClearLocalStorage}}').tooltipster('hide');\">Cancel</a>",'<a class="btn-clear" href="javascript: localStorage.clear(); location.reload();">Clear</a>',"</p>","</div>"].join(""))},statusBar:{textFrames:Handlebars.compile(['<div class="mirador-status-bar-msg-left"></div>','<div class="mirador-status-bar-msg-right"></div>'].join(""))},widget:{initialLayout:Handlebars.compile(['<div class="{{widgetToolbarCls}}"></div>','<div class="{{widgetContentCls}}">Loading...</div>','<div class="{{widgetStatusBarCls}}"></div>'].join(""))},imageView:{navToolbar:Handlebars.compile(['<div class="{{navToolbarCls}}">','<a href="javascript:;" class="mirador-btn mirador-icon-annotations"><i class="icon-comments"></i></a>','<a href="javascript:;" class="mirador-btn mirador-icon-choices"></a>','<a href="javascript:;" class="mirador-btn mirador-icon-metadata-view"></a>','<a href="javascript:;" class="mirador-btn mirador-icon-scroll-view"></a>','<a href="javascript:;" class="mirador-btn mirador-icon-thumbnails-view"></a>','<a href="javascript:;" class="mirador-btn mirador-icon-previous"></a>','<a href="javascript:;" class="mirador-btn mirador-icon-next"></a>','<a href="javascript:;" class="mirador-btn mirador-icon-annotator"></a>',"</div>"].join("")),statusbar:Handlebars.compile(['<div class="{{statusbarCls}}">','<a href="javascript:;" class="mirador-btn mirador-icon-lock"></a>','<div class="mirador-image-dimensions">','<span class="noDimensionsWarning">No Dimensions Given</span>','<textarea rows="1" class="mirador-image-view-physical-dimensions x">{{width}}</textarea>',"<span>✕</span>",'<textarea rows="1" class="mirador-image-view-physical-dimensions y">{{height}}</textarea>','<span class="units">mm','<select class="unit-selector">','<option value="mm">millimeters</option>','<option value="cm">centimeters</option>','<option value="m">meters</option>',"</select>","</span>","</div>","</div>"].join("")),annotationPanel:Handlebars.compile(['<div class="annotationListPanel">','<div class="resizeGrip"></div>',"{{> annotationStats}}",'<ul class="annotationList">',"{{#each annotations}}","{{> annotationListing}}","{{/each}}","</ul>","</div>"].join("")),annotationStats:function(){var e=['<div class="annotationPanelHeader">','<h4>Annotation List (<span class="annotationsTotal">{{annotationCount}}</span>)</h4>','<div class="annoSearch">','<select id="annotationTypeSelector" name="annotationTypes">','<option value="">All (<span class="annotationCount">{{annotationCount}}</span>)</option>','<option value="commenting">Commentary (<span class="imageAnnotationCount">{{imageAnnotationCount}}</span>)</option>','<option value="painting">Transcription (<span class="textAnnotationCount">{{textAnnotationCount}}</span>)</option>',"</select>","</div>","</div>"].join("");
return Handlebars.registerPartial("annotationStats",e),Handlebars.compile(e)}(),noAnnotationMessage:function(){var e=['<div class="annotationPanelHeader">',"<h4>No Annotations Provided</h4>","</div>"].join("");return Handlebars.registerPartial("annotationStats",e),Handlebars.compile(e)}(),annotationListing:function(){var e=['<li id="listing_{{id}}" class="annotationListing">',"{{#if title}}","<h3>{{{title}}}</h3>","{{/if}}","<p>{{{content}}}</p>","</li>"].join("");return Handlebars.registerPartial("annotationListing",e),Handlebars.compile(e)}(),annotationDetail:Handlebars.compile(['<div class="annotationDetails">','<div class="annotationNumber">{{annotationNumber}}</div>','<a class="annotationDetailToggle mirador-icon-annotationDetail-toggle" title="Hide this detail panel."><i class="icon-eye-close"></i></a>',"<p>{{{body}}}</p>","</div>"].join("")),annotationDetailToggle:Handlebars.compile(['<div class="displayBottomPanelButton">','<a class="annotationDetailToggle mirador-icon-annotationDetail-toggle" title="Display annotation details in bottom panel."><i class="icon-eye-open"></i></a>',"</div>"].join("")),imageChoices:Handlebars.compile(['<ul class="mirador-image-view-choices">',"{{#choicesInfo}}",'<li><a href="javascript:;" class="mirador-image-view-choice" data-choice="{{label}}" data-image-url="{{imageUrl}}">{{label}}</a></li>',"{{/choicesInfo}}","</ul>"].join(""))},scrollView:{imagesFrame:Handlebars.compile(['<div class="{{frameCls}}"></div>'].join("")),listImages:Handlebars.compile(["{{#images}}",'<div id="{{id}}" class="item">','<div class="header" style="height: {{../toolbarHeight}}px">','<div id="{{id}}-osd-toolbar" class="toolbar">','<a href="javascript:;" class="enable-zoom">Enable zoom</a>',"</div>","</div>",'<div id="{{id}}-osd" class="image-instance">','<img class="static-thumb">',"</div>",'<div class="title">{{title}}</div>',"</div>","{{/images}}"].join("")),navToolbar:Handlebars.compile(['<div class="{{navToolbarCls}}">','<a href="javascript:;" class="mirador-btn mirador-icon-metadata-view"></a>','<a href="javascript:;" class="mirador-btn mirador-icon-thumbnails-view"></a>',"</div>"].join(""))},thumbnailsView:{listImages:Handlebars.compile(['<ul class="{{listingCssCls}} listing-thumbs">',"{{#thumbs}}","<li>",'<a href="javascript:;">','<img title="{{title}}" data-image-id="{{id}}" src="{{thumbUrl}}" height="{{../defaultHeight}}">','<div class="thumb-label">{{title}}</div>',"</a>","</li>","{{/thumbs}}","</ul>"].join("")),navToolbar:Handlebars.compile(['<div class="{{navToolbarCls}}">','<a href="javascript:;" class="mirador-btn mirador-icon-metadata-view"></a>','<a href="javascript:;" class="mirador-btn mirador-icon-scroll-view"></a>',"</div>"].join(""))},metadataView:{listTerms:Handlebars.compile(['<div class="sub-title">Details (Metadata about physical object/intellectual work):</div>','<dl class="{{metadataListingCls}}">',"{{#each details}}","<dt>{{label}}:</dt><dd>{{value}}</dd>","{{/each}}","</dl>",'<div class="sub-title">Rights Metadata:</div>','<dl class="{{metadataListingCls}}">',"{{#each rights}}","<dt>{{label}}:</dt><dd>{{value}}</dd>","{{/each}}","</dl>",'<div class="sub-title">Linking Metadata:</div>','<dl class="{{metadataListingCls}}">',"{{#each links}}","<dt>{{label}}:</dt><dd>{{value}}</dd>","{{/each}}","</dl>",'<div class="sub-title">About (Metadata about this manuscript\'s manifest file):</div>','<dl class="{{metadataListingCls}}">',"{{#each about}}","<dt>{{label}}:</dt><dd>{{value}}</dd>","{{/each}}","</dl>"].join(""),{noEscape:!0}),navToolbar:Handlebars.compile(['<div class="{{navToolbarCls}}">','<a href="javascript:;" class="mirador-btn mirador-icon-scroll-view"></a>','<a href="javascript:;" class="mirador-btn mirador-icon-thumbnails-view"></a>',"</div>"].join(""))}},Handlebars.registerHelper("trimTitlePrefix",function(e){return e=e.replace(/^Beinecke MS \w+,? \[?/,""),e=e.replace(/\]$/,"")})}(Mirador),function(e){e.MainMenuWindowOptions=function(e){jQuery.extend(!0,this,{menuContent:null,windowOptionsMenuCls:"window-options-menu"},e),this.html=this.html||"<div/>",this.render(),this.attachEvents()},e.MainMenuWindowOptions.prototype={render:function(){this.html=e.Templates.mainMenu.windowOptionsMenu({windowOptionsMenuCls:this.windowOptionsMenuCls})},attachEvents:function(){var t="."+this.windowOptionsMenuCls+" .cascade-all",n="."+this.windowOptionsMenuCls+" .tile-all-vertically",i="."+this.windowOptionsMenuCls+" .tile-all-horizontally",o="."+this.windowOptionsMenuCls+" .stack-all-vertically-2-cols",r="."+this.windowOptionsMenuCls+" .stack-all-vertically-3-cols",a="."+this.windowOptionsMenuCls+" .close-all";jQuery(document).on("click",t,function(){e.viewer.layout.applyLayout("cascade")}),jQuery(document).on("click",n,function(){e.viewer.layout.applyLayout("tileAllVertically")}),jQuery(document).on("click",i,function(){e.viewer.layout.applyLayout("tileAllHorizontally")}),jQuery(document).on("click",o,function(){e.viewer.layout.applyLayout("stackAll2Columns")}),jQuery(document).on("click",r,function(){e.viewer.layout.applyLayout("stackAll3Columns")}),jQuery(document).on("click",a,function(){e.viewer.layout.closeAll()})}}}(Mirador),function(e){e.MainMenuLoadWindow=function(e){jQuery.extend(!0,this,{element:null,width:300,collectionsListingCls:"mirador-listing-collections"},e),this.element=this.element||jQuery("<div/>"),this.attachEvents()},e.MainMenuLoadWindow.prototype={attachEvents:function(){var t="."+this.collectionsListingCls,n=t+" select",i=t+" ul",o=t+" a.mirador-icon-scroll-view",r=t+" a.mirador-icon-metadata-view",a=t+" a.mirador-icon-thumbnails-view";jQuery(document).on("change",n,function(){var e=jQuery(this).find("option:selected").data("manifest-id");jQuery(i).hide(),jQuery(i+".ul-"+e).show()}),jQuery(document).on("click",i,function(t){var n,i,o=jQuery(t.target);n=o.data("manifest-id"),i=o.data("image-id"),e.viewer.loadView("imageView",n,i)}),jQuery(document).on("click",a,function(){var t=jQuery(n).find("option:selected").data("manifest-id");e.viewer.loadView("thumbnailsView",t)}),jQuery(document).on("click",o,function(){var t=jQuery(n).find("option:selected").data("manifest-id");e.viewer.loadView("scrollView",t)}),jQuery(document).on("click",r,function(){var t=jQuery(n).find("option:selected").data("manifest-id");e.viewer.loadView("metadataView",t)})}}}(Mirador),function(e){e.MainMenu=function(t){jQuery.extend(!0,this,{element:null,mainMenuHeight:e.DEFAULT_SETTINGS.mainMenu.height,mainMenuWidth:e.DEFAULT_SETTINGS.mainMenu.width,windowOptionsMenu:null,loadWindow:null,clearLocalStorage:"",viewerCls:"mirador-viewer",mainMenuBarCls:"mirador-main-menu-bar",mainMenuCls:"mirador-main-menu",windowOptionsMenuCls:"mirador-window-options-menu",clearLocalStorageCls:"clear-local-storage",clearLocalStorageDialogCls:"mirador-main-menu-clear-local-storage",collectionsListingCls:"mirador-listing-collections"},t),this.element=this.element||jQuery("<div/>"),this.render(),this.attachMainMenuEvents()},e.MainMenu.prototype={render:function(){this.element.addClass(this.mainMenuBarCls).height(this.mainMenuHeight).width(this.mainMenuWidth).appendTo(this.appendTo),this.element.append(e.Templates.mainMenu.menuItems({mainMenuCls:this.mainMenuCls})),this.windowOptionsMenu=new e.MainMenuWindowOptions({windowOptionsMenuCls:this.windowOptionsMenuCls}),e.loadWindowContent="Loading...",this.loadWindow=new e.MainMenuLoadWindow({collectionsListingCls:this.collectionsListingCls}),this.clearLocalStorage=e.Templates.mainMenu.clearLocalStorage({cssCls:this.clearLocalStorageDialogCls,selectorClearLocalStorage:"."+this.mainMenuCls+" ."+this.clearLocalStorageCls})},attachMainMenuEvents:function(){var e=this.element.find("."+this.mainMenuCls);selectorBookmarkWorkspace=".bookmark-workspace",selectorLoadWindow=".load-window",selectorWindowOptions=".window-options",selectorClearLocalStorage="."+this.clearLocalStorageCls,selectorWindowOptionsMenu="."+this.mainMenuBarCls+" ."+this.windowOptionsMenuCls,_this=this,e.on("click",selectorBookmarkWorkspace,function(){}),e.find(selectorLoadWindow).tooltipster({arrow:!0,content:_this.loadWindow.element,interactive:!0,position:"bottom",theme:".tooltipster-mirador",functionReady:function(){var e=.8*jQuery("."+_this.viewerCls).height();jQuery("."+_this.collectionsListingCls).height(e),jQuery("."+_this.collectionsListingCls+" ul").height(e-70)}}),e.find(selectorWindowOptions).tooltipster({arrow:!0,content:_this.windowOptionsMenu.html,interactive:!0,theme:".tooltipster-mirador"}),e.find(selectorClearLocalStorage).tooltipster({arrow:!0,content:_this.clearLocalStorage,interactive:!0,theme:".tooltipster-mirador"})}}}(Mirador),function(e){e.StatusBar=function(t){jQuery.extend(!0,this,{element:null,statusBarHeight:e.DEFAULT_SETTINGS.statusBar.height,statusBarWidth:e.DEFAULT_SETTINGS.statusBar.width,statusBarBarCls:"mirador-status-bar"},t),this.element=this.element||jQuery("<div/>"),this.render()},e.StatusBar.prototype={render:function(){this.element.addClass(this.statusBarBarCls).height(this.statusBarHeight).width(this.statusBarWidth).appendTo(this.appendTo),this.element.append(e.Templates.statusBar.textFrames({})),this.xbox=this.element.find(".x"),this.ybox=this.element.find(".y")}}}(Mirador),function(e){e.Layout=function(e){jQuery.extend(!0,this,{rowPadding:10,columnPadding:10,cascade:{x:10,y:40,offset:25}},e)},e.Layout.prototype={cascadeAll:function(){var t,n,i=this,o=0,r={};r.top=e.viewer.mainMenu.element.outerHeight(!0),r.left=this.columnPadding,jQuery.each(e.viewer.widgets,function(e,r){t=i.cascade.x+o,n=i.cascade.y+o,r.setPosition(t,n),r.moveToTop(),o+=i.cascade.offset})},tileAllVertically:function(){this.stackAllByColumns(1)},tileAllHorizontally:function(){this.stackAllByColumns(e.viewer.widgets.length)},stackAllByColumns:function(t){var n,i,o,r,a=this,s={},l=0;s.top=e.viewer.mainMenu.element.outerHeight(!0)+this.rowPadding,s.width=e.viewer.canvas.width()-this.columnPadding,s.height=e.viewer.canvas.height()-this.rowPadding,n=Math.ceil(e.viewer.widgets.length/t),i=Math.floor(s.width/t)-this.columnPadding,o=Math.ceil(s.height/n)-this.rowPadding,jQuery.each(e.viewer.widgets,function(e,n){var u=0,c=0;r=e%t,0===r&&0!==e&&++l,u=a.columnPadding+r*(a.columnPadding+i),c=s.top+l*(a.rowPadding+o),n.setPositionAndSize(u,c,i,o)})},closeAll:function(){jQuery.each(e.viewer.widgets.slice(),function(e,t){t&&t.close()})},applyLayout:function(t){switch(t){case"cascade":this.cascadeAll();break;case"tileAllVertically":this.tileAllVertically();break;case"tileAllHorizontally":this.tileAllHorizontally();break;case"stackAll2Columns":this.stackAllByColumns(2);break;case"stackAll3Columns":this.stackAllByColumns(3);break;default:t="cascade",this.cascadeAll()}e.viewer.saveCurrentLayout(t)}}}(Mirador),function(e){e.Manifest=function(t,n){jQuery.extend(!0,this,{uri:t,jsonLd:null,sequences:[],metadata:{about:{},details:{},rights:{},links:{}},showNoImageChoiceOption:e.DEFAULT_SETTINGS.showNoImageChoiceOption}),this.loadManifestDataFromURI(n)},e.Manifest.prototype={loadManifestDataFromURI:function(e){var t=this;jQuery.ajax({url:t.uri,dataType:"json",async:!0,success:function(n){t.jsonLd=n,t.sequences=t.parseSequences(),t.parseMetadata(),e.resolve(!0)},error:function(){console.log("Failed loading "+t.uri),e.resolve(!1)}})},parseSequences:function(){var e=this,t=[];return jQuery.each(this.jsonLd.sequences,function(n,i){"sc:Sequence"===i["@type"]&&t.push({id:i["@id"],imagesList:e.getImagesList(i)})}),t},getImagesList:function(e){var t=this,n=[];return jQuery.each(e.canvases,function(e,i){var o,r=[];"sc:Canvas"===i["@type"]&&(r=i.resources||i.images,jQuery.each(r,function(e,r){"oa:Annotation"===r["@type"]&&(o=t.getImageObject(r),o.title=i.label||"",o.canvasWidth=i.width,o.canvasHeight=i.height,o.canvasId=i["@id"],i.otherContent&&(o.annotations=jQuery.map(i.otherContent,function(e){return e["@id"].indexOf(".json")>=0?e["@id"]:e["@id"]+".json"})),t.isDetailImage(r.on)||n.push(o))}))}),n},getImageObject:function(e){var t,n=e.resource;return t=n.hasOwnProperty("@type")&&"oa:Choice"===n["@type"]?this.getImageObjWithChoices(e.resource):this.getImageProperties(n),this.showNoImageChoiceOption&&t.choices.push(this.getNoImageChoiceObj()),t},getImageProperties:function(e){var t={height:e.height||0,width:e.width||0,id:e.service["@id"],imageUrl:e.service["@id"].replace(/\/$/,""),choices:[],choiceLabel:e.label||"Default"};return t.aspectRatio=t.width/t.height||1,t},getImageObjWithChoices:function(e){var t,n,i=this,o=[],r=1;return jQuery.isArray(e.item)?o=e.item:o.push(e.item),t=this.getImageProperties(e["default"]),""===t.choiceLabel&&(t.choiceLabel="Choice "+r),jQuery.each(o,function(e,o){n=i.getImageProperties(o),""===n.choiceLabel&&(r+=1,n.choiceLabel="Choice "+r),t.choices.push(n)}),t},getNoImageChoiceObj:function(){return{height:0,width:0,imageUrl:null,choices:[],choiceLabel:"No Image",aspectRatio:1}},isDetailImage:function(e){return/#xywh/.test(e)},parseMetadata:function(){this.parseMetadataAbout(),this.parseMetadataDetails(),this.parseMetadataRights(),this.parseMetadataLinks(),++e.viewer.numManifestsLoaded},parseMetadataAbout:function(){this.metadata.about={"@context":this.jsonLd["@context"]||"","@id":this.jsonLd["@id"]||""}},parseMetadataDetails:function(){this.metadata.details={label:this.jsonLd.label||"",agent:this.jsonLd.agent||"",location:this.jsonLd.location||"",date:this.jsonLd.date||"",description:this.jsonLd.description||""};var e={};this.jsonLd.metadata!==void 0&&jQuery.each(this.jsonLd.metadata,function(t,n){e[n.label]=n.value}),this.metadata.metadata=e},parseMetadataRights:function(){this.metadata.rights={license:this.jsonLd.license||"",attribution:this.jsonLd.attribution||""}},parseMetadataLinks:function(){this.metadata.links={service:this.jsonLd.service||"",seeAlso:this.jsonLd.seeAlso||"",within:this.jsonLd.within||""}}}}(Mirador),function(e){e.AnnotationsLayer=function(t){jQuery.extend(!0,this,{sidePanel:null,bottomPanel:null,regionController:null,width:e.DEFAULT_SETTINGS.imageView.annotationsList.width,parent:null,stateEvents:{},showList:!0,annotationUrls:null,annotations:[],commentAnnotations:0,textAnnotations:0,visible:!1,selectedAnnotation:null,hoveredAnnotation:null,annotationListCls:"mirador-annotation-list",filter:null},t),this.create()},e.AnnotationsLayer.prototype={create:function(){var t=this;t.getAnnotations().done(function(){t.bottomPanel=new e.AnnotationBottomPanel({parent:t}),t.regionController=new e.AnnotationLayerRegionController({parent:t}),t.sidePanel=new e.AnnotationLayerSidePanel({parent:t})}),this.bindEvents()},get:function(e){return this[e]},set:function(e,t,n){_this=this,this[e]=t,_this.event(e+":set").publish(t,n)},event:function(e){var t=e&&this.stateEvents[e];return t||(this.callbacks=jQuery.Callbacks(),t={publish:this.callbacks.fire,subscribe:this.callbacks.add,unsubscribe:this.callbacks.remove},e&&(this.stateEvents[e]=t)),t},getAnnotations:function(){var t=this,n=[];return t.set("annotations",[]),t.annotationUrls?(jQuery.each(t.annotationUrls,function(i,o){var r=jQuery.ajax({url:o,dataType:"json",async:!0,cache:!1,success:function(n){jQuery.each(n.resources,function(n,i){var o={region:e.parseRegion(i.on),title:null,content:i.resource.full?i.resource.full.chars:i.resource.chars,type:i.motivation.split(":")[1],id:e.genUUID()};o.osdFrame=e.getOsdFrame(o.region,t.parent.currentImg),t.annotations.push(o)}),t.computeAnnotationStats()},error:function(){console.log("Failed loading "+uri)}});n.push(r)}),jQuery.when.apply(this,n)):(t.annotations=[],jQuery.when(function(){}))},bindEvents:function(){var e=this;e.event("visible:set").subscribe(function(t){t===!1?e.hide():e.show()}),e.event("disabled:set").subscribe(function(t){t===!0?e.hide():e.show()}),e.event("selectedAnnotation:set").subscribe(function(t,n){return null===t?(e.deselect(),void 0):(e.focusSelected(t,n),void 0)}),e.event("hoveredAnnotation:set").subscribe(function(t,n){e.accentHovered(t,n)}),e.event("annotationUrls:set").subscribe(function(t){t&&console.log(t),e.changePage()}),e.event("filter:set").subscribe(function(t,n){e.filterAnnotations(t,n)})},computeAnnotationStats:function(){var e=0,t=0;jQuery.each(_this.annotations,function(n,i){"commenting"===i.type?e++:t++}),_this.commentAnnotations=e,_this.textAnnotations=t},setVisible:function(){var e=this;e.get("visible")===!1?e.set("visible",!0):e.set("visible",!1)},changePage:function(){var e=this;return null===e.annotations?(e.set("visible",!1),void 0):(e.selectedAnnotation&&e.set("selectedAnnotation",null),e.getAnnotations().done(function(){e.sidePanel.render(),e.regionController.render()}),void 0)},accentHovered:function(e,t){var n=this;"listing"===t?n.regionController.accentHovered(e):n.sidePanel.accentHovered(e)},focusSelected:function(e,t){var n=this;n.sidePanel.focusSelected(e,t),n.regionController.focusSelected(e),n.bottomPanel.focusSelected(e)},deselect:function(){var e=this;e.bottomPanel.deselect(),e.sidePanel.deselect(),e.regionController.deselect()},filterAnnotations:function(e){_this=this,filteredAnnos=jQuery.grep(_this.annotations,function(t){return t.type!==e}),filteredIds=jQuery.map(filteredAnnos,function(e){return e.id}),filteredRegions=jQuery.map(filteredIds,function(e){var t="#region_"+e;return jQuery(t)}),filteredListings=jQuery.map(filteredIds,function(e){var t="#listing_"+e;return jQuery(t)}),console.log(_this),_this.parent.element.find(".annotation").fadeIn(),_this.parent.element.find(".annotationListing").slideDown(),_this.bottomPanel.deselect(),""!==e&&(jQuery(filteredRegions).map(function(){return this.toArray()}).fadeOut(),jQuery(filteredListings).map(function(){return this.toArray()}).slideUp())},append:function(e){this.element.append(e)},show:function(){var e=this;this.parent.parent.element.find(".mirador-widget-content").css("padding-right",e.width),this.sidePanel.show(),this.regionController.show(),this.bottomPanel.show()},hide:function(){this.parent.parent.element.find(".mirador-widget-content").css("padding-right",0),this.sidePanel.hide(),this.regionController.hide(),this.bottomPanel.hide(),this.bottomPanel.hidden=!1}}}(Mirador),function(e){e.Widget=function(t){jQuery.extend(!0,this,{appendTo:"body",autoOpen:!0,containerCls:".mirador-viewer",closeOnEscape:!1,content:null,draggable:!0,element:null,height:e.DEFAULT_SETTINGS.widget.height,id:null,metadataDetails:null,openAt:null,showStatusbar:!0,showToolbar:!0,statusbar:null,toolbar:null,type:"thumbnailsView",viewObj:null,widgetCls:"mirador-widget",widgetContentCls:"mirador-widget-content",widgetStatusbarCls:"mirador-widget-statusbar",widgetToolbarCls:"mirador-widget-toolbar",width:e.DEFAULT_SETTINGS.widget.width,position:{my:"left top",at:"left+50 top+50",of:".mirador-viewer",collision:"fit",within:".mirador-viewer"},dialogOptions:{resize:function(){},resizeStop:function(){},close:function(){}},dialogExtendOptions:{maximizable:!0,collapsable:!0,icons:{maximize:"ui-icon-arrow-4-diag",collapse:"ui-icon-minus"},mainMenuHeight:e.viewer.mainMenu.element.outerHeight(!0),statusBarHeight:e.viewer.statusBar.element.outerHeight(!0)}},t),this.element=this.element||jQuery("<div/>"),this.metadataDetails=e.getMetadataByManifestId(this.manifestId).details,this.imagesList=e.getImagesListByManifestId(this.manifestId),this.create(),this.attachEvents()},e.Widget.prototype={create:function(){this.dialogExtendOptions.containerCls=this.containerCls,this.element.addClass(this.widgetCls).attr("id",this.id).attr("title",this.getTitle()).appendTo(this.appendTo).dialog(this).dialog(this.dialogOptions).dialogExtend(this.dialogExtendOptions).dialog("option","id",this.id).parent().resizable({containment:this.containerCls}).draggable({containment:this.containerCls}),this.toolbar=new e.WidgetToolbar({parent:this,showToolbar:this.showToolbar}),this.statusbar=new e.WidgetStatusBar({parent:this,showStatusbar:this.showStatusbar}),this.content=new e.WidgetContent({parent:this}),this.render()},render:function(){var t=this.type[0].toUpperCase()+this.type.substring(1,1e3);this.viewObj=new e[t]({imagesList:this.imagesList,manifestId:this.manifestId,element:this.content.element,imageId:this.imageId,openAt:this.openAt,parent:this}),this.viewObj.render()},setPosition:function(e,t){e=Math.round(e),t=Math.round(t),this.element.dialog("option","position",[e,t])},setWidth:function(e){this.element.dialog("option","width",Math.round(e))},setHeight:function(e){this.element.dialog("option","height",Math.round(e))},setSize:function(e,t){this.setWidth(Math.round(e)),this.setHeight(Math.round(t)),this.element.trigger("dialogresize"),this.element.trigger("dialogresizestop")},setPositionAndSize:function(e,t,n,i){this.setPosition(e,t),this.setSize(n,i)},getPosition:function(){return this.element.dialog("option","position")},getHeight:function(){return this.element.dialog("option","height")},getWidth:function(){return this.element.dialog("option","width")},moveToTop:function(){this.element.dialog("moveToTop")},close:function(){this.element.dialog("destroy"),this.element.remove(),e.viewer.removeWidget(this.id)},attachEvents:function(){var t=this;this.element.dialog({close:function(){t.close()},drag:function(){e.viewer.saveCurrentLayout(null)},resize:function(){e.viewer.saveCurrentLayout(null)}})},getTitle:function(){return e.getViewLabel(this.type)+" : "+e.getTitlePrefix(this.metadataDetails)}}}(Mirador),function(e){e.WidgetToolbar=function(t){jQuery.extend(!0,this,{appendTo:"body",element:null,height:e.DEFAULT_SETTINGS.widgetToolbar.height,parent:null,showToolbar:!1,toolbarCls:"mirador-widget-toolbar"},t),this.element=this.element||jQuery("<div/>"),this.create()},e.WidgetToolbar.prototype={create:function(){this.element.addClass(this.toolbarCls).height(this.height).appendTo(this.parent.element),this.hide(),this.showToolbar&&this.show()},append:function(e){this.element.append(e)},show:function(){this.element.show()},hide:function(){this.element.hide()}}}(Mirador),function(e){e.LockController=function(e){jQuery.extend(this,{translationMethod:null,lockedViews:[],lockProfile:"lazyZoom"},e)},e.LockController.prototype={LockOptions:{relativeZoom:function(e,t){e.viewport.panTo(e.viewport.getCenter()),e.viewport.zoomTo(t.leaderZoom,e.viewport.getCenter())},relativeLock:function(e,t){var n=t.leaderBounds;e.viewport.fitBounds(n)},dimensionalZoom:function(e,t){var n=e.viewport.getCenter();leaderViewportPixelWidth=t.leaderContainerWidth,followerViewportPixelWidth=e.viewport.getContainerSize().x,viewportRatio=followerViewportPixelWidth/leaderViewportPixelWidth;var i=t.leaderBounds.width*t.leaderWidth/e.width*viewportRatio,o=e.viewport.getAspectRatio()*i,r=n.x-i/2,a=n.y-o/2;console.log(o),followerTargetRect=new OpenSeadragon.Rect(r,a,i,o),console.log(followerTargetRect),console.log("updated"),e.viewport.fitBounds(followerTargetRect)},dimensionalLock:function(e,t){var n=e.viewport.getCenter();leaderViewportPixelWidth=t.leaderContainerWidth,followerViewportPixelWidth=e.viewport.getContainerSize().x,viewportRatio=followerViewportPixelWidth/leaderViewportPixelWidth;var i=t.leaderBounds.width*t.leaderWidth/e.width*viewportRatio,o=e.viewport.getAspectRatio*i,r=n.x-i/2,a=n.y-o/2;followerTargetRect=new OpenSeadragon.Rect(r,a,i,o),e.viewport.fitBounds(followerTargetRect)},lazyZoom:function(e,t){var n=e.viewport.getCenter(),i=t.leaderZoom/t.leaderOldZoom,o=e.viewport.getMaxZoom(),r=e.viewport.getMinZoom(),a=e.viewport.getZoom()*i;console.log("factor: "+i),o>=a&&a>=r?e.viewport.zoomBy(i,n):a>o?(e.viewport.zoomTo(o,n),console.log("reachedMax")):r>a&&(e.viewport.zoomTo(r,n),console.log("reachedMin"))},lazyLock:function(){}},addLockedView:function(e){lockObj={viewId:e.parent.id,rectObj:e.osd.viewport.getBounds(),zoomLevel:e.zoomLevel,width:e.width,units:e.units,viewport:e.osd.viewport},this.lockedViews.push(lockObj)},broadcast:function(e){var t=this,n=jQuery.map(t.lockedViews,function(t){return t.viewId===e?t:void 0})[0],i={leaderId:e,leaderBounds:n.viewport.getBounds(),leaderCenter:n.viewport.getCenter(),leaderOldZoom:n.zoomLevel,leaderZoom:n.viewport.getZoom(),leaderWidth:n.width,leaderContainerWidth:n.viewport.getContainerSize().x},o=jQuery.map(t.lockedViews,function(t){return t.viewId!=e?t:void 0});jQuery.each(o,function(e,n){t.LockOptions[t.lockProfile](n,i)}),n.zoomLevel=n.viewport.getZoom()},removeLockedView:function(e){for(var t=0;this.lockedViews.length>t;t++)if(this.lockedViews[t].viewId===e){this.lockedViews.splice(t,1);break}}}}(Mirador),function(e){e.Iiif={getUri:function(e){var t=e,n=/http?:\/\/stacks.stanford.edu\/image\/(\w+\/\S+)/i.exec(e);return n&&2===n.length&&(t="https://stacks.stanford.edu/image/iiif/"+encodeURIComponent(n[1])),t},getUriWithHeight:function(e,t){return e=e.replace(/\/$/,""),this.getUri(e)+"/full/,"+t+"/0/native.jpg"},prepJsonForOsd:function(e){return e.image_host=this.getImageHostUrl(e),e.scale_factors=this.packageScaleFactors(e),e.profile=e.profile.replace(/image-api\/1.\d/,"image-api"),e.tile_width||(e.tile_width=256,e.tile_height=256),e},getImageHostUrl:function(e){var t,n=[];return e.hasOwnProperty("image_host")||(e.image_host=e.tilesUrl||e["@id"]||"",e.hasOwnProperty("identifier")?(t=RegExp("/?"+e.identifier+"/?$","i"),e.image_host=e.image_host.replace(t,"")):(t=RegExp("(.*)/(.*)$"),n=t.exec(e.image_host),n.length>1&&(e.image_host=n[1],e.identifier=n[2]))),e.image_host},packageScaleFactors:function(e){var t=[];if(e.hasOwnProperty("scale_factors")&&jQuery.isArray(e.scale_factors))for(var n=0;e.scale_factors.length>n;n++)t.push(n);return t}}}(Mirador),function(e){e.ImageView=function(e){jQuery.extend(this,{currentImg:null,currentImgIndex:0,element:null,elemChoice:null,height:null,width:null,units:"mm",unitsLong:"Millimetres",imageId:null,imagesList:[],leading:!1,locked:!1,navToolbarCls:"mirador-image-view-nav-toolbar",annotationsLayer:null,openAt:null,zoomLevel:null,osd:null,osdBounds:null,osdCls:"mirador-osd",osdToolbarCls:"mirador-osd-toolbar",parent:null,scale:null,scaleCls:"mirador-image-scale",selectedChoice:"",statusbarCls:"mirador-image-view-statusbar",imageViewBgCls:"mirador-image-view-bg"},e),null!==this.imageId&&(this.currentImgIndex=this.getImageIndexById(this.imageId)),null!==this.openAt&&(this.currentImgIndex=this.getImageIndexByTitle(this.openAt)),this.parent.element.find(".mirador-widget-content").addClass(this.imageViewBgCls),this.currentImg=this.imagesList[this.currentImgIndex]},e.ImageView.prototype={render:function(){this.addToolbarNav(),this.createOpenSeadragonInstance(this.currentImg.imageUrl),this.addStatusbarNav(),this.attachWindowEvents(),this.addAnnotationsLayer()},createOpenSeadragonInstance:function(t,n){var i,o,r=e.Iiif.getUri(t)+"/info.json",a="mirador-osd-"+e.genUUID(),s=a+"-toolbar",l=this;this.element.find("."+this.osdCls).remove(),this.addOpenSeadragonToolBar(s),i=e.getJsonFromUrl(r,!1),o=jQuery("<div/>").addClass(this.osdCls).attr("id",a).appendTo(this.element),this.osd=e.OpenSeadragon({id:o.attr("id"),toolbar:s,tileSources:e.Iiif.prepJsonForOsd(i)}),this.osd.addHandler("open",function(){l.addScale(),l.attachOsdEvents(),l.zoomLevel=l.osd.viewport.getZoom(),n!==void 0&&l.osd.viewport.fitBounds(n,!0),console.log(jQuery(l.element)),e.DEFAULT_SETTINGS.imageView.osda.optionsOpenSeadragon.instance=l.osd,l.osda=new OpenSeadragonAnnotation(jQuery(l.element),e.DEFAULT_SETTINGS.imageView.osda)}),this.parent.element.dialog("option","title",this.getTitle()),this.parent.toolbar.element.find("."+this.osdToolbarCls+" button:last-child").hide(),this.renderChoices()},clearOpenSeadragonInstance:function(){this.element.find("."+this.osdCls).remove(),this.osd=null,this.renderChoices()},addOpenSeadragonToolBar:function(e){var t=jQuery("<div/>").addClass(this.osdToolbarCls).attr("id",e);this.parent.toolbar.element.find("."+this.osdToolbarCls).remove(),this.parent.toolbar.append(t)},renderChoices:function(){var t=this,n=[];this.clearChoices(),this.currentImg.choices.length>0&&(n.push({label:this.currentImg.choiceLabel,imageUrl:this.currentImg.imageUrl}),jQuery.each(this.currentImg.choices,function(e,t){n.push({label:t.choiceLabel,imageUrl:t.imageUrl})}),this.elemChoice.show(),this.selectedChoice=this.currentImg.choiceLabel,this.elemChoice.tooltipster({arrow:!0,content:e.Templates.imageView.imageChoices({choicesInfo:n}),functionReady:function(){t.addImageChoiceEvents()},interactive:!0,position:"bottom",theme:".tooltipster-mirador"}),this.addImageChoiceEvents())},addImageChoiceEvents:function(){var e=this,t=jQuery(document).find(".mirador-image-view-choices");t.find("li a").each(function(){jQuery(this).removeClass("mirador-image-view-choice-selected"),jQuery(this).data("choice")===e.selectedChoice&&jQuery(this).addClass("mirador-image-view-choice-selected")}),t.on("click","li a",function(n){var i=jQuery(n.target),o=jQuery.Deferred();e.storeCurrentOsdBounds(o),o.done(function(){"No Image"!==i.data("choice")?e.createOpenSeadragonInstance(i.data("image-url"),e.osdBounds):e.clearOpenSeadragonInstance()}),e.selectedChoice=i.data("choice"),t.find("li a").removeClass("mirador-image-view-choice-selected"),i.addClass("mirador-image-view-choice-selected")})},clearChoices:function(){""!==this.elemChoice.data("plugin_tooltipster")&&this.elemChoice.tooltipster("destroy"),this.elemChoice.hide()},storeCurrentOsdBounds:function(e){null!==this.parent.viewObj.osd&&(this.osdBounds=this.parent.viewObj.osd.viewport.getBounds()),e.resolve()},addToolbarNav:function(){this.parent.toolbar.append(e.Templates.imageView.navToolbar({navToolbarCls:this.navToolbarCls,hasAnnotations:this.currentImg.annotations})),this.elemChoice=this.parent.toolbar.element.find("."+this.navToolbarCls+" .mirador-icon-choices"),this.elemChoice.hide(),this.attachNavEvents()},addStatusbarNav:function(){this.parent.statusbar.append(e.Templates.imageView.statusbar({statusbarCls:this.statusbarCls,width:this.width,height:this.height})),this.attachStatusbarEvents()},addScale:function(){this.scale||(this.scale=new e.WidgetScale({parent:this,showScale:!0}))},addAnnotationsLayer:function(){this.annotationsLayer=new e.AnnotationsLayer({parent:this,annotationUrls:this.currentImg.annotations})},getImageIndexByTitle:function(t){var n=0;return jQuery.each(this.imagesList,function(i,o){e.trimString(o.title)===e.trimString(t)&&(n=i)}),n},getImageIndexById:function(t){var n=0;return jQuery.each(this.imagesList,function(i,o){e.trimString(o.id)===e.trimString(t)&&(n=i)}),n},getTitle:function(){var t=[];return t.push(e.getViewLabel(this.parent.type)+" : "+e.getTitlePrefix(this.parent.metadataDetails)),this.currentImg.title&&t.push(this.currentImg.title),t.join(" / ")},setHeight:function(e){this.height=e},setWidth:function(e){this.width=e},next:function(){var e,t=this.currentImgIndex+1;this.locked||this.imagesList.length>t&&(this.currentImgIndex=t,this.currentImg=this.imagesList[t],e=this.currentImg.imageUrl,this.createOpenSeadragonInstance(e),this.annotationsLayer.set("annotationUrls",this.currentImg.annotations))},prev:function(){var e=this.currentImgIndex-1;this.locked||e>=0&&(this.currentImgIndex=e,this.currentImg=this.imagesList[e],this.createOpenSeadragonInstance(this.currentImg.imageUrl),this.annotationsLayer.set("annotationUrls",this.currentImg.annotations))},attachWindowEvents:function(){var e=this;this.parent.element.on({mouseenter:function(){e.leading=!0},mouseleave:function(){e.leading=!1}}),this.parent.element.dialog({resize:function(){e.osd.viewport.ensureVisible()}}),this.parent.element.bind("dialogextendmaximize dialogextendrestore",function(){e.osd.viewport.ensureVisible()})},attachOsdEvents:function(){var e=this;this.osd.addHandler("zoom",function(){e.broadcast()}),this.osd.addHandler("pan",function(){e.broadcast()})},attachNavEvents:function(){var t=this.parent.toolbar.element.find("."+this.navToolbarCls),n=".mirador-icon-annotations",i=".mirador-icon-metadata-view",o=".mirador-icon-scroll-view",r=".mirador-icon-thumbnails-view",a=".mirador-icon-next",s=".mirador-icon-previous",l=".mirador-icon-annotator",u=this;t.on("click",s,function(){u.prev()}),t.on("click",a,function(){u.next()}),t.on("click",i,function(){e.viewer.loadView("metadataView",u.manifestId)
}),t.on("click",o,function(){e.viewer.loadView("scrollView",u.manifestId)}),t.on("click",r,function(){e.viewer.loadView("thumbnailsView",u.manifestId)}),t.on("click",n,function(){u.annotationsLayer.setVisible()}),t.on("click",l,function(){u.osda.annotator.osda._reset(),u.osda.annotator.osda.isAnnotating=!u.osda.annotator.osda.isAnnotating})},attachStatusbarEvents:function(){var e=this.parent.statusbar.element.find("."+this.statusbarCls),t=".mirador-icon-lock",n=".mirador-image-view-physical-dimensions",i=".units",o=this;e.on("click",t,function(){o.locked?o.unlock():o.lock()}),e.on("keypress paste keyup",n,function(e){o.dimensionChange(e)}),e.on("input",i,function(){o.unitChange()})},broadcast:function(){this.scale.render(),null!==this.osd&&null!==this.osd.viewport&&(this.zoomLevel=this.osd.viewport.getZoom()),this.locked===!0&&this.leading===!0&&e.viewer.lockController.broadcast(this.parent.id)},reachedExtent:function(){},lock:function(){this.locked=!0,this.parent.element.parent().addClass("locked"),e.viewer.lockController.addLockedView(this.parent.viewObj)},unlock:function(){this.locked=!1,this.parent.element.parent().removeClass("locked"),e.viewer.lockController.removeLockedView(this.parent.id)},dimensionChange:function(e){var t,n,i=/[0-9]|\./.test(String.fromCharCode(e.keyCode))&&!e.shiftKey,o=e.currentTarget.className,r=o.charAt(o.length-1),a=this.parent.viewObj.currentImg.aspectRatio;i||e.preventDefault(),13===(e.keyCode||e.which)&&e.target.blur(),"x"===r?(t=this.parent.statusbar.element.find(".x").val(),n=Math.floor(a*t),t?this.parent.statusbar.element.find(".y").val(n):this.parent.statusbar.element.find(".y").val("")):(n=this.parent.statusbar.element.find(".y").val(),t=Math.floor(n/a),n?this.parent.statusbar.element.find(".x").val(t):this.parent.statusbar.element.find(".x").val(""),this.height=n,this.width=t),unitCls=".units",this.setWidth(t),this.setHeight(n),this.scale.dimensionsProvided=t?!0:!1,this.scale.render()},unitChange:function(){}}}(Mirador),function(e){e.ScrollView=function(t){jQuery.extend(this,{element:null,imagesList:[],currentImg:null,frameCls:"scroll-view-frame",imageItemCls:"item",parent:null,imagesFrame:null,tplData:{},toolbarHeight:e.DEFAULT_SETTINGS.scrollView.toolbarHeight,imageLabelHeight:e.DEFAULT_SETTINGS.scrollView.imageLabelHeight,maxItemHeight:0,navToolbarCls:"mirador-scroll-view-nav-toolbar"},t)},e.ScrollView.prototype={render:function(){this.element.html(""),this.setProperties(),this.loadContent(),this.attachEvents()},setProperties:function(){var t=this,n=[];jQuery.each(this.imagesList,function(i,o){var r=t.parent.element.attr("id")+"-item-"+i;n[r]={},n[r].aspectRatio=(o.width/o.height).toFixed(2),n[r].infoJsonUrl=e.Iiif.getUri(o.imageUrl)+"/info.json",n[r].imageUrl=o.imageUrl}),this.imagesList.attrs=n},appendImagesFrame:function(){this.imagesFrame=jQuery(e.Templates.scrollView.imagesFrame({frameCls:this.frameCls})),this.element.append(this.imagesFrame)},generateTemplateData:function(){var e=this,t=[];return jQuery.each(this.imagesList,function(n,i){var o=e.parent.element.attr("id")+"-item-"+n;t.push({id:o,title:i.title})}),{toolbarHeight:this.toolbarHeight,images:t}},addToolbarNav:function(){this.parent.toolbar.append(e.Templates.scrollView.navToolbar({navToolbarCls:this.navToolbarCls}))},getMaxItemHeight:function(){var e=0;return e+=parseInt(this.imagesFrame.css("padding-top"),10),e+=parseInt(this.imagesFrame.css("padding-bottom"),10),this.imagesFrame.height()-e},loadContent:function(){this.appendImagesFrame(),this.addToolbarNav(),this.imagesFrame.append(e.Templates.scrollView.listImages(this.generateTemplateData())),this.setFrameAndItemsDimensions(),this.loadImagesInViewPort()},setFrameAndItemsDimensions:function(){var e=this,t="."+this.imageItemCls,n=this.getMaxItemHeight(),i=n-(this.toolbarHeight+this.imageLabelHeight);totalItemWidth=0,this.imagesFrame.find(t).each(function(t){var o=e.parent.element.attr("id")+"-item-"+t,r=Math.round(e.imagesList.attrs[o].aspectRatio*i),a=jQuery(this).find(".image-instance");jQuery(this).width(r).height(n),a.height(i),totalItemWidth+=jQuery(this).outerWidth(!0)}),this.imagesFrame.width(totalItemWidth+15)},loadImagesInViewPort:function(){var t=this,n=this.element.find("."+this.frameCls+" ."+this.imageItemCls),i=jQuery(this.element).width();jQuery(n).each(function(){var n,o,r=jQuery(this),a=r.attr("id"),s=r.find(".image-instance"),l=r.find(".static-thumb"),u=r.find(".enable-zoom"),c=t.isItemInViewport(i,r);s.find(".openseadragon-container").remove(),r.find(".toolbar form").remove(),u.unbind().show().click(function(){t.showOsdContent(a,l,u)}),l.height("100%").width("100%").show(),c&&(o=t.imagesList.attrs[a].imageUrl,n=e.Iiif.getUriWithHeight(o,jQuery(s).height()),l.attr("src",n))})},showOsdContent:function(t,n,i){var o;i.hide(),n.hide(),o=e.getJsonFromUrl(this.imagesList.attrs[t].infoJsonUrl,!1),e.OpenSeadragon({id:t+"-osd",toolbar:t+"-osd-toolbar",tileSources:e.Iiif.prepJsonForOsd(o)}),jQuery("#"+t+"-osd-toolbar button:last-child").hide()},isItemInViewport:function(e,t){var n=t.position().left+t.width();return n>0&&e>t.position().left},attachEvents:function(){this.attachWindowEvents(),this.attachNavEvents(),this.attachKeyboardScrollingEvents()},attachWindowEvents:function(){var e=this;this.parent.element.dialog({resizeStop:function(){e.setFrameAndItemsDimensions(),e.loadImagesInViewPort()}}),this.parent.element.on("dialogresizestop dialogextendmaximize dialogextendrestore",function(){e.setFrameAndItemsDimensions(),e.loadImagesInViewPort()})},attachKeyboardScrollingEvents:function(){var e=this,t=300,n=37,i=39,o=jQuery("#"+this.parent.id+" ."+this.frameCls);o.on("mouseenter",function(){o.data("hover",!0)}),o.on("mouseleave",function(){o.data("hover",!1)}),jQuery(document).on("keydown",function(r){var a,s=e.element.width();o.data("hover")&&(a=e.element.scrollLeft(),r.keyCode===n&&e.element.animate({scrollLeft:a-s},t),r.keyCode===i&&e.element.animate({scrollLeft:a+s},t))})},attachNavEvents:function(){var t=this,n=this.parent.toolbar.element.find("."+this.navToolbarCls),i=".mirador-icon-metadata-view",o=".mirador-icon-thumbnails-view";this.element.scrollStop(function(){t.loadImagesInViewPort()}),n.on("click",i,function(){e.viewer.loadView("metadataView",t.manifestId)}),n.on("click",o,function(){e.viewer.loadView("thumbnailsView",t.manifestId)})}}}(Mirador),function(e){e.MetadataView=function(t){jQuery.extend(this,{currentImg:null,element:null,parent:null,metadata:null,metadataListingCls:"metadata-listing",navToolbarCls:"mirador-metadata-view-nav-toolbar"},t),this.metadata=e.getMetadataByManifestId(this.manifestId)},e.MetadataView.prototype={render:function(){var t=this,n=["about","details","rights","links","metadata"],i={metadataListingCls:this.metadataListingCls};jQuery.each(n,function(n,o){i[o]=[],jQuery.each(t.metadata[o],function(n,r){"object"==typeof r&&(r=e.stringifyObject(r)),"string"==typeof r&&""!==r&&i[o].push({label:e.extractLabelFromAttribute(n),value:t.addLinksToUris(r)})})}),this.element.append(e.Templates.metadataView.listTerms(i)),this.addToolbarNav(),this.attachEvents()},addToolbarNav:function(){this.parent.toolbar.append(e.Templates.metadataView.navToolbar({navToolbarCls:this.navToolbarCls}))},attachEvents:function(){var t=this.parent.toolbar.element.find("."+this.navToolbarCls),n=".mirador-icon-scroll-view",i=".mirador-icon-thumbnails-view",o=this;t.on("click",n,function(){e.viewer.loadView("scrollView",o.manifestId)}),t.on("click",i,function(){e.viewer.loadView("thumbnailsView",o.manifestId)})},addLinksToUris:function(e){var t,n=/(http|ftp|https):\/\/[\w\-]+(\.[\w\-]+)+([\w.,@?\^=%&amp;:\/~+#\-]*[\w@?\^=%&amp;\/~+#\-])?/gi,i=e;return"string"==typeof e&&(t=e.match(n),t&&jQuery.each(t,function(e,t){i=i.replace(t,'<a href="'+t+'" target="_blank">'+t+"</a>")})),i}}}(Mirador),function(e){e.ThumbnailsView=function(t){jQuery.extend(this,{currentImg:null,element:null,imagesList:[],sliderCls:"thumbnails-view-slider",sliderId:"",thumbsListingCls:"",thumbsMaxHeight:e.DEFAULT_SETTINGS.thumbnailsView.thumbsMaxHeight,thumbsMinHeight:e.DEFAULT_SETTINGS.thumbnailsView.thumbsMinHeight,thumbsDefaultZoom:e.DEFAULT_SETTINGS.thumbnailsView.thumbsDefaultZoom,thumbsDefaultHeight:this.thumbsMinHeight,parent:null,navToolbarCls:"mirador-thumbnails-view-nav-toolbar"},t)},e.ThumbnailsView.prototype={render:function(){this.sliderId=this.parent.element.attr("id")+"-thumbs-slider",this.thumbsListingCls=this.parent.element.attr("id")+"-thumbs-listing",this.thumbsDefaultHeight=this.thumbsMinHeight+(this.thumbsMaxHeight-this.thumbsMinHeight)*this.thumbsDefaultZoom,this.element.html(""),this.addToolbarNav(),this.loadContent(),this.setUpSlider(),this.attachEvents()},loadContent:function(){var t=this,n={defaultHeight:this.thumbsDefaultHeight,listingCssCls:this.thumbsListingCls};n.thumbs=jQuery.map(this.imagesList,function(n){return{thumbUrl:e.Iiif.getUriWithHeight(n.imageUrl,t.thumbsMaxHeight),title:n.title,id:n.id}}),this.element.append(e.Templates.thumbnailsView.listImages(n))},addToolbarNav:function(){this.parent.toolbar.append(e.Templates.thumbnailsView.navToolbar({navToolbarCls:this.navToolbarCls}))},setUpSlider:function(){var e=jQuery("<div/>").attr("id",this.sliderId).addClass(this.sliderCls).slider({max:this.thumbsMaxHeight,min:this.thumbsMinHeight,value:this.thumbsDefaultHeight,step:1});this.parent.toolbar.append(e)},attachEvents:function(){this.attachKeyboardScrollingEvents(),this.attachNavEvents()},attachKeyboardScrollingEvents:function(){var e=this,t=300,n=38,i=40,o=this.parent.content.element;o.on("mouseenter",function(){o.data("hover",!0)}),o.on("mouseleave",function(){o.data("hover",!1)}),jQuery(document).on("keydown",function(r){var a,s=e.parent.content.element.height();o.data("hover")&&(a=e.element.scrollTop(),r.keyCode===n&&e.element.animate({scrollTop:a-s},t),r.keyCode===i&&e.element.animate({scrollTop:a+s},t))})},attachNavEvents:function(){var t="."+this.thumbsListingCls+" li img",n="."+this.thumbsListingCls+" li a",i="#"+this.sliderId,o=this.parent.toolbar.element.find("."+this.navToolbarCls),r=".mirador-icon-scroll-view",a=".mirador-icon-metadata-view",s=this;jQuery(i).on("slide",function(e,n){jQuery(t).attr("height",n.value)}),jQuery(n).on("click",function(t){var n,i=jQuery(t.target);n=i.data("image-id"),e.viewer.loadView("imageView",s.manifestId,n)}),o.on("click",a,function(){e.viewer.loadView("metadataView",s.manifestId)}),o.on("click",r,function(){e.viewer.loadView("scrollView",s.manifestId)})}}}(Mirador),function(e){e.WidgetStatusBar=function(t){jQuery.extend(!0,this,{appendTo:"body",element:null,height:e.DEFAULT_SETTINGS.widgetStatusBar.height,parent:null,showStatusbar:!1,statusbarCls:"mirador-widget-statusbar"},t),this.element=this.element||jQuery("<div/>"),this.create()},e.WidgetStatusBar.prototype={create:function(){this.element.addClass(this.statusbarCls).height(this.height).appendTo(this.parent.element),this.hide(),this.showStatusbar&&this.show()},append:function(e){this.element.append(e)},show:function(){this.element.show()},hide:function(){this.element.hide()}}}(Mirador),function(e){e.WidgetContent=function(e){jQuery.extend(!0,this,{appendTo:"body",element:null,contentCls:"mirador-widget-content",parent:null},e),this.element=this.element||jQuery("<div/>"),this.create()},e.WidgetContent.prototype={create:function(){var e=this;this.element.addClass(this.contentCls).height(e.getHeight()).appendTo(this.parent.element),this.parent.element.on("dialogresize dialogresizestop dialogextendmaximize dialogextendrestore",function(){e.updateHeight()})},updateHeight:function(){this.element.height(this.getHeight())},getHeight:function(){var e=this.parent.element.height();return e-=this.parent.toolbar.element.outerHeight(!0),e-=this.parent.statusbar.element.outerHeight(!0)},show:function(){this.element.show()},hide:function(){this.element.hide()}}}(Mirador),function(e){e.OpenSeadragon=function(e){return OpenSeadragon(jQuery.extend({preserveViewport:!0,visibilityRatio:1,minZoomLevel:0,defaultZoomLevel:0,prefixUrl:"images/openseadragon/",navImages:{zoomIn:{REST:"zoom-in.png",GROUP:"zoom-in.png",HOVER:"zoom-in-hover.png",DOWN:"zoom-in-hover.png"},zoomOut:{REST:"zoom-out.png",GROUP:"zoom-out.png",HOVER:"zoom-out-hover.png",DOWN:"zoom-out-hover.png"},home:{REST:"fit.png",GROUP:"fit.png",HOVER:"fit-hover.png",DOWN:"fit-hover.png"},fullpage:{REST:"full-screen.png",GROUP:"full-screen.png",HOVER:"full-screen-hover.png",DOWN:"full-screen-hover.png"},previous:{REST:"previous.png",GROUP:"previous.png",HOVER:"previous-hover.png",DOWN:"previous-hover.png"},next:{REST:"next.png",GROUP:"next.png",HOVER:"next-hover.png",DOWN:"next-hover.png"}}},e))}}(Mirador),function(e){e.WidgetScale=function(t){jQuery.extend(!0,this,{appendTo:"body",element:null,parent:null,height:e.DEFAULT_SETTINGS.scale.height,width:e.DEFAULT_SETTINGS.scale.maxWidth,physicalScaleWidth:null,showScale:!1,scaleCls:"mirador-image-scale",dimensionsProvided:!1,visualisation:{},controlElement:null},t),jQuery(this.parent.element).find("."+this.scaleCls).remove(),this.element=this.element||jQuery("<svg/>"),this.create()},e.WidgetScale.prototype={create:function(){var e=this;scaleDimensions=this.calculateScaleDimensions(),visPadding=10;var t=this.width+3*visPadding,n=this.height;e.controlElement=e.parent.parent.element.find(".mirador-image-dimensions");var i=this.visualisation.scale=d3.select(this.parent.element[0]).append("svg").attr("class",this.scaleCls).attr("height",n).attr("width",t),o=this.visualisation.xScaleFunction=d3.scale.linear().domain([0,d3.max(scaleDimensions)]).range([visPadding,t-2*visPadding]),r=this.visualisation.axis=d3.svg.axis().scale(o).orient("bottom").ticks(4);i.append("g").attr("class","axis x").attr("transform","translate("+visPadding+","+(n-4.5*visPadding)+")").call(r),i.append("text").attr("class","scale-units").text(e.parent.unitsLong).attr("transform","translate("+visPadding+","+(n-visPadding)+")"),this.render()},render:function(){return e.debounce(function(){var e=this,t=this.visualisation.scale,n=this.visualisation.axis,i=this.visualisation.xScaleFunction,o=this.calculateScaleDimensions();i.domain([0,d3.max(o)]),t.select(".x.axis").transition().duration(850).call(n),this.showScale&&this.dimensionsProvided?(this.visualisation.scale.attr("class",this.scaleCls),this.controlElement.removeClass("noDimensionsSet")):(this.visualisation.scale.attr("class",function(){return e.scaleCls+" hidden"}),this.controlElement.addClass("noDimensionsSet"))},50)}(),calculateScaleDimensions:function(){var e,t=this,n=null,i=t.parent.parent.element.width(),o=t.width,r=o/i;return null!==t.parent.osd&&null!==t.parent.osd.viewport&&(e=t.parent.osd.viewport.getBounds().width),physicalViewportWidth=t.parent.width*e,n=physicalViewportWidth*r,[n]},show:function(){this.element.fadeIn()},hide:function(){this.element.fadeOut()}}}(Mirador),function(e){e.SettingsLoader=function(e){var t=this;jQuery.extend(!0,this,{config:t.load()?t.load():e})},e.SettingsLoader.prototype={load:function(){return localStorage.getItem("Mirador_data")?(console.log("session restored"),JSON.parse(localStorage.getItem("Mirador_data"))):!1}}}(Mirador),function(e){e.SaveController=function(){jQuery.extend(!0,this,{saveInterval:e.DEFAULT_SETTINGS.saveController.saveInterval})},e.SaveController.prototype={buildJSON:function(){var t,n={},i={id:"viewer",data:[]};return t=function(e){var t={height:e.getHeight(),width:e.getWidth(),type:e.type,position:e.position};return"imageView"===t.type&&(t.openAt=e.openAt,t.zoomState=function(e){return{x:e.x,y:e.y,width:e.width,height:e.height}}(e.viewObj.osd.viewport.getBounds()),t.dimensions=[],t.lockedViews=[]),"thumbnailsView"===t.type,"scrollView"===t.type,t},jQuery.each(e.viewer.widgets,function(e,i){n[i.manifestId]||(n[i.manifestId]=[]),n[i.manifestId].push(t(i))}),jQuery.each(e.manifests,function(t){var o={manifestUri:e.manifests[t].uri,title:e.getTitlePrefix(e.getMetadataByManifestId(t).details)[0],widgets:[],location:e.manifests[t].location||"-"};n.hasOwnProperty(t)&&(o.widgets=n[t]),i.data.push(o)}),JSON.stringify(i)},save:function(){e.viewer&&localStorage.setItem("Mirador_data",this.buildJSON()),setTimeout(function(){e.viewer.saveController.save(),e.viewer.addStatusBarMessage("right","Workspace saved at "+new Date,1e3,!1)},e.viewer?e.viewer.saveController.saveInterval:e.DEFAULT_SETTINGS.saveController.saveInterval)}}}(Mirador),function(e){e.AnnotationBottomPanel=function(e){jQuery.extend(!0,this,{visible:!1,parent:null,hidden:!1},e),this.create()},e.AnnotationBottomPanel.prototype={create:function(){var t=this,n=null;this.element=jQuery(e.Templates.imageView.annotationDetail(n)),this.showPanelButton=jQuery(e.Templates.imageView.annotationDetailToggle()),this.annotationViewport=t.parent.parent.parent.element.find(".mirador-widget-content"),this.annotationViewport.append(t.element),this.annotationViewport.append(t.showPanelButton.hide()),t.hide(),t.bindEvents()},focusSelected:function(){this.visible=!0,this.render(),this.show()},bindEvents:function(){var e=this;this.element.find(".annotationDetailToggle").on("click",function(){e.toggleHidden()}),this.showPanelButton.find(".annotationDetailToggle").on("click",function(){e.toggleHidden()})},render:function(){var e=this,t=e.parent.selectedAnnotation,n=jQuery.grep(e.parent.annotations,function(e){return e.id===t})[0].content;e.element.find("p").fadeOut(function(){jQuery(this).text(n).fadeIn()})},deselect:function(){var e=this;e.visible=!1,e.hidden=!1,e.hide()},toggleHidden:function(){var e=this;return console.log("toggle called"),e.hidden?(e.hidden=!1,e.show(),void 0):(e.hidden=!0,e.hide(),void 0)},show:function(){var e=this;!this.hidden&&this.visible&&(e.showPanelButton.fadeOut("fast"),this.element.animate({height:"20%",opacity:1,display:"block"}))},hide:function(){var e=this;return this.element.animate({height:0,opacity:0,display:"none"}),e.hidden&&e.visible?(e.showPanelButton.fadeIn("slow"),void 0):(e.showPanelButton.fadeOut("fast"),void 0)}}}(Mirador),function(e){e.AnnotationLayerRegionController=function(e){jQuery.extend(!0,this,{visible:!0,lastSelected:null,lastHovered:null},e),this.create()},e.AnnotationLayerRegionController.prototype={create:function(){this.render(),this.hide()},append:function(e){this.element.append(e)},sortRegionsBySize:function(e,t){var n=parseInt(e.region[2],10)*parseInt(e.region[3],10),i=parseInt(t.region[2],10)*parseInt(t.region[3],10);return i-n},render:function(){var e=this,t=this.parent.get("annotations").slice().sort(this.sortRegionsBySize);e.parent.get("visible")&&(jQuery.each(t,function(t,n){var i='<div class="annotation" id="region_'+n.id+'">',o=jQuery(i)[0];e.parent.parent.osd.drawer.addOverlay(o,n.osdFrame)}),setTimeout(function(){e.bindEvents()},200))},bindEvents:function(){var e=this;jQuery(".annotation").on("click",function(t){e.clickRegion(t)}),jQuery(".annotation").on("mouseenter",function(t){e.hoverRegion(t)}),jQuery(".annotation").on("mouseleave",function(){e.leaveRegion(event)})},leaveRegion:function(){this.parent.set("hoveredAnnotation",null,"region")},clickRegion:function(e){var t=this,n=jQuery(e.target).attr("id").split("_")[1];t.parent.set("selectedAnnotation",n,"region")},hoverRegion:function(e){var t=this,n=jQuery(e.target).attr("id").split("_")[1];t.parent.set("hoveredAnnotation",n,"region")},accentHovered:function(e){var t=this;null===e&&(null===t.lastHovered||t.lastHovered.removeClass("hovered"));var n="#region_"+e,i=jQuery(n);null===t.lastHovered||t.lastHovered.removeClass("hovered"),i.hasClass("selected")||i.addClass("hovered"),t.lastHovered=i},focusSelected:function(e){var t=this,n="#region_"+e,i=jQuery(n);null===t.lastSelected||t.lastSelected.removeClass("selected"),i.removeClass("hovered"),i.addClass("selected"),t.lastSelected=i;var o=jQuery.grep(t.parent.annotations,function(t){return t.id===e})[0].osdFrame;t.parent.parent.osd.viewport.fitBounds(o)},deselect:function(){var e=this;e.lastSelected.removeClass("selected")},show:function(){this.render()},hide:function(){this.parent.annotationUrls&&this.parent.parent.osd.drawer.clearOverlays()}}}(Mirador),function(e){e.AnnotationListing=function(e){jQuery.extend(!0,this,{element:null,id:null,title:null,content:null,type:null},e),this.create()},e.AnnotationListing.prototype={create:function(){this.render()},render:function(){templateData={id:this.id,title:this.title,content:this.content},this.element=jQuery(e.Templates.imageView.annotationListing(templateData)),this.parent.listShell.append(this.element),this.bindEvents()},bindEvents:function(){var e=this;this.element.on("click",function(){e.parent.parent.set("selectedAnnotation",e.id,"listing")}),this.element.on("mouseover",function(){e.parent.parent.set("hoveredAnnotation",e.id,"listing")}),this.element.on("mouseleave",function(){e.parent.parent.set("hoveredAnnotation",null,"listing")})},show:function(){this.element.fadeIn()},hide:function(){this.element.fadeOut()}}}(Mirador),function(e){e.AnnotationLayerSidePanel=function(e){jQuery.extend(!0,this,{element:null,listShell:null,visible:!0,listings:[],lastSelected:null,lastHovered:null},e),this.create()},e.AnnotationLayerSidePanel.prototype={create:function(){var t={annotations:this.parent.get("annotations"),annotationCount:this.parent.get("annotations").length,imageAnnotationCount:this.parent.get("commentAnnotations"),textAnnotationCount:this.parent.get("textAnnotations")};this.element=jQuery(e.Templates.imageView.annotationPanel(t)),this.listShell=this.element.find(".annotationList"),this.listStats=this.element.find(".annotationPanelHeader"),this.parent.parent.element.append(this.element),this.render(),this.parent.get("visible")||this.element.hide()},bindEvents:function(){var e=this;this.annoSelector.on("change",function(){e.parent.set("filter",e.annoSelector.val())})},render:function(){var t=this;this.listings=[],this.listShell.empty();var n={annotations:this.parent.get("annotations"),annotationCount:this.parent.get("annotations").length,imageAnnotationCount:this.parent.get("commentAnnotations"),textAnnotationCount:this.parent.get("textAnnotations")};this.listStats.replaceWith(e.Templates.imageView.annotationStats(n)),this.listStats=this.element.find(".annotationPanelHeader"),this.annoSelector=this.element.find("select"),console.log(this.annoSelector),jQuery.each(this.parent.get("annotations"),function(n,i){var o=new e.AnnotationListing({id:i.id,title:i.title,content:i.content,type:i.type,parent:t});t.listings.push(o)}),this.bindEvents()},focusSelected:function(e,t){var n=this,i="#listing_"+e,o=jQuery(i);null===n.lastSelected||n.lastSelected.removeClass("selected"),o.removeClass("hovered"),o.addClass("selected"),n.lastSelected=o,"listing"!==t&&n.listShell.stop().scrollTo(o,500)},deselect:function(){var e=this;null===e.lastSelected||e.lastSelected.removeClass("selected"),e.lastSelected=null},accentHovered:function(e){var t=this;null===e&&(null===t.lastHovered||t.lastHovered.removeClass("hovered"));var n="#listing_"+e,i=jQuery(n);null===t.lastHovered||t.lastHovered.removeClass("hovered"),i.hasClass("selected")||i.addClass("hovered"),t.lastHovered=i},show:function(){this.render(),this.element.stop().show()},hide:function(){this.element.stop().hide()}}}(Mirador);